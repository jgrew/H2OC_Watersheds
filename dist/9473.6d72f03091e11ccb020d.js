(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[9473],{6687:(e,t,i)=>{var s,r;s=[i(58797),i(3718)],void 0===(r=function(e,t){"use strict";return function(){function i(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}var s=i.prototype;return s.enqueue=function(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null},s.dequeue=function(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e},s.clear=function(){for(;t.isSome(this.dequeue()););},e._createClass(i,[{key:"entries",get:function(){return this._buffer}}]),i}()}.apply(t,s))||(e.exports=r)},9192:(e,t,i)=>{var s,r;s=[t,i(58797),i(9720),i(18167),i(5360),i(16670),i(40546),i(6502),i(79140),i(88451)],void 0===(r=function(e,i,s,r,n,o,a,l,u,f){"use strict";let d=function(e){function t(t){var i;return(i=e.call(this,t)||this)._rendererInfo=new f.WGLRendererInfo,i._materialItemsRequestQueue=new n,i.attributeView=new l.AttributeStoreView,i}i._inheritsLoose(t,e);var u=t.prototype;return u.destroy=function(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()},u.setRendererInfo=function(e,t,i){this._rendererInfo.setInfo(e,t,i),this.requestRender()},u.getMaterialItems=async function(e,t){if(!e||0===e.length)return null;const i=s.createResolver();return this._materialItemsRequestQueue.push({items:e,abortOptions:t,resolver:i}),this.requestRender(),i.promise},u.onTileData=function(e,t){if(t.addOrUpdate&&"tileDisplayData"in t.addOrUpdate)e.setData(t);else{const i=t.addOrUpdate&&o.TileData.decode(t.addOrUpdate),s={...t,addOrUpdate:i};e.setData(s)}this.contains(e)||this.addChild(e),this.requestRender()},u.onTileError=function(e){e.clear(),this.contains(e)||this.addChild(e)},u.doRender=function(t){if(t.context.capabilities.textureFloat,t.context.capabilities.vao,this._materialItemsRequestQueue.length>0){let e=this._materialItemsRequestQueue.pop();for(;e;)this._processMaterialItemRequest(t,e),e=this._materialItemsRequestQueue.pop()}e.prototype.doRender.call(this,t)},u.renderChildren=function(t){for(const e of this.children)e.commitChanges(t);this._rendererInfo.update(t.state),e.prototype.renderChildren.call(this,t)},u.createTile=function(e){const t=this._tileInfoView.getTileBounds(r.create(),e);return new a.WGLTile(e,t)},u.destroyTile=function(e){this.removeChild(e),e.destroy()},u.createRenderParams=function(t){return{...e.prototype.createRenderParams.call(this,t),rendererInfo:this._rendererInfo,attributeView:this.attributeView}},u._processMaterialItemRequest=function(e,{items:t,abortOptions:i,resolver:r}){const{painter:n,pixelRatio:o}=e,a=t.map((e=>n.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,i)));s.all(a).then((e=>{if(!this.stage)return void r.reject();const i=e.map(((e,i)=>({id:t[i].id,mosaicItem:e})));r.resolve(i)}),r.reject)},t}(u.default);t.FeatureContainer=d,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},6502:(e,t,i)=>{var s,r;s=[t,i(58797),i(74637),i(3718),i(73462),i(49359),i(9720),i(39241),i(80593),i(27975),i(48188),i(98043),i(20780),i(14579)],void 0===(r=function(e,i,s,r,n,o,a,l,u,f,d,c,h,p){"use strict";const y=n.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),m=p.createDebugLogger(p.DEBUG_ATTR_UPDATES,y),_=e=>2147483647&e;let g=function(){function e(e,t,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:s,pixelType:n,textureOnly:o}=e,a=h.getPixelArrayCtor(n);this.shared=i,this.pixelType=n,this.size=t,this.textureOnly=o,o||(this.data=new a(r.unwrap(s))),this._resetRange()}var t=e.prototype;return t.destroy=function(){r.andThen(this._texture,(e=>e.dispose()));for(const e in this._fbos)r.andThen(this._fbos[e],(t=>{"0"===e&&t.detachColorTexture(),t.dispose()})),this._fbos[e]=null;this._texture=null},t.setData=function(e,t,i){const s=_(e),n=r.unwrap(this.data),o=s*this.texelSize+t;!n||o>=n.length||(n[o]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s))},t.getData=function(e,t){if(r.isNone(this.data))return null;const i=_(e)*this.texelSize+t;return!this.data||i>=this.data.length?null:this.data[i]},t.getTexture=function(e){return r.unwrapOr(this._texture,(()=>this._initTexture(e)))},t.getFBO=function(e,t=0){if(r.isNone(this._fbos[t])){const i={colorTarget:0,depthStencilTarget:0},s=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new d(e,i,s)}return this._fbos[t]},t.updateTexture=function(e){if(!this.locked)try{const t=this.dirtyStart,i=this.dirtyEnd;if(t>i)return;this._resetRange();const s=r.unwrap(this.data).buffer,n=this.getTexture(e),a=4,l=(t-t%this.size)/this.size,u=(i-i%this.size)/this.size,f=l,d=this.size,c=u,p=l*this.size*a,m=(d+c*this.size)*a-p,_=h.getPixelArrayCtor(this.pixelType),g=_.BYTES_PER_ELEMENT;try{new _(s,p*g,m)}catch(e){console.debug(e)}const x=new _(s,p*g,m),v=this.size,D=c-f+1;if(D>this.size)return void y.error(new o("mapview-webgl","Out-of-bounds index when updating AttributeData"));n.updateData(0,0,f,v,D,x)}catch(e){console.debug(e)}},t.update=function(e){const{data:t,start:i,end:s}=e;if(r.isSome(t)){const s=this.data,r=i*this.texelSize;for(let i=0;i<t.length;i++){const n=1<<i%this.texelSize;e.layout&n&&(s[r+i]=t[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,s)},t.resize=function(e,t){const i=this.size;if(this.size=t,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const s=h.getPixelArrayCtor(this.pixelType);this.destroy(),this.data=new s(r.unwrap(e.buffer))},t._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},t._initTexture=function(e){const t=new f(e,this._textureDesc,r.unwrapOr(this.data,void 0));if(r.isSome(this._lastTexture)&&this._fbos[0]){const i=this._lastTexture.descriptor.width,s=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,n=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(e),a=h.getPixelBytes(r),l=new(h.getPixelArrayCtor(r))(new ArrayBuffer(i*s*a*this.texelSize)),u=e.getBoundFramebufferObject(),{x:f,y:d,width:c,height:p}=e.getViewport();e.bindFramebuffer(o),o.readPixels(0,0,i,s,n,r,l),t.updateData(0,0,0,2*i,s/2,l),e.setViewport(f,d,c,p),e.bindFramebuffer(u)}return this.destroy(),this._texture=t,this._texture},i._createClass(e,[{key:"_textureDesc",get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}},{key:"locked",get:function(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!s("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}}]),e}(),x=function(){function e(){this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}var t=e.prototype;return t.initialize=function(e){const{blocks:t,shared:i,size:s}=e;if(this.shared=i,this.size=s,m("Initializing AttributeStoreView",e),r.isNone(this._data))this._data=r.mapMany(t,(e=>new g(e,s,i)));else for(let e=0;e<this._data.length;e++){const n=this._data[e],o=t[e];r.isSome(o)&&(r.isNone(n)?this._data[e]=new g(o,s,i):n.resize(o,s))}this._initialized=!0},t.destroy=function(){r.andThen(this._data,(e=>r.mapMany(e,(e=>e.destroy())))),r.andThen(this._defaultTexture,(e=>e.dispose()))},t.getBlock=function(e){return r.isNone(this._data)?null:this._data[e]},t.setLabelMinZoom=function(e,t){this.setData(e,0,1,t)},t.getLabelMinZoom=function(e){return this.getData(e,0,1,255)},t.getFilterFlags=function(e){return this.getData(e,0,0,0)},t.getVVSize=function(e){return this.getData(e,l.ATTRIBUTE_DATA_VV,0,0)},t.getData=function(e,t,i,s){if(!this._data)return 0;const n=r.unwrap(this._data)[t];if(r.isNone(n))return 0;const o=n.getData(e,i);return r.isSome(o)?o:s},t.setData=function(e,t,i,s){const n=r.unwrap(this._data)[t];r.unwrap(n).setData(e,i,s)},t.lockTextureUpload=function(){this._locked=!0},t.unlockTextureUpload=function(){this._locked=!1},t.forceTextureUpload=function(){this._forceNextUpload=!0},t.requestUpdate=async function(e){if(this._pendingAttributeUpdate)return void y.error(new o("mapview-webgl","Tried to update attribute data with a pending update"));const t=a.createResolver();return m("AttributeStoreView Update Requested",e),this._pendingAttributeUpdate={data:e,resolver:t},t.promise},t.update=function(){if(this._initialized&&r.isSome(this._pendingAttributeUpdate)){const{data:e,resolver:t}=this._pendingAttributeUpdate,i=r.unwrap(this._data);for(let t=0;t<e.blocks.length;t++){const s=e.blocks[t],n=i[t];r.andThen(n,(e=>r.andThen(s,(i=>{m(`Updating block ${t}`,i),e.update(i)}))))}this._pendingAttributeUpdate=null,t()}},t.bindTextures=function(e){this.update();const t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,l.TEXTURE_BINDING_ATTRIBUTE_DATA_0),e.bindTexture(t,l.TEXTURE_BINDING_ATTRIBUTE_DATA_1),e.bindTexture(t,l.TEXTURE_BINDING_ATTRIBUTE_DATA_2),void e.bindTexture(t,l.TEXTURE_BINDING_ATTRIBUTE_DATA_3);const i=r.unwrap(this._data);this._locked&&!this._forceNextUpload||(r.forEachSome(i,(t=>t.updateTexture(e))),this._forceNextUpload=!1),e.bindTexture(r.mapOr(i[0],t,(t=>t.getTexture(e))),l.TEXTURE_BINDING_ATTRIBUTE_DATA_0),e.bindTexture(r.mapOr(i[1],t,(t=>t.getTexture(e))),l.TEXTURE_BINDING_ATTRIBUTE_DATA_1),e.bindTexture(r.mapOr(i[2],t,(t=>t.getTexture(e))),l.TEXTURE_BINDING_ATTRIBUTE_DATA_2),e.bindTexture(r.mapOr(i[3],t,(t=>t.getTexture(e))),l.TEXTURE_BINDING_ATTRIBUTE_DATA_3)},t._getDefaultTexture=function(e){if(r.isNone(this._defaultTexture)){const t={wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1};this._defaultTexture=new f(e,t,new Uint8Array(4))}return this._defaultTexture},e}();t.AttributeStoreView=x,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},98881:(e,t,i)=>{var s,r;s=[i(20780)],void 0===(r=function(e){"use strict";function t(e,t,i){if(!e.allDirty)if(null!=e.from&&null!=e.count){const s=Math.min(e.from,t),r=Math.max(e.from+e.count,t+i)-s;e.from=s,e.count=r}else e.from=t,e.count=i}return function(){function i(){this._dirties=e.createGeometryData((()=>({indices:{from:null,count:null,allDirty:!1}})),(()=>({vertices:{from:null,count:null,allDirty:!1}})))}var s=i.prototype;return s.hasDirty=function(){for(const e of this._dirties)if(null!==e.data.indices.count||e.data.indices.allDirty)return!0;return!1},s.markAllClean=function(){for(const e of this._dirties){e.data.indices.from=null,e.data.indices.count=null,e.data.indices.allDirty=!1;for(const t in e.buffers)e.buffers[t].data.vertices.from=null,e.buffers[t].data.vertices.count=null,e.buffers[t].data.vertices.allDirty=!1}},s.markAllDirty=function(){for(const e of this._dirties){e.data.indices.allDirty=!0;for(const t in e.buffers)e.buffers[t].data.vertices.allDirty=!0}},s.forEach=function(e){for(let t=0;t<this._dirties.length;++t){const i=this._dirties[t],s={};for(const e in i.buffers){const t=i.buffers[e].data.vertices;(t.allDirty||null!=t.from&&null!=t.count&&t.count>0)&&(s[e]=t)}const r=i.data.indices;let n;n=r.allDirty||null!=r.from&&null!=r.count&&r.count>0?{indices:r,vertices:s}:{indices:null,vertices:s},(n.indices||Object.keys(n).length>0)&&e(n,t)}},s.markDirtyIndices=function(e,i,s){t(this._dirties[e].data.indices,i,s)},s.markDirtyVertices=function(e,i,s,r){t(this._dirties[e].buffers[i].data.vertices,s,r)},i}()}.apply(t,s))||(e.exports=r)},56173:(e,t,i)=>{var s,r;s=[i(74637),i(20780),i(8603)],void 0===(r=function(e,t,i){"use strict";const s=["FILL","LINE","MARKER","TEXT","LABEL"];return function(){function e(e,s,r,n){this._strides=e,this._displayList=s,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=r;for(const s in e){this._freeListsAndStorage[s]={vtxFreeList:n?new i.FreeList(n):null,idxFreeList:n?new i.FreeList(n):null,vertexBuffers:{},indexBuffer:n?new Uint32Array(n):null};for(const i in e[s])this._freeListsAndStorage[s].vertexBuffers[i]={data:n?t.allocateTypedArrayBuffer(n,e[s][i]):null,stride:e[s][i]}}}e.fromTileData=function(r,n){const o=function(e){const t=e.getStrides(),i={};for(let e=0;e<t.length;e++)i[s[e]]=t[e];return i}(r),a=[0,0,0,0,0],l=[0,0,0,0,0],u=r.tileDisplayData.displayObjects;for(const e of u)for(const t of e.displayRecords)a[t.geometryType]=Math.max(a[t.geometryType],t.vertexFrom+t.vertexCount),l[t.geometryType]=Math.max(l[t.geometryType],t.indexFrom+t.indexCount);const f=new e(o,r.tileDisplayData.displayList,n,null);for(let e=0;e<r.tileBufferData.geometries.length;++e){const n=a[e],o=l[e],u=r.tileBufferData.geometries[e],d=s[e],c=f._storageFor(d),h=r.tileBufferData.geometries[e].indexBuffer;let p;c.indexBuffer=h,c.idxFreeList=new i.FreeList(h.length),c.idxFreeList.allocate(o);for(const i in u.vertexBuffer){const s=r.tileBufferData.geometries[e].vertexBuffer[i];c.vertexBuffers[i].data=s.data,c.vertexBuffers[i].stride=s.stride;const n=t.strideToPackingFactor(s.stride),o=s.data.length*n/s.stride;p||(p=o)}c.vtxFreeList=new i.FreeList(p),c.vtxFreeList.allocate(n)}return f};var r=e.prototype;return r.delete=function(e){const t=s[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0},r.setMeshData=function(e,i,r,n,o){const a=s[e.geometryType];let l,u;e.meshData=null,void 0===e.vertexFrom?(u=i.vertexCount,l=this._allocateVertices(a,u)):i.vertexCount>e.vertexCount?(this._freeVertices(a,e.vertexFrom,e.vertexCount),u=i.vertexCount,l=this._allocateVertices(a,u)):i.vertexCount===e.vertexCount?(l=e.vertexFrom,u=e.vertexCount):(this._freeVertices(a,e.vertexFrom+i.vertexCount,e.vertexCount-i.vertexCount),l=e.vertexFrom,u=i.vertexCount);let f,d,c,h=!0;if(void 0===e.indexFrom?(f=o,c=i.indexCount,d=this._allocateIndices(a,c)):i.indexCount>e.indexCount?(f=this._displayList.removeFromList(e),this._freeIndices(a,e.indexFrom,e.indexCount),c=i.indexCount,d=this._allocateIndices(a,c)):i.indexCount===e.indexCount?(h=!1,d=e.indexFrom,c=e.indexCount):(f=this._displayList.removeFromList(e),this._freeIndices(a,e.indexFrom+i.indexCount,e.indexCount-i.indexCount),d=e.indexFrom,c=i.indexCount),-1!==l&&-1!==d){const s=this._storageFor(a);if(t.copyMeshData(l,d,s.vertexBuffers,s.indexBuffer,i,r,n),e.vertexFrom=l,e.indexFrom=d,e.vertexCount=i.vertexCount,e.indexCount=i.indexCount,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,e.vertexFrom,e.vertexCount)}return h&&this._displayList.addToList(e,f),!0}return-1!==l&&this._freeVertices(a,l,u),-1!==d&&this._freeIndices(a,d,c),e.setMeshDataFromBuffers(i,r,n),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1},r.tryAddMeshData=function(e,i){const r=i.vertexBuffer,n=i.indexBuffer,o=s[e.geometryType],a=this._allocateVertices(o,e.vertexCount);if(-1===a)return this._freeVertices(o,a,e.vertexCount),!1;const l=this._allocateIndices(o,e.indexCount);if(-1===l)return this._freeVertices(o,a,e.vertexCount),this._freeIndices(o,l,e.indexCount),!1;const u=this._storageFor(o);if(t.copyMeshData(a,l,u.vertexBuffers,u.indexBuffer,e,r,n),e.vertexFrom=a,e.indexFrom=l,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,a,e.vertexCount)}return this._displayList.addToList(e),!0},r._allocateVertices=function(e,t){const i=this._storageFor(e),s=i.vtxFreeList.allocate(t);return-1===s||i.vtxFreeList.fragmentation>.5?-1:s},r._freeVertices=function(e,t,i){this._storageFor(e).vtxFreeList.free(t,i)},r._freeIndices=function(e,t,i){this._storageFor(e).idxFreeList.free(t,i)},r._allocateIndices=function(e,t){const i=this._storageFor(e),s=i.idxFreeList.allocate(t);return-1===s||i.idxFreeList.fragmentation>.5?-1:s},r._storageFor=function(e){return this._freeListsAndStorage[e]},r._stridesFor=function(e,t){return this._strides[e][t]},e}()}.apply(t,s))||(e.exports=r)},84877:(e,t,i)=>{var s,r;s=[i(58797)],void 0===(r=function(e){"use strict";return function(){function t(e=400){this.duration=e,this._lastTime=0,this._elapsed=0,this._value=0,this._finished=!1}var i=t.prototype;return i.reset=function(){this._lastTime=0,this._elapsed=0,this._value=0},i.step=function(){const e=performance.now();if(0===this._lastTime)return this._lastTime=e,this._value=0,!0;if(this._elapsed>=this.duration)return!0;const t=e-this._lastTime;return this._elapsed+=t,this._lastTime=e,this._value=Math.min(this._elapsed/this.duration,1),!1},e._createClass(t,[{key:"value",get:function(){return this._value}}]),t}()}.apply(t,s))||(e.exports=r)},8603:(e,t,i)=>{var s,r;s=[t,i(58797)],void 0===(r=function(e,i){"use strict";let s=function(){function e(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}var t=e.prototype;return t.rangeCreated=function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)},t.rangeResized=function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)},t.findBestRange=function(e){let t=this._parent._freeHead,i=null;for(;null!==t;)t.count>=e&&(!i||t.count-e<i.count-e)&&(i=t),t=t.next;return i},t.findAdjacentRanges=function(e,t){let i=!0,s=!1,r=null,n=this._parent._freeHead;for(;i&&!s;){const o=null!==r?r.from+r.count:0,a=null!==n?n.from:this._parent._size;e>=o&&e+t<=a?(i=!1,s=!0):null!==n?(r=n,n=n.next):i=!1}return[r,n]},t._updateLargestRange=function(){let e=null,t=this._parent._freeHead;for(;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e},i._createClass(e,[{key:"largestRange",get:function(){return this._largestRange}}]),e}(),r=function(){function e(e,t){this._allocated=0,this._size=e,this._freeHead=e>0?{from:0,count:e,prev:null,next:null}:null,this._bookKeeper=t||new s(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}var t=e.prototype;return t.allocate=function(t){const i=this._bookKeeper.findBestRange(t);if(null===i)return-1;const s=i.from,r=i.count;if(i.from+=t,i.count-=t,this._bookKeeper.rangeResized(i,s,r),this._allocated+=t,0===i.count){const t=null!==i.prev?this._freeHead:i.next;e._removeRange(i),this._freeHead=t}return s},t.free=function(t,i){const[s,r]=this._bookKeeper.findAdjacentRanges(t,i),n={from:t,count:i,prev:s,next:r};if(null!==s&&(s.next=n),null!==r&&(r.prev=n),this._bookKeeper.rangeCreated(n),this._allocated-=i,null!==r&&n.from+n.count===r.from){const t=n.from,i=n.count;e._fuse(n,r),e._removeRange(r),this._bookKeeper.rangeResized(n,t,i),this._bookKeeper.rangeResized(r,void 0,0)}if(null!==s&&s.from+s.count===n.from){const t=s.from,i=s.count;e._fuse(s,n),e._removeRange(n),this._bookKeeper.rangeResized(s,t,i),this._bookKeeper.rangeResized(n,void 0,0)}this._freeHead=null!==n.prev?this._freeHead:n},e._removeRange=function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)},e._fuse=function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)},i._createClass(e,[{key:"fragmentation",get:function(){const e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}]),e}();t.FreeList=r,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},11719:(e,t,i)=>{var s,r;s=[i(58797)],void 0===(r=function(e){"use strict";return function(){function t(){this._byGeometryType=null}var i=t.prototype;return i.reset=function(){this._byGeometryType=null},i.verticesFor=function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0},i.indicesFor=function(e){return this._byGeometryType?this._byGeometryType[e].indices:0},i.needMore=function(e,t,i){if(!t&&!i)return;this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);const s=this._byGeometryType[e];s.vertices+=t,s.indices+=i},e._createClass(t,[{key:"satisfied",get:function(){return!this._byGeometryType}}]),t}()}.apply(t,s))||(e.exports=r)},36423:(e,t,i)=>{var s,r;s=[i(20780)],void 0===(r=function(e){"use strict";return function(){function t(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}var i=t.prototype;return i.clone=function(){const e=new t;for(let t=0;t<this.geometries.length;t++){const i=this.geometries[t],s=e.geometries[t];s.indexBuffer=i.indexBuffer.slice(),s.vertexBuffer={};for(const e in i.vertexBuffer){const{data:t,stride:r}=i.vertexBuffer[e];s.vertexBuffer[e]={data:t.slice(),stride:r}}}return e},t.deserialize=function(i){const s=new t;for(let t=0;t<5;++t){s.geometries[t].indexBuffer=new Uint32Array(i.geometries[t].indexBuffer),s.geometries[t].vertexBuffer={};for(const r in i.geometries[t].vertexBuffer)s.geometries[t].vertexBuffer[r]={data:e.allocateTypedArrayBufferwithData(i.geometries[t].vertexBuffer[r].data,i.geometries[t].vertexBuffer[r].stride),stride:i.geometries[t].vertexBuffer[r].stride}}return s},i.serialize=function(){const e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]};for(let t=0;t<5;++t)for(const i in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[i]={data:this.geometries[t].vertexBuffer[i].data.buffer,stride:this.geometries[t].vertexBuffer[i].stride};return e},i.getBuffers=function(){const e=[];for(let t=0;t<5;++t){e.push(this.geometries[t].indexBuffer.buffer);for(const i in this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[i].data.buffer)}return e},t}()}.apply(t,s))||(e.exports=r)},79140:(e,t,i)=>{var s,r;s=[t,i(58797),i(53183),i(83534),i(40910),i(98520)],void 0===(r=function(e,i,s,r,n,o){"use strict";const a=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;let l=function(e){function t(t){var i;return(i=e.call(this)||this)._tileInfoView=t,i}i._inheritsLoose(t,e);var o=t.prototype;return o.renderChildren=function(t){this.sortChildren(a),this.setStencilReference(),e.prototype.renderChildren.call(this,t)},o.createRenderParams=function(t){const{state:i}=t;return{...e.prototype.createRenderParams.call(this,t),requiredLevel:this._tileInfoView.getClosestInfoForScale(i.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(i.scale)}},o.prepareRenderPasses=function(t){const i=t.registerRenderPass({name:"stencil",brushes:[n],drawPhase:s.WGLDrawPhase.DEBUG|s.WGLDrawPhase.MAP|s.WGLDrawPhase.HIGHLIGHT,target:()=>this.getStencilTarget()}),o=t.registerRenderPass({name:"tileInfo",brushes:[r],drawPhase:s.WGLDrawPhase.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...e.prototype.prepareRenderPasses.call(this,t),i,o]},o.getStencilTarget=function(){return this.children},o.updateTransforms=function(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}},o.setStencilReference=function(){let e=1;for(const t of this.children)t.stencilRef=e++},t}(o);t.default=l,t.sortByLevel=a,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},16670:(e,t,i)=>{var s,r;s=[t,i(53183),i(20780),i(11719),i(36423),i(74125),i(62435),i(60595),i(33151),i(28862)],void 0===(r=function(e,i,s,r,n,o,a,l,u,f){"use strict";const d=new r,c=new r,h=1.5;function p(e,t){const i={};for(const r in e){const n={data:s.allocateTypedArrayBuffer(t,e[r]),stride:e[r]};i[r]=n}return i}let y=function(){function e(){this.tileDisplayData=null,this.tileBufferData=null}var t=e.prototype;return t.reshuffle=function(){d.reset();const t=a.groupRecordsByGeometryType(this.tileDisplayData.displayObjects);for(const e of t)for(const t of e)t&&d.needMore(t.geometryType,t.meshData?t.meshData.vertexCount:t.vertexCount,t.meshData?t.meshData.indexData.length:t.indexCount);const i=t.length,r=new n;for(let t=0;t<i;++t){r.geometries[t].indexBuffer=new Uint32Array(Math.round(h*d.indicesFor(t)));const i=[];for(const e in this.tileBufferData.geometries[t].vertexBuffer)i.push(this.tileBufferData.geometries[t].vertexBuffer[e].stride);const n=e._computeVertexAlignment(i),o=Math.round(h*d.verticesFor(t)),a=e._align(o,n);for(const e in this.tileBufferData.geometries[t].vertexBuffer){const i=this.tileBufferData.geometries[t].vertexBuffer[e].stride;r.geometries[t].vertexBuffer[e]={stride:i,data:s.allocateTypedArrayBuffer(a,i)}}}c.reset(),this.tileDisplayData.displayList.clear();for(let e=0;e<i;++e){const i=t[e];for(const t of i){if(t.meshData)t.writeMeshDataToBuffers(c.verticesFor(e),r.geometries[e].vertexBuffer,c.indicesFor(e),r.geometries[e].indexBuffer),t.meshData=null;else{const i=this.tileBufferData.geometries[e].vertexBuffer,n=this.tileBufferData.geometries[e].indexBuffer,o=r.geometries[e].vertexBuffer,a=r.geometries[e].indexBuffer,l=c.verticesFor(e),u=c.indicesFor(e);s.copyMeshData(l,u,o,a,t,i,n),t.vertexFrom=l,t.indexFrom=u}c.needMore(e,t.vertexCount,t.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(i)}if(this.tileDisplayData.displayList.unified)for(const e of this.tileDisplayData.displayObjects)this.tileDisplayData.displayList.addToList(e.displayRecords);this.tileBufferData=r},t.reshuffleBulkAdd=function(t,r,o){const a=t.addOrUpdate.tileDisplayData.displayObjects,l=this.tileDisplayData.displayObjects;d.reset();for(let e=0;e<l.length;e++){const t=l[e];for(let e=0;e<t.displayRecords.length;e++){const i=t.displayRecords[e];d.needMore(i.geometryType,i.vertexCount,i.indexCount)}}for(let e=r;e<a.length;e++){const t=a[e];for(let i=e===r?o:0;i<t.displayRecords.length;i++){const e=t.displayRecords[i];d.needMore(e.geometryType,e.vertexCount,e.indexCount)}}const u=new n;for(let t=0;t<5;t++){u.geometries[t].indexBuffer=new Uint32Array(Math.round(h*d.indicesFor(t)));const i=[],r=this.tileBufferData.geometries[t].vertexBuffer;for(const e in r)i.push(r[e].stride);const n=e._computeVertexAlignment(i),o=Math.round(h*d.verticesFor(t)),a=e._align(o,n);for(const e in r){const i=r[e].stride,n=s.allocateTypedArrayBuffer(a,i);u.geometries[t].vertexBuffer[e]={stride:i,data:n}}}c.reset(),this.tileDisplayData.displayList.clear();for(let e=0;e<l.length;e++){const t=l[e];for(let e=0;e<t.displayRecords.length;e++){const i=t.displayRecords[e],r=i.geometryType,n=this.tileBufferData.geometries[r].vertexBuffer,o=this.tileBufferData.geometries[r].indexBuffer,a=u.geometries[r].vertexBuffer,l=u.geometries[r].indexBuffer,f=c.verticesFor(r),d=c.indicesFor(r);s.copyMeshData(f,d,a,l,i,n,o),i.vertexFrom=f,i.indexFrom=d,c.needMore(r,i.vertexCount,i.indexCount),this.tileDisplayData.displayList.addToList(i)}}const f=this.tileDisplayData.displayObjectRegistry;if(0!==o){const e=a[r];for(let t=0;t<o;t++){const r=e.displayRecords[t];if(f.get(e.id)&&r.geometryType!==i.WGLGeometryType.FILL&&r.geometryType!==i.WGLGeometryType.LINE)continue;const n=r.geometryType,o=this.tileBufferData.geometries[n].vertexBuffer,a=this.tileBufferData.geometries[n].indexBuffer,l=u.geometries[n].vertexBuffer,d=u.geometries[n].indexBuffer,h=c.verticesFor(n),p=c.indicesFor(n);s.copyMeshData(h,p,l,d,r,o,a),r.vertexFrom=h,r.indexFrom=p,c.needMore(n,r.vertexCount,r.indexCount),this.tileDisplayData.displayList.addToList(r)}}for(let e=r;e<a.length;e++){const n=a[e],l=e===r?o:0,d=f.get(n.id);for(let e=l;e<n.displayRecords.length;e++){const r=n.displayRecords[e];if(d){if(r.geometryType!==i.WGLGeometryType.FILL&&r.geometryType!==i.WGLGeometryType.LINE)continue;d.displayRecords.push(r)}const o=r.geometryType,a=t.addOrUpdate.tileBufferData.geometries[o],l=a.vertexBuffer,f=a.indexBuffer,h=u.geometries[o].vertexBuffer,p=u.geometries[o].indexBuffer,y=c.verticesFor(o),m=c.indicesFor(o);s.copyMeshData(y,m,h,p,r,l,f),r.vertexFrom=y,r.indexFrom=m,c.needMore(o,r.vertexCount,r.indexCount),this.tileDisplayData.displayList.addToList(r)}d||(f.set(n.id,n),this.tileDisplayData.displayObjects.push(n))}this.tileBufferData=u},t.getStrides=function(){const e=[];for(let t=0;t<this.tileBufferData.geometries.length;++t){const i=this.tileBufferData.geometries[t];e[t]={};for(const s in i.vertexBuffer)e[t][s]=i.vertexBuffer[s].stride}return e},t.clone=function(){const t=new e;return t.tileBufferData=this.tileBufferData.clone(),t.tileDisplayData=this.tileDisplayData.clone(),t},t._guessSize=function(){const{displayObjects:e}=this.tileDisplayData,t=Math.min(e.length,4);let i=0;for(let s=0;s<t;s++)i=Math.max(i,e[s].displayRecords.length);return 2*(12*e.length+e.length*i*40)},t.serialize=function(){const e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),i=this.tileDisplayData.serialize(new l(Int32Array,this._guessSize())).buffer();return t.push(i),{result:{displayData:i,bufferData:e},transferList:t}},e.decode=function(t){const i=u.MeshData.deserializeDisplayObjects(t),s={};for(const e in t.vertexBuffersMap)s[e]=f.VertexBuffers.decode(t.vertexBuffersMap[e]);return e.fromMeshData({displayObjects:i,vertexBuffersMap:s})},e.fromMeshData=function(t){const i=new e,s=new a.default,r=new n;s.displayObjects=t.displayObjects;for(const e in t.vertexBuffersMap){const i=t.vertexBuffersMap[e];r.geometries[e].indexBuffer=i.indexBuffer,r.geometries[e].vertexBuffer=i.namedBuffers}return i.tileDisplayData=s,i.tileBufferData=r,i},e.bind=function(t,i){const s=new e;return s.tileDisplayData=t,s.tileBufferData=i,s},e.create=function(t,i){const s=new e;s.tileDisplayData=new a.default,s.tileDisplayData.displayObjects=t;const r=[0,0,0,0,0],l=[0,0,0,0,0],u=[[],[],[],[],[]];for(const e of t)for(const t of e.displayRecords)u[t.geometryType].push(t),r[t.geometryType]+=t.meshData.vertexCount,l[t.geometryType]+=t.meshData.indexData.length;const f=new n,d=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(i);for(let e=0;e<5;e++){const t=new Uint32Array(l[e]),i=p(d[e],r[e]);o.writeAllMeshDataToBuffers(u[e],i,t),f.geometries[e]={indexBuffer:t,vertexBuffer:i}}return s.tileBufferData=f,s},e._align=function(e,t){const i=e%t;return 0===i?e:e+(t-i)},e._computeVertexAlignment=function(e){let t=!1,i=!1;for(const s of e)s%4==2?t=!0:s%4!=0&&(i=!0);return i?4:t?2:1},e}();t.TileData=y,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},62435:(e,t,i)=>{var s,r;s=[t,i(58797),i(64818),i(29726),i(55534)],void 0===(r=function(e,i,s,r,n){"use strict";function o(e){const t=[[],[],[],[],[]],i=e;for(const e of i)for(const i of e.displayRecords)t[i.geometryType].push(i);return t}let a=function(){function e(){}var t=e.prototype;return t.computeDisplayList=function(e){if(this._displayList=new s(e),e)for(const e of this.displayObjects)for(const t of e.displayRecords)this._displayList.addToList(t);else{const e=o(this.displayObjects),t=e.length;for(let i=0;i<t;++i){const t=e[i];this._displayList.addToList(t)}}},t.clone=function(){const t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((e=>e.clone()))),t},t.serialize=function(e){return r.serializeList(e,this.displayObjects),e},t._deserializeObjects=function(e){const t=e.readInt32(),i=new Array(t),s=new Map;for(let t=0;t<i.length;++t){const r=n.deserialize(e);i[t]=r,s.set(r.id,r)}this.displayObjects=i,this._displayList=null,this._displayObjectRegistry=s},e.deserialize=function(t){const i=new e;return i._deserializeObjects(t),i},i._createClass(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const e of this.displayObjects)this._displayObjectRegistry.set(e.id,e)}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}}]),e}();t.default=a,t.groupRecordsByGeometryType=o,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},5702:(e,t,i)=>{var s,r;s=[t,i(58797),i(74637),i(12525),i(11286),i(83334),i(93681)],void 0===(r=function(e,i,s,r,n,o,a){"use strict";let l=function(e){function t(t,i,s,r=s){var a;return(a=e.call(this)||this).triangleCountReportedInDebug=0,a.transforms={dvs:o.create(),tileMat3:o.create()},a.triangleCount=0,a.key=new n(t),a.bounds=i,a.size=s,a.coordRange=r,a}i._inheritsLoose(t,e);var s=t.prototype;return s.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)},s.setTransform=function(e,t){const i=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[n,o]=e.toScreenNoRotation([0,0],this.coords),a=this.size[0]/this.coordRange[0]*i,l=this.size[1]/this.coordRange[1]*i;r.set(s,a,0,0,0,l,0,n,o,1),r.multiply(this.transforms.dvs,e.displayViewMat3,s)},i._createClass(t,[{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(e){this._coords=[e[0],e[3]],this._bounds=e}}]),t}(a.DisplayObject);t.TiledDisplayObject=l,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},26886:(e,t,i)=>{var s,r;s=[i(74637),i(3438),i(80593),i(739),i(48188),i(98043),i(20780)],void 0===(r=function(e,t,i,s,r,n,o){"use strict";return function(){function e(e){this.geometryMap=o.createGeometryData((()=>({indexBuffer:s.createIndex(e,35044),vao:null})),((t,i)=>({vertexBuffer:s.createVertex(e,o.C_VBO_INFO[i])})))}var t=e.prototype;return t.dispose=function(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose();for(const e in t.buffers)t.buffers[e]&&t.buffers[e].data.vertexBuffer.dispose()}}},t.get=function(e){const t=this.geometryMap[e],i={};for(const e in t.buffers)i[e]=t.buffers[e].data.vertexBuffer;return{indexBuffer:t.data.indexBuffer,get vao(){return t.data.vao},set vao(e){t.data.vao=e},vertexBufferMap:i}},t.has=function(e){return null!=this.geometryMap[e]},t.upload=function(e,t){t.forEach(((t,i)=>{this._upload(t,i,e)}))},t._upload=function(e,t,i){if(e.indices&&(e.indices.allDirty?this._uploadIndices(i,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(i,t,e.indices.from,e.indices.count)),e.vertices){const s=e.vertices;for(const e in s){const r=s[e];r.allDirty?this._uploadVertices(i,t,e):null!=r.from&&null!=r.count&&this._uploadVertices(i,t,e,r.from,r.count)}}},t._uploadVertices=function(e,t,i,s,r){const n=this.geometryMap[t];if(!n)return;const o=e.geometries[t].vertexBuffer[i];if(!o)return;const a=o.stride,l=o.data.buffer;n.buffers[i]&&l.byteLength>0&&(null!=s&&null!=r?n.buffers[i].data.vertexBuffer.setSubData(l,s*a,s*a,(s+r)*a):n.buffers[i].data.vertexBuffer.setData(l))},t._uploadIndices=function(e,t,i,s){const r=this.geometryMap[t];if(!r)return;const n=e.geometries[t].indexBuffer.buffer;r.data.indexBuffer&&n.byteLength>0&&(null!=i&&null!=s?r.data.indexBuffer.setSubData(n,4*i,4*i,4*(i+s)):r.data.indexBuffer.setData(n))},e}()}.apply(t,s))||(e.exports=r)},64818:(e,t,i)=>{var s,r;s=[i(58797),i(73462),i(53183)],void 0===(r=function(e,t,i){"use strict";const s=t.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");function r(e,t,i,...s){t<e.length?e.splice(t,i,...s):e.push(...s)}const n=new Map;n.set(i.WGLDrawPhase.MAP,[i.WGLGeometryType.FILL,i.WGLGeometryType.LINE,i.WGLGeometryType.MARKER,i.WGLGeometryType.TEXT]),n.set(i.WGLDrawPhase.LABEL,[i.WGLGeometryType.LABEL]),n.set(i.WGLDrawPhase.LABEL_ALPHA,[i.WGLGeometryType.LABEL]);let o=function(){function t(e=!1){this.symbolLevels=[],this.unified=e}var n=t.prototype;return n.replay=function(e,t,i){if(this.unified)for(const s of this.symbolLevels)for(const r of s.zLevels){const s=r.geometryDPInfo.unified;if(s)for(const r of s){const s=e.painter.getGeometryBrush(r.geometryType),n=t.getGeometry(r.geometryType);s.prepareState(e,t),s.drawGeometry(e,t,r,n,i)}}},n.clear=function(){this.symbolLevels.length=0},n.addToList=function(e,t){if(Array.isArray(e))for(const i of e)this._addToList(i,t);else this._addToList(e,t)},n.removeFromList=function(e){Array.isArray(e)||(e=[e]);let t=null;for(const i of e)t=this._removeFromList(i);return t},n.byType=function(e,t){for(const i of this.symbolLevels)for(const s of i.zLevels){const i=s.geometryDPInfo,r=this.getDPInfoType(e);if(i[r])for(const e of i[r])t(e)}},n.clone=function(){const e=new t(this.unified);for(const t of this.symbolLevels)e.symbolLevels.push(t.clone());return e},n.splitAfter=function(e){const t=this._getDisplayList(e.symbolLevel,e.zOrder,e.geometryType),i=t.length,s=e.indexFrom+e.indexCount;for(let r=0;r<i;++r){const i=t[r];if(i.geometryType===e.geometryType&&s>i.indexFrom&&s<=i.indexFrom+i.indexCount){if(s<i.indexFrom+i.indexCount){const e=new a;e.geometryType=i.geometryType,e.materialKey=i.materialKey,e.indexFrom=s,e.indexCount=i.indexFrom+i.indexCount-s,t.splice(r+1,0,e),i.indexCount=s-i.indexFrom}return r}}},n._addToList=function(e,t){const i=e.symbolLevel,s=e.zOrder,n=this._getDisplayList(i,s,e.geometryType),o=null!=t?t:n.length-1,l=o>=0&&o<n.length?n[o]:null;if(null===l||l.materialKey!==e.materialKey||l.indexFrom+l.indexCount!==e.indexFrom||this.unified&&l.geometryType!==e.geometryType){const t=new a;t.indexFrom=e.indexFrom,t.indexCount=e.indexCount,t.materialKey=e.materialKey,t.geometryType=e.geometryType,r(n,o+1,0,t)}else l.indexCount+=e.indexCount},n._removeFromList=function(e){const t=e.symbolLevel,i=e.zOrder,s=this._getDisplayList(t,i,e.geometryType),n=s.length;let o;for(let t=0;t<n;++t){const i=s[t];if(e.indexFrom+e.indexCount>i.indexFrom&&e.indexFrom<i.indexFrom+i.indexCount&&(!this.unified||i.geometryType===e.geometryType)){o=t;break}}if(void 0!==o){const t=s[o];if(e.indexFrom===t.indexFrom)return t.indexCount-=e.indexCount,t.indexFrom+=e.indexCount,0===t.indexCount&&r(s,o,1),o-1;if(e.indexFrom+e.indexCount===t.indexFrom+t.indexCount)return t.indexCount-=e.indexCount,0===t.indexCount?(r(s,o,1),o-1):o;{const i=t.indexFrom,n=e.indexFrom-t.indexFrom,l=e.indexCount,u=t.indexFrom+t.indexCount-(e.indexFrom+e.indexCount);t.indexCount=n;const f=new a;return f.geometryType=t.geometryType,f.materialKey=t.materialKey,f.indexFrom=i+n+l,f.indexCount=u,r(s,o+1,0,f),o}}return null},n._getDisplayList=function(e,t,s){let r;const n=this.symbolLevels.length;for(let t=0;t<n;t++)if(this.symbolLevels[t].symbolLevel===e){r=this.symbolLevels[t];break}let o;r||(r=new f,r.symbolLevel=e,this.symbolLevels.push(r));const a=r.zLevels.length;for(let e=0;e<a;e++)if(r.zLevels[e].zLevel===t){o=r.zLevels[e];break}let d;if(o||(o=new u,o.geometryDPInfo=new l,o.zLevel=t,r.zLevels.push(o)),this.unified)o.geometryDPInfo.unified||(o.geometryDPInfo.unified=[]),d=o.geometryDPInfo.unified;else switch(s){case i.WGLGeometryType.FILL:o.geometryDPInfo.fill||(o.geometryDPInfo.fill=[]),d=o.geometryDPInfo.fill;break;case i.WGLGeometryType.LINE:o.geometryDPInfo.line||(o.geometryDPInfo.line=[]),d=o.geometryDPInfo.line;break;case i.WGLGeometryType.MARKER:o.geometryDPInfo.marker||(o.geometryDPInfo.marker=[]),d=o.geometryDPInfo.marker;break;case i.WGLGeometryType.TEXT:o.geometryDPInfo.text||(o.geometryDPInfo.text=[]),d=o.geometryDPInfo.text;break;case i.WGLGeometryType.LABEL:o.geometryDPInfo.label||(o.geometryDPInfo.label=[]),d=o.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+s+"'.")}return d},n.getDPInfoType=function(e){if(this.unified)return"unified";switch(e){case i.WGLGeometryType.FILL:return"fill";case i.WGLGeometryType.LINE:return"line";case i.WGLGeometryType.MARKER:return"marker";case i.WGLGeometryType.TEXT:return"text";case i.WGLGeometryType.LABEL:return"label";default:return void s.error(`DisplayList: Tried to convert unknown geometryType: ${e}`)}},e._createClass(t,[{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}}]),t}(),a=function(){function e(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}return e.prototype.clone=function(){const t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t},e}(),l=function(){function e(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return e.prototype.clone=function(){const t=new e;return t.fill=this.fill&&this.fill.map((e=>e.clone())),t.line=this.line&&this.line.map((e=>e.clone())),t.marker=this.marker&&this.marker.map((e=>e.clone())),t.text=this.text&&this.text.map((e=>e.clone())),t.label=this.label&&this.label.map((e=>e.clone())),t.unified=this.unified&&this.unified.map((e=>e.clone())),t},e}(),u=function(){function e(){this.geometryDPInfo=new l}return e.prototype.clone=function(){const t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t},e}(),f=function(){function e(){this.zLevels=[]}return e.prototype.clone=function(){const t=new e;t.symbolLevel=this.symbolLevel;for(const e of this.zLevels)t.zLevels.push(e.clone());return t},e}();return o}.apply(t,s))||(e.exports=r)},88451:(e,t,i)=>{var s,r;s=[t,i(58797),i(3718),i(46674),i(90920),i(35477),i(13294),i(39241),i(43768),i(20780)],void 0===(r=function(e,i,s,r,n,o,a,l,u,f){"use strict";function d(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function c(e,t,i=0){if(s.isNone(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r,g:n,b:o,a}=t;e[i+0]=r*a/255,e[i+1]=n*a/255,e[i+2]=o*a/255,e[i+3]=a}let h=function(){function e(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}var t=e.prototype;return t.getSizeVVFieldStops=function(e){const t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return s.unwrapOr(t.levels[e],(()=>{let i=1/0,r=0;for(const s in t.levels){const t=parseFloat(s),n=Math.abs(e-t);n<i&&(i=n,r=t)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const n=e-r,o=Math.pow(2,n/2),a=s.unwrap(t.levels[r]),l=new Float32Array(a.values);return l[2]*=o,l[3]*=o,{sizes:s.unwrap(a.sizes),values:l}}))}},t.update=function(e){s.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)},t.setInfo=function(e,t,i){switch(s.isSome(i)&&i.forEach((e=>this._updateEffects(e))),this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}},t.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:u().supportsTextureFloat}},t.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1},t._updateEffects=function(e){s.isSome(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)},t._updateVisualVariables=function(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const s=e.size;if(s){if(i.vvSizeEnabled=!0,s.minMaxValue){const e=s.minMaxValue;let i,r;if(f.isDefined(e.minSize)&&f.isDefined(e.maxSize))if(f.isNumber(e.minSize)&&f.isNumber(e.maxSize))i=n.pt2px(e.minSize),r=n.pt2px(e.maxSize);else{const s=t.scale;i=n.pt2px(d(s,e.minSize.stops)),r=n.pt2px(d(s,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,r])}if(s.scaleStops&&(this.vvSizeScaleStopsValue=n.pt2px(d(t.scale,s.scaleStops.stops))),s.unitValue){const e=o.getMetersPerUnitForSR(t.spatialReference)/a.meterIn[s.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}s.fieldStops&&(this._vvSizeFieldStops=s.fieldStops)}const r=e.color;r&&(i.vvColorEnabled=!0,this.vvColorValues.set(r.values),this.vvColors.set(r.colors));const l=e.opacity;l&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(l.values),this.vvOpacities.set(l.opacities));const u=e.rotation;u&&(i.vvRotationEnabled=!0,i.vvRotationType=u.type)},t._updateDotDensityInfo=function(e){const t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(let e=0;e<l.DOT_DENSITY_MAX_FIELDS;e++){const i=e>=t.length?new r([0,0,0,0]):t[e].color;c(this.ddColors,i,4*e)}for(let t=0;t<8;t++)this.ddActiveDots[t]=t<e.attributes.length?1:0;c(this.ddBackgroundColor,e.backgroundColor)},i._createClass(e,[{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}}]),e}();t.WGLRendererInfo=h,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},40546:(e,t,i)=>{var s,r;s=[t,i(58797),i(74637),i(3718),i(6687),i(10709),i(39241),i(68904),i(38970),i(1422),i(5702),i(53183),i(98881),i(56173),i(84877),i(26886)],void 0===(r=function(e,i,s,r,n,o,a,l,u,f,d,c,h,p,y,m){"use strict";const _=new Set;let g=function(e){function t(t,i,s=!1){var r;return(r=e.call(this,t,i,[a.TILE_SIZE,a.TILE_SIZE])||this)._data=null,r._displayList=null,r._wglBuffers=null,r._deferPatches=!1,r._dirtyMap=new h,r._labelIndex=null,r._lastCommitTime=0,r._patchQueue=new n(100),r.fader=new y,r._dirty=!0,r._replaceBuffers=!1,r._uploadsLocked=!1,r._hasData=!1,r._invalidated=!1,r.transforms.labelMat2d=u.create(),r._ensureCorrectZOrder=s,r._deferPatches=!s,r}i._inheritsLoose(t,e);var s=t.prototype;return s.destroy=function(){e.prototype.destroy.call(this),this.clear()},s.getGeometry=function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null},s.getDisplayList=function(){return this._displayList},s.setTransform=function(t,i){e.prototype.setTransform.call(this,t,i);const s=this.transforms.labelMat2d,r=t.getScreenTransform(s,i),n=f.create();o.transformMat2d(n,this.coords,r),l.identity(s),l.translate(s,s,n),l.multiply(s,t.viewMat2d,s)},s.setData=function(e){const t=e.addOrUpdate,i=e.remove;e.clear&&(this.clear(),this._patchQueue.clear(),this._hasData=!1),"replace"===e.type&&(this._replaceBuffers=!0,this._patchQueue.clear(),this._data=null),!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new h,this._dispRecStore=p.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||i.length)?this._deferPatches?this._patchQueue.enqueue(e):this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")},s.lockUploads=function(){this._uploadsLocked=!0},s.unlockUploads=function(){this._uploadsLocked=!1,this.requestRender()},s.commitChanges=function(e){if(!e.time||e.time!==this._lastCommitTime){if(this._lastCommitTime=e.time,this.fader.step()||this.requestRender(),this._patchQueue.size){const e=this._patchQueue.dequeue();r.isSome(e)&&(e.end&&this.ready(),this._doPatchData(e),this.requestRender(),this._hasData=!0)}if(this._uploadsLocked)this.requestRender();else if(this.visible&&this._data){if(this._replaceBuffers)for(this._wglBuffers&&this._wglBuffers.dispose(),this._wglBuffers=null,this._replaceBuffers=!1;this._patchQueue.size;){const e=this._patchQueue.dequeue();r.isSome(e)&&(e.end&&this.ready(),this._doPatchData(e),this._hasData=!0)}this._wglBuffers||(this._wglBuffers=new m(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._rebuildLabelIndex(),this._dirtyMap.markAllClean())}}},s.clear=function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)},s._doPatchData=function(e){try{if("new"===e.type){if(!e.addOrUpdate)return;this._invalidated=!0;const t=this._bulkAddFeatures(e);t&&(this._dirtyMap.markAllDirty(),this._data.reshuffleBulkAdd(e,t.objectIndex,t.recordIndex),this._dispRecStore=p.fromTileData(this._data,this._dirtyMap))}else this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=p.fromTileData(this._data,this._dirtyMap))}catch(e){}this.requestRender()},s._rebuildLabelIndex=function(){var e,t;if(null!=(e=this._data)&&null!=(t=e.tileBufferData.geometries[c.WGLGeometryType.LABEL])&&t.indexBuffer.length){this.isDirty=!0,this._labelIndex=this._initLabelIndex();for(const e of this.displayObjects)for(const t of e.metrics)this._insertIntoLabelIndex(t)}},s._insertIntoLabelIndex=function(e){e.xBucket<0||e.yBucket<0||e.yBucket>3||e.xBucket>3||this.labelIndex[e.yBucket][e.xBucket].push(e)},s._initLabelIndex=function(){const e=[];for(let t=0;t<a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;t++){e.push([]);for(let i=0;i<a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;i++)e[t].push([])}return e},s._bulkAddFeatures=function(e){const t=e.addOrUpdate.tileDisplayData.displayObjects,i=this._data.tileDisplayData.displayObjects,s=this._data.tileDisplayData.displayObjectRegistry;for(let r=0;r<t.length;r++){const n=t[r],o=s.get(n.id);for(let t=0;t<n.displayRecords.length;++t){const i=n.displayRecords[t];if(o){if(i.geometryType!==c.WGLGeometryType.FILL&&i.geometryType!==c.WGLGeometryType.LINE)continue;o.displayRecords.push(i)}const s=e.addOrUpdate.tileBufferData.geometries[i.geometryType];if(!this._dispRecStore.tryAddMeshData(i,s))return{objectIndex:r,recordIndex:t}}o||(s.set(n.id,n),i.push(n))}return null},s._patchData=function(e){let t=!0;const i=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],s=(e.remove||[]).slice();for(const e of i)null!=e.insertAfter&&s.push(e.id);for(const e of s){const t=this._data.tileDisplayData.displayObjectRegistry.get(e);if(t){this._data.tileDisplayData.displayList.removeFromList(t.displayRecords);for(const e of t.displayRecords)this._dispRecStore.delete(e);this._data.tileDisplayData.displayObjectRegistry.delete(e);const i=this._data.tileDisplayData.displayObjects.indexOf(t);this._data.tileDisplayData.displayObjects.splice(i,1)}}for(const s of i){let i,r=this._data.tileDisplayData.displayObjectRegistry.get(s.id);if(r){const e=r.displayRecords;r.set(s),r.displayRecords=e;const t=r.displayRecords.length;for(let e=0;e<t;++e){const t=r.displayRecords[e],i=s.displayRecords[e];(e>=s.displayRecords.length||t.geometryType!==i.geometryType||t.symbolLevel!==i.symbolLevel||t.zOrder!==i.zOrder||t.materialKey!==i.materialKey)&&(this._dispRecStore.delete(r.displayRecords[e]),e<s.displayRecords.length&&(r.displayRecords[e]=void 0))}r.displayRecords.length=s.displayRecords.length,r.metrics=s.metrics}else{let e;r=s.copy(),r.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(s.id,r);const t=this._data.tileDisplayData.displayObjects;if(null!=r.insertAfter)if(i={},r.insertAfter>=0){const i=this._data.tileDisplayData.displayObjectRegistry.get(r.insertAfter);i?(e=t.indexOf(i)+1,e<t.length?t.splice(e,0,r):(t.push(r),e=t.length)):(t.push(r),e=t.length)}else t.unshift(r),e=0;else t.push(r),e=t.length;if(i){let r;if(this._data.tileDisplayData.displayList.unified)r=s.displayRecords.length>0?1:0;else{_.clear();for(const e of s.displayRecords){const t=this._data.tileDisplayData.displayList.getDPInfoType(e.geometryType);_.add(t)}r=_.size}let n=0;for(let s=e-1;s>=0&&n<r;--s)for(let e=t[s].displayRecords.length-1;e>=0&&n<r;--e){const r=t[s].displayRecords[e],o=this._data.tileDisplayData.displayList.getDPInfoType(r.geometryType);i[o]||(i[o]=r,++n)}}}const n=s.displayRecords.length;for(let o=0;o<n;++o){const n=s.displayRecords[o];let a=r.displayRecords[o];a?(a.meshData=n.meshData,a.materialKey=n.materialKey):(a=n.copy(),a.vertexFrom=void 0,a.indexFrom=void 0,r.displayRecords[o]=a);const l=n.geometryType,u=this._data.tileDisplayData.displayList.getDPInfoType(l),f=e.addOrUpdate.tileBufferData.geometries[l],d=f.vertexBuffer,c=f.indexBuffer;let h;i&&(h=i[u]?this._data.tileDisplayData.displayList.splitAfter(i[u]):-1),t=this._dispRecStore.setMeshData(a,n,d,c,h)&&t,i&&null!=a.indexFrom&&null!=a.indexFrom&&(i[u]=a)}}return t},i._createClass(t,[{key:"displayObjects",get:function(){var e;return null!=(e=this._displayObjects)?e:[]}},{key:"isDirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.requestRender()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"labelIndex",get:function(){return this._labelIndex}}]),t}(d.TiledDisplayObject);t.WGLTile=g,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)},14579:(e,t)=>{var i;void 0===(i=function(e){"use strict";t.DEBUG_ATTR_UPDATES=!1,t.createDebugLogger=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=i)},68305:(e,t,i)=>{var s,r;s=[t,i(3718),i(90920),i(39241),i(53183),i(31581),i(36494)],void 0===(r=function(e,i,s,r,n,o,a){"use strict";function l(e){return{value:e.value,size:s.toPt(e.size)}}function u(e){return e.map((e=>l(e)))}function f(e){if("string"==typeof e||"number"==typeof e)return s.toPt(e);const t=e;return{type:"size",expression:t.expression,stops:u(t.stops)}}const d=e=>{const t=[],i=[],n=u(e),o=n.length;for(let e=0;e<6;e++){const a=n[Math.min(e,o-1)];t.push(a.value),i.push(null==a.size?r.NAN_MAGIC_NUMBER:s.pt2px(a.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}};function c(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const i=e.stops;for(let e=0;e<8;++e){const s=i[Math.min(e,i.length-1)];t.values[e]=s.value,t.opacities[e]=s.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=i}}return t}function h(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function p(e){if(i.isNone(e))return null;if(e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const i=e.stops;for(let e=0;e<8;++e){const s=i[Math.min(e,i.length-1)];t.values[e]=s.value,h(t.colors,e,s.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)t.values[e]=1/0,h(t.colors,e,i)}}for(let e=0;e<32;e+=4)o.premultiplyAlpha(t.colors,e,!0);return t}t.convertColorVariable=p,t.convertVisualVariables=function(e){const t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(const s of e)if(s.field&&(t[s.type]=s.field),"size"===s.type){i.size||(i.size={});const e=s;switch(a.getTypeOfSizeVisualVariable(e)){case n.WGLVVFlag.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:f(e.minSize),maxSize:f(e.maxSize)};break;case n.WGLVVFlag.SIZE_SCALE_STOPS:i.size.scaleStops={stops:u(e.stops)};break;case n.WGLVVFlag.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const i in e.levels)t[i]=d(e.levels[i]);i.size.fieldStops={type:"level-dependent",levels:t}}else i.size.fieldStops={type:"static",...d(e.stops)};break;case n.WGLVVFlag.SIZE_UNIT_VALUE:i.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===s.type)i.color=p(s);else if("opacity"===s.type)i.opacity=c(s);else if("rotation"===s.type){const e=s;i.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:i}},t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.getVisualVariablesFields=function(e){const t=e&&e.length>0?{}:null;return t&&e.forEach((e=>{const i=e.type;e.field&&(t[i]=e.field)})),t},t.normalizeSizeElement=f,t.normalizeSizeStops=u,t.stopToSizeStop=l,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,s))||(e.exports=r)}}]);