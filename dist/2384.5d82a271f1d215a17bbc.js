(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[2384],{42384:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(86928),i(12187),i(59376),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(88710),i(95791),i(64393),i(8336),i(23704),i(9377),i(62631),i(87842),i(52058),i(40162),i(93511),i(65131),i(26924),i(99192)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b,I,S,T,R,M,C,k){"use strict";const P=s.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"});function O(){return{enabled:!this.loaded||"RasterTileServer"===this.raster.datasetFormat&&"Raster"===this.raster.tileType}}let F=function(t){function i(...e){var i;return(i=t.call(this,...e)||this).bandIds=null,i.interpolation=null,i.legendEnabled=!0,i.isReference=null,i.listMode="show",i.sourceJSON=null,i.version=null,i.title=null,i.type="imagery-tile",i.operationalLayerType="ArcGISTiledImageServiceLayer",i.popupEnabled=!0,i.popupTemplate=null,i}e._inheritsLoose(i,t);var n=i.prototype;return n.normalizeCtorArgs=function(e,t){return"string"==typeof e?{url:e,...t}:e},n.load=function(e){const t=r.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((()=>this._openRaster(t)),(()=>this._openRaster(t)))),m.resolve(this)},n.readRenderer=function(e,t,i){const r=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,n=_.read(r,i)||void 0;if(null!=n)return n},n.createPopupTemplate=function(e){return M.createPopupTemplate(this,e)},n.write=function(e,i){const{raster:r}=this;if(this.loaded?"RasterTileServer"===r.datasetFormat&&("Raster"===r.tileType||"Map"===r.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return t.prototype.write.call(this,e,i);if(i&&i.messages){const e=`${i.origin}/${i.layerContainerType||"operational-layers"}`;i.messages.push(new f("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this}))}return null},n._openRaster=async function(e){this.raster?(this.raster.rasterInfo||await this.raster.open(),this.url=this.raster.url):this.raster=await k.open({url:this.url,sourceJSON:this.sourceJSON,ioConfig:this.ioConfig,signal:e});const{rasterInfo:t}=this.raster;if(!t)throw new f("imagery-tile-layer:load","cannot load resources on "+this.url);this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText)),null==this.title&&(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings()},e._createClass(i,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"fields",get:function(){var e,t;let i=[new b({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})];const r=null==(e=this.rasterInfo)||null==(t=e.attributeTable)?void 0:t.fields;if(r){const e=r.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name="Raster."+e.name,t}));i=i.concat(e)}return i}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}}]),i}(I.BlendLayer(R.ScaleRangeLayer(T.RefreshableLayer(w.OperationalLayer(S.PortalLayer(C.ImageryTileMixin(x.MultiOriginJSONMixin(g))))))));return t.__decorate([o.property()],F.prototype,"ioConfig",void 0),t.__decorate([o.property({type:[a.Integer],json:{write:{overridePolicy:O}}})],F.prototype,"bandIds",void 0),t.__decorate([o.property({json:{write:{overridePolicy:O}}}),l.enumeration(P)],F.prototype,"interpolation",void 0),t.__decorate([o.property({json:{write:!0}})],F.prototype,"multidimensionalDefinition",void 0),t.__decorate([o.property(v.legendEnabled)],F.prototype,"legendEnabled",void 0),t.__decorate([o.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],F.prototype,"isReference",void 0),t.__decorate([o.property({type:["show","hide"]})],F.prototype,"listMode",void 0),t.__decorate([o.property()],F.prototype,"sourceJSON",void 0),t.__decorate([o.property({readOnly:!0})],F.prototype,"version",void 0),t.__decorate([o.property()],F.prototype,"title",void 0),t.__decorate([o.property({readOnly:!0,json:{read:!1}})],F.prototype,"type",void 0),t.__decorate([o.property({type:["ArcGISTiledImageServiceLayer"]})],F.prototype,"operationalLayerType",void 0),t.__decorate([o.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy:O,writer(e,t,i){t[i]=!e}}}})],F.prototype,"popupEnabled",void 0),t.__decorate([o.property({type:y,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:O}}})],F.prototype,"popupTemplate",void 0),t.__decorate([o.property({readOnly:!0,dependsOn:["title"]})],F.prototype,"defaultPopupTemplate",null),t.__decorate([o.property({readOnly:!0,type:[b],dependsOn:["rasterInfo"]})],F.prototype,"fields",null),t.__decorate([o.property({types:_.rasterRendererTypes,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:O},origins:{"web-scene":{types:_.websceneRasterRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:e=>({enabled:e&&"vector-field"!==e.type})}}}}})],F.prototype,"renderer",null),t.__decorate([c.reader("renderer")],F.prototype,"readRenderer",null),F=t.__decorate([u.subclass("esri.layers.ImageryTileLayer")],F),F}.apply(t,r))||(e.exports=n)},26924:(e,t,i)=>{var r,n;r=[t,i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(94718),i(99752),i(4037),i(51916),i(18377),i(56750),i(23084),i(12997),i(26016),i(40810),i(30106),i(8336),i(9377),i(72146),i(77098),i(97057),i(54181),i(16169)],void 0===(n=function(e,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b,I,S,T,R){"use strict";const M=o.getLogger("esri.layers.mixins.ImageryTileMixin");t.ImageryTileMixin=e=>{let t=function(e){function t(){var t;return(t=e.apply(this,arguments)||this)._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},t.bandIds=null,t.copyright=null,t.fullExtent=null,t.interpolation="nearest",t.raster=null,t.rasterInfo=null,t.sourceJSON=null,t.spatialReference=null,t.tileInfo=null,t.symbolizer=null,t}i._inheritsLoose(t,e);var r=t.prototype;return r.updateRenderer=async function(){if(!this.loaded)return;if(JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer))return;const e=this._rasterJobHandler.instance;e&&(this.symbolizer.rendererJSON=this.renderer.toJSON(),this.symbolizer.bind(),await e.updateSymbolizer(this.symbolizer),this._cachedRendererJson=this.renderer.toJSON())},r.applyRenderer=async function(e,t){const i=e&&e.pixelBlock;if(!(i&&i.pixels&&i.pixels.length>0))return null;let r;this.updateRenderer();const n=this._rasterJobHandler.instance,{bandIds:a}=this;return r=n?await n.symbolize({...e,simpleStretchParams:t,bandIds:a}):this.symbolizer.symbolize({...e,simpleStretchParams:t,bandIds:a}),r},r.getTileUrl=function(e,t,i){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${e}/${t}/${i}`:""},r.getCompatibleTileInfo=function(e,t){if(!this.loaded)return null;const i=d.getInfo(e);return b.create({size:256,spatialReference:e,origin:i?{x:i.origin[0],y:i.origin[1]}:{x:t.xmin,y:t.ymax}})},r.getCompatibleFullExtent=function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null},r.fetchTile=async function(e,t,i,r={}){if(r.requestAsImageElement){const n=this.getTileUrl(e,t,i);return x(n,{responseType:"image",query:{sliceId:this._sliceId,_ts:r.timestamp},signal:r.signal}).then((e=>e.data))}if(await this._initJobHandler(),this.multidimensionalDefinition){const e=this._sliceId;r={multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e,...r}}return"raster-shaded-relief"===this.renderer.type&&(r={buffer:{cols:1,rows:1},...r}),this.raster.fetchTile(e,t,i,r)},r.fetchPixels=async function(e,t,i,r){if(await this._initJobHandler(),this.multidimensionalDefinition){const e=this._sliceId;r={multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e,...r}}return this.raster.fetchPixels(e,t,i,r)},r.identify=function(e,t={}){return this.multidimensionalDefinition&&!t.multidimensionalDefinition&&(t={...t,multidimensionalDefinition:this.multidimensionalDefinition}),this.raster.identify(e,t)},r.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},r.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},r._configDefaultSettings=function(){this._configDefaultInterpolation(),this._configDefaultSlice(),this._configDefaultRenderer()},r._initJobHandler=function(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const e=new S;return this._rasterJobHandler.connectionPromise=e.initialize().then((()=>{this._rasterJobHandler.instance=e,this.raster.rasterJobHandler=e,this.renderer&&this.updateRenderer()})).catch((()=>null)),this._rasterJobHandler.connectionPromise},r._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},r._configDefaultInterpolation=function(){if(null==this.interpolation){var e;const t=T.getDefaultInterpolation(this.rasterInfo,this.raster.tileType,null==(e=this.sourceJSON)?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}},r._configDefaultSlice=function(){const{multidimensionalInfo:e}=this.raster.rasterInfo;if(a.isSome(e)){if(!this.multidimensionalDefinition){const t=e.variables[0],i=[];t.dimensions.forEach((e=>{i.push(new I({variableName:t.name,dimensionName:e.name,values:e.hasRegularIntervals?e.extent[0]:e.values[0],isSlice:!0}))})),this.multidimensionalDefinition=i}this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)}},r._configDefaultRenderer=function(){const e=this.raster.rasterInfo;var t;this.bandIds||(this.bandIds=T.getDefaultBandCombination(e)),this.renderer||(this.renderer=T.createDefaultRenderer(e,{bandIds:this.bandIds,variableName:null==(t=this.multidimensionalDefinition)?void 0:t[0].variableName})),this.symbolizer?(this.symbolizer.rendererJSON=this.renderer.toJSON(),this.symbolizer.rasterInfo=e):this.symbolizer=new R({rendererJSON:this.renderer.toJSON(),rasterInfo:e}),this.symbolizer.bind()||M.warn("imagery-tile-mixin","The given renderer is not supported by the layer.")},i._createClass(t,[{key:"multidimensionalDefinition",set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)}},{key:"url",set:function(e){this._set("url",v.sanitizeUrl(e,M))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}}]),t}(e);return r.__decorate([l.property()],t.prototype,"_cachedRendererJson",void 0),r.__decorate([l.property()],t.prototype,"_sliceId",void 0),r.__decorate([l.property()],t.prototype,"_compatibleFullExtent",void 0),r.__decorate([l.property()],t.prototype,"_rasterJobHandler",void 0),r.__decorate([l.property()],t.prototype,"bandIds",void 0),r.__decorate([l.property()],t.prototype,"copyright",void 0),r.__decorate([l.property({type:y}),c.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),r.__decorate([l.property()],t.prototype,"interpolation",void 0),r.__decorate([l.property({type:[I]})],t.prototype,"multidimensionalDefinition",null),r.__decorate([l.property()],t.prototype,"raster",void 0),r.__decorate([l.property({readOnly:!0}),c.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),r.__decorate([l.property()],t.prototype,"sourceJSON",void 0),r.__decorate([l.property({type:m}),c.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),r.__decorate([l.property({type:b,dependsOn:["rasterInfo"]}),c.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),r.__decorate([l.property(w.url)],t.prototype,"url",null),r.__decorate([l.property({types:_.rasterRendererTypes})],t.prototype,"renderer",null),r.__decorate([l.property()],t.prototype,"symbolizer",void 0),t=r.__decorate([u.subclass("esri.layers.ImageryTileMixin")],t),t},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},62663:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(56162),i(35558)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f){"use strict";let p=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).blockWidth=void 0,e.blockHeight=void 0,e.compression=null,e.origin=null,e.firstPyramidLevel=null,e.maximumPyramidLevel=null,e.pyramidScalingFactor=2,e.pyramidBlockWidth=null,e.pyramidBlockHeight=null,e.isVirtualTileInfo=!1,e.tileInfo=null,e.blockBoundary=null,e}return e._inheritsLoose(i,t),i}(u.JSONSupport);return t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"blockWidth",void 0),t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"blockHeight",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],p.prototype,"compression",void 0),t.__decorate([a.property({type:f,json:{write:!0}})],p.prototype,"origin",void 0),t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"firstPyramidLevel",void 0),t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"maximumPyramidLevel",void 0),t.__decorate([a.property()],p.prototype,"pyramidScalingFactor",void 0),t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"pyramidBlockWidth",void 0),t.__decorate([a.property({type:Number,json:{write:!0}})],p.prototype,"pyramidBlockHeight",void 0),t.__decorate([a.property({type:Boolean,json:{write:!0}})],p.prototype,"isVirtualTileInfo",void 0),t.__decorate([a.property({json:{write:!0}})],p.prototype,"tileInfo",void 0),t.__decorate([a.property()],p.prototype,"blockBoundary",void 0),p=t.__decorate([o.subclass("esri.layers.support.RasterStorageInfo")],p),p}.apply(t,r))||(e.exports=n)},24048:(e,t,i)=>{var r,n;r=[t,i(92231),i(49359),i(45630),i(40810)],void 0===(n=function(e,i,r,n,a){"use strict";let o=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}var t=e.prototype;return t.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,n=i>>3,a=this._tileAvailabilityBitSet;return n<0||n>a.length?"unknown":a[n]&1<<r?"available":"unavailable"},t._updateFromData=function(e){const t=this.location.width,i=this.location.height;let r=!0,n=!0;const a=Math.ceil(t*i/8),o=new Uint8Array(a);let s=0;for(let t=0;t<e.length;t++){const i=t%8;e[t]?(n=!1,o[s]|=1<<i):r=!1,7===i&&++s}n?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=o,this.byteSize+=o.length)},e.fromDefinition=function(t,i){const o=t.service.request||a,{row:l,col:c,width:u,height:f}=t,p={query:{f:"json"}};return i=i?{...p,...i}:p,o(s(t),i).then((e=>e.data)).catch((e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:l,left:c,width:u,height:f},valid:!0,data:n.constant(u*f,0)};throw e})).then((t=>{if(t.location&&(t.location.top!==l||t.location.left!==c||t.location.width!==u||t.location.height!==f))throw new r("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:l,left:c,width:u,height:f}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);const r=new e;return r.location=Object.freeze(i.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new r("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new r("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new r("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new r("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new r("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function s(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}t.Tilemap=o,t.default=o,t.tilemapDefinitionId=function(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`},t.tilemapDefinitionUrl=s,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},83568:(e,t,i)=>{var r,n;r=[t,i(58797),i(11285),i(74637),i(73462),i(26475),i(37055),i(99752),i(49359),i(4037),i(51916),i(18377),i(20499),i(9720),i(48199),i(37862),i(40810),i(75416),i(69788),i(79058),i(24048)],void 0===(n=function(e,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_){"use strict";var b;const I=a.getLogger("esri.layers.support.TilemapCache");t.TilemapCache=b=function(e){function t(t){var i;return(i=e.call(this,t)||this)._handles=new x,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=g,i._prefetchingEnabled=!0,i}i._inheritsLoose(t,e);var r=t.prototype;return r.initialize=function(){this._tilemapCache=new w(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(()=>this._initializeTilemapDefinition())),v.init(this,"layer.tileInfo.lods",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()},r.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},r.castLevels=function(e){return e<=2?(I.error("Minimum levels for Tilemap is 3, but got ",e),3):e},r.fetchTilemap=function(e,t,i,r){if(!this._availableLevels[e])return d.reject(new c("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,n);if(a)return d.resolve(a);const o=r&&r.signal;return r={...r,signal:null},d.create(((e,t)=>{d.onAbort(o,(()=>t(d.createAbortError())));const i=_.tilemapDefinitionId(n);let a=this._pendingTilemapRequests[i];if(!a){a=_.Tilemap.fromDefinition(n,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=a,a.then(e,e)}a.then(e,t)}))},r.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},r.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;for(n.updateTileInfo(r);;){const e=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==e)return e;if(!n.upsampleTile(r))return"unavailable"}},r.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof _.Tilemap){const n=r.getAvailability(t,i);return"unavailable"===n?d.reject(new c("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}if(d.isAbortError(r))throw r;return"unknown"})):d.reject(new c("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))},r.fetchAvailabilityUpsample=function(e,t,i,r,n){r.level=e,r.row=t,r.col=i;const a=this.layer.tileInfo;a.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,n).catch((e=>{if(d.isAbortError(e))throw e;if(a.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,n,o),o},r._fetchAvailabilityUpsamplePrefetch=async function(e,t,i,r,n,a){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this._handles.has(o))return;const s=d.createAbortController();a.then((()=>s.abort()),(()=>s.abort()));let l=!1;const c={remove(){l||(l=!0,s.abort())}};if(this._handles.add(c,o),await m.waitTicks(10,s.signal).catch((()=>{})),l||(l=!0,this._handles.remove(o)),d.isAborted(s))return;const u={id:e,level:t,row:i,col:r},f={...n,signal:s.signal},p=this.layer.tileInfo;for(let e=0;b._prefetches.length<b._maxPrefetch&&p.upsampleTile(u);++e){const e=this.fetchAvailability(u.level,u.row,u.col,f);b._prefetches.push(e);const t=()=>{b._prefetches.removeUnordered(e)};e.then(t,t)}},r._initializeTilemapDefinition=function(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?u.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}},r._tilemapFromCache=function(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const n=_.tilemapDefinitionId(r);return this._tilemapCache.get(n)},r._initializeAvailableLevels=function(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))},i._createClass(t,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}}]),t}(y),t.TilemapCache._maxPrefetch=4,t.TilemapCache._prefetches=new h({initialSize:b._maxPrefetch}),r.__decorate([o.property({constructOnly:!0,type:Number})],e.TilemapCache.prototype,"levels",void 0),r.__decorate([s.cast("levels")],e.TilemapCache.prototype,"castLevels",null),r.__decorate([o.property({readOnly:!0,dependsOn:["levels"],type:Number})],e.TilemapCache.prototype,"size",null),r.__decorate([o.property({constructOnly:!0,type:Number})],e.TilemapCache.prototype,"cacheByteSize",void 0),r.__decorate([o.property({constructOnly:!0})],e.TilemapCache.prototype,"layer",void 0),r.__decorate([o.property({constructOnly:!0})],e.TilemapCache.prototype,"request",void 0),t.TilemapCache=b=r.__decorate([l.subclass("esri.layers.support.TilemapCache")],e.TilemapCache),Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},43338:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(56162),i(35558),i(12997),i(26016),i(40810),i(96349),i(30106),i(8336),i(72146),i(53952),i(56117),i(62663),i(85775),i(12491)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b,I,S,T,R){"use strict";let M=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},e}e._inheritsLoose(i,t);var a=i.prototype;return a.init=async function(){const e=T.load();this.addResolvingPromise(e),await this.when()},a.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e={...e,ioConfig:{resolution:null,bandIds:null,sampling:"closest",tileInfo:_.create(),...e.ioConfig}}),e},a.open=async function(e){throw new l("BaseRaster:open-not-implemented","open() is not implemented")},a.fetchTile=async function(e,t,i,n={}){var a;const{tileInfo:o}=n,s=o.lodAt(e),l=new d({x:s.resolution,y:s.resolution,spatialReference:o.spatialReference}),c=this.getTileExtent(l,t,i,o);return null!=(a=n.multidimensionalDefinition)&&a.length&&r.isSome(this.rasterInfo.multidimensionalInfo)&&null==n.sliceId&&(n={...n,sliceId:this.getSliceIndex(n.multidimensionalDefinition)||0}),this.fetchPixels(c,o.size[0],o.size[1],n)},a.identify=async function(e,t={}){const{spatialReference:i,extent:n}=this.rasterInfo,{datumTransformation:a}=t,o=T.projectPoint(e,i,a);if(!n.intersects(o))return{location:o,value:null};let s=0;if(t.srcResolution)s=T.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel;else if(s=await this.computeBestPyramidLevelForLocation(e,t),null==s)return{location:o,value:null};const l=this.identifyPixelLocation(o,s,null);if(null===l)return{location:o,value:null};const{row:c,col:u,rowOffset:f,colOffset:p}=l,h=R.getRasterId(this.url,t.sliceId),d=`${s}/${c}/${u}`;let m=R.getBlock(h,null,d);r.isSome(m)||(m=this.fetchRawTile(s,c,u,t),R.putBlock(h,null,d,m));const y=await m;if(!(y&&y.pixels&&y.pixels.length>0))return{location:o,value:null};const g=f*this.rasterInfo.storageInfo.blockHeight+p;return{location:o,value:!y.mask||y.mask[g]?y.pixels.map((e=>e[g])):null,pyramidLevel:s}},a.fetchPixels=async function(e,t,i,n={}){const a=e.clone().normalize();e=a[0];const o=this.rasterInfo.spatialReference,s=!e.spatialReference.equals(o),{datumTransformation:l}=n,c=new d({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/i,spatialReference:e.spatialReference}),u=n.srcResolution||(s?T.projectResolution(c,o,e,l):c);if(!u)return null;const{pyramidLevel:f,pyramidResolution:p,excessiveReading:h}=T.snapPyramid(u,this.rasterInfo,this.ioConfig.sampling);if(h)return null;const m=this.rasterInfo.storageInfo;let y=s?T.projectExtent(e,o,l):e;const g=r.unwrap(this.rasterInfo.transform);if(g&&(y=g.inverseTransform(y)),null==y)return null;const x={x:Math.floor((y.xmin-m.origin.x)/p.x+.1),y:Math.floor((m.origin.y-y.ymax)/p.y+.1)},v=Math.ceil((y.xmax-y.xmin)/p.x-.1),w=Math.ceil((y.ymax-y.ymin)/p.y-.1);if(v/t>8||w/i>8)return null;const _=await this.fetchRawPixels(f,x,{width:v,height:w},n);if(!_)return null;const b=f>0?m.pyramidBlockWidth:m.blockWidth,S=f>0?m.pyramidBlockHeight:m.blockHeight;if(!s&&1===_.pixelBlocks.length&&b===t&&S===i&&u.x===c.x&&u.y===c.y)return{extent:e,srcExtent:y,pixelBlock:_.pixelBlocks[0],transformGrid:null};const R=T.getProjectionOffsetGrid(e,_.extent,c,l,g);let M;const C=!n.requestRawData,k={rows:R.spacing[0],cols:R.spacing[1]},{pixelBlocks:P,mosaicSize:O,isPartiallyFilled:F}=_;if(this.rasterJobHandler)M=await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:P,srcMosaicSize:O,destDimension:C?{width:t,height:i}:null,coefs:C?R.coefficients:null,sampleSpacing:C?k:null,interpolation:n.interpolation},n);else{const e=I.mosaic(P,O);M=C?I.approximateTransform(e,{width:t,height:i},R.coefficients,k,n.interpolation):e}return{srcExtent:y,pixelBlock:M,transformGrid:R,extent:e,isPartiallyFilled:F}},a.fetchRawPixels=async function(e,t,i,r){const{origin:n,blockBoundary:a}=this.rasterInfo.storageInfo,o=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,s=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight;let{x:l,y:c}=t,{width:u,height:f}=i;r.buffer&&(l-=r.buffer.cols,c-=r.buffer.rows,u+=2*r.buffer.cols,f+=2*r.buffer.rows);const h=Math.floor(l/o),d=Math.floor(c/s),y=Math.floor((l+u-1)/o),g=Math.floor((c+f-1)/s),x=a[e];if(!x)return null;const{minRow:v,minCol:w,maxCol:_,maxRow:b}=x;if(g<v||y<w||d>b||h>_)return null;const I=[];let S,T=!1;for(let t=d;t<=g;t++)for(let i=h;i<=y;i++)t>=v&&i>=w&&b>=t&&_>=i?(S=this._fetchRawTile(e,t,i,r),this.ioConfig.allowPartialFill&&(S=p.create((e=>{S.then((t=>e(t))).catch((()=>{T=!0,e(null)}))}))),I.push(S)):I.push(null);if(0===I.length)return null;const R=await p.all(I),M={height:(g-d+1)*o,width:(y-h+1)*s},{nativePixelSize:C,spatialReference:k}=this.rasterInfo,P=C.x*Math.pow(2,e),O=C.y*Math.pow(2,e);return{extent:new m({xmin:n.x+h*o*P,xmax:n.x+(y+1)*o*P,ymin:n.y-(g+1)*s*O,ymax:n.y-d*s*O,spatialReference:k}),pixelBlocks:R,mosaicSize:M,isPartiallyFilled:T}},a.fetchRawTile=async function(e,t,i,r){throw new l("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")},a.computeExtent=function(e){return T.projectExtent(this.rasterInfo.extent,e)},a.decodePixelBlock=function(e,t){return!this.rasterJobHandler||t.useCanvas?b.decode(e,t):this.rasterJobHandler.decode({data:e,options:t})},a.request=async function(e,t,i){var r,n;const{customFetchParameters:a}=this.ioConfig,{range:o,query:s,headers:l}=t;i=null!=(r=null!=(n=i)?n:t.retryCount)?r:this.ioConfig.retryCount;const c=o?{Range:`bytes=${o.from}-${o.to}`}:null;try{return await g(e,{...t,query:{...s,...a},headers:{...l,...c}})}catch(r){if(i>0)return i--,this.request(e,t,i);throw r}},a.getSliceIndex=function(e){const{multidimensionalInfo:t}=this.rasterInfo;if(!r.isSome(t)||null==e||!e.length)return null;let i=0;const n=e[0].variableName;for(let r=0;r<t.variables.length;r++){const a=t.variables[r],o=a.dimensions;if(a.name!==n){i+=o.map((e=>this._getDimensionValuesCount(e))).reduce(((e,t)=>e+t));break}const s=o.map((e=>this._getDimensionValuesCount(e))),l=o.length;for(let t=0;t<l;t++){const r=e.filter((e=>e.dimensionName===o[t].name))[0];if(null==r)return null;const n=Array.isArray(r.values[0])?r.values[0][0]:r.values[0],a=this._getIndexFromDimensions(n,o[t]);if(-1===a)return null;s.shift(),i+=t===l-1?a:a*s.reduce(((e,t)=>e+t))}}return i},a.updateTileInfo=function(){const{storageInfo:e,spatialReference:t,extent:i,pixelSize:r}=this.rasterInfo;if(!e.tileInfo){const n=[],a=e.maximumPyramidLevel||0;let o=Math.max(r.x,r.y),s=1/.0254*96*o;for(let e=0;e<=a;e++)n.push({level:a-e,resolution:o,scale:s}),o*=2,s*=2;const l=new d({x:i.xmin,y:i.ymax,spatialReference:t});e.tileInfo=new _({origin:l,size:[e.blockWidth,e.blockHeight],spatialReference:t,lods:n}),e.isVirtualTileInfo=!0}},a.createRemoteDatasetStorageInfo=function(e,t=512,i=512,r){const{width:n,height:a,nativeExtent:o,pixelSize:s,spatialReference:l}=e,c=new d({x:o.xmin,y:o.ymax,spatialReference:l});null==r&&(r=Math.max(0,Math.round(Math.log(Math.max(n,a))/Math.LN2-8)));const u=this._computeBlockBoundary(o,s,r,512,512);e.storageInfo=new S({blockWidth:t,blockHeight:i,pyramidBlockWidth:t,pyramidBlockHeight:i,origin:c,firstPyramidLevel:1,maximumPyramidLevel:r,blockBoundary:u})},a.computeBestPyramidLevelForLocation=async function(e,t={}){return 0},a.identifyPixelLocation=function(e,t,i){const{spatialReference:r,pixelSize:n,extent:a}=this.rasterInfo,{blockWidth:o,blockHeight:s,maximumPyramidLevel:l,pyramidScalingFactor:c,origin:u}=this.rasterInfo.storageInfo,f=T.projectPoint(e,r,i);if(!a.intersects(f))return null;if(t<0||t>l)return null;const p=Math.pow(c,t),h=p*n.x,d=p*n.y,m=(u.y-f.y)/d/s,y=(f.x-u.x)/h/o,g=Math.min(s-1,Math.floor((m-Math.floor(m))*s)),x=Math.min(o-1,Math.floor((y-Math.floor(y))*o));return{pyramidLevel:t,row:Math.floor(m),col:Math.floor(y),rowOffset:g,colOffset:x,srcLocation:f}},a.getTileExtent=function(e,t,i,r){const{origin:n,spatialReference:a}=r,o=r.size[0],s=r.size[1],l=n.x+i*o*e.x,c=l+o*e.x,u=n.y-t*s*e.y,f=u-s*e.y;return new m({xmin:l,xmax:c,ymin:f,ymax:u,spatialReference:a})},a._computeBlockBoundary=function(e,t,i,r,n){let{x:a,y:o}=t;const s=e.xmin,l=e.ymax,c=[{minCol:Math.floor((e.xmin-s+.1*a)/r/a),maxCol:Math.floor((e.xmax-s-.1*a)/r/a),minRow:Math.floor((l-e.ymax+.1*o)/n/o),maxRow:Math.floor((l-e.ymin-.1*o)/n/o)}];if(i>0)for(let t=0;t<i;t++)a*=2,o*=2,c.push({minCol:Math.floor((e.xmin-s+.1*a)/r/a),maxCol:Math.floor((e.xmax-s-.1*a)/r/a),minRow:Math.floor((l-e.ymax+.1*o)/n/a),maxRow:Math.floor((l-e.ymin-.1*o)/n/a)});return c},a._fetchRawTile=function(e,t,i,n){const a=this.rasterInfo.storageInfo.blockBoundary[e];if(!a)return p.resolve(null);const{minRow:o,minCol:s,maxCol:l,maxRow:c}=a;if(t<o||i<s||t>c||i>l)return p.resolve(null);const u=R.getRasterId(this.url,n.sliceId),f=`${e}/${t}/${i}`;let h=R.getBlock(u,n.registryId,f);if(!r.isSome(h)){const r=p.createAbortController();h=this.fetchRawTile(e,t,i,{...n,signal:r.signal}),R.putBlock(u,n.registryId,f,h,r),h.catch((()=>{R.deleteBlock(u,n.registryId,f)}))}return n.signal&&p.onAbort(n,(()=>{R.decreaseRefCount(u,n.registryId,f)})),h},a._getIndexFromDimensions=function(e,t){const{extent:i,interval:r,unit:n,values:a}=t;if(null!=a&&a.length)return Array.isArray(a[0])?a.findIndex((t=>t[0]<=e&&t[1]>=e)):a.indexOf(e);if(e>i[1])return-1;const o=i[0];let s=-1;if("ISO8601"===n){var l;switch((null==(l=t.intervalUnit)?void 0:l.toLowerCase())||"seconds"){case"seconds":s=Math.round((e-o)/1e3/r);break;case"minutes":s=Math.round((e-o)/6e4/r);break;case"hours":s=Math.round((e-o)/36e5/r);break;case"days":s=Math.round((e-o)/864e5/r);break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(o).getUTCFullYear())/r);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(o).getUTCFullYear())/10/r)}return s}return Math.round((e-o)/r)},a._getDimensionValuesCount=function(e){const{extent:t,interval:i,unit:r,values:n}=e;let a=(null==n?void 0:n.length)||0;if(a)return a;const o=t[0];if(0===a&&"ISO8601"===r){var s;switch((null==(s=e.intervalUnit)?void 0:s.toLowerCase())||"seconds"){case"seconds":a=Math.round((t[1]-t[0])/1e3/i);break;case"minutes":a=Math.round((t[1]-t[0])/6e4/i);break;case"hours":a=Math.round((t[1]-t[0])/36e5/i);break;case"days":a=Math.round((t[1]-t[0])/864e5/i);break;case"years":a=Math.round((new Date(t[1]).getUTCFullYear()-new Date(o).getUTCFullYear())/i);break;case"decades":a=Math.round((new Date(t[1]).getUTCFullYear()-new Date(o).getUTCFullYear())/10/i)}return a}return Math.round((t[1]-t[0])/i)},e._createClass(i,[{key:"url",set:function(e){this._set("url",v.sanitizeUrl(e,n.getLogger(this.declaredClass)))}}]),i}(x.EsriPromiseMixin(h.JSONSupport));return t.__decorate([o.property(w.url)],M.prototype,"url",null),t.__decorate([o.property({type:String,json:{write:!0}})],M.prototype,"datasetName",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],M.prototype,"datasetFormat",void 0),t.__decorate([o.property()],M.prototype,"rasterInfo",void 0),t.__decorate([o.property()],M.prototype,"ioConfig",void 0),t.__decorate([o.property()],M.prototype,"sourceJSON",void 0),M=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.BaseRaster")],M),M}.apply(t,r))||(e.exports=n)},34170:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(23084),i(35558),i(12997),i(26016),i(57517),i(72146),i(76519),i(62663),i(43338),i(6461)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b){"use strict";const I=new Map;I.set("int16","esriFieldTypeSmallInteger"),I.set("int32","esriFieldTypeInteger"),I.set("int64","esriFieldTypeInteger"),I.set("float32","esriFieldTypeSingle"),I.set("float64","esriFieldTypeDouble"),I.set("text","esriFieldTypeString");let S=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).storageInfo=null,e.datasetFormat="CRF",e}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){await this.init();const{data:t}=await this.request(this.url+"/conf.json",{signal:null==e?void 0:e.signal});if(!this._validateHeader(t))throw new l("cloudraster:open","Invalid or unsupported conf.json.");this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);const{storageInfo:i,rasterInfo:r}=this._parseHeader(t);if("thematic"===r.dataType){const e=await this._fetchAuxiliaryInformation();r.attributeTable=e}this._set("storageInfo",i),this._set("rasterInfo",r),this.ioConfig.retryCount=this.ioConfig.retryCount||0},n.fetchRawTile=async function(e,t,i,r={}){const n=this.rasterInfo.storageInfo.maximumPyramidLevel-e;if(n<0)return null;const a=this._buildCacheFilePath(n,t,i,r.multidimensionalDefinition),o=this._getIndexRecordFromBundle(t,i),s=await this.request(a,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:r.signal});if(!s)return null;const l=new Uint8Array(s.data),c=this._getTileEndAndContentType(l,o);if(0===c.recordSize)return null;const u=await this.request(a,{range:{from:c.position,to:c.position+c.recordSize},responseType:"array-buffer",signal:r.signal});return u?this.decodePixelBlock(u.data,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null}):null},n._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((t=>!e[t]))},n._parseHeader=function(e){var t;const i=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],{bandCount:r,histograms:n,colormap:a,blockWidth:o,blockHeight:s,firstPyramidLevel:l,maximumPyramidLevel:c}=e,u=e.statistics&&e.statistics.map((e=>({min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}))),f=new h(e.extent.spatialReference||e.geodataXform.spatialReference),p=new m({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:f}),y=new d({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:f}),g=null!=(t=e.properties)?t:{},_=e.format.toLowerCase().replace("cache/",""),b=new d(e.origin.x,e.origin.y,f);let I,S,T,R;if(a&&a.colors)for(I=[],S=0;S<a.colors.length;S++)T=a.colors[S],R=a.values?a.values[S]:S,I.push([R,255&T,T<<16>>>24,T<<8>>>24,T>>>24]);const M=e.LODInfos,C=[];for(S=0;S<M.levels.length;S++)C.push({level:M.levels[S],resolution:M.resolutions[S],scale:96/.0254*M.resolutions[S]});const k=new x({dpi:96,lods:C,format:_,origin:b,size:[o,s],spatialReference:f}),P={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},O=Math.round((p.xmax-p.xmin)/y.x),F=Math.round((p.ymax-p.ymin)/y.y),N=[{maxCol:Math.ceil(O/o)-1,maxRow:Math.ceil(F/s)-1,minCol:0,minRow:0}];let D=2;if(c>0)for(S=0;S<c;S++)N.push({maxCol:Math.ceil(O/D/o)-1,maxRow:Math.ceil(F/D/s)-1,minCol:0,minRow:0}),D*=2;const B=e.mdInfo;return{storageInfo:P,rasterInfo:new v({width:O,height:F,pixelType:i,bandCount:r,extent:p,spatialReference:f,pixelSize:y,keyProperties:g,statistics:u,histograms:n,multidimensionalInfo:B,colormap:I,storageInfo:new w({blockWidth:o,blockHeight:s,pyramidBlockWidth:o,pyramidBlockHeight:s,origin:b,tileInfo:k,firstPyramidLevel:l,maximumPyramidLevel:c,blockBoundary:N})})}},n._fetchAuxiliaryInformation=async function(e){const t=this.request(this.url+"/conf.vat.json",{signal:e}).then((e=>e.data)).catch((()=>null)),i=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:e}).then((e=>e.data)).catch((()=>null)),r=await p.all([t,i]);let n;if(r[0]){let e=r[0].fields;const t=r[0].values;if(e&&t){e=e.map((e=>({type:"OID"===e.name?"esriFieldTypeOID":I.get(e.type),name:e.name,alias:e.alias||e.name})));const i=t.map((e=>({attributes:e})));e&&t&&(n={fields:e,features:i})}}return!n&&r[1]&&(n=b.parse(r[1]).recordSet),g.fromJSON(n)},n._buildCacheFilePath=function(e,t,i,n){const a=this.storageInfo.packetSize,o=Math.floor(t/a)*a,s=Math.floor(i/a)*a,l="R"+this._toHexString4(o)+"C"+this._toHexString4(s);let c="L";c+=e>=10?e.toString():"0"+e.toString();const{multidimensionalInfo:u}=this.rasterInfo,f=null==n?void 0:n[0];if(!r.isSome(u)||!f)return`${this.url}/_alllayers/${c}/${l}.bundle`;let p=u.variables.filter((e=>e.name===f.variableName))[0].dimensions[0].values.indexOf(f.values[0]).toString(16);const h=4-p.length;for(let e=0;e<h;e++)p="0"+p;return p="S"+p,`${this.url}/_alllayers/${f.variableName}/${p}/${c}/${l}.bundle`},n._getIndexRecordFromBundle=function(e,t){const i=this.storageInfo.packetSize,r=i*(e%i)+t%i;if(r<0)throw"Invalid level / row / col";return 20+r*this.storageInfo.recordSize+44},n._getTileEndAndContentType=function(e,t){const i=e.subarray(t,t+8);let r,n=0;for(r=0;r<5;r++)n|=(255&i[r])<<8*r;const a=0xffffffffff&n;for(n=0,r=5;r<8;r++)n|=(255&i[r])<<8*(r-5);return{position:a,recordSize:0xffffffffff&n}},n._toHexString4=function(e){let t=e.toString(16);if(4!==t.length){let e=4-t.length;for(;e-- >0;)t="0"+t}return t},i}(_);return t.__decorate([o.property({readOnly:!0})],S.prototype,"storageInfo",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],S.prototype,"datasetFormat",void 0),S=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.CloudRaster")],S),S}.apply(t,r))||(e.exports=n)},6461:(e,t,i)=>{var r,n;r=[i(58797),i(52854)],void 0===(n=function(e,t){"use strict";return function(){function i(){}return i.parse=function(e){const i=new DataView(e),r=3&i.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};const n=i.getUint32(4,!0),a=i.getUint16(8,!0),o=i.getUint16(10,!0),s={version:r,recordCount:n,headerByteCount:a,recordByteCount:o};let l=32;const c=[],u=[];let f;if(3===r){for(;13!==i.getUint8(l);)f=String.fromCharCode(i.getUint8(l+11)).trim(),c.push({name:t.bytesToUTF8(new Uint8Array(e,l,11)),type:f,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(f)],length:i.getUint8(l+16)}),l+=32;if(l+=1,c.length>0)for(;u.length<n&&e.byteLength-l>o;){const r=[];32===i.getUint8(l)?(l+=1,c.forEach((i=>{if("C"===i.type)r.push(t.bytesToUTF8(new Uint8Array(e,l,i.length)).trim());else if("N"===i.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,i.length)).trim(),10));else if("F"===i.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,i.length)).trim()));else if("D"===i.type){const t=String.fromCharCode.apply(null,new Uint8Array(e,l,i.length)).trim();r.push(new Date(parseInt(t.substring(0,4),10),parseInt(t.substring(4,6),10)-1,parseInt(t.substring(6,8),10)))}l+=i.length})),u.push(r)):l+=o}}const p=function(e){const t=e.fields,i=e.records,r=t.some((e=>"oid"===e.name.toLowerCase()))?"OBJECTID":"OID",n=[{name:r,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((e=>({name:e.name,type:"esriFieldType"+e.typeName,alias:e.name})))),a=n.map((e=>e.name)),o=[];let s=0,l=0;return i.forEach((e=>{const t={};for(t[r]=s++,l=1;l<a.length;l++)t[a[l]]=e[l-1];o.push({attributes:t})})),{displayFieldName:"",fields:n,features:o}}({fields:c,records:u});return{header:s,fields:c,records:u,recordSet:p}},e._createClass(i,null,[{key:"supportedVersions",get:function(){return[5]}}]),i}()}.apply(t,r))||(e.exports=n)},40660:(e,t,i)=>{var r;void 0===(r=function(){"use strict";return function(){function e(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}var t=e.prototype;return t.decreaseRefCount=function(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.refCount--,e.refCount<=0&&(r.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0},t.getBlock=function(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.ts=Date.now(),e.refCount++,r.delete(i),r.set(i,e),e.block}return null},t.putBlock=function(e,t,i,r=null){const n=this._cachedBlocks,a=e+"/"+t;if(n.has(a)){const e=n.get(a);e.ts=Date.now(),e.refCount++}else n.set(a,{block:i,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()},t.deleteBlock=function(e,t){const i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)},t.updateMaxSize=function(e){this._size=e,this.trim()},t.empty=function(){this._cachedBlocks.clear(),this.clearTimer()},t.getCurrentSize=function(){return this._cachedBlocks.size},t.updateTimer=function(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),i=Date.now();for(let r=0;r<t.length&&t[r][1].ts<=i-this._duration;r++)e.delete(t[r][0]);0===e.size&&this.clearTimer()}),this._interval)},t.trim=function(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])},t.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)},e}()}.call(t,i,t,e))||(e.exports=r)},7979:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(23084),i(12997),i(26016),i(53952),i(56117),i(43338),i(20390),i(50189),i(61952)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_){"use strict";let b=function(t){function i(){return t.apply(this,arguments)||this}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){await this.init();const t=await this._fetchData(e);let{spatialReference:i,statistics:r,histograms:n,transform:a}=await this._fetchAuxiliaryData(e);const o=!i;o&&(i=new h({wkid:3857})),null!=n&&n.length&&null==r&&(r=g.estimateStatisticsFromHistograms(n));const{width:s,height:l}=t;let c=new d({xmin:-.5,ymin:.5-l,xmax:s-.5,ymax:.5,spatialReference:i});const u=a?a.forwardTransform(c):c;let f=!0;if(a){const e=a.forwardCoefficients;f=e&&0===e[1]&&0===e[2],f&&(a=null,c=u)}const p=new v({data:{extent:u,nativeExtent:c,transform:a,pixelBlock:t,statistics:r,histograms:n,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:o}});await p.open(),this._set("rasterInfo",p.rasterInfo),this._inMemoryRaster=p},n.fetchRawTile=function(e,t,i,r={}){return this._inMemoryRaster.fetchRawTile(e,t,i,r)},n._fetchData=async function(e){const{data:t}=await this.request(this.url,{responseType:"array-buffer",signal:null==e?void 0:e.signal}),i=y.getFormat(t).toUpperCase();if("JPG"!==i&&"PNG"!==i&&"GIF"!==i&&"BMP"!==i)throw new l("image-aux-raster:open","the data is not a supported format");return this._set("datasetFormat",i),await this.decodePixelBlock(t,{format:"jpg",width:1,height:1,useCanvas:!0})},n._fetchAuxiliaryData=async function(e){var t,i;const n=r.unwrap(null==e?void 0:e.signal),a=null!=(t=this.ioConfig.skipExtensions)?t:[],o=a.indexOf("aux.xml")>-1?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:n}),s=this.datasetFormat,l="JPG"===s?"jgw":"PNG"===s?"pgw":"BMP"===s?"bpw":null,c=a.indexOf(l)>-1?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+l,{responseType:"text",signal:n}),u=await p.eachAlways([o,c]);if(null!=n&&n.aborted)throw p.createAbortError();const f=_.parsePAMInfo(null==(i=u[0].value)?void 0:i.data);if(!f.transform){const e=u[1].value?u[1].value.data.split("\n").slice(0,6).map((e=>Number(e))):null;f.transform=6===(null==e?void 0:e.length)?new w({forwardCoefficients:[e[4],e[5],e[0],-e[1],e[2],-e[3]]}):null}return f},i}(x);return t.__decorate([o.property({type:String,json:{write:!0}})],b.prototype,"datasetFormat",void 0),b=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.ImageAuxRaster")],b),b}.apply(t,r))||(e.exports=n)},57041:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(23084),i(35558),i(12997),i(26016),i(57517),i(72146),i(89425),i(83568),i(76519),i(56117),i(62663),i(43338)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b,I,S){"use strict";let T=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._levelOffset=0,e._slices=null,e._tilemapCache=null,e.datasetFormat="RasterTileServer",e}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){await this.init();const t=e&&e.signal,i=this.sourceJSON?{data:this.sourceJSON}:await this.request(this.url,{query:{f:"json"},signal:t});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));const n=i.data;if(this.sourceJSON=n,this.tileType=n.cacheType,null==this.tileType&&(["jpg","jpeg","png","png8","png24","png32","mixed"].indexOf(n.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===n.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),!n)throw new l("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!n.tileInfo)throw new l("imageserverraster:open","use ImageryLayer to open non-tiled image services");this.datasetName=n.name.slice(n.name.indexOf("/")+1);const a=await this._fetchRasterInfo({signal:t});if(!r.isSome(a))throw new l("image-server-raster:open","cannot initialize image service");{const e="Map"===this.tileType?v.readServiceTileInfo(n.tileInfo,n):x.fromJSON(n.tileInfo),{extent:t,pixelSize:i}=a,r=.5/a.width*i.x;let o,s;const l=e.lodAt(Math.max.apply(null,e.lods.map((e=>e.level))));"Map"!==this.tileType&&0!==n.maxScale&&("Raster"===this.tileType?(o=e.lods.filter((e=>e.resolution===i.x))[0],o||(o=e.lods[e.lods.length-1])):(o=e.lods.filter((e=>Math.abs(e.scale-n.maxScale)<r))[0],o||(o=e.lods.filter((e=>e.scale>n.maxScale)).sort(((e,t)=>e.scale>t.scale?1:-1))[0])),i.x=i.y=o.resolution,a.width=Math.ceil((t.xmax-t.xmin)/i.x-.1),a.height=Math.ceil((t.ymax-t.ymin)/i.y-.1)),o||(o=l);const c=e.lodAt(Math.min.apply(null,e.lods.map((e=>e.level))));"Map"===this.tileType?this._levelOffset=e.lods[0].level:0!==n.minScale&&"Elevation"===this.tileType&&(s=e.lods.filter((e=>Math.abs(e.scale-n.minScale)<r))[0],this._levelOffset=s.level-c.level),s||(s=c);const u=Math.max(i.x,i.y);(Math.abs(i.x-i.y)>r||!e.lods.some((e=>Math.abs(e.resolution-u)<r)))&&(i.x=i.y=o.resolution,a.width=Math.ceil((t.xmax-t.xmin)/i.x-.1),a.height=Math.ceil((t.ymax-t.ymin)/i.y-.1));const f=o.level-s.level,[p,h]=e.size,d=e.origin;let{x:m,y}=i;const g=[{minCol:Math.floor((t.xmin-d.x+.1*m)/p/m),maxCol:Math.floor((t.xmax-d.x-.1*m)/p/m),minRow:Math.floor((d.y-t.ymax+.1*y)/h/y),maxRow:Math.floor((d.y-t.ymin-.1*y)/h/y)}];if(f>0)for(let e=0;e<f;e++)m*=2,y*=2,g.push({minCol:Math.floor((t.xmin-d.x+.1*m)/p/m),maxCol:Math.floor((t.xmax-d.x-.1*m)/p/m),minRow:Math.floor((d.y-t.ymax+.1*y)/h/m),maxRow:Math.floor((d.y-t.ymin-.1*y)/h/m)});a.storageInfo=new I({blockWidth:e.size[0],blockHeight:e.size[1],pyramidBlockWidth:e.size[0],pyramidBlockHeight:e.size[1],compression:e.format,origin:e.origin,firstPyramidLevel:1,maximumPyramidLevel:f,tileInfo:e,blockBoundary:g}),this._set("rasterInfo",a)}if(n.capabilities.toLowerCase().indexOf("tilemap")>-1){const e={tileInfo:a.storageInfo.tileInfo,parsedUrl:c.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"};this._tilemapCache=new w.TilemapCache({layer:e})}},n.fetchRawTile=async function(e,t,i,r={}){const{storageInfo:n,extent:a,pixelSize:o}=this.rasterInfo,s=n.maximumPyramidLevel-e+this._levelOffset,l=`${this.url}/tile/${s}/${t}/${i}`,c=this._slices?{sliceId:r.sliceId||0}:null,{data:u}=await this.request(l,{query:c,responseType:"array-buffer",signal:r.signal});if(!u)return null;const f=await this.decodePixelBlock(u,{width:n.tileInfo.size[0],height:n.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType}),p=n.blockBoundary[e];if("jpg"!==n.compression||i>p.minCol&&i<p.maxCol&&t>p.minRow&&t<p.maxRow)return f;const{origin:h,blockWidth:d,blockHeight:m}=n,y=Math.pow(2,e),g=Math.round((a.xmin-h.x)/(o.x*y))%d,x=Math.round((a.xmax-h.x)/(o.x*y))%d,v=Math.round((h.y-a.ymax)/(o.x*y))%m,w=Math.round((h.y-a.ymin)/(o.x*y))%m,_=i===p.minCol?g:0,I=t===p.minRow?v:0,S=i===p.maxCol?x:d,T=t===p.maxRow?w:m;return b.setValidBoundary(f,{x:_,y:I},{width:S-_,height:T-I}),f},n.getSliceIndex=function(e){if(null==e||!e.length||!this._slices)return null;const t=e;for(let e=0;e<this._slices.length;e++){const i=this._slices[e].multidimensionalDefinition;if(i.length===t.length&&!i.some((e=>{const i=t.filter((t=>e.variableName===t.variableName&&t.dimensionName===e.dimensionName))[0];return!i||(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(i.values[0])?i.values[0][0]:i.values[0])})))return e}return null},n.fetchVariableStatisticsHistograms=async function(e,t){const i=this.request(this.url+"/statistics",{query:{variable:e,f:"json"},signal:t}).then((e=>{var t;return null==(t=e.data)?void 0:t.statistics})),r=this.request(this.url+"/histograms",{query:{variable:e,f:"json"},signal:t}).then((e=>{var t;return null==(t=e.data)?void 0:t.histograms})),n=await p.all([i,r]);return n[0]&&n[0].forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:n[0]||null,histograms:n[1]||null}},n.computeBestPyramidLevelForLocation=async function(e,t={}){if(!this._tilemapCache)return 0;let i=this.identifyPixelLocation(e,0,t.datumTransformation);if(null===i)return null;let r=0;const{maximumPyramidLevel:n}=this.rasterInfo.storageInfo;let a=n-r+this._levelOffset;const o=i.srcLocation;for(;a>=0;){try{if("available"===await this._tilemapCache.fetchAvailability(a,i.row,i.col,t))break}catch{}if(a--,r++,i=this.identifyPixelLocation(o,r,t.datumTransformation),null===i)return null}return-1===a||null==i?null:r},n._fetchRasterInfo=async function(e){const t=this.sourceJSON,i=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),r=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),n=h.fromJSON(t.spatialReference||t.extent.spatialReference);if("Map"===this.tileType)return new _({width:i,height:r,bandCount:3,extent:m.fromJSON(t.extent),spatialReference:n,pixelSize:new d({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:n}),pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}});const{slice:a,signal:o}=e,s=!!t.hasRasterAttributeTable&&this.request(this.url+"/rasterAttributeTable",{query:{slice:a,f:"json"},signal:o}).then((e=>g.fromJSON(e.data))).catch((()=>null)),l=!!t.hasColormap&&this.request(this.url+"/colormap",{query:{slice:a,f:"json"},signal:o}).then((e=>{var t;return null==(t=e.data)?void 0:t.colormap})),c=!!t.hasHistograms&&this.request(this.url+"/histograms",{query:{slice:a,f:"json"},signal:o}).then((e=>{var t;return null==(t=e.data)?void 0:t.histograms})),u=this.request(this.url+"/keyProperties",{query:{f:"json"},signal:o}).then((e=>e.data)).catch((()=>{})),f=!!t.hasMultidimensions&&this._fetchMultidimensionalInfo(),y=!!t.hasMultidimensions&&this.request(this.url+"/slices",{query:{f:"json"},signal:o}).then((e=>e.data&&e.data.slices)).catch((()=>{}));return p.all([s,l,c,u,f,y]).then((e=>{let a=null;if(t.minValues&&t.minValues.length===t.bandCount){a=[];for(let e=0;e<t.minValues.length;e++)a.push({min:t.minValues[e],max:t.maxValues[e],avg:t.meanValues[e],stddev:t.stdvValues[e]})}return this._slices=e[5]||null,new _({width:i,height:r,bandCount:t.bandCount,extent:m.fromJSON(t.extent),spatialReference:n,pixelSize:new d({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:n}),pixelType:t.pixelType.toLowerCase(),statistics:a,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||{},multidimensionalInfo:e[4]||null})}))},n._fetchMultidimensionalInfo=async function(e){var t;const i=await this.request(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:e}).then((e=>{var t;return null==(t=e.data)?void 0:t.multidimensionalInfo}));return null!=(t=i.variables)&&t.length&&i.variables.forEach((e=>{var t;null!=(t=e.statistics)&&t.length&&e.statistics.forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation}))})),i},i}(S);return t.__decorate([o.property({type:String,json:{write:!0}})],T.prototype,"datasetFormat",void 0),t.__decorate([o.property()],T.prototype,"tileType",void 0),T=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],T),T}.apply(t,r))||(e.exports=n)},20390:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(23084),i(12997),i(26016),i(76519),i(56117),i(43338)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x){"use strict";let v=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).datasetFormat="MEMORY",e}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){var t;await this.init();const{pixelBlock:i,statistics:r,histograms:n,name:a,keyProperties:o,nativeExtent:s,transform:l}=this.data,{width:c,height:u,pixelType:f}=i,p=this.data.extent||new d({xmin:-.5,ymin:.5,xmax:c-.5,ymax:u-.5,spatialReference:new h({wkid:3857})}),m=null!=(t=this.data.isPseudoSpatialReference)?t:!this.data.extent,g={x:p.width/c,y:p.height/u},x=new y({width:c,height:u,pixelType:f,extent:p,nativeExtent:s,transform:l,pixelSize:g,spatialReference:p.spatialReference,bandCount:3,keyProperties:o||{},statistics:r,isPseudoSpatialReference:m,histograms:n});this.createRemoteDatasetStorageInfo(x,512,512),this._set("rasterInfo",x),this.updateTileInfo(),await this._buildInMemoryRaster(i,{width:512,height:512},e),this.datasetName=a,this.url="/InMemory/"+a},n.fetchRawTile=function(e,t,i,r={}){const n=this._pixelBlockTiles.get(`${e}/${t}/${i}`);return p.resolve(n)},n._buildInMemoryRaster=async function(e,t,i){const n=this.rasterInfo.storageInfo.maximumPyramidLevel,a=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:e,tileSize:t,maximumPyramidLevel:n},i):p.resolve(g.split(e,t,n)),o=r.isSome(this.rasterInfo.statistics),s=r.isSome(this.rasterInfo.histograms),c=o&&s?p.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:e},i):p.resolve(g.estimateStatisticsHistograms(e)),u=await p.eachAlways([a,c]);if(!u[0].value&&u[1].value)throw new l("inmemory-raster:open","failed to build in memory raster");var f,h;this._pixelBlockTiles=u[0].value,o||(this.rasterInfo.statistics=null==(f=u[1].value)?void 0:f.statistics),s&&(this.rasterInfo.histograms=null==(h=u[1].value)?void 0:h.histograms)},i}(x);return t.__decorate([o.property({type:String,json:{write:!0}})],v.prototype,"datasetFormat",void 0),t.__decorate([o.property()],v.prototype,"data",void 0),v=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],v),v}.apply(t,r))||(e.exports=n)},52693:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(23084),i(35558),i(12997),i(26016),i(45173),i(76519),i(14021),i(56117),i(62663),i(43338),i(69263),i(61952)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_,b,I,S){"use strict";const T=new Map;T.set("Int8","s8"),T.set("UInt8","u8"),T.set("Int16","s16"),T.set("UInt16","u16"),T.set("Int32","s32"),T.set("UInt32","u32"),T.set("Float32","f32"),T.set("Float64","f32"),T.set("Double64","f32");const R=new Map;R.set("lerc",".lrc"),R.set("none",".til"),R.set("deflate",".pzp"),R.set("jpeg",".jzp");let M=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._files=null,e._storageIndex=null,e.datasetFormat="MRF",e}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){var t;await this.init(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);const i=e?r.unwrap(e.signal):null,n=await this.request(this.url,{responseType:"xml",signal:i}),{rasterInfo:a,files:o}=this._parseHeader(n.data);if(-1===(null==(t=this.ioConfig.skipExtensions)?void 0:t.indexOf("aux.xml"))){const t=await this._fetchAuxiliaryData(e);var s;null!=t&&(a.statistics=null!=(s=t.statistics)?s:a.statistics,a.histograms=t.histograms,t.histograms&&!r.isSome(a.statistics)&&(a.statistics=w.estimateStatisticsFromHistograms(t.histograms)))}this._set("rasterInfo",a),this._files=o;const l=await this.request(o.index,{responseType:"array-buffer",signal:i});this._storageIndex=this._parseIndex(l.data);let c,u,f=0,p=-1;const{blockWidth:h,blockHeight:d,compression:m}=this.rasterInfo.storageInfo,y=this.rasterInfo.storageInfo.pyramidScalingFactor,{width:g,height:x,bandCount:v}=this.rasterInfo,_=[],b="none"===m?1:v;for(;f<this._storageIndex.length;)p++,c=Math.ceil(g/h/Math.pow(y,p)),u=Math.ceil(x/d/Math.pow(y,p)),f+=c*u*b*4,_.push({maxRow:u,maxCol:c,minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=_,p>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=p),this.updateTileInfo()},n.fetchRawTile=async function(e,t,i,r={}){const{blockWidth:n,blockHeight:a,blockBoundary:o,compression:s}=this.rasterInfo.storageInfo,l=o[e];if(!l||l.maxRow<t||l.maxCol<i||l.minRow>t||l.minCol>i)return null;const{bandCount:c,pixelType:u}=this.rasterInfo,{ranges:f,actualTileWidth:h,actualTileHeight:d}=this._getTileLocation(e,t,i);if(!f||0===f.length)return null;if(0===f[0].from&&0===f[0].to){const e=new Uint8Array(n*a);return new g({width:n,height:a,pixels:null,mask:e,validPixelCount:0})}const{bandIds:m}=this.ioConfig,y="none"===s?1:c,x=[];let v=0;for(v=0;v<y;v++)(!m||m.indexOf[v]>-1)&&x.push(this.request(this._files.data,{range:{from:f[v].from,to:f[v].to},responseType:"array-buffer",signal:r.signal}));const w=await p.all(x),_=w.map((e=>e.data.byteLength)).reduce(((e,t)=>e+t)),b=new Uint8Array(_);let I=0;for(v=0;v<y;v++)b.set(new Uint8Array(w[v].data),I),I+=w[v].data.byteLength;const S="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",T=await this.decodePixelBlock(b.buffer,{width:n,height:a,format:S,pixelType:u});let R=0,M=0;if(h!==n||d!==a){let e=T.mask;if(e)for(v=0;v<a;v++)if(M=v*n,v<d)for(R=h;R<n;R++)e[M+R]=0;else for(R=0;R<n;R++)e[M+R]=0;else for(e=new Uint8Array(n*a),T.mask=e,v=0;v<d;v++)for(M=v*n,R=0;R<h;R++)e[M+R]=1}return T},n._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";let t,i,r,n,a,o;if(v.isPlatformLittleEndian){for(i=new Uint8Array(e),n=new ArrayBuffer(e.byteLength),r=new Uint8Array(n),a=0;a<e.byteLength/4;a++)for(o=0;o<4;o++)r[4*a+o]=i[4*a+3-o];t=new Uint32Array(n)}else t=new Uint32Array(e);return t},n._getTileLocation=function(e,t,i){const{blockWidth:r,blockHeight:n,pyramidScalingFactor:a,compression:o}=this.rasterInfo.storageInfo,{width:s,height:l,bandCount:c}=this.rasterInfo,u="none"===o?1:c;let f,p,h,d=0,m=0;for(h=0;h<e;h++)m=Math.pow(a,h),f=Math.ceil(s/r/m),p=Math.ceil(l/n/m),d+=f*p;m=Math.pow(a,e),f=Math.ceil(s/r/m),p=Math.ceil(l/n/m),d+=t*f+i,d*=4*u;const y=this._storageIndex.subarray(d,d+4*u);let g=0,x=0;const v=[];for(let e=0;e<u;e++)g=y[4*e+0]*Math.pow(2,32)+y[4*e+1],x=g+y[4*e+2]*Math.pow(2,32)+y[4*e+3],v.push({from:g,to:x});return{ranges:v,actualTileWidth:i<f-1?r:Math.ceil(s/m)-r*(f-1),actualTileHeight:t<p-1?n:Math.ceil(l/m)-n*(p-1)}},n._parseHeader=function(e){const t=I.getElement(e,"MRF_META/Raster");if(!t)throw new l("mrf:open","not a valid MRF format");const i=I.getElement(t,"Size"),r=parseInt(i.getAttribute("x"),10),n=parseInt(i.getAttribute("y"),10),a=parseInt(i.getAttribute("c"),10),o=(I.getElementValue(t,"Compression")||"none").toLowerCase();if(!o||-1===["none","lerc"].indexOf(o))throw new l("mrf:open","currently does not support compression "+o);const s=I.getElementValue(t,"DataType")||"UInt8",c=T.get(s);if(null==c)throw new l("mrf:open","currently does not support pixel type "+s);const u=I.getElement(t,"PageSize"),f=parseInt(u.getAttribute("x"),10),p=parseInt(u.getAttribute("y"),10),y=I.getElement(t,"DataValues");let g,v;if(y&&(v=y.getAttribute("NoData"),null!=v&&(g=v.trim().split(" ").map((e=>parseFloat(e))))),I.getElement(e,"MRF_META/CachedSource"))throw new l("mrf:open","currently does not support MRF referencing other data files");const w=I.getElement(e,"MRF_META/GeoTags"),b=I.getElement(w,"BoundingBox");if(null==b)throw new l("mrf:open","missing node MRF_META/GeoTags/BoundingBox");const S=parseFloat(b.getAttribute("minx")),M=parseFloat(b.getAttribute("miny")),C=parseFloat(b.getAttribute("maxx")),k=parseFloat(b.getAttribute("maxy")),P=I.getElementValue(w,"Projection"),O=I.getElementValue(e,"datafile"),F=I.getElementValue(e,"IndexFile");let N;"LOCAL_CS[]"!==P&&(N=new h({wkt:P}));const D=new m(S,M,C,k);D.spatialReference=N;const B=I.getElement(e,"MRF_META/Rsets"),L=parseInt(B&&B.getAttribute("scale")||"2",10),E=new _({origin:new d({x:D.xmin,y:D.ymax,spatialReference:N}),blockWidth:f,blockHeight:p,pyramidBlockWidth:f,pyramidBlockHeight:p,compression:o,pyramidScalingFactor:L}),z=new d({x:(C-S)/r,y:(k-M)/n,spatialReference:N});return{rasterInfo:new x({width:r,height:n,extent:D,spatialReference:N,bandCount:a,pixelType:c,pixelSize:z,noDataValue:g,storageInfo:E}),files:{mrf:this.url,index:F||this.url.replace(".mrf",".idx"),data:O||this.url.replace(".mrf",R.get(o))}}},n._fetchAuxiliaryData=async function(e){try{const{data:t}=await this.request(this.url+".aux.xml",{responseType:"xml",signal:null==e?void 0:e.signal});return S.parsePAMInfo(t)}catch{return null}},i}(b);return t.__decorate([o.property()],M.prototype,"_files",void 0),t.__decorate([o.property()],M.prototype,"_storageIndex",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],M.prototype,"datasetFormat",void 0),M=t.__decorate([s.subclass("esri.layers.support.rasterIO.MRFRaster")],M),M}.apply(t,r))||(e.exports=n)},99192:(e,t,i)=>{var r,n;r=[i(58797),i(49359),i(34170),i(7979),i(57041),i(52693),i(34759)],void 0===(n=function(e,t,i,r,n,a,o){"use strict";const s=new Map;return s.set("CRF",{desc:"Cloud Raster Format",constructor:i}),s.set("MRF",{desc:"Meta Raster Format",constructor:a}),s.set("TIFF",{desc:"GeoTIFF",constructor:o}),s.set("RasterTileServer",{desc:"Raster Tile Server",constructor:n}),s.set("JPG",{desc:"JPG Raster Format",constructor:r}),s.set("PNG",{desc:"PNG Raster Format",constructor:r}),s.set("GIF",{desc:"GIF Raster Format",constructor:r}),s.set("BMP",{desc:"BMP Raster Format",constructor:r}),function(){function i(){}return i.open=async function(e){const{url:i,ioConfig:r,sourceJSON:n}=e;let a=e.datasetFormat;null==a&&i.lastIndexOf(".")&&(a=i.slice(i.lastIndexOf(".")+1).toUpperCase()),"OVR"===a||"TIF"===a?a="TIFF":"JPG"!==a&&"JPEG"!==a&&"JFIF"!==a||(a="JPG"),i.toLowerCase().indexOf("/imageserver")>-1&&-1===i.toLowerCase().indexOf("/wcsserver")&&(a="RasterTileServer");const o={url:i,sourceJSON:n,datasetFormat:a,ioConfig:r||{bandIds:null,sampling:null}};let l,c;if(this.supportedFormats.has(a))return l=s.get(a).constructor,c=new l(o),await c.open({signal:e.signal}),c;if(a)throw new t("rasterfactory:open","not a supported format "+a);const u=Array.from(s.keys());let f=0;const p=function(){return a=u[f++],a?(l=s.get(a).constructor,c=new l(o),c.open({signal:e.signal}).then((()=>c)).catch((()=>p()))):null};return p()},i.register=function(e,t,i){s.has(e.toUpperCase())||s.set(e.toUpperCase(),{desc:t,constructor:i})},e._createClass(i,null,[{key:"supportedFormats",get:function(){const e=new Set;return s.forEach(((t,i)=>e.add(i))),e}}]),i}()}.apply(t,r))||(e.exports=n)},12491:(e,t,i)=>{var r,n;r=[t,i(3718),i(35558),i(26016),i(40660),i(85775)],void 0===(n=function(e,i,r,n,a,o){"use strict";const s=new Map,l=new a;t.decreaseRefCount=function(e,t,i){if(!s.has(e))return null==t?l.decreaseRefCount(e,i):0;const r=s.get(e);if(null==r[t])return l.decreaseRefCount(e,i);const n=r[t].cache;if(n.has(i)){const e=n.get(i);if(e.refCount--,0===e.refCount){n.delete(i);for(let e=0;e<r.length;e++)r[e]&&r[e].cache.has(i)&&r[e].cache.delete(i);e.controller&&e.controller.abort()}return e.refCount}return 0},t.deleteBlock=function(e,t,i){if(!s.has(e))return void(null==t&&l.deleteBlock(e,i));const r=s.get(e);null!=r[t]?r[t].cache.delete(i):l.deleteBlock(e,i)},t.deleteRaster=function(e){s.delete(e)},t.getBlock=function(e,t,i){if(!s.has(e))return null==t?l.getBlock(e,i):null;const r=s.get(e);if(null==r[t]){for(let e=0;e<r.length;e++)if(r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,t.block}return l.getBlock(e,i)}const n=r[t].cache;if(n.has(i)){const e=n.get(i);return e.refCount++,e.block}for(let e=0;e<r.length;e++)if(e!==t&&r[e]&&r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,n.set(i,t),t.block}return null},t.getRasterId=function(e,t){return null==t?e:`${e}?sliceId=${t}`},t.putBlock=function(e,t,i,r,n=null){if(!s.has(e))return void(null==t&&l.putBlock(e,i,r,n));const a=s.get(e);if(null==a[t])return void l.putBlock(e,i,r,n);const o={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:n};r.then((()=>o.isResolved=!0)).catch((()=>o.isRejected=!0)),a[t].cache.set(i,o)},t.register=function(e,t){const i={extent:null,rasterInfo:t,cache:new Map};if(s.has(e)){const t=s.get(e);return t.push(i),t.length-1}return s.set(e,[i]),0},t.unregister=function(e,t){s.has(e)&&(s.get(e)[t]=null)},t.update=function(e,t,n,a,l,c,u=null){const f=function(e,t){if(!s.has(e))return null;const i=s.get(e);return null==i[t]?null:i[t]}(e,t),p=f.extent,{cache:h,rasterInfo:d}=f;if(p&&p.xmin===n.xmin&&p.xmax===n.xmax&&p.ymin===n.ymin&&p.ymax===n.ymax)return;const m=n.clone().normalize(),{spatialReference:y,transform:g}=d,x=new Set;for(let e=0;e<m.length;e++){const t=m[e];if(t.xmax-t.xmin<=a||t.ymax-t.ymin<=a)continue;let n=o.projectExtent(t,y,u);i.isSome(g)&&(n=g.inverseTransform(n));const s=new r({x:a,y:a,spatialReference:t.spatialReference});if(null===l&&!(l=o.projectResolution(s,y,t,u)))return;const{pyramidLevel:f,pyramidResolution:p,excessiveReading:h}=o.snapPyramid(l,d,c||"closest");if(h)return;const{storageInfo:v}=d,{origin:w}=v,_={x:Math.max(0,Math.floor((n.xmin-w.x)/p.x)),y:Math.max(0,Math.floor((w.y-n.ymax)/p.y))},b=Math.ceil((n.xmax-n.xmin)/p.x-.1),I=Math.ceil((n.ymax-n.ymin)/p.y-.1),S=f>0?v.pyramidBlockWidth:v.blockWidth,T=f>0?v.pyramidBlockHeight:v.blockHeight,R=1,M=Math.max(0,Math.floor(_.x/S)-R),C=Math.max(0,Math.floor(_.y/T)-R),k=Math.floor((_.x+b-1)/S)+R,P=Math.floor((_.y+I-1)/T)+R;for(let e=C;e<=P;e++)for(let t=M;t<=k;t++)x.add(`${f}/${e}/${t}`)}h.forEach(((e,t)=>{if(!x.has(t)){const e=h.get(t);(null==e||e.isResolved||e.isRejected)&&h.delete(t)}})),f.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},34759:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(35558),i(12997),i(26016),i(76519),i(36935),i(36500),i(56117),i(62663),i(43338),i(61952)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h,d,m,y,g,x,v,w,_){"use strict";const b=function(e,t){const i=e.get(t);return i&&i.values},I=function(e,t){const i=e.get(t);return i&&i.values[0]};let S=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",e}e._inheritsLoose(i,t);var n=i.prototype;return n.open=async function(e){var t;await this.init();const i=e?r.unwrap(e.signal):null,{data:n}=await this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:i});if(!n)throw new l("tiffraster:open","failed to open url "+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);const{littleEndian:a,firstIFD:o,isBigTiff:s}=g.parseSignature(n),c=[];await this.readIFDs(c,n,a,o,0,s?8:4,i);const u=g.getImageInfo(c),{width:f,height:d,tileWidth:y,tileHeight:w,planes:_,pixelType:b,compression:I,firstPyramidLevel:S,maximumPyramidLevel:T,pyramidBlockWidth:R,pyramidBlockHeight:M,tileBoundary:C,metadata:k}=u,P=h.fromJSON(u.extent),O=P.spatialReference,F=new p(P?{x:P.xmin,y:P.ymax,spatialReference:O}:{x:0,y:0}),N=new v({blockWidth:y,blockHeight:w,pyramidBlockWidth:R,pyramidBlockHeight:M,compression:I,origin:F,firstPyramidLevel:S,maximumPyramidLevel:T,blockBoundary:C}),D=new p({x:(P.xmax-P.xmin)/f,y:(P.ymax-P.ymin)/d,spatialReference:O}),B=k?{BandProperties:k.bandProperties,DataType:k.dataType}:{},L=new m({width:f,height:d,bandCount:_,pixelType:b,compression:I,pixelSize:D,storageInfo:N,spatialReference:O,keyProperties:B,extent:P,statistics:k?k.statistics:null});if(-1===(null==(t=this.ioConfig.skipExtensions)?void 0:t.indexOf("aux.xml"))){const t=await this._fetchAuxiliaryData(e);var E;null!=t&&(L.statistics=null!=(E=t.statistics)?E:L.statistics,L.histograms=t.histograms,t.histograms&&!r.isSome(L.statistics)&&(L.statistics=x.estimateStatisticsFromHistograms(t.histograms)))}if(this._set("rasterInfo",L),this._headerInfo={littleEndian:a,isBigTiff:s,ifds:c,...u},!this._headerInfo.isSupported)throw new l("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);this.updateTileInfo()},n.fetchRawTile=async function(e,t,i,r={}){if(!this._headerInfo&&this._headerInfo.isSupported)return null;const{blockBoundary:n}=this.rasterInfo.storageInfo,a=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,o=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,s=n[e];if(!s||s.maxRow<t||s.maxCol<i||s.minRow>t||s.minCol>i)return null;const l=this.getTileLocation(e,t,i);if(!l)return null;const{range:c,actualTileWidth:u,actualTileHeight:f,ifd:p}=l,{data:h}=await this.request(this.url,{range:c,responseType:"array-buffer",signal:r.signal}),d=await this.decodePixelBlock(h,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:p,offset:0,size:0},width:a,height:o,planes:null,pixelType:null});let m,y,g;if(u!==a||f!==o){let e=d.mask;if(e)for(m=0;m<o;m++)if(g=m*a,m<f)for(y=u;y<a;y++)e[g+y]=0;else for(y=0;y<a;y++)e[g+y]=0;else for(e=new Uint8Array(a*o),d.mask=e,m=0;m<f;m++)for(g=m*a,y=0;y<u;y++)e[g+y]=1}return d},n.readIFDs=async function(e,t,i,r,n,a=4,o){if(!r)return null;(r>=t.byteLength||r<0)&&(t=(await this.request(this.url,{range:{from:r+n,to:r+n+this._bufferSize},responseType:"array-buffer",signal:o})).data,n=r+n,r=0);const s=await this.readIFD(t,i,r,n,y.TIFF_TAGS,a,o);if(e.push(s.ifd),!s.nextIFD)return null;await this.readIFDs(e,t,i,s.nextIFD-n,n,a,o)},n.readIFD=async function(e,t,i,r,n=y.TIFF_TAGS,a=4,o){if(!e)return null;const s=g.parseIFD(e,t,i,r,n,a);if(s.success){const i=[];if(s.ifd.forEach((e=>{e.values||i.push(e)})),i.length>0){const n=i.map((e=>e.offlineOffsetSize)),a=Math.min.apply(null,n.map((e=>e[0])));if(Math.min.apply(null,n.map((e=>e[0]+e[1])))-a<=this._bufferSize){const{data:n}=await this.request(this.url,{range:{from:a,to:a+this._bufferSize},responseType:"array-buffer",signal:o});e=n,r=a,i.forEach((i=>g.parseFieldValues(e,t,i,r)))}}if(s.ifd.has("GEOKEYDIRECTORY")){const i=s.ifd.get("GEOKEYDIRECTORY"),n=i.values;if(n&&n.length>4){const a=n[0]+"."+n[1]+"."+n[2],s=await this.readIFD(e,t,i.valueOffset+6-r,r,y.GEO_KEYS,2,o);i.data=s.ifd,i.data&&i.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}return s}if(s.requiredBufferSize&&s.requiredBufferSize!==e.byteLength){const i=await this.request(this.url,{range:{from:r,to:r+s.requiredBufferSize+4},responseType:"array-buffer",signal:o});return(e=i.data).byteLength<s.requiredBufferSize?null:this.readIFD(e,t,0,r,y.TIFF_TAGS,4,o)}},n.getTileLocation=function(e,t,i){const{firstPyramidLevel:r,blockBoundary:n}=this.rasterInfo.storageInfo,a=0===e?0:e-(r-1),o=this._headerInfo.ifds[a];if(!o)return null;const s=b(o,"TILEOFFSETS");if(void 0===s)return null;const l=b(o,"TILEBYTECOUNTS"),{minRow:c,minCol:u,maxRow:f,maxCol:p}=n[a];if(t>f||i>p||t<c||i<u)return null;const h=I(o,"IMAGEWIDTH"),d=I(o,"IMAGELENGTH"),m=I(o,"TILEWIDTH"),y=I(o,"TILELENGTH"),g=t*(p+1)+i,x=s[g],v=l[g];return null==x||null==v?null:{range:{from:x,to:x+v-1},ifd:o,actualTileWidth:i===p?h%m:m,actualTileHeight:t===f?d%y:y}},n._fetchAuxiliaryData=async function(e){try{const{data:t}=await this.request(this.url+".aux.xml",{responseType:"xml",signal:null==e?void 0:e.signal});return _.parsePAMInfo(t)}catch{return null}},i}(w);return t.__decorate([o.property()],S.prototype,"_files",void 0),t.__decorate([o.property()],S.prototype,"_headerInfo",void 0),t.__decorate([o.property()],S.prototype,"_bufferSize",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],S.prototype,"datasetFormat",void 0),S=t.__decorate([s.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],S),S}.apply(t,r))||(e.exports=n)},61952:(e,t,i)=>{var r,n;r=[t,i(23084),i(26016),i(69263),i(50189)],void 0===(n=function(e,i,r,n,a){"use strict";function o(e,t){if(!e||!t)return null;const i=[];for(let r=0;r<e.length;r++)i.push(e[r]),i.push(t[r]);return i}function s(e){if(!e)return null;let t=Number(e);if(!isNaN(t)&&0!==t)return new i({wkid:t});const r=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((e=>e.trim())).filter((e=>""!==e)),n=r[r.length-1].split(",");return"EPSG"!==n[0]||(t=Number(n[1]),isNaN(t)||0===t)?new i({wkt:e}):new i({wkid:t})}t.parsePAMInfo=function(e){var t;if("pamdataset"!==(null==e||null==(t=e.documentElement.tagName)?void 0:t.toLowerCase()))return{};const i={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((e=>{if(1===e.nodeType)if(n.isSameTagIgnoreNS(e,"SRS")){if(!i.spatialReference){const t=n.getElementValue(e);i.spatialReference=s(t)}}else if(n.isSameTagIgnoreNS(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){const{spatialReference:t,transform:r}=function(e){var t;const i=n.getElement(e,"GeodataXform"),r=s(n.getElementNumericValue(i,"SpatialReference/WKID")||n.getElementValue(i,"SpatialReference/WKT"));if("typens:PolynomialXform"!==i.getAttribute("xsi:type"))return{spatialReference:r,transform:null};const l=null!=(t=n.getElementNumericValue(i,"PolynomialOrder"))?t:1,c=n.getElementNumericValues(i,"CoeffX/Double"),u=n.getElementNumericValues(i,"CoeffY/Double"),f=n.getElementNumericValues(i,"InverseCoeffX/Double"),p=n.getElementNumericValues(i,"InverseCoeffY/Double"),h=o(c,u),d=o(f,p);return{spatialReference:r,transform:new a({polynomialOrder:l,forwardCoefficients:h,inverseCoefficients:d})}}(e);i.transform=r,i.spatialReference||(i.spatialReference=t)}else n.getElements(e,"MDI").forEach((e=>i.metadata[e.getAttribute("key")]=n.getElementValue(e)));else if(n.isSameTagIgnoreNS(e,"PAMRasterBand")){const t=function(e){var t;const i=n.getElementNumericValue(e,"NoDataValue"),r=n.getElement(e,"Histograms/HistItem"),a=n.getElementNumericValue(r,"HistMin"),o=n.getElementNumericValue(r,"HistMax"),s=n.getElementNumericValue(r,"BucketCount"),l=null==(t=n.getElementValue(r,"HistCounts"))?void 0:t.split("|").map((e=>Number(e)));let c,u,f,p;n.getElements(e,"Metadata/MDI").forEach((e=>{var t;const i=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":c=i;break;case"STATISTICS_MAXIMUM":u=i;break;case"STATISTICS_MEAN":f=i;break;case"STATISTICS_STDDEV":p=i}}));const h=n.getElementNumericValue(e,"Metadata/SourceBandIndex");return{noDataValue:i,histogram:null!=l&&l.length&&null!=c&&null!=u?{min:a,max:o,size:s||l.length,counts:l}:null,sourceBandIndex:h,statistics:null!=c&&null!=u?{min:c,max:u,avg:f,stddev:p}:null}}(e);null!=t.sourceBandIndex&&null==i.rasterBands[t.sourceBandIndex]?i.rasterBands[t.sourceBandIndex]=t:i.rasterBands.push(t)}}));const r=i.rasterBands;if(r){const e=!!r[0].statistics;i.statistics=e?r.map((e=>e.statistics)):null;const t=!!r[0].histogram;i.histograms=t?r.map((e=>e.histogram)):null}return i},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},69263:(e,t)=>{var i;void 0===(i=function(e){"use strict";function i(e,t){if(!e||!t)return[];let r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const n=[];if(t){const a=i(e,r);for(let e=0;e<a.length;e++)i(a[e],t).forEach((e=>n.push(e)));return n}const a=e.getElementsByTagNameNS("*",r);if(!a||0===a.length)return[];for(let e=0;e<a.length;e++)n.push(a[e]||a.item[e]);return n}function r(e,t){if(!e||!t)return null;let n=t;t.indexOf("/")>-1?(n=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const a=i(e,n);return a.length>0?t?r(a[0],t):a[0]:null}function n(e,t=null){const i=t?r(e,t):e;let n;return i?(n=i.textContent||i.nodeValue,n?n.trim():null):null}function a(e,t){const r=i(e,t),n=[];let a;for(let e=0;e<r.length;e++)a=r[e].textContent||r[e].nodeValue,a&&(a=a.trim(),""!==a&&n.push(a));return n}t.getElement=r,t.getElementNumericValue=function(e,t){const i=n(e,t);return Number(i)},t.getElementNumericValues=function(e,t){return a(e,t).map((e=>Number(e)))},t.getElementValue=n,t.getElementValues=a,t.getElements=i,t.getNodeNameIgnoreNS=function(e){return e.nodeName.slice(e.nodeName.lastIndexOf(":")+1)},t.getSpaceDelimitedNumericValues=function(e,t=null){return n(e,t).split(" ").map((e=>Number(e)))},t.isSameTagIgnoreNS=function(e,t){var i;const r=null==e||null==(i=e.nodeName)?void 0:i.toLowerCase(),n=t.toLowerCase();return r.slice(r.lastIndexOf(":")+1)===n},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=i)},85775:(e,t,i)=>{var r,n;r=[t,i(49359),i(56750),i(70272),i(35558),i(12997),i(26016),i(35477),i(79928)],void 0===(n=function(e,i,r,n,a,o,s,l,c){"use strict";const u=5e-4,f=function(e,t){const i=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||i)};function p(e,t,r,a=null){if(e.spatialReference.equals(t))return e;const s=f(e.spatialReference,t);if(s&&!c.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");const l=r.center,u=new o({xmin:l.x-e.x/2,xmax:l.x+e.x/2,ymin:l.y-e.y/2,ymax:l.y+e.y/2,spatialReference:e.spatialReference}),p=s?c.project(u,t,a):n.project(u,t);return null==p?null:{x:p.xmax-p.xmin,y:p.ymax-p.ymin}}function h(e,t=.01){return l.getMetersPerUnitForSR(e)?t/l.getMetersPerUnitForSR(e):0}function d(e,t,a=null,o=!0){const s=e.spatialReference;if(s.equals(t))return e;const l=f(s,t);if(l&&!c.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");const p=l?c.project(e,t,a):n.project(e,t);if(p&&o&&t.isGeographic){var d,m;const[t,i]=s.isWebMercator?r.getInfo(s).origin:null!=(d=null==(m=r.getInfo(s))?void 0:m.valid)?d:[],n=h(s);n&&null!=t&&null!=i&&(Math.abs(e.x-t)<n&&Math.abs(180-p.x)<u?p.x-=360:Math.abs(e.x-i)<n&&Math.abs(180+p.x)<u&&(p.x+=360))}return p}function m(e,t,o=null,s=!0){var l,p,m,y;const g=e.spatialReference;if(g.equals(t))return e;const x=f(g,t);if(x&&!c.isLoaded())throw new i("rasterprojectionhelper-projectExtent","projection engine is not loaded");const v=x?c.project(e,t,o):n.project(e,t);let[w,_]=null!=(l=null==(p=r.getInfo(g))?void 0:p.origin)?l:[];if(v&&s&&g.isWebMercator&&t.isGeographic&&null!=w&&null!=_){const i=.001,r=1e3;if(Math.abs(e.xmin-w)<i&&Math.abs(_-e.xmax)>r&&Math.abs(180-v.xmax)<u){v.xmin=-180;const i=[];i.push(new a(e.xmax,e.ymin,g)),i.push(new a(e.xmax,(e.ymin+e.ymax)/2,g)),i.push(new a(e.xmax,e.ymax,g));const r=i.map((e=>d(e,t,o))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));v.xmax=Math.max.apply(null,r)}if(Math.abs(e.xmax-_)<i&&Math.abs(w-e.xmin)>r&&Math.abs(180+v.xmin)<u){v.xmax=180;const i=[];i.push(new a(e.xmin,e.ymin,g)),i.push(new a(e.xmin,(e.ymin+e.ymax)/2,g)),i.push(new a(e.xmin,e.ymax,g));const r=i.map((e=>d(e,t,o))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));v.xmin=Math.min.apply(null,r)}}[w,_]=t.isWebMercator?r.getInfo(t).origin:null!=(m=null==(y=r.getInfo(t))?void 0:y.valid)?m:[];const b=h(t);return b&&null!=w&&null!=_&&(Math.abs(v.xmin-w)<b&&(v.xmin=w),Math.abs(v.xmax-_)<b&&(v.xmax=_)),v}t.computeProjectedScales=function(e,t,i=512,r=!0){const{extent:n,spatialReference:o,pixelSize:s}=e,c=p(new a({x:s.x,y:s.y,spatialReference:o}),t,n);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null};const u=(c.x+c.y)/2,f=l.getMetersPerUnitForSR(t),h=u*f*96*39.37,d=t.isGeographic?512/i*295828763.7958547:512/i*591657527.591555;let y=!1;if(r&&(t.isGeographic||t.isWebMercator)){const e=m(n,t);y=e.xmin*e.xmax<0}let g,x=h;if(y){x=d;const e=x/(96*f*39.37);g=p(new a({x:e,y:e,spatialReference:t}),o,n)}else{g={x:s.x,y:s.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let i=0;for(;x<.5005*d&&i<t;)i++,x*=2,g.x*=2,g.y*=2;Math.max(x,d)/Math.min(x,d)<=1.001&&(x=d)}const v=[],w=[],_=Math.min(70.5310735,h)/1.001;for(;x>=_;)v.push(x),w.push({x:g.x,y:g.y}),x/=2,g.x/=2,g.y/=2;return{projectedPixelSize:c,scales:v,srcResolutions:w}},t.defaultGridSpacing=32,t.getProjectionOffsetGrid=function(e,t,n,o=null,s=null,l=!1,u=[32,32]){var p,h;if(f(e.spatialReference,t.spatialReference)&&!c.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&n))return null;const{xmin:m,ymin:y,xmax:g,ymax:x}=e,v=e.spatialReference,w=t.spatialReference,[_,b]=null!=(p=null==(h=r.getInfo(v))?void 0:h.valid)?p:[],I={x:u[0]*n.x,y:u[1]*n.y},S={cols:Math.ceil((g-m)/I.x-.1)+1,rows:Math.ceil((x-y)/I.y-.1)+1},T=I.x,R=I.y,M=[];let C,k=!1;for(let e=0;e<S.cols;e++){const i=[];for(let r=0;r<S.rows;r++){let n=d(new a({x:m+T*e,y:x-R*r,spatialReference:v}),w,o);s&&(n=s.inverseTransform(n)),i.push(n),e>0&&l&&n&&C[r]&&null!=_&&n.x<C[r].x&&(n.x+=b-_),n?(M.push((n.x-t.xmin)/(t.xmax-t.xmin)),M.push((t.ymax-n.y)/(t.ymax-t.ymin))):(M.push(NaN),M.push(NaN),k=!0)}C=i}const P=function(e,t){const i=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,r=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(i-e[2*t.rows+2]),Math.abs(r-e[2*t.rows+3])]}(M,S),O=new Float32Array((S.cols-1)*(S.rows-1)*2*6),F=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),N=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<S.cols-1;e++){for(let t=0;t<S.rows-1;t++){let i=e*S.rows*2+2*t;const r=M[i],n=M[i+1],a=M[i+2],o=M[i+3];i+=2*S.rows;const s=M[i],l=M[i+1],c=M[i+2],u=M[i+3];let f=0,p=12*(t*(S.cols-1)+e);for(let e=0;e<3;e++)O[p++]=F[f++]*r+F[f++]*a+F[f++]*c;f=0;for(let e=0;e<3;e++)O[p++]=F[f++]*n+F[f++]*o+F[f++]*u;f=0;for(let e=0;e<3;e++)O[p++]=N[f++]*r+N[f++]*s+N[f++]*c;f=0;for(let e=0;e<3;e++)O[p++]=N[f++]*n+N[f++]*l+N[f++]*u}if(k)for(let e=0;e<O.length;e++)isNaN(O[e])&&(O[e]=-1)}return{offsets:M,error:P,coefficients:O,spacing:u,size:[S.cols-1,S.rows-1]}},t.load=async function(){if(c.isLoaded()||!c.isSupported())return null;await c.load()},t.projectExtent=m,t.projectPoint=d,t.projectResolution=p,t.snapPyramid=function(e,t,i){const r=Math.log(e.x/t.pixelSize.x)/Math.LN2,n=Math.log(e.y/t.pixelSize.y)/Math.LN2,o=t.storageInfo.maximumPyramidLevel||0;let s="down"===i?Math.floor(Math.min(r,n)):"up"===i?Math.ceil(Math.max(r,n)):Math.round((r+n)/2),l=!1;s<0?s=0:s>o&&(l=s>o+3,s=o);const c=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new a({x:c*t.nativePixelSize.x,y:c*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},50189:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(56162),i(35558),i(12997),i(26016)],void 0===(n=function(e,t,i,r,n,a,o,s,l,c,u,f,p,h){"use strict";function d(e,t,i){const{x:r,y:n}=t;if(i<2)return{x:e[0]+r*e[2]+n*e[4],y:e[1]+r*e[3]+n*e[5]};if(2===i){const t=r*r,i=n*n,a=r*n;return{x:e[0]+r*e[2]+n*e[4]+t*e[6]+a*e[8]+i*e[10],y:e[1]+r*e[3]+n*e[5]+t*e[7]+a*e[9]+i*e[11]}}const a=r*r,o=n*n,s=r*n,l=a*r,c=a*n,u=r*o,f=n*o;return{x:e[0]+r*e[2]+n*e[4]+a*e[6]+s*e[8]+o*e[10]+l*e[12]+c*e[14]+u*e[16]+f*e[18],y:e[1]+r*e[3]+n*e[5]+a*e[7]+s*e[9]+o*e[11]+l*e[13]+c*e[15]+u*e[17]+f*e[19]}}function m(e,t,i){const{xmin:r,ymin:n,xmax:a,ymax:o,spatialReference:s}=t;let l=[];if(i<2)l.push({x:r,y:o}),l.push({x:a,y:o}),l.push({x:r,y:n}),l.push({x:a,y:n});else{let e=10;for(let t=0;t<e;t++)l.push({x:r,y:n+(o-n)*t/(e-1)}),l.push({x:a,y:n+(o-n)*t/(e-1)});e=8;for(let t=1;t<=e;t++)l.push({x:r+(a-r)*t/e,y:n}),l.push({x:r+(a-r)*t/e,y:o})}l=l.map((t=>d(e,t,i)));const c=l.map((e=>e.x)),u=l.map((e=>e.y));return new p({xmin:Math.min.apply(null,c),xmax:Math.max.apply(null,c),ymin:Math.min.apply(null,u),ymax:Math.max.apply(null,u),spatialReference:s})}let y=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).polynomialOrder=1,e}e._inheritsLoose(i,t);var r=i.prototype;return r.forwardTransform=function(e){if("point"===e.type){const t=d(this.forwardCoefficients,e,this.polynomialOrder);return new f({x:t.x,y:t.y,spatialReference:e.spatialReference})}return m(this.forwardCoefficients,e,this.polynomialOrder)},r.inverseTransform=function(e){if("point"===e.type){const t=d(this.inverseCoefficients,e,this.polynomialOrder);return new f({x:t.x,y:t.y,spatialReference:e.spatialReference})}return m(this.inverseCoefficients,e,this.polynomialOrder)},e._createClass(i,[{key:"inverseCoefficients",get:function(){let e=this._get("inverseCoefficients");const t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){const[t,i,r,n,a,o]=e,s=r*o-a*n,l=a*n-r*o;return[(a*i-t*o)/s,(r*i-t*n)/l,o/s,n/l,-a/s,-r/l]}(t)),e},set:function(e){this._set("inverseCoefficients",e)}}]),i}(u.JSONSupport);return t.__decorate([a.property({json:{write:!0}})],y.prototype,"polynomialOrder",void 0),t.__decorate([a.property({json:{write:!0}})],y.prototype,"forwardCoefficients",void 0),t.__decorate([a.property({dependsOn:["forwardCoefficients"],json:{write:!0}})],y.prototype,"inverseCoefficients",null),y=t.__decorate([o.subclass("esri.layers.support.rasterTransforms.PolynomialTransform")],y),y}.apply(t,r))||(e.exports=n)},89425:(e,t,i)=>{var r,n;r=[t,i(72146)],void 0===(n=function(e,i){"use strict";const r={type:i,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:n}}}}};function n(e,t,r,n){if(!e)return null;const{minScale:a,maxScale:o,minLOD:s,maxLOD:l}=t;if(null!=s&&null!=l)return n&&n.ignoreMinMaxLOD?i.fromJSON(e):i.fromJSON({...e,lods:e.lods.filter((({level:e})=>null!=e&&e>=s&&e<=l))});if(0!==a&&0!==o){const t=e=>Math.round(1e4*e)/1e4,r=a?t(a):1/0,n=o?t(o):-1/0;return i.fromJSON({...e,lods:e.lods.filter((e=>{const i=t(e.scale);return i<=r&&i>=n}))})}return i.fromJSON(e)}t.readServiceTileInfo=n,t.serviceTileInfoProperty=r,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)}}]);