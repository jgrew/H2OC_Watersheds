self.webpackChunkRemoteClient([152],{467:function(e,t,r){"use strict";var a=r(18),s=(r(7),r(3),r(4),r(20)),n=r(19),o=(r(24),r(34),r(35),r(131));let i=class extends o.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(a.a)([Object(s.b)({readOnly:!0})],i.prototype,"supportsTileUpdates",null),Object(a.a)([Object(s.b)({constructOnly:!0})],i.prototype,"remoteClient",void 0),Object(a.a)([Object(s.b)({constructOnly:!0})],i.prototype,"service",void 0),Object(a.a)([Object(s.b)({dependsOn:["tileStore.tileScheme.spatialReference"]})],i.prototype,"spatialReference",null),Object(a.a)([Object(s.b)({constructOnly:!0})],i.prototype,"tileInfo",void 0),Object(a.a)([Object(s.b)({constructOnly:!0})],i.prototype,"tileStore",void 0),i=Object(a.a)([Object(n.a)("esri.views.2d.layers.features.processors.BaseProcessor")],i);var c=i;t.a=c},677:function(e,t,r){"use strict";r.r(t);var a=r(18),s=(r(7),r(1)),n=(r(3),r(4),r(20),r(19)),o=(r(24),r(34),r(35),r(228)),i=r(0);r(81),(()=>{if(!("document"in i.a))return()=>null;const e=document.createElement("canvas");e.getContext("2d"),e.height=512,e.width=1})();var c=r(467);let l=class extends c.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&Object(o.a)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}async onTileData(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)&&"replace"!==t.type||this._tileKeyToFeatureSets.set(e.key.id,new Map);const a=this._tileKeyToFeatureSets.get(e.key.id);Object(s.g)(t.addOrUpdate)&&a.set(t.addOrUpdate.instance,t);let n=t.end;if(a.forEach((e=>n=n||e.end)),!n)return;const o=[];a.forEach((e=>{Object(s.g)(e.addOrUpdate)&&o.push(e.addOrUpdate)}));const i=function(e,t,r,a){const{blurRadius:s,fieldOffset:n,field:o}=t,i=new Float64Array(262144),c=function(e){const t=Math.round(3*e),r=2*e*e,a=new Float64Array(2*t+1);for(let s=0;s<=a.length;s++)a[s]=Math.exp(-Math.pow(s-t,2)/r)/Math.sqrt(2*Math.PI)*(e/2);return a}(s),l=Math.round(3*s);let d,u=Number.NEGATIVE_INFINITY;const p=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(o,n),h=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(h.has(t))continue;h.add(t);const r=e.readLegacyPointGeometry(),a=+p(e),s=r.x-l,n=r.y-l,o=Math.max(0,s),y=Math.max(0,n),f=Math.min(512,r.y+l),b=Math.min(512,r.x+l);for(let e=y;e<f;e++){const t=c[e-n];for(let r=o;r<b;r++){const n=c[r-s];d=i[512*e+r]+=t*n*a,d>u&&(u=d)}}}}return{matrix:i.buffer,max:u}}(o,this._schema.mesh),c={tileKey:e.key.id,intensityInfo:i},l=[i.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",c,{...r,transferList:l})}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};l=Object(a.a)([Object(n.a)("esri.views.2d.layers.features.processors.HeatmapProcessor")],l);var d=l;t.default=d}});