(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[6839],{56839:(e,t,i)=>{var r,a;r=[i,i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(59376),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(40810),i(95791),i(64393),i(44071),i(8336),i(23704),i(25548),i(52058),i(59332),i(41530)],void 0===(a=function(e,t,r,a,n,o,l,s,c,p,h,u,d,f,y,v,m,_,b,g,w,S,T,A,C){"use strict";const L=o.getLogger("esri.layers.ElevationLayer");let O=function(e){function r(...t){var i;return(i=e.call(this,...t)||this).copyright=null,i.heightModelInfo=null,i.path=null,i.opacity=1,i.operationalLayerType="ArcGISTiledElevationServiceLayer",i.sourceJSON=null,i.type="elevation",i.url=null,i.version=null,i._lercDecoder=C.acquireDecoder(),i}t._inheritsLoose(r,e);var a=r.prototype;return a.normalizeCtorArgs=function(e,t){return"string"==typeof e?{url:e,...t}:e},a.destroy=function(){C.releaseDecoder(this._lercDecoder),this._lercDecoder=null},a.readVersion=function(e,t){let i=t.currentVersion;return i||(i=9.3),i},a.load=function(e){const t=n.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:e=>{for(let t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new h("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).then((()=>this._fetchImageService(t)),(()=>this._fetchImageService(t)))),y.resolve(this)},a.fetchTile=function(e,t,i,r){r=r||{signal:null};const a=n.isSome(r.signal)?r.signal:r.signal=y.createAbortController().signal,o={responseType:"array-buffer",signal:a},l={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then((()=>this._fetchTileAvailability(e,t,i,r))).then((()=>v(this.getTileUrl(e,t,i),o))).then((e=>this._lercDecoder.decode(e.data,l,a))).then((e=>({values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})))},a.getTileUrl=function(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,a=u.objectToQuery({...this.parsedUrl.query,blankTile:!r&&null});return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${a?"?"+a:""}`},a.queryElevation=async function(e,t){const{ElevationQuery:r}=await new Promise((function(e,t){i.e(5994).then(function(){var t=[i(5994)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}));return y.throwIfAborted(t),(new r).query(this,e,t)},a.createElevationSampler=async function(e,t){const{ElevationQuery:r}=await new Promise((function(e,t){i.e(5994).then(function(){var t=[i(5994)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}));return y.throwIfAborted(t),(new r).createSampler(this,e,t)},a._fetchTileAvailability=function(e,t,i,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,r):y.resolve("unknown")},a._fetchImageService=async function(e){if(this.sourceJSON)return this.sourceJSON;const t={query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:e},i=await v(this.parsedUrl.path,t);i.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl})},t._createClass(r,[{key:"minScale",set:function(e){this.constructed&&L.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)},get:function(){}},{key:"maxScale",set:function(e){this.constructed&&L.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)},get:function(){}}]),r}(A.ArcGISCachedService(S.ArcGISService(w.OperationalLayer(T.PortalLayer(_.MultiOriginJSONMixin(m))))));return r.__decorate([s.property({json:{read:{source:"copyrightText"}}})],O.prototype,"copyright",void 0),r.__decorate([s.property({readOnly:!0,type:b})],O.prototype,"heightModelInfo",void 0),r.__decorate([s.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],O.prototype,"path",void 0),r.__decorate([s.property({type:["show","hide"]})],O.prototype,"listMode",void 0),r.__decorate([s.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],O.prototype,"minScale",null),r.__decorate([s.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],O.prototype,"maxScale",null),r.__decorate([s.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],O.prototype,"opacity",void 0),r.__decorate([s.property({type:["ArcGISTiledElevationServiceLayer"]})],O.prototype,"operationalLayerType",void 0),r.__decorate([s.property()],O.prototype,"sourceJSON",void 0),r.__decorate([s.property({json:{read:!1},value:"elevation",readOnly:!0})],O.prototype,"type",void 0),r.__decorate([s.property(g.url)],O.prototype,"url",void 0),r.__decorate([s.property()],O.prototype,"version",void 0),r.__decorate([c.reader("version",["currentVersion"])],O.prototype,"readVersion",null),O=r.__decorate([p.subclass("esri.layers.ElevationLayer")],O),O}.apply(t,r))||(e.exports=a)},59332:(e,t,i)=>{var r,a;r=[t,i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(59376),i(99752),i(4037),i(51916),i(18377),i(23084),i(26016),i(89425),i(83568)],void 0===(a=function(e,i,r,a,n,o,l,s,c,p,h,u,d,f,y,v){"use strict";t.ArcGISCachedService=e=>{let t=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}i._inheritsLoose(t,e);var r=t.prototype;return r.readMinScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},r.readMaxScale=function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0},r.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new v.TilemapCache({layer:this}):null},i._createClass(t,[{key:"supportsBlankTile",get:function(){return this.version>=10.2}}]),t}(e);return r.__decorate([l.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),r.__decorate([l.property()],t.prototype,"minScale",void 0),r.__decorate([s.reader("service","minScale")],t.prototype,"readMinScale",null),r.__decorate([l.property()],t.prototype,"maxScale",void 0),r.__decorate([s.reader("service","maxScale")],t.prototype,"readMaxScale",null),r.__decorate([l.property({type:d})],t.prototype,"spatialReference",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),r.__decorate([l.property(y.serviceTileInfoProperty)],t.prototype,"tileInfo",void 0),r.__decorate([l.property()],t.prototype,"tilemapCache",void 0),r.__decorate([s.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),r.__decorate([l.property()],t.prototype,"version",void 0),t=r.__decorate([c.subclass("esri.layers.mixins.ArcGISCachedService")],t),t},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)},41530:(e,t,i)=>{var r,a;r=[t,i(58797),i(9720),i(84182)],void 0===(a=function(e,i,r,a){"use strict";let n=function(e){function t(t){var i;return(i=e.call(this,"LercWorker","_decode",t,{strategy:"dedicated"})||this).scheduler=t,i}i._inheritsLoose(t,e);var a=t.prototype;return a.decode=function(e,t,i){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},i):r.resolve(null)},a.getTransferList=function(e){return[e.buffer]},t}(a.WorkerHandle);const o=new Map;t.acquireDecoder=function(e){let t=o.get(e);return t||(t={instance:new n(e),ref:0},o.set(e,t)),++t.ref,t.instance},t.releaseDecoder=function(e){if(null==e)return;const t=e.scheduler,i=o.get(t);i&&--i.ref<=0&&(i.instance.destroy(),o.delete(t))},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)},24048:(e,t,i)=>{var r,a;r=[t,i(92231),i(49359),i(45630),i(40810)],void 0===(a=function(e,i,r,a,n){"use strict";let o=function(){function e(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}var t=e.prototype;return t.getAvailability=function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,a=i>>3,n=this._tileAvailabilityBitSet;return a<0||a>n.length?"unknown":n[a]&1<<r?"available":"unavailable"},t._updateFromData=function(e){const t=this.location.width,i=this.location.height;let r=!0,a=!0;const n=Math.ceil(t*i/8),o=new Uint8Array(n);let l=0;for(let t=0;t<e.length;t++){const i=t%8;e[t]?(a=!1,o[l]|=1<<i):r=!1,7===i&&++l}a?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=o,this.byteSize+=o.length)},e.fromDefinition=function(t,i){const o=t.service.request||n,{row:s,col:c,width:p,height:h}=t,u={query:{f:"json"}};return i=i?{...u,...i}:u,o(l(t),i).then((e=>e.data)).catch((e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:s,left:c,width:p,height:h},valid:!0,data:a.constant(p*h,0)};throw e})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==c||t.location.width!==p||t.location.height!==h))throw new r("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:s,left:c,width:p,height:h}});return e.fromJSON(t)}))},e.fromJSON=function(t){e.validateJSON(t);const r=new e;return r.location=Object.freeze(i.clone(t.location)),r._updateFromData(t.data),Object.freeze(r)},e.validateJSON=function(e){if(!e||!e.location)throw new r("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new r("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new r("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new r("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new r("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();function l(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}t.Tilemap=o,t.default=o,t.tilemapDefinitionId=function(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`},t.tilemapDefinitionUrl=l,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)},83568:(e,t,i)=>{var r,a;r=[t,i(58797),i(11285),i(74637),i(73462),i(26475),i(37055),i(99752),i(49359),i(4037),i(51916),i(18377),i(20499),i(9720),i(48199),i(37862),i(40810),i(75416),i(69788),i(79058),i(24048)],void 0===(a=function(e,i,r,a,n,o,l,s,c,p,h,u,d,f,y,v,m,_,b,g,w){"use strict";var S;const T=n.getLogger("esri.layers.support.TilemapCache");t.TilemapCache=S=function(e){function t(t){var i;return(i=e.call(this,t)||this)._handles=new _,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=m,i._prefetchingEnabled=!0,i}i._inheritsLoose(t,e);var r=t.prototype;return r.initialize=function(){this._tilemapCache=new g(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(()=>this._initializeTilemapDefinition())),b.init(this,"layer.tileInfo.lods",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()},r.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},r.castLevels=function(e){return e<=2?(T.error("Minimum levels for Tilemap is 3, but got ",e),3):e},r.fetchTilemap=function(e,t,i,r){if(!this._availableLevels[e])return f.reject(new c("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const a=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,a);if(n)return f.resolve(n);const o=r&&r.signal;return r={...r,signal:null},f.create(((e,t)=>{f.onAbort(o,(()=>t(f.createAbortError())));const i=w.tilemapDefinitionId(a);let n=this._pendingTilemapRequests[i];if(!n){n=w.Tilemap.fromDefinition(a,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=n,n.then(e,e)}n.then(e,t)}))},r.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"},r.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;const a=this.layer.tileInfo;for(a.updateTileInfo(r);;){const e=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==e)return e;if(!a.upsampleTile(r))return"unavailable"}},r.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof w.Tilemap){const a=r.getAvailability(t,i);return"unavailable"===a?f.reject(new c("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):a}if(f.isAbortError(r))throw r;return"unknown"})):f.reject(new c("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))},r.fetchAvailabilityUpsample=function(e,t,i,r,a){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,a).catch((e=>{if(f.isAbortError(e))throw e;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,a,o),o},r._fetchAvailabilityUpsamplePrefetch=async function(e,t,i,r,a,n){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this._handles.has(o))return;const l=f.createAbortController();n.then((()=>l.abort()),(()=>l.abort()));let s=!1;const c={remove(){s||(s=!0,l.abort())}};if(this._handles.add(c,o),await y.waitTicks(10,l.signal).catch((()=>{})),s||(s=!0,this._handles.remove(o)),f.isAborted(l))return;const p={id:e,level:t,row:i,col:r},h={...a,signal:l.signal},u=this.layer.tileInfo;for(let e=0;S._prefetches.length<S._maxPrefetch&&u.upsampleTile(p);++e){const e=this.fetchAvailability(p.level,p.row,p.col,h);S._prefetches.push(e);const t=()=>{S._prefetches.removeUnordered(e)};e.then(t,t)}},r._initializeTilemapDefinition=function(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?p.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}},r._tilemapFromCache=function(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const a=w.tilemapDefinitionId(r);return this._tilemapCache.get(a)},r._initializeAvailableLevels=function(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))},i._createClass(t,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}}]),t}(v),t.TilemapCache._maxPrefetch=4,t.TilemapCache._prefetches=new d({initialSize:S._maxPrefetch}),r.__decorate([o.property({constructOnly:!0,type:Number})],e.TilemapCache.prototype,"levels",void 0),r.__decorate([l.cast("levels")],e.TilemapCache.prototype,"castLevels",null),r.__decorate([o.property({readOnly:!0,dependsOn:["levels"],type:Number})],e.TilemapCache.prototype,"size",null),r.__decorate([o.property({constructOnly:!0,type:Number})],e.TilemapCache.prototype,"cacheByteSize",void 0),r.__decorate([o.property({constructOnly:!0})],e.TilemapCache.prototype,"layer",void 0),r.__decorate([o.property({constructOnly:!0})],e.TilemapCache.prototype,"request",void 0),t.TilemapCache=S=r.__decorate([s.subclass("esri.layers.support.TilemapCache")],e.TilemapCache),Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)},89425:(e,t,i)=>{var r,a;r=[t,i(72146)],void 0===(a=function(e,i){"use strict";const r={type:i,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:a}}}}};function a(e,t,r,a){if(!e)return null;const{minScale:n,maxScale:o,minLOD:l,maxLOD:s}=t;if(null!=l&&null!=s)return a&&a.ignoreMinMaxLOD?i.fromJSON(e):i.fromJSON({...e,lods:e.lods.filter((({level:e})=>null!=e&&e>=l&&e<=s))});if(0!==n&&0!==o){const t=e=>Math.round(1e4*e)/1e4,r=n?t(n):1/0,a=o?t(o):-1/0;return i.fromJSON({...e,lods:e.lods.filter((e=>{const i=t(e.scale);return i<=r&&i>=a}))})}return i.fromJSON(e)}t.readServiceTileInfo=a,t.serviceTileInfoProperty=r,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)},84182:(e,t,i)=>{var r,a;r=[t,i(58797),i(73462),i(9720),i(51972)],void 0===(a=function(e,i,r,a,n){"use strict";const o=r.getLogger("esri.views.3d.support.WorkerHandle");let l=function(){function e(e,t,i,r={}){this._methodName=t,this._promise=n.open(e,{...r,scheduler:i}).then((e=>{void 0===this._thread?(this._thread=e,this._promise=null,r.hasInitialize&&this.broadcast({},"initialize")):e.close()})),this._promise.catch((t=>o.error(`Failed to initialize ${e} worker: ${t}`)))}var t=e.prototype;return t.destroy=function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null},t.invoke=function(e,t){if(this._thread){const i=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:i,signal:t})}return this._promise?this._promise.then((()=>(a.throwIfAborted(t),this.invoke(e,t)))):a.reject(null)},t.broadcast=function(e,t){return this._thread?a.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):a.reject()},i._createClass(e,[{key:"promise",get:function(){return this._promise}}]),e}();t.WorkerHandle=l,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=a)}}]);