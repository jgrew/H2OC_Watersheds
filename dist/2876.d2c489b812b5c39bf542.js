(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[2876],{6687:(e,t,r)=>{var n,s;n=[r(58797),r(3718)],void 0===(s=function(e,t){"use strict";return function(){function r(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}var n=r.prototype;return n.enqueue=function(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null},n.dequeue=function(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e},n.clear=function(){for(;t.isSome(this.dequeue()););},e._createClass(r,[{key:"entries",get:function(){return this._buffer}}]),r}()}.apply(t,n))||(e.exports=s)},73819:(e,t,r)=>{var n,s;n=[t,r(58797),r(3718),r(6687),r(34254),r(44789)],void 0===(s=function(e,r,n,s,i,o){"use strict";let a=function(){function e(e=[],t=8096){this._nodes=0,this._root=new c(0,0,0),this._statisticFields=e,this._pool=t?new s(8096):null}var t=e.prototype;return t._acquire=function(e,t,r){this._nodes++;let s=null;return n.isSome(this._pool)&&(s=this._pool.dequeue()),n.isSome(s)?s.realloc(e,t,r):new c(e,t,r)},t._release=function(e){this._nodes--,n.isSome(this._pool)&&this._pool.enqueue(e)},t.dropLevels=function(e){this._forEachNode((t=>{if(t.depth>=e)for(let e=0;e<t.children.length;e++){const r=t.children[e];t.children[e]=null,r&&this._release(r)}}))},t.clear=function(){this.dropLevels(0)},t.insert=function(e,t,r=0){const n=o.FeatureSetReaderJSON.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();n.next();const s=n.readGeometry();if(!s)return;const[i,a]=s.coords,c=e.geohashX,u=e.geohashY;this.insertCursor(n,e.displayId,i,a,c,u,t,r)},t.insertCursor=function(e,t,r,n,s,i,o,a=0){let c=this._root,u=0,l=0,h=0;for(;null!==c;){if(c.depth>=a&&(c.count+=1,c.xTotal+=r,c.yTotal+=n,c.xGeohashTotal+=s,c.yGeohashTotal+=i,c.displayId=t,this._updateStatisticsCursor(e,c,1)),u>=o)return void c.add(t);const d=Math.ceil((u+1)/2),f=Math.floor((u+1)/2),p=1-u%2,_=30-(3*d+2*f),y=30-(2*d+3*f),g=(s&7*p+3*(1-p)<<_)>>_,m=(i&3*p+7*(1-p)<<y)>>y,I=g+m*(8*p+4*(1-p));l=l<<3*p+2*(1-p)|g,h=h<<2*p+3*(1-p)|m,null==c.children[I]&&(c.children[I]=this._acquire(l,h,u+1)),u+=1,c=c.children[I]}},t.remove=function(e,t){const r=o.FeatureSetReaderJSON.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();r.next();const n=r.readGeometry();if(!n)return;const[s,i]=n.coords,a=e.geohashX,c=e.geohashY;this.removeCursor(r,s,i,a,c,t)},t.removeCursor=function(e,t,r,n,s,i){let o=this._root,a=0;for(;null!==o;){if(o.count-=1,o.xTotal-=t,o.yTotal-=r,o.xGeohashTotal-=n,o.yGeohashTotal-=s,this._updateStatisticsCursor(e,o,-1),a>=i)return void o.remove(e.getDisplayId());const c=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),l=1-a%2,h=30-(3*c+2*u),d=30-(2*c+3*u),f=((n&7*l+3*(1-l)<<h)>>h)+((s&3*l+7*(1-l)<<d)>>d)*(8*l+4*(1-l)),p=o.children[f];1===p.count&&(this._release(p),o.children[f]=null),a+=1,o=p}},t.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},t.findSingleOccupancyNode=function(e,t,r,n,s){let i=this._root;for(;null!==i;){const o=i.depth,a=i.xNode,c=i.yNode,u=1-o%2,l=i.xGeohashTotal/i.count,h=i.yGeohashTotal/i.count;if(1===i.count&&e<l&&l<=r&&t<h&&h<=n)return i;if(o>=s){i=i.next;continue}const d=Math.ceil((o+1)/2),f=Math.floor((o+1)/2),p=30-(3*d+2*f),_=30-(2*d+3*f),y=~((1<<p)-1),g=~((1<<_)-1),m=(e&y)>>p,I=(t&g)>>_,v=(r&y)>>p,b=(n&g)>>_,S=a<<3*u+2*(1-u),T=c<<2*u+3*(1-u),w=S+8*u+4*(1-u),E=T+4*u+8*(1-u),x=Math.max(S,m),F=Math.max(T,I),C=Math.min(w,v),A=Math.min(E,b);let R=null,O=null;for(let e=F;e<=A;e++)for(let t=x;t<=C;t++){const r=t-S+(e-T)*(8*u+4*(1-u)),n=i.children[r];n&&(R||(R=n,R.next=i.next),O&&(O.next=n),O=n,n.next=i.next)}i=R||i.next}return null},t.getRegionDisplayIds=function(e,t,r,n,s){let i=this._root;const o=[];for(;null!==i;){const a=i.depth,c=i.xNode,u=i.yNode;if(a>=s){const s=i.xGeohashTotal/i.count,a=i.yGeohashTotal/i.count;e<=s&&s<=r&&t<=a&&a<=n&&i.displayIds.forEach((e=>o.push(e))),i=i.next;continue}const l=Math.ceil((a+1)/2),h=Math.floor((a+1)/2),d=1-a%2,f=30-(3*l+2*h),p=30-(2*l+3*h),_=~((1<<f)-1),y=~((1<<p)-1),g=(e&_)>>f,m=(t&y)>>p,I=(r&_)>>f,v=(n&y)>>p,b=c<<3*d+2*(1-d),S=u<<2*d+3*(1-d),T=b+8*d+4*(1-d),w=S+4*d+8*(1-d),E=Math.max(b,g),x=Math.max(S,m),F=Math.min(T,I),C=Math.min(w,v);let A=null,R=null;for(let e=x;e<=C;e++)for(let t=E;t<=F;t++){const r=t-b+(e-S)*(8*d+4*(1-d)),n=i.children[r];n&&(A||(A=n,A.next=i.next),R&&(R.next=n),R=n,n.next=i.next)}i=A||i.next}return o},t.getRegionStatistics=function(e,t,r,n,s){let i=this._root,o=0,a=0,c=0;const u={};let l=0;for(;null!==i;){const h=i.depth,d=i.xNode,f=i.yNode;if(h>=s){const s=i.xGeohashTotal/i.count,h=i.yGeohashTotal/i.count;e<s&&s<=r&&t<h&&h<=n&&(o+=i.count,a+=i.xTotal,c+=i.yTotal,1===i.count&&(l=i.displayId),this._aggregateStatistics(u,i.statistics)),i=i.next;continue}const p=Math.ceil((h+1)/2),_=Math.floor((h+1)/2),y=1-h%2,g=30-(3*p+2*_),m=30-(2*p+3*_),I=~((1<<g)-1),v=~((1<<m)-1),b=(e&I)>>g,S=(t&v)>>m,T=(r&I)>>g,w=(n&v)>>m,E=d<<3*y+2*(1-y),x=f<<2*y+3*(1-y),F=E+8*y+4*(1-y),C=x+4*y+8*(1-y),A=Math.max(E,b),R=Math.max(x,S),O=Math.min(F,T),L=Math.min(C,w);let k=null,M=null;for(let s=R;s<=L;s++)for(let h=A;h<=O;h++){const d=h-E+(s-x)*(8*y+4*(1-y)),f=i.children[d];if(f){if(s!==R&&s!==L&&h!==A&&h!==O){const s=f.xGeohashTotal/f.count,i=f.yGeohashTotal/f.count;e<s&&s<=r&&t<i&&i<=n&&(o+=f.count,a+=f.xTotal,c+=f.yTotal,1===f.count&&(l=f.displayId),this._aggregateStatistics(u,f.statistics));continue}k||(k=f,k.next=i.next),M&&(M.next=f),M=f,f.next=i.next}}i=k||i.next}return{count:o,attributes:this._normalizeStatistics(u,o),xTotal:a,yTotal:c,referenceId:l}},t._forEachNode=function(e){let t=this._root;for(;null!==t;){const r=this._linkChildren(t)||t.next;e(t),t=r}},t._linkChildren=function(e){let t=null,r=null;for(let n=0;n<=e.children.length;n++){const s=e.children[n];s&&(t||(t=s,t.next=e.next),r&&(r.next=s),r=s,s.next=e.next)}return t},t._updateStatisticsCursor=function(e,t,r){for(const n of this._statisticFields){const s=n.name,i=n.inField?e.readAttribute(n.inField):e.getComputedNumericAtIndex(n.inFieldIndex);switch(n.statisticType){case"norm":{t.statistics[s]||(t.statistics[s]={});const o=n.inNormalizationField,a=e.readAttribute(o),c=t.statistics[s].onStatisticField||0,u=t.statistics[s].onStatisticNormalizationField||0;null==i||isNaN(i)||null==a||0===a||isNaN(a)||(t.statistics[s].onStatisticField=c+r*i,t.statistics[s].onStatisticNormalizationField=u+r*a);break}case"sum":case"avg":{t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});const e=t.statistics[s].value,n=t.statistics[s].nanCount;null==i||isNaN(i)?t.statistics[s].nanCount=n+r:t.statistics[s].value=e+r*i;break}case"avg_angle":{t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});const e=t.statistics[s].x,n=t.statistics[s].y,o=t.statistics[s].nanCount,a=Math.PI/180;null==i||isNaN(i)?t.statistics[s].nanCount=o+r:(t.statistics[s].x=e+r*Math.cos(i*a),t.statistics[s].y=n+r*Math.sin(i*a));break}case"mode":{t.statistics[s]||(t.statistics[s]={});const e=t.statistics[s][i]||0;t.statistics[s][i]=e+r;break}}}},t._aggregateStatistics=function(e,t){for(const r of this._statisticFields){const n=r.name;switch(r.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":e[n]||(e[n]={});for(const r in t[n]){const s=e[n][r]||0;e[n][r]=s+t[n][r]}}}},t._normalizeStatistics=function(e,t){const r={};for(const n of this._statisticFields){const s=n.name;switch(n.statisticType){case"norm":{const n=e[s];if(t&&null==n.onStatisticNormalizationField)break;if(t&&n.onStatisticNormalizationField){r[s]=n.onStatisticField/n.onStatisticNormalizationField;break}r[s]=0;break}case"sum":{if(!t)break;const{value:n,nanCount:i}=e[s];if(!(t-i))break;r[s]=n;break}case"avg":{if(!t)break;const{value:n,nanCount:i}=e[s];if(!(t-i))break;r[s]=n/(t-i);break}case"avg_angle":{if(!t)break;const{x:n,y:i,nanCount:o}=e[s];if(!(t-o))break;const a=n/(t-o),c=i/(t-o),u=180/Math.PI,l=Math.atan2(c,a)*u;r[s]=l;break}case"mode":{const t=e[s];let n=0,i=null;for(const e in t){const r=t[e];r>n&&(n=r,i=e)}r[s]="null"===i?null:i;break}}}return r},r._createClass(e,[{key:"count",get:function(){return this._root.count}},{key:"size",get:function(){return this._nodes}},{key:"poolSize",get:function(){return n.mapOr(this._pool,0,(e=>e.size))}},{key:"depth",get:function(){let e=0;return this._forEachNode((t=>e=Math.max(e,t.depth))),e}}]),e}(),c=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.displayIds=new Set,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(let e=0;e<this.children.length;e++)this.children[e]=null;this.xNode=e,this.yNode=t,this.depth=r}var t=e.prototype;return t.realloc=function(e,t,r){for(let e=0;e<this.children.length;e++)this.children[e]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this.displayIds.clear(),this},t.add=function(e){this.displayIds.add(e)},t.remove=function(e){this.displayIds.delete(e)},t.getLngLatBounds=function(){const e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),s=30-(2*t+3*r),o=this.xNode<<n,a=this.yNode<<s;return i.decodeGeohashXY({geohashX:o,geohashY:a},this.depth)},t.find=function(e,t,r,n,s,i){if(n>=r)return this;const o=1-n%2,a=3*o+2*(1-o),c=2*o+3*(1-o),u=30-s-a,l=30-i-c,h=((e&7*o+3*(1-o)<<u)>>u)+((t&3*o+7*(1-o)<<l)>>l)*(8*o+4*(1-o)),d=this.children[h];return null==d?null:d.find(e,t,r,n+1,s+a,i+c)},e}();t.GeohashTree=a,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},34254:(e,t)=>{var r;void 0===(r=function(e){"use strict";const r=16,n=new Float64Array(2),s=new Float64Array(2);function i(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function c(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){const r=a(e),n=t,s=!t;e[0]=s*e[0]+n*r,e[1]=s*r+n*e[1]}function l(e,t){const r=t>a(e);return u(e,r),r}function h(e,t){const o=c(n,-90,90),l=c(s,-180,180);for(let e=0;e<t.length;e++){const n=i(t.charCodeAt(e));e%2==0?(u(l,!!(r&n)),u(l,!!(4&n)),u(l,!!(1&n)),u(o,!!(8&n)),u(o,!!(2&n))):(u(o,!!(r&n)),u(o,!!(4&n)),u(o,!!(1&n)),u(l,!!(8&n)),u(l,!!(2&n)))}return e[0]=a(o),e[1]=a(l),e}function d(e,t,r){let i="";const a=c(n,-90,90),u=c(s,-180,180);for(let n=0;n<r;n++){let r=0;n%2?(r|=l(a,e)<<4,r|=l(u,t)<<3,r|=l(a,e)<<2,r|=l(u,t)<<1,r|=l(a,e)<<0):(r|=l(u,t)<<4,r|=l(a,e)<<3,r|=l(u,t)<<2,r|=l(a,e)<<1,r|=l(u,t)<<0),i+=o(r)}return i}function f(e){const t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function p(e){const t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function _(e,t){return t?1&e|(4&e)>>1|(r&e)>>2:(2&e)>>1|(8&e)>>2}function y(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(r&e)>>2}function g(e,t,n){const s=!((e.length-1)%2),a=e.substring(0,e.length-1),c=i(e.charCodeAt(e.length-1));let u=0,l=0,h=0,d=0;s?(u=8,l=4,h=1&c|(4&c)>>1|(r&c)>>2,d=(2&c)>>1|(8&c)>>2):(u=4,l=8,d=1&c|(4&c)>>1|(r&c)>>2,h=(2&c)>>1|(8&c)>>2);const f=h+t,p=d+n,_=Math.floor(f/u),y=Math.floor(p/l),m=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(f-_*u,p-y*l,s));return e.length>1&&(_||y)?g(a,_,y)+m:a+m}t.convertGeohash32ToXY=function(e,t){let r=0,n=0,s=30,o=30;for(let e=0;e<t.length;e++){const a=i(t.charCodeAt(e)),c=e%2==0;s-=c?3:2,o-=c?2:3,r|=_(a,c)<<s,n|=y(a,c)<<o}return{geohashX:r,geohashY:n}},t.decodeBase32Char=i,t.decodeGeohash=h,t.decodeGeohashXY=function(e,t){let r=-90,n=90,s=-180,i=180;for(let o=0;o<t;o++){const t=Math.ceil((o+1)/2),a=Math.floor((o+1)/2),c=1-o%2,u=30-(3*t+2*a),l=30-(2*t+3*a),h=3*c+2*(1-c),d=2*c+3*(1-c),f=3*c+7*(1-c)<<l,p=(7*c+3*(1-c)<<u&e.geohashX)>>u,_=(f&e.geohashY)>>l;for(let e=h-1;e>=0;e--){const t=(s+i)/2,r=p&1<<e?1:0;s=(1-r)*s+r*t,i=(1-r)*t+r*i}for(let e=d-1;e>=0;e--){const t=(r+n)/2,s=_&1<<e?1:0;r=(1-s)*r+s*t,n=(1-s)*t+s*n}}return[s,r,i,n]},t.encodeBase32Char=o,t.encodeGeohash=d,t.forEachIntersectingGeohash=function(e,t,r,n,s,i){const o=Math.abs(r-e),a=Math.abs(n-t),c=f(s),u=p(s),l=Math.ceil(a/u),_=Math.ceil(o/c),y=d(e,t,s);for(let s=0;s<l;s++)for(let o=0;o<_;o++){const a=g(y,s,o),[l,d]=h([0,0],a),f=l-c/2,p=d-u/2,_=l+c/2,m=d+u/2,I=c*u,v=Math.max(e,f),b=Math.max(t,p),S=Math.min(r,_)-v,T=Math.min(n,m)-b;i(a,Math.abs(S*T)/I)}},t.getIntersectingGeohashes=function(e,t,r,n,s){const i=Math.abs(r-e),o=Math.abs(n-t),a=f(s),c=p(s),u=Math.ceil(o/c),l=Math.ceil(i/a),h=d(e,t,s),_=new Array;for(let e=0;e<u;e++)for(let t=0;t<l;t++)_.push(g(h,e,t));return _},t.getRelativeGeohash=g,t.latDistPerGeohash=f,t.lonDistPerGeohash=p,t.setGeohashBuf=function(e,t,r,n,s){s%2&&(s+=1);let i=0,o=0,a=-90,c=90,u=-180,l=180;for(let e=0;e<s/2;e++){for(let t=0;t<5;t++){const r=(u+l)/2,s=n>r?1:0;i|=s<<29-(t+5*e),u=(1-s)*u+s*r,l=(1-s)*r+s*l}for(let t=0;t<5;t++){const n=(a+c)/2,s=r>n?1:0;o|=s<<29-(t+5*e),a=(1-s)*a+s*n,c=(1-s)*n+s*c}}e[2*t]=i,e[2*t+1]=o},t.setGeohashXY=function(e,t,r,n){n%2&&(n+=1);let s=0,i=0,o=-90,a=90,c=-180,u=180;for(let e=0;e<n/2;e++){for(let t=0;t<5;t++){const n=(c+u)/2,i=r>n?1:0;s|=i<<29-(t+5*e),c=(1-i)*c+i*n,u=(1-i)*n+i*u}for(let r=0;r<5;r++){const n=(o+a)/2,s=t>n?1:0;i|=s<<29-(r+5*e),o=(1-s)*o+s*n,a=(1-s)*n+s*a}}e.geohashX=s,e.geohashY=i},t.unpackXBits=_,t.unpackYBits=y,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},63634:(e,t,r)=>{var n,s;n=[t,r(3718),r(3438),r(6687)],void 0===(s=function(e,r,n,s){"use strict";const i="__esri_stream_id__",o="__esri_timestamp__";let a=function(){function e(e,t,r,n,s=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=r,this._purgeOptions=n,this.store=e,this.objectIdField=t,this.purgeInterval=s,this._useGeneratedIds=this.objectIdField===i}var t=e.prototype;return t.add=function(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return;const t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){const e=r.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,i=n.clamp(e,0,1e3);this._trackIdToObservations.set(t,new s(i))}const i=this._trackIdToObservations.get(t).enqueue(e.objectId);r.isSome(i)&&(this._addOrUpdated.has(i)?this._addOrUpdated.delete(i):this._removed.push(i))},t.checkForUpdates=function(){const e=this._getToAdd(),t=this._getToRemove(),n=performance.now();n-this._lastPurge>=this.purgeInterval&&(this._purge(n),this._lastPurge=n);const s=[];if(r.isSome(t))for(const e of t){const t=this.store.removeById(e);r.isSome(t)&&s.push(t)}if(r.isSome(e))for(const t of e)t.attributes[o]=n,this.store.add(t);(e||s)&&this.store.update(e,s)},t._getToAdd=function(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach((r=>e[t++]=r)),this._addOrUpdated.clear(),e},t._getToRemove=function(){const e=this._removed;return this._removed.length?(this._removed=[],e):null},t._nextId=function(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},t._purge=function(e){const t=this._purgeOptions;r.isSome(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())},t._purgeSomeByDisplayCount=function(e){if(!e.displayCount)return;let t=this.store.size;t>e.displayCount&&this._trackIdToObservations.forEach((n=>{if(t>e.displayCount&&n.size){const e=r.unwrap(n.dequeue());this._removed.push(e),t--}}))},t._purgeByAge=function(e){var t;if(!e.age||null==(t=this._timeInfo)||!t.startTimeField)return;const r=60*e.age*1e3,n=this._maxAge-r;this.store.forEach((e=>{e.attributes[this._timeInfo.startTimeField]<n&&this._removed.push(e.objectId)}))},t._purgeByAgeReceived=function(e,t){if(!t.ageReceived)return;const r=e+60*t.ageReceived*1e3;this.store.forEach((e=>{e.attributes[o]<r&&this._removed.push(e.objectId)}))},t._purgeTracks=function(){this._trackIdToObservations.forEach(((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)}))},e}();t.DEFAULT_STREAM_ID_FIELD=i,t.ESRI_TIMESTAMP=o,t.default=a,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},13996:(e,t,r)=>{var n,s;n=[r,r(58797),r(11285),r(74637),r(3718),r(73462),r(67059),r(26475),r(99752),r(49359),r(4037),r(51916),r(18377),r(9720),r(23084),r(57167),r(26016),r(40810),r(909),r(71315),r(82504)],void 0===(s=function(e,t,n,s,i,o,a,c,u,l,h,d,f,p,_,y,g,m,I,v,b){"use strict";const S=o.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection"),T={maxQueryDepth:5,maxRecordCountFactor:3};let w=function(e){function n(t){return e.call(this,{...T,...t})||this}t._inheritsLoose(n,e);var s=n.prototype;return s._open=async function(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||S.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");const t=await this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:n}=this._config;this.destroyed||this._setFilter(r,n)},s._onMessage=function(e){let t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void S.error(new l("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},s._fetchServiceDefinition=async function(e){const t=m(e.path,{query:{f:"json"},responseType:"json"}),r=(await t).data;return this._serviceDefinition=r,r},s._fetchWebSocketUrl=async function(e,t){const r=e[0],{urls:n,token:s}=r;return`${this._inferWebSocketBaseUrl(n)}/subscribe?outSR=${t.wkid}${s?"&token="+s:""}`},s._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(const t of e)if(-1!==t.indexOf("wss"))return t;return S.error(new l("geoevent-connection","Unable to infer WebSocket url",e)),null},s._setFilter=async function(e,t){const r=this._websocket;if(i.isNone(r)||i.isNone(e)&&i.isNone(t))return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let s=!1;const o=p.createResolver();return r.onmessage=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(S.error(new l("geoevent-connection","Failed to set service filter",t.error)),this._set("errorString",`Could not set service filter - ${t.error}`),o.reject(t.error)),r.onmessage=this._onMessage.bind(this),s=!0,o.resolve())},r.send(n),setTimeout((()=>{s||(this.destroyed||this._websocket!==r||S.error(new l("geoevent-connection","Server timed out when setting filter")),o.reject())}),1e4),o.promise},s._serializeFilter=function(e,t){const r={};if(i.isNone(e)&&i.isNone(t))return r;if(i.isSome(e)&&e.geometry)try{const t=y.fromJSON(e.geometry);if("extent"!==t.type)throw new l(`Expected extent but found type ${t.type}`);r.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(e){S.error(new l("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return i.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),i.isSome(t)&&(r.outFields=t.join(",")),r},s._enrich=function(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return S.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;const{attributes:n,geometry:s}=this._relatedFeatures.get(r);for(const t in n)e.attributes[t]=n[t];return s&&(e.geometry=s),e.geometry||e.centroid||S.error(new l("geoevent-connection","Found malformed feature - no geometry found",e)),e},s._queryBuddyServices=async function(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),n=this._queryArchive(t);await r;const s=await n;if(!s)return;for(const e of s.features)this.onFeature(this._enrich(e))}catch(e){S.error(new l("geoevent-connection","Encountered an error when querying buddy services",{error:e}))}},s._queryRelatedFeatures=async function(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)},s._queryArchive=async function(e){if(e)return this._queryBuddy(e.featuresUrl)},s._queryBuddy=async function(e){const t=new((await new Promise((function(e,t){Promise.resolve().then((function(){var t=[r(98757)];(function(t){e(function(e){return Object.freeze({__proto__:null,default:e})}(t))}).apply(null,t)})).catch(t.bind(this))}))).default)({url:e}),{capabilities:n}=await t.load(),s=n.query.supportsMaxRecordCountFactor,o=n.query.supportsPagination,a=n.query.supportsCentroid,c=this._config.maxRecordCountFactor,u=t.capabilities.query.maxRecordCount,l=s?u*c:u,h=new I;if(h.outFields=i.unwrapOr(this._config.outFields,["*"]),h.where=i.unwrapOr(i.get(this._config.filter,"where"),"1=1"),h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=_.fromJSON(this._config.spatialReference),a&&(h.returnCentroid=!0),s&&(h.maxRecordCountFactor=c),o)return h.num=l,t.destroy(),this._queryPages(e,h);const d=await v.executeQuery(e,h,this._config.sourceSpatialReference);return t.destroy(),d.data},s._queryPages=async function(e,t,r=[],n=0){t.start=i.isSome(t.num)?n*t.num:null;const{data:s}=await v.executeQuery(e,t,this._config.sourceSpatialReference);return s.exceededTransferLimit&&n<this._config.maxQueryDepth?(s.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,n+1)):(r.forEach((e=>s.features.push(e))),s)},s._addRelatedFeatures=function(e){const t=new Map,r=e.features,n=this._serviceDefinition.relatedFeatures.joinField;for(const e of r){const r=e.attributes[n];t.set(r,e)}this._relatedFeatures=t},n}(b.WebSocketConnection);return w=n.__decorate([u.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],w),w}.apply(t,n))||(e.exports=s)},22210:(e,t,r)=>{var n,s;n=[r(58797),r(11285),r(74637),r(73462),r(67059),r(26475),r(99752),r(4037),r(51916),r(18377),r(59286),r(74474)],void 0===(s=function(e,t,r,n,s,i,o,a,c,u,l,h){"use strict";let d=function(t){function r(){return t.apply(this,arguments)||this}return e._inheritsLoose(r,t),r.prototype.onFeature=function(e){this.emit("feature",e)},r}(l.EventedMixin(h.HandleOwner));return d=t.__decorate([o.subclass("esri.layers.graphics.sources.connections.StreamConnection")],d),d}.apply(t,n))||(e.exports=s)},82504:(e,t,r)=>{var n,s;n=[t,r(58797),r(11285),r(74637),r(3718),r(73462),r(67059),r(26475),r(99752),r(49359),r(4037),r(51916),r(18377),r(9720),r(54220),r(22210)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d,f,p,_,y){"use strict";const g=o.getLogger("esri.layers.graphics.sources.connections.WebSocketConnection");var m;(m=e.ReadyState||(t.ReadyState={}))[m.CONNECTING=0]="CONNECTING",m[m.OPEN=1]="OPEN",m[m.CLOSING=2]="CLOSING",m[m.CLOSED=3]="CLOSED",t.WebSocketConnection=function(t){function n(e){var r;(r=t.call(this)||this).errorString=null;const{geometryType:n,spatialReference:s,sourceSpatialReference:i}=e;return r._config=e,r._featureZScaler=_.getGeometryZScaler(n,i,s),r._open(),r}r._inheritsLoose(n,t);var s=n.prototype;return s._open=async function(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()},s.destroy=function(){i.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},s._tryCreateWebSocket=async function(e=this._config.source.path,t=1e3,r=0){try{if(this.destroyed)return;this._websocket=await this._createWebSocket(e),this.notifyChange("connectionStatus")}catch(n){const s=t/1e3;return this._config.maxReconnectionAttempts&&r>=this._config.maxReconnectionAttempts?(g.error(new l("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()):(g.error(new l("websocket-connection",`Failed to connect. Attempting to reconnect in ${s}s`,n)),await p.after(t),this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),r+1))}},s._createWebSocket=function(e){const t=new WebSocket(e),r=p.create(((e,r)=>{t.onopen=()=>e(t),t.onclose=e=>r(e)}));return r.then((()=>{if(this.destroyed)return t.onclose=()=>{},void t.close();t.onclose=e=>this._onClose(e),t.onerror=e=>this._onError(e),t.onmessage=e=>this._onMessage(e)})),r},s._handshake=async function(e=1e4){const t=this._websocket;if(i.isNone(t))return;const r=p.createResolver(),n=t.onmessage,{filter:s,outFields:o,spatialReference:a}=this._config;return r.timeout(e),t.onmessage=e=>{var i;let c=null;try{c=JSON.parse(e.data)}catch(e){}c&&"object"==typeof c||(g.error(new l("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),r.reject(),this.destroy()),(null==(i=c.spatialReference)?void 0:i.wkid)!==(null==a?void 0:a.wkid)&&(g.error(new l("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${a.wkid}`,e.data)),r.reject(),this.destroy()),"json"!==c.format&&(g.error(new l("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),r.reject(),this.destroy()),s&&c.filter!==s&&g.error(new l("websocket-connection","Tried to set filter, but server doesn't support it")),o&&c.outFields!==o&&g.error(new l("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=n,r.resolve()},t.send(JSON.stringify({filter:s,outFields:o,format:"json",spatialReference:{wkid:a.wkid}})),r.promise},s._onMessage=function(e){try{const t=JSON.parse(e.data);if("featureResult"!==t.type)throw new l("websocket-connection","Protocol violation - Expected to find message of type 'featureResult'",t);for(const e of t.features)this._featureZScaler&&this._featureZScaler(e.geometry),this.onFeature(e)}catch(e){return g.error(new l("websocket-connection","Failed to parse message",e)),void this.destroy()}},s._onError=function(e){const t="Encountered an error over WebSocket connection";this._set("errorString",t),g.error("websocket-connection",t)},s._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&g.error("websocket-connection",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()},r._createClass(n,[{key:"connectionStatus",get:function(){if(i.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case e.ReadyState.CONNECTING:case e.ReadyState.OPEN:return"connected";case e.ReadyState.CLOSING:case e.ReadyState.CLOSED:return"disconnected"}}}]),n}(y),n.__decorate([c.property()],e.WebSocketConnection.prototype,"connectionStatus",null),n.__decorate([c.property()],e.WebSocketConnection.prototype,"errorString",void 0),t.WebSocketConnection=n.__decorate([u.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],e.WebSocketConnection),Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},46233:(e,t,r)=>{var n,s;n=[t,r(82504),r(13996)],void 0===(s=function(e,r,n){"use strict";t.createConnection=function(e,t,s,i,o,a,c){const u=0===e.path.indexOf("wss://")||0===e.path.indexOf("ws://"),l={source:e,sourceSpatialReference:t,spatialReference:s,geometryType:i,filter:o,maxReconnectionAttempts:a,maxReconnectionInterval:c};return u?new r.WebSocketConnection(l):new n(l)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},58641:(e,t,r)=>{var n,s;n=[t,r(49359),r(5691),r(87547)],void 0===(s=function(e,r,n,s){"use strict";function i(e){const t=[];return e.forEach((e=>t.push(e))),t}const o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*a(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*c(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function u(e){for(;;){const{value:t,done:r}=e.next();if(r)return!1;if(t.length>2)return!0}}function l(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r],s=e[(r+1)%e.length];t+=n[0]*s[1]-s[0]*n[1]}return t<=0}function h(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function d(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return _(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const n of t.coordinates)_(e,n,r);return e}(e,t,r);case"MultiPoint":return function(e,t,r){return _(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const n of t.coordinates){f(e,n[0],r);for(let t=1;t<n.length;t++)p(e,n[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return g(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const n=t.coordinates;f(e,n[0],r);for(let t=1;t<n.length;t++)p(e,n[t],r);return e}(e,t,r)}}function f(e,t,r){const n=h(t);l(n)?_(e,n,r):y(e,n,r)}function p(e,t,r){const n=h(t);l(n)?y(e,n,r):_(e,n,r)}function _(e,t,r){for(const n of t)g(e,n,r);e.lengths.push(t.length)}function y(e,t,r){for(let n=t.length-1;n>=0;n--)g(e,t[n],r);e.lengths.push(t.length)}function g(e,t,r){const[n,s,i]=t;e.coords.push(n,s),r.hasZ&&e.coords.push(i||0)}function m(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}t.createOptimizedFeatures=function(e,t){return function(e){const t=[];for(;;){const{value:r,done:n}=e.next();if(n)return t;t.push(r)}}(function*(e,t={}){const{geometryType:r,objectIdFieldName:i}=t;for(;;){const{value:a,done:c}=e.next();if(c)return;const{geometry:u,properties:l,id:h}=a;if(u&&o[u.type]!==r)continue;const f=l||{};i&&null!=h&&!f[i]&&(f[i]=h);const p=new n(u?d(new s,u,t):null,f);yield p}}(a(e),t))},t.inferLayerProperties=function(e,t={}){const r=a(e),n=[],s=new Set,l=new Set;let h,d=!1,f=Number.NEGATIVE_INFINITY,p=null,_=!1,{geometryType:y=null}=t,g=!1;for(;;){const{value:e,done:t}=r.next();if(t){const e=p&&1===p.length&&p[0]||null;if(e)for(const t of n)t.name===e&&(t.type="esriFieldTypeOID");return{fields:n,geometryType:y,hasZ:d,maxObjectId:Math.max(0,f),objectIdFieldName:e,objectIdFieldType:h,unknownFields:i(l)}}const{geometry:a,properties:I,id:v}=e;if((!a||(y||(y=o[a.type]),o[a.type]===y))&&(d||(d=u(c(a))),_||(_=null!=v,_&&(h=typeof v,"number"===h&&(p=Object.keys(I).filter((e=>I[e]===v))))),_&&"number"===h&&null!=v&&(f=Math.max(f,v),p.length>1?p=p.filter((e=>I[e]===v)):1===p.length&&(p=I[p[0]]===v?p:[])),!g&&I)){let e=!0;for(const t in I){if(s.has(t))continue;const r=I[t];if(null==r){e=!1,l.add(t);continue}const i=m(r);"unknown"!==i?(l.delete(t),s.add(t),n.push({name:t,alias:t,type:i})):l.add(t)}g=e}}},t.validateGeoJSON=function(e){if(!e)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const n="string"==typeof t?t:"name"===t.type?t.properties.name:null,s=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!s.test(n))throw new r("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},44385:(e,t,r)=>{var n,s;n=[t,r(3718),r(73462),r(49359),r(56750),r(40810),r(13213),r(18358),r(16985),r(97949),r(57517),r(79043),r(58641),r(21863)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d,f,p){"use strict";const _=n.getLogger("esri.layers.graphics.sources.ogcfeature"),y="json";async function g(e,t,r){const n=await m(e,t,r);return u.convertToFeatureSet(n)}async function m(e,t,n){var s;const{capabilities:{query:{maxRecordCount:a}},collectionId:l,layerDefinition:h,url:p}=e,_=`${p}/collections/${l}/items`,{geometry:g,num:m,start:I,timeExtent:v,where:b}=t,S=r.isSome(t.outSpatialReference)?t.outSpatialReference:i.WGS84,T=function(e){if(r.isNone(e))return null;const{xmin:t,ymin:n,xmax:s,ymax:i}=e;return`${t},${n},${s},${i}`}(d.project(g,i.WGS84)),w=function(e){if(r.isNone(e))return null;const{start:t,end:n}=e;return`${t?t.toISOString():".."}/${n?n.toISOString():".."}`}(v),E=function(e){return r.isNone(e)||!e||"1=1"===e?null:e}(b),x=null!=m?m:null!=I&&void 0!==I?10:a,{data:F}=await o(_,{...n,query:{bbox:T,datetime:w,query:E,limit:x,startindex:I,f:y}}),C=null==(s=F.links)?void 0:s.filter((e=>"next"===e.rel)),A=0!==(null==C?void 0:C.length),{fields:R,globalIdField:O,hasM:L,hasZ:k,objectIdField:M}=h,P=h.geometryType,N=f.createOptimizedFeatures(F,{geometryType:P,hasZ:k,objectIdFieldName:M});if(!i.equals(S,i.WGS84))for(const e of N)e.geometry&&(e.geometry=u.convertFromGeometry(d.project(u.convertToGeometry(e.geometry,P,k,!1),i.WGS84,S)));for(const e of N)e.objectId=e.attributes[M];const D=new c;return D.exceededTransferLimit=A,D.features=N,D.fields=R,D.geometryType=P,D.globalIdFieldName=O,D.hasM=L,D.hasZ=k,D.objectIdFieldName=M,D.spatialReference=S||i.WGS84,D}t.getCollectionDefinition=async function(e,t,r,n,c=5){try{await d.checkProjectionSupport(i.WGS84,r.spatialReference)}catch{throw new s("ogc-feature-layer:projection-not-supported","Projection not supported")}const u=`${e}/collections/${t}/items`,{data:h}=await o(u,{signal:n,query:{limit:c,f:y}});await f.validateGeoJSON(h);const g=f.inferLayerProperties(h,{geometryType:r.geometryType}),m=r.fields||g.fields||[],I=null!=r.hasZ?r.hasZ:g.hasZ,v=g.geometryType,b=r.objectIdField||g.objectIdFieldName||"OBJECTID";let S=r.timeInfo;const T=m.find((e=>e.name===b));if(T)T.type="esriFieldTypeOID",T.editable=!1,T.nullable=!1;else{if(!g.objectIdFieldType)throw new s("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");m.unshift({name:b,alias:b,type:"esriFieldTypeOID",editable:!1,nullable:!1})}if(b!==g.objectIdFieldName){const e=m.find((e=>e.name===g.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}if(!v)throw new s("ogc-feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");m===g.fields&&g.unknownFields.length>0&&_.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:g.unknownFields}});for(const e of m){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new s("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(-1===a.kebabDict.jsonValues.indexOf(e.type))throw new s("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(S){const e=new l(m);if(S.startTimeField){const t=e.get(S.startTimeField);t?(S.startTimeField=t.name,t.type="esriFieldTypeDate"):S.startTimeField=null}if(S.endTimeField){const t=e.get(S.endTimeField);t?(S.endTimeField=t.name,t.type="esriFieldTypeDate"):S.endTimeField=null}if(S.trackIdField){const t=e.get(S.trackIdField);t?S.trackIdField=t.name:(S.trackIdField=null,_.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:S}}))}S.startTimeField||S.endTimeField||(_.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:S}}),S=null)}return{drawingInfo:p.createDrawingInfo(v),geometryType:v,fields:m,hasZ:!!I,objectIdField:b,timeInfo:S}},t.getServerCollection=async function(e,t,r){const n=`${e}/collections/${t}`,{data:s}=await o(n,{signal:r,query:{f:y}});return s},t.getServerCollections=async function(e,t){const r=`${e}/collections`,{data:n}=await o(r,{signal:t,query:{f:y}});return n},t.getServerConformance=async function(e,t){const r=`${e}/conformance`,{data:n}=await o(r,{signal:t,query:{f:y}});return n},t.getServerLandingPage=async function(e,t){const{data:r}=await o(e,{signal:t,query:{f:y}});return r},t.queryFeatureSet=async function(e,t,r){const n=await g(e,t,r);return h.fromJSON(n)},t.queryFeatureSetJSON=g,t.queryOptimizedFeatureSet=m,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},30682:(e,t,r)=>{var n,s;n=[r(73462)],void 0===(s=function(e){"use strict";return function(t,r,n){t.referencesGeometry();const s=r.readArcadeFeature();try{return t.evaluate({...n,$feature:s})}catch(t){return e.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",t),null}}}.apply(t,n))||(e.exports=s)},84896:(e,t,r)=>{var n,s;n=[t,r(49233)],void 0===(s=function(e,r){"use strict";let n=function(){function e(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}var t=e.prototype;return t.acquire=function(e,t,r,n,s,i,o,a,c){this.color=e,this.haloColor=t,this.haloSize=r,this.size=n,this.angle=s,this.offsetX=i,this.offsetY=o,this.hAnchor=a,this.vAnchor=c},t.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0},e}();n.pool=new r(n),t.TextProperties=n,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},20780:(e,t,r)=>{var n,s;n=[t,r(74637),r(73462),r(49359),r(3438),r(90920),r(80593),r(27975),r(48188),r(98043),r(53183),r(31581),r(84896)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d,f){"use strict";const p=n.getLogger("esri.views.2d.engine.webgl.Utils"),_="geometry",y=[{name:_,strideInBytes:32,divisor:0}],g=[{name:_,strideInBytes:32,divisor:0}],m=[{name:_,strideInBytes:12,divisor:0}],I=[{name:_,strideInBytes:36,divisor:0}],v=[{name:_,strideInBytes:32,divisor:0}],b=[{name:_,strideInBytes:36,divisor:0}];function S(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const T=S(y),w=S(g),E=S(m),x=S(I),F=S(v),C=S(b),A=[_],R=[_],O=[_],L=[_],k=[_];function M(e){switch(e){case h.WGLGeometryType.MARKER:return A;case h.WGLGeometryType.FILL:return R;case h.WGLGeometryType.LINE:return O;case h.WGLGeometryType.TEXT:return L;case h.WGLGeometryType.LABEL:return k}}function P(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}const N={[_]:35044};function D(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}const G=new Map;t.C_FILL_STRIDE_SPEC=w,t.C_FILL_STRIDE_SPEC_DD=E,t.C_FILL_VERTEX_DEF=g,t.C_FILL_VERTEX_DEF_DD=m,t.C_ICON_STRIDE_SPEC=T,t.C_ICON_VERTEX_DEF=y,t.C_LABEL_STRIDE_SPEC=C,t.C_LABEL_VERTEX_DEF=b,t.C_LINE_STRIDE_SPEC=x,t.C_LINE_VERTEX_DEF=I,t.C_TEXT_STRIDE_SPEC=F,t.C_TEXT_VERTEX_DEF=v,t.C_VBO_GEOMETRY=_,t.C_VBO_INFO=N,t.C_VBO_PERINSTANCE="per_instance",t.C_VBO_PERINSTANCE_VV="per_instance_vv",t.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},t.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},t.copyMeshData=function(e,t,r,n,s,i,o){for(const t in i){const n=i[t].stride,o=P(n),a=i[t].data,c=r[t].data,u=n*s.vertexCount/o,l=n*e/o,h=n*s.vertexFrom/o;for(let e=0;e<u;++e)c[e+l]=a[e+h]}const a=s.indexCount;for(let r=0;r<a;++r)n[r+t]=o[r+s.indexFrom]-s.vertexFrom+e},t.createGeometryData=function(e,t){const r=[];for(let n=0;n<5;++n){const s=M(n),i={};for(const e of s)i[e]={data:t(n,e)};r.push({data:e(n),buffers:i})}return r},t.createProgramDescriptor=(e,t)=>{if(!G.has(e)){const r=function(e){const t={};for(const r in e){const n=e[r];let s=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:s,stride:0};return s+=e.count*D(e.type),t})),t[r].forEach((e=>e.stride=s))}return t}(t),n={strides:(e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t})(r),bufferLayouts:r,attributes:(e=>{const t={};for(const r in e)for(const n of e[r])t[n.name]=n.location;return t})(t)};G.set(e,n)}return G.get(e)},t.createTextureFromTexelData=function(e,t){let r,n;return i.isPowerOfTwo(t.width)&&i.isPowerOfTwo(t.height)?(r=!0,n=9987):(r=!1,n=9729),new c(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:n,wrapMode:33071,flipped:!0},t)},t.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}},t.getBytes=D,t.getCapType=function(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return p.error(new s("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}},t.getJoinType=function(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return p.error(new s("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}},t.getNamedBuffers=M,t.getPixelArrayCtor=function(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void p.error(new s("webgl-utils",`Unable to handle type ${e}`))}},t.getPixelBytes=function(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void p.error(new s("webgl-utils",`Unable to handle type ${e}`))}},t.getStrides=function(e,t){switch(e){case h.WGLGeometryType.MARKER:return T;case h.WGLGeometryType.FILL:return t?E:w;case h.WGLGeometryType.LINE:return x;case h.WGLGeometryType.TEXT:return F;case h.WGLGeometryType.LABEL:return C}},t.getTextProperties=function(e){return f.TextProperties.pool.acquire(e.color?d.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?d.copyAndPremultiply(e.haloColor):[255,255,255,255],o.pt2px(e.haloSize),o.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},t.getTransformParams=function(e){const{transform:t,hasZ:r,hasM:n}=e;return{transform:t,hasZ:r,hasM:n}},t.getVVType=function(e){switch(e){case"opacity":return h.VVType.OPACITY;case"color":return h.VVType.COLOR;case"rotation":return h.VVType.ROTATION;case"size":return h.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${e}`),null}},t.isDefined=function(e){return null!=e},t.isNumber=function(e){return"number"==typeof e},t.strideToPackingFactor=P,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},31581:(e,t,r)=>{var n,s;n=[t,r(74518)],void 0===(s=function(e,r){"use strict";const n=[0,0,0,0];function s(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function i(e,t=0,r=!1){const n=e[t+3];return e[t+0]*=n,e[t+1]*=n,e[t+2]*=n,r||(e[t+3]*=255),e}t.copyAndPremultiply=function(e){return i(s([],e))},t.premultiplyAlpha=i,t.premultiplyAlphaRGBA=function(e){if(!e)return 0;const{r:t,g:n,b:s,a:i}=e,o=t*i,a=n*i,c=s*i,u=255*i;return r.i8888to32(o,a,c,u)},t.premultiplyAlphaRGBAArray=function(e){if(!e)return 0;const[t,n,s,i]=e,o=t*(i/255),a=n*(i/255),c=s*(i/255),u=i;return r.i8888to32(o,a,c,u)},t.premultiplyAlphaUint32=function(e){return i(s(n,e)),r.i8888to32(n[0],n[1],n[2],n[3])},t.white=[255,255,255,1],Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},39241:(e,t)=>{var r;void 0===(r=function(e){"use strict";t.ANGLE_FACTOR_256=256/360,t.ATTRIBUTE_DATA_ANIMATION=1,t.ATTRIBUTE_DATA_DD0=3,t.ATTRIBUTE_DATA_DD1=3,t.ATTRIBUTE_DATA_FILTER_FLAGS=0,t.ATTRIBUTE_DATA_VV=2,t.ATTRIBUTE_STORE_TEXTURE_SIZE=1024,t.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}},t.COLLISION_BOX_PADDING=16,t.COLLISION_BUCKET_SIZE=128,t.COLLISION_EARLY_REJECT_BUCKET_SIZE=16,t.COLLISION_MAX_ZOOM_DELTA=1,t.COLLISION_PLACEMENT_PADDING=8,t.COLLISION_TILE_BOX_SIZE=4,t.DEBUG_LABELS=!1,t.DOT_DENSITY_MAX_FIELDS=8,t.EFFECT_FLAG_0=4,t.EXTRUDE_SCALE=64,t.FILTER_FLAG_0=2,t.GLYPH_SIZE=24,t.HEURISTIC_GLYPHS_PER_FEATURE=10,t.HEURISTIC_GLYPHS_PER_LINE=50,t.HIGHLIGHT_FLAG=1,t.HITTEST_SEARCH_SIZE=6,t.MAGIC_LABEL_LINE_HEIGHT=29,t.MAX_FILTERS=2,t.MAX_GPU_UPLOADS_PER_FRAME=2,t.NAN_MAGIC_NUMBER=1e-30,t.PICTURE_FILL_COLOR=4294967295,t.RASTER_TILE_SIZE=256,t.SPRITE_PADDING=2,t.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1,t.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2,t.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3,t.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4,t.TEXTURE_BINDING_BITMAP=0,t.TEXTURE_BINDING_GLYPH_ATLAS=0,t.TEXTURE_BINDING_HIGHLIGHT_0=5,t.TEXTURE_BINDING_HIGHLIGHT_1=6,t.TEXTURE_BINDING_RENDERER_0=5,t.TEXTURE_BINDING_RENDERER_1=6,t.TEXTURE_BINDING_SPRITE_ATLAS=0,t.TEXT_PLACEMENT_PADDING=8,t.THIN_LINE_THRESHOLD=2.5,t.TILE_SIZE=512,t.VTL_HIGH_RES_CUTOFF=1.15,t.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6,t.VTL_TEXTURE_BINDING_UNIT_SPRITES=5,t.WEBGL_MAX_INNER_STOPS=6,t.WEBGL_MAX_STOPS=8,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},53183:(e,t)=>{var r;void 0===(r=function(e){"use strict";var r,n,s,i,o,a,c;(r=e.WGLGeometryType||(t.WGLGeometryType={}))[r.FILL=0]="FILL",r[r.LINE=1]="LINE",r[r.MARKER=2]="MARKER",r[r.TEXT=3]="TEXT",r[r.LABEL=4]="LABEL",(n=e.WGLGeometryTransactionStatus||(t.WGLGeometryTransactionStatus={}))[n.SUCCEEDED=0]="SUCCEEDED",n[n.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY",(s=e.WGLDrawPhase||(t.WGLDrawPhase={}))[s.NONE=0]="NONE",s[s.MAP=1]="MAP",s[s.LABEL=2]="LABEL",s[s.LABEL_ALPHA=4]="LABEL_ALPHA",s[s.HITTEST=8]="HITTEST",s[s.HIGHLIGHT=16]="HIGHLIGHT",s[s.CLIP=32]="CLIP",s[s.DEBUG=64]="DEBUG",s[s.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES",(i=e.VVType||(t.VVType={}))[i.SIZE=0]="SIZE",i[i.COLOR=1]="COLOR",i[i.OPACITY=2]="OPACITY",i[i.ROTATION=3]="ROTATION",(o=e.WGLVVFlag||(t.WGLVVFlag={}))[o.NONE=0]="NONE",o[o.OPACITY=1]="OPACITY",o[o.COLOR=2]="COLOR",o[o.ROTATION=4]="ROTATION",o[o.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",o[o.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",o[o.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",o[o.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE",(a=e.WGLVVTarget||(t.WGLVVTarget={}))[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE",(c=e.MosaicType||(t.MosaicType={}))[c.SPRITE=0]="SPRITE",c[c.GLYPH=1]="GLYPH",Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},74518:(e,t)=>{var r;void 0===(r=function(e){"use strict";const r=new Float32Array(1),n=new Uint32Array(r.buffer);function s(e,t,r){return Math.round(Math.max(Math.min(e,r),t))}t.i16=function(e){return s(e,-32768,32767)},t.i1616to32=function(e,t){return 65535&e|t<<16},t.i32=function(e){return s(e,-2147483648,2147483647)},t.i8=function(e){return s(e,-128,127)},t.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},t.i8888to32=function(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24},t.numTo32=function(e){return 0|e},t.toFloat32=function(e){return n[0]=e,r[0]},t.toUint32=function(e){return r[0]=e,n[0]},t.u16=function(e){return s(e,0,65535)},t.u32=function(e){return s(e,0,4294967295)},t.u32to4Xu8=function(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]},t.u8=function(e){return s(e,0,255)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},14579:(e,t)=>{var r;void 0===(r=function(e){"use strict";t.DEBUG_ATTR_UPDATES=!1,t.createDebugLogger=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},30347:(e,t,r)=>{var n,s;n=[t,r(58797),r(3718),r(59286),r(24088),r(32782),r(45552)],void 0===(s=function(e,r,n,s,i,o,a){"use strict";function c(e){return(4294901760&e)>>>16}function u(e){return 65535&e}const l={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};let h=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).featureAdapter=l,n.events=new s,n._featureSetsByInstance=new Map,n._objectIdToDisplayId=new Map,n._spatialIndexInvalid=!0,n._index=o.rbush(9,(e=>({minX:n._storage.getXMin(e),minY:n._storage.getYMin(e),maxX:n._storage.getXMax(e),maxY:n._storage.getYMax(e)}))),n}r._inheritsLoose(t,e);var a=t.prototype;return a.onTileData=function(e,t,r){if(n.isNone(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=r,t.addOrUpdate._storage=r;const s=t.addOrUpdate.getCursor();for(;s.next();){const t=s.getObjectId(),n=s.instance<<16|s.getIndex();let i=this._objectIdToDisplayId.get(t);i||(i=r.createDisplayId(),this._objectIdToDisplayId.set(t,i),this._spatialIndexInvalid=!0),s.setDisplayId(i),r.setInstanceId(i,n),this.setComputedAttributes(r,s,i,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t},a.forEach=function(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),n=this._lookupFeature(r);e(n)}))},a.forEachUnsafe=function(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),n=c(r),s=u(r),i=this._getFeatureSet(n);i.setIndex(s),e(i)}))},a.forEachInBounds=function(e,t){const r=this._searchIndex(e);for(const e of r){const r=this.lookupFeatureByDisplayId(e,this._storage);t(n.unwrap(r))}},a.forEachBounds=function(e,t,r){this._rebuildIndex();const n=[0,0,0,0];for(const s of e){if(!s.readGeometry())continue;const e=s.getDisplayId();n[0]=this._storage.getXMin(e),n[1]=this._storage.getYMin(e),n[2]=this._storage.getXMax(e),n[3]=this._storage.getYMax(e),t(i.fromRect(r,n))}},a.sweepFeatures=function(e,t,r){this._objectIdToDisplayId.forEach(((n,s)=>{e.has(n)||(t.releaseDisplayId(n),r.unsetAttributeData(n),this._objectIdToDisplayId.delete(s))})),this.events.emit("changed")},a.sweepFeatureSets=function(e){this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))},a.lookupObjectId=function(e,t){const r=this.lookupFeatureByDisplayId(e,t);return n.isNone(r)?null:r.getObjectId()},a.lookupDisplayId=function(e){return this._objectIdToDisplayId.get(e)},a.lookupFeatureByDisplayId=function(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)},a.lookupByDisplayIdUnsafe=function(e){const t=this._storage.getInstanceId(e),r=c(t),n=u(t),s=this._getFeatureSet(r);return s?(s.setIndex(n),s):null},a.hasInstance=function(e){return this._featureSetsByInstance.has(e)},a._rebuildIndex=function(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.load(e),this._spatialIndexInvalid=!1},a._lookupFeature=function(e){const t=c(e),r=u(e),n=this._getFeatureSet(t);if(!n)return null;const s=n.getCursor();return s.setIndex(r),s},a._getFeatureSet=function(e){return this._featureSetsByInstance.get(e)},a._searchIndex=function(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)},r._createClass(t,[{key:"storeStatistics",get:function(){return{featureCount:0,vertexCount:0}}}]),t}(a.Store2D);t.FeatureStore2D=h,t.featureAdapter=l,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},44546:(e,t,r)=>{var n,s;n=[t,r(58797),r(11285),r(74637),r(73462),r(67059),r(26475),r(99752),r(4037),r(51916),r(18377),r(9720),r(74474),r(72146),r(20598),r(19993),r(91240),r(6393),r(29707),r(90259)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d,f,p,_,y,g,m,I,v){"use strict";const b=new Set;let S=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).controller=null,t.processor=null,t.remoteClient=null,t.tileStore=null,t.service=null,t.viewState=null,t}r._inheritsLoose(t,e);var n=t.prototype;return n.initialize=function(){this.handles.add(this.watch("updating",(e=>{this.remoteClient.invoke("setUpdating",e).catch((e=>{}))})))},n.destroy=function(){var e,t,r;null==(e=this.controller)||e.destroy(),null==(t=this.processor)||t.destroy(),null==(r=this.tileStore)||r.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null},n.startup=async function({service:e,config:t,tileInfo:r}){if(this.service=e,!this.tileStore){const e=new y(p.fromJSON(r));this.tileStore=new g(e)}await this._configure(t),this.tileStore.clear()},n.updateTiles=async function(e){this.tileStore.updateTiles(e)},n.update=async function({config:e,pause:t}){const r=I.UpdateToken.empty();return await d.all([this.processor.update(r,e),this.controller.update(r,e,t)]),r.toJSON()},n.invalidate=async function(e){const t=I.UpdateToken.create(e),r=this.controller.invalidate(t);return await this.remoteClient.invoke("setUpdating",this.updating),r},n.setViewState=function(e){const t=_.fromJSON(e);this._set("viewState",t)},n._configure=async function(e){await d.all([this._handleControllerConfig(e),this._handleProcessorConfig(e)]),this.controller.processor=this.processor,await this.update({config:e})},n._handleControllerConfig=async function(e){const t=await this._createController(this.service,e);return await t.startup(),t},n._handleProcessorConfig=async function(e){return this._createProcessor(this.service,e)},n._createController=async function(e,t){this.controller&&this.controller.destroy();const{tileStore:r,remoteClient:n}=this,s=new v({service:e,config:t,tileStore:r,remoteClient:n});return this.controller=s,s},n._createProcessor=async function(e,t){const r=t.schema.processors[0].type,n=(await m.loadProcessorModule(r)).default,{remoteClient:s,tileStore:i}=this,o=new n({service:e,config:t,tileStore:i,remoteClient:s});return this.processor&&this.processor.destroy(),this.processor=o,o},r._createClass(t,[{key:"updating",get:function(){return!this.controller||this.controller.updating}}]),t}(f.HandleOwner);n.__decorate([a.property()],S.prototype,"controller",void 0),n.__decorate([a.property()],S.prototype,"processor",void 0),n.__decorate([a.property({dependsOn:["controller.updating"]})],S.prototype,"updating",null),n.__decorate([a.property()],S.prototype,"viewState",void 0),S=n.__decorate([c.subclass("esri.views.2d.layers.features.Pipeline")],S);var T=S;t.default=T,t.getInstances=function(){return b},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},43125:(e,t,r)=>{var n,s;n=[t,r(58797),r(74637),r(3718),r(9720),r(62008),r(63940),r(909),r(39241),r(11685),r(89647),r(29707)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d){"use strict";let f=0,p=function(){function e(e,t){this.didSend=!1,this.dataTileCount=0,this.update=d.UpdateToken.all(),this._abortController=new AbortController,this.invalid=!1,this.displayTile=e,this._pixelBuffer=t,this.partitions=y(e,t)}var t=e.prototype;return t.setUpdate=function(e,t){this.update=e,this.dataTileCount=0,t!==this._pixelBuffer&&(this._pixelBuffer=t,this.partitions=y(this.displayTile,t)),e.mesh&&(this.didSend=!1)},t.abort=function(){this._abortController.abort()},r._createClass(e,[{key:"signal",get:function(){return this._abortController.signal}}]),e}(),_=function(){function e(e,t,r){this.resolved=!1,this.tile=t,this.offset=e,this.extent=r}return e.prototype.reset=function(){this.resolved=!1},e}();function y(e,t){const r=[];if(r.push(new _([0,0],e,null)),0===t)return r;const n=Math.min(t,u.TILE_SIZE),s=u.TILE_SIZE;return r.push(new _([-s,-s],h.getPow2NeighborTile(e,-1,-1),[s-n,s-n,s,s])),r.push(new _([0,-s],h.getPow2NeighborTile(e,0,-1),[0,s-n,s,s])),r.push(new _([s,-s],h.getPow2NeighborTile(e,1,-1),[0,s-n,n,s])),r.push(new _([-s,0],h.getPow2NeighborTile(e,-1,0),[s-n,0,s,s])),r.push(new _([s,0],h.getPow2NeighborTile(e,1,0),[0,0,n,s])),r.push(new _([-s,s],h.getPow2NeighborTile(e,-1,1),[s-n,0,s,n])),r.push(new _([0,s],h.getPow2NeighborTile(e,0,1),[0,0,s,n])),r.push(new _([s,s],h.getPow2NeighborTile(e,1,1),[0,0,n,n])),r}let g=function(){function e(e,t,r){this.type="remote",this._pendingEdits=new Set,this._queryInfo=null,this._subscriptions={display:new Map},this._invalid={outFields:!1,queryFilterParameters:!1};const n=this._onDataTileRequest.bind(this);this._source=l.createSource(e,t,r,n,(()=>this.canAcceptPatch())),this._serviceInfo=e,this._geometryType=e.geometryType,this._outSR=t}var t=e.prototype;return t.destroy=function(){this._getSubscriptions().map((({displayTile:e})=>this.unsubscribe(e))),this._source.destroy()},t.enableEvent=function(e,t){this._source.enableEvent(e,t)},t.setViewState=function(e){this._source.setViewState(e)},t.update=function(e,t){var r,s,i,c;const u=this._serviceInfo.fields.length,l=null!=(r=null==(s=this._schema)?void 0:s.outFields)?r:[],h=null!=(i=null==(c=this._schema)?void 0:c.pixelBuffer)?i:0,d=t.outFields.filter((e=>-1===l.indexOf(e))),f=[...l,...d],p=0===t.pixelBuffer?0:Math.max(t.pixelBuffer,h);t.pixelBuffer=p,t.outFields=f.length>=.75*u?["*"]:f,t.outFields.sort();const _=a.diff(this._schema,t);if(this._subscriptions.display.forEach((t=>{t.invalid&&(e.queryFilter=!0)})),!_)return;const y=this._schema&&a.hasDiff(_,"outFields"),g=this._schema&&a.hasDiff(_,"pixelBuffer"),m=this._schema&&a.hasDiffAny(_,["definitionExpression","gdbVersion","historicMoment"]);n("esri-2d-update-debug")&&console.debug("Applying Update - Source:",_);const I={returnCentroid:"esriGeometryPolygon"===this._geometryType,returnGeometry:!0,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:[`${this._serviceInfo.objectIdField} ASC`],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?new Date(t.historicMoment):null,timeExtent:o.fromJSON(t.timeExtent)};e.source=!0,g&&(e.why.mesh.push("Pixel buffer changed"),e.mesh=!0),m&&(e.why.mesh.push("Layer filter changed"),e.why.source.push("Layer filter changed"),e.mesh=!0,e.queryFilter=!0,this._invalid.queryFilterParameters=!0),y&&(e.why.source.push("Layer required fields changed"),this._invalid.outFields=!0),this._schema=t,this._source.update(I),this._queryInfo=I},t.subscribe=function(e){this._subscriptions.display.has(e.id)||this._subscribeDisplayTile(e)},t.unsubscribe=function(e){if(!this._subscriptions.display.has(e.id))return;const t=this._subscriptions.display.get(e.id);this._subscriptions.display.delete(e.id),this._source.unsubscribe(e),t.abort()},t.forEachRequest=function(e,t){this._source.forEachRequest(e,t)},t.query=function(e){return this._source.query(e)},t.createQuery=function(){return new c({...this._queryInfo})},t.createTileQuery=function(e){if("stream"===this._serviceInfo.type)throw new Error("Service does not support tile  queries");const t=this.createQuery();return t.quantizationParameters=e.getQuantizationParameters(),t.resultType="tile",t.geometry=e.extent,"esriGeometryPolyline"===this._serviceInfo.geometryType&&(t.maxAllowableOffset=e.resolution),this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,t.maxAllowableOffset=e.resolution),t},t.invalidate=function(){this._subscriptions.display.forEach((e=>e.invalid=!0))},t.forEachPendingEdit=function(e){this._getSubscriptions().some((({invalid:e})=>e))?this._pendingEdits.forEach(e):this._pendingEdits.clear()},t.onEdits=async function(e){const t=e.addedFeatures.filter((e=>!e.error)).map((e=>e.objectId)),r=e.updatedFeatures.filter((e=>!e.error)).map((e=>e.objectId)),n=e.deletedFeatures.filter((e=>!e.error)).map((e=>e.objectId)),s=[...t,...r];n.forEach((e=>{this._pendingEdits.has(e)&&this._pendingEdits.delete(e)})),s.forEach((e=>this._pendingEdits.add(e)));const o=this._getSubscriptions().map((({displayTile:e})=>e)).map((e=>{const t=this.createTileQuery(e);return t.objectIds=s,{tile:e,query:t}})).map((async({tile:e,query:t})=>({tile:e,result:await this._source.query(t)})));(await i.all(o)).forEach((({tile:e,result:t})=>{const s=this._subscriptions.display.get(e.key.id);if(!s)return;const i=s.signal,o=d.UpdateToken.all();this.onDisplayTilePatch({type:"update",id:e.key.id,version:f++,update:o,addOrUpdate:t,remove:[...r,...n],end:!0,noData:!1},{signal:i})})),this.invalidate()},t.resubscribe=async function(e,t=!1){const r=this._schema.pixelBuffer;this._subscriptions.display.forEach((t=>t.setUpdate(e,r)));let n=!1;if(this._subscriptions.display.forEach((e=>{e.invalid&&(n=!0)})),this._invalid.outFields&&(this._invalid.outFields=!1),t||this._invalid.queryFilterParameters||n){const e=this._getSubscriptions().map((({displayTile:e})=>e));e.forEach((e=>this.unsubscribe(e))),e.forEach((e=>this.subscribe(e))),this._source.resume(),this._invalid.queryFilterParameters=!1}else e.mesh?await this._source.resend({dataTileOnly:!1}):await this._source.resend({dataTileOnly:!0})},t.pause=function(){this._source.pause()},t.resume=function(){this._source.resume()},t._getSubscriptions=function(){const e=[];return this._subscriptions.display.forEach((t=>{e.push(t)})),e},t._subscribeDisplayTile=function(e){const t=new p(e,this._schema.pixelBuffer);this._subscriptions.display.set(e.id,t),this._source.subscribe(e);for(const r of t.partitions){const t=r.tile,n=this._source.get(t.id);if(s.isSome(n))for(const t of n.requests.done)this._onPartitionMessage(e.id,r,t.request,"new")}},t._onDataTileRequest=function(e,t,r){const n=this._subscriptions.display.get(e.id);if(r&&r.dataTileOnly){for(const r of n.partitions)if(r.tile.id===e.id){this._onPartitionMessage(e.id,r,e,t);break}}else{for(const r of n.partitions)if(r.tile.id===e.id){this._onPartitionMessage(e.id,r,e,t);break}this._subscriptions.display.forEach(((r,n)=>{if(n!==e.id)for(const s of r.partitions)if(s.tile.id===e.id){this._onPartitionMessage(n,s,e,t);break}}))}},t._onPartitionMessage=function(e,t,r,n){const i=s.andThen(r.features,(e=>function(e,t){if(s.isNone(t.extent))return e;const{offset:r,extent:n}=t,[i,o,a,c]=n,[u,l]=r;return e.extent(i,o,a,c).transform(u,l)}(e,t))),o=this._subscriptions.display.get(e),a=o.signal;let c=o.update;o.didSend||(n="replace"),s.isSome(i)&&!i.seen&&(c=d.UpdateToken.all(),i.seen=!0);let u=!1;r.end&&(t.resolved=!0,u=e===t.tile.id),o.didSend=!0,this.onDisplayTilePatch({type:n,id:e,version:f++,update:c,addOrUpdate:i,remove:r.remove||[],noData:r.noData,end:u},{signal:a})},r._createClass(e,[{key:"updating",get:function(){return this._source.updating||this._getSubscriptions().some((e=>!e.didSend))}},{key:"isStream",get:function(){return"geoevent"===this._source.type}},{key:"sourceEvents",get:function(){return"geoevent"===this._source.type?{type:"geoevent",events:this._source.events}:{type:"feature",events:this._source.events}}}]),e}();t.Source2D=g,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},45552:(e,t,r)=>{var n,s;n=[r,t,r(74637),r(3718),r(9720),r(27006),r(63940),r(30682)],void 0===(s=function(e,n,s,i,o,a,c,u){"use strict";const l=new Promise((function(e,t){r.e(9144).then(function(){var t=[r(29144)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}));let h=function(){function e(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}var t=e.prototype;return t.updateSchema=async function(e,t){const r=c.diff(this._schema,t);if(this._schema=t,!t||i.isNone(r)||!c.hasDiff(r,"attributes"))return;s("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const n=t.attributes,a=[],u=[];for(const e in n){const t=n[e];switch(t.type){case"field":break;case"expression":a.push(this._createArcadeComputedField(t));break;case"label-expression":a.push(this._createLabelArcadeComputedField(t));break;case"statistic":u.push(t)}}this._computedFields=await o.all(a),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=u},t.setComputedAttributes=function(e,t,r,n){const s=this._bitsets.computed;if(!this._canCacheExpressionValue||!s.has(r)){s.set(r);for(const s of this._computedFields){const i=this._evaluateField(t,s,n);switch(s.resultType){case"numeric":e.setComputedNumericAtIndex(r,s.fieldIndex,i);break;case"string":e.setComputedStringAtIndex(r,s.fieldIndex,i)}}}},t._createArcadeComputedField=async function(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await a.createRendererExpression(e.valueExpression,t,r)}},t._createLabelArcadeComputedField=async function(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fields,{createLabelFunction:n}=await l,s=await n(e.label,r,t);return{...e,builder:s}},t._evaluateField=function(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:n}=t;return u(n,e,{$view:{scale:r}})}}},e}();t.Store2D=h,Object.defineProperty(n,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},90259:(e,t,r)=>{var n,s;n=[r(58797),r(11285),r(74637),r(3718),r(73462),r(67059),r(26475),r(99752),r(4037),r(51916),r(18377),r(9720),r(69788),r(16985),r(97949),r(74474),r(44789),r(8876),r(74549),r(30390),r(30347),r(28405),r(29707),r(43125),r(19866)],void 0===(s=function(e,t,r,n,s,i,o,a,c,u,l,h,d,f,p,_,y,g,m,I,v,b,S,T,w){"use strict";function E(e){if(!h.isAbortError(e)&&!function(e){return"worker:port-closed"===e.name}(e))throw e}let x=function(t){function s(){var e;return(e=t.apply(this,arguments)||this)._storage=new I.ComputedAttributeStorage,e._markedIdsBufId=e._storage.createBitset(),e._lastCleanup=performance.now(),e._cleanupNeeded=!1,e._invalidated=!1,e._tileToResolver=new Map,e.tileStore=null,e.config=null,e.processor=null,e.remoteClient=null,e.service=null,e._editing=!1,e}e._inheritsLoose(s,t);var i=s.prototype;return i.initialize=function(){this._initAttributeStore(),this._initStores(),this._initQueryEngine(),this._initSource(),this._updateQueue=new g.QueueProcessor({concurrency:4,process:(e,t)=>this._onDisplayTilePatch(e,{signal:t})}),this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this)),this.watch("updating",(e=>!e&&this.onIdle()))])},i.startup=async function(){this._initAttributeStore()},i._initSource=function(){this._source=new T.Source2D(this.service,this.spatialReference,this.tileStore.tileScheme),this._source.onDisplayTilePatch=(e,t)=>(this._invalidated=!0,this._patchTile(e,t)),this._source.canAcceptPatch=()=>this._updateQueue.length<50;const e=this._source.sourceEvents;if("geoevent"===e.type){const t=e.events;this.handles.add([t.on("connectionStatus",(e=>this.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:e}).catch(E))),t.on("errorString",(e=>this.remoteClient.invoke("setProperty",{propertyName:"errorString",value:e}).catch(E))),t.on("feature",(e=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(E))),t.on("updateRate",(e=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...e}}).catch(E)))])}},i._initAttributeStore=function(){this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new m.default({type:"remote",initialize:(e,t)=>h.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t}).catch(E)),update:(e,t)=>h.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t}).catch(E)),render:e=>h.ignoreAbortErrors(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}).catch(E))},this.config)},i._initStores=function(){const e={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new v.FeatureStore2D(e,this._storage),this.aggregateStore=new w.ClusterStore(e,this.spatialReference,this._storage),this.handles.add(this.aggregateStore.events.on("valueRangesChanged",(e=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}}).catch(E)})))},i._initQueryEngine=function(){var e;const t=this;null==(e=this.queryEngine)||e.destroy(),this.queryEngine=new b.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds:e=>t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map((e=>t.getObjectId(e)))},timeInfo:this.service.timeInfo})},i.destroy=function(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy()},i.isUpdating=function(){return this._source.updating||!!this._updateQueue.length},i.enableEvent=function(e){this._source.enableEvent(e.name,e.value)},i.invalidate=async function(e){if(!e.any())return;r("esri-2d-update-debug")&&e.describe();const t=this.tileStore.tiles.map((({key:e})=>{const t=h.createResolver();return this._tileToResolver.set(e.id,t),t.promise})),n=this._updateQueue.takeAll();this._updateQueue.resume(),this.hasAggregates&&e.mesh&&e.targets.aggregate&&!e.queryFilter?this._repushAggregateMeshTiles(e):(this._source.resubscribe(e),h.all(t).then((()=>{this._source.resume()})),e.mesh&&await d.whenFalseOnce(this,"updating")),this.notifyChange("updating"),await h.all(t),this._updateQueue.pause();for(const e of n)this._patchTile(e);e.source&&(this._cleanupNeeded=!0)},i.resume=function(){return this._updateQueue.resume(),this._source.resume()},i.update=async function(e,t,r=!1){this._editing&&await d.whenFalseOnce(this,"updating"),r&&(this._source.pause(),this._updateQueue.pause()),this._set("config",t),this._schema=t.schema,this._initQueryEngine(),await h.all([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t),this.attributeStore.updateFilters(e,this)]),await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate)},i.refresh=async function(){this._source.resubscribe(S.UpdateToken.all(),!0),this._cleanupNeeded=!0,this.notifyChange("updating"),await d.whenFalseOnce(this,"updating",!0)},i.onTileUpdate=function(e){this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange("updating")},i.onIdle=function(){this.hasAggregates&&this._invalidated&&(this._repushAggregateMeshTiles(),this._invalidated=!1),this._markAndSweep()},i.onEdits=async function(e){if(this._editing)return await d.whenFalseOnce(this,"updating"),await h.after(16),this.onEdits(e);this._editing=!0;try{await this._source.onEdits(e),await d.whenFalseOnce(this,"updating")}catch(e){}this._editing=!1},i.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},i.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},i.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},i.queryLatestObservations=function(e){return this.queryEngine.executeQueryForLatestObservations(e)},i.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},i.queryStatistics=async function(){return{...this.featureStore.storeStatistics,displayedFeatureCount:0,displayedVertexCount:0,displayPreProcessTime:0}},i.getObjectId=function(e){return this.featureStore.lookupObjectId(e,this._storage)},i.getDisplayId=function(e){if(this._schema.targets.aggregate){const t=this.aggregateStore.getDisplayId(e);if(n.isNone(t)){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)},i.getFeature=function(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(n.isNone(t))return null;const r=t.readHydratedGeometry(),s=f.convertToGeometry(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:s}},i.getAggregate=function(e){return this.aggregateStore.getAggregate(e)},i.setHighlight=async function(e){const t=e.map((e=>this.getDisplayId(e)));return this.attributeStore.setHighlight(e,t)},i._repushAggregateMeshTiles=function(e){for(const t of this.tileStore.tiles)this._patchTile({type:"replace",id:t.key.id,addOrUpdate:y.FeatureSetReaderJSON.fromOptimizedFeatures([],this.service.geometryType),remove:[],end:!0,noData:!1,update:e||S.UpdateToken.create({mesh:!0,targets:{aggregate:!0}})})},i._maybeForceCleanup=function(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()},i._patchTile=function(e,t){const r=this._updateQueue.push(e,t).then((()=>{this.notifyChange("updating")})).catch((e=>{this.notifyChange("updating")}));return this.notifyChange("updating"),r},i._onDisplayTilePatch=async function(e,t){h.throwIfAborted(t);const r=this.tileStore.get(e.id);if(!r)return;const s=e.update;e.remove.length&&(this._cleanupNeeded=!0);const i=[];for(const t of e.remove)i.push(this.featureStore.lookupDisplayId(t));e.remove=i;try{if(n.isNone(e.addOrUpdate))return this.processor.onTileData(r,{...e,addOrUpdate:null},t).catch((e=>{h.throwIfNotAbortError(e)})),void this._finishedPatch(e);e.addOrUpdate._storage=this._storage;const i=e.addOrUpdate.hasFilter(),o=e.addOrUpdate.instance;e.addOrUpdate._arcadeSpatialReference=this.spatialReference,(!this.featureStore.hasInstance(o)||s.targets.feature&&!i)&&this.featureStore.onTileData(r,e,this._storage),!s.storage.data&&!s.storage.filters||i||(this.attributeStore.onTileData(r,e),this._source.isStream?await this.attributeStore.sendUpdates():this.attributeStore.sendUpdates()),this.hasAggregates&&s.targets.aggregate&&(this.aggregateStore.onTileData(r,e,this._storage,this.attributeStore,s.mesh),s.mesh&&(this.attributeStore.onTileData(r,e),await this.attributeStore.sendUpdates())),s.mesh&&await this.processor.onTileData(r,e,t),this._maybeForceCleanup(),this._finishedPatch(e)}catch(e){h.throwIfNotAbortError(e)}},i._finishedPatch=function(e){(e.noData||e.end)&&this._tileToResolver.has(e.id)&&(this._tileToResolver.get(e.id).resolve(),this._tileToResolver.delete(e.id))},i._markAndSweep=function(){if(this._lastCleanup=performance.now(),!this._cleanupNeeded&&!this._source.isStream)return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();const r=r=>{const n=this.featureStore.lookupDisplayId(r),s=(4294901760&this._storage.getInstanceId(n))>>>16;n&&(t.add(s),e.set(n))};for(const e of this.tileStore.tiles)this._source.forEachRequest(e.key.id,(e=>{if(n.isNone(e.features))return;const t=e.features.getCursor();for(;t.next();){const e=t.getObjectId();r(e)}}));this._source.forEachPendingEdit((e=>r(e))),this._updateQueue.forEach((e=>{for(const t of e.remove)r(t)})),this.config.schema.targets.aggregate&&(this.aggregateStore.sweepFeatures(e,this.featureStore),this.aggregateStore.sweepClusters(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(e,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(t)},e._createClass(s,[{key:"fieldsIndex",get:function(){return new p(this.service.fields)}},{key:"hasAggregates",get:function(){return!!this.config.schema.targets.aggregate}},{key:"spatialReference",get:function(){return this.tileStore.tileScheme.spatialReference}},{key:"updating",get:function(){return this.isUpdating()}}]),s}(_.HandleOwner);return t.__decorate([o.property({constructOnly:!0})],x.prototype,"tileStore",void 0),t.__decorate([o.property()],x.prototype,"config",void 0),t.__decorate([o.property({readOnly:!0,dependsOn:["service"]})],x.prototype,"fieldsIndex",null),t.__decorate([o.property()],x.prototype,"processor",void 0),t.__decorate([o.property({constructOnly:!0})],x.prototype,"remoteClient",void 0),t.__decorate([o.property({constructOnly:!0})],x.prototype,"service",void 0),t.__decorate([o.property({dependsOn:["tileStore"]})],x.prototype,"spatialReference",null),t.__decorate([o.property()],x.prototype,"updating",null),x=t.__decorate([a.subclass("esri.views.2d.layers.features.controllers.FeatureController2D")],x),x}.apply(t,n))||(e.exports=s)},56478:(e,t,r)=>{var n,s;n=[t,r(58797),r(3718),r(16985),r(51972),r(71315),r(44789),r(44385),r(3980)],void 0===(s=function(e,r,n,s,i,o,a,c,u){"use strict";let l=function(){function e(e){this.service=e}return e.prototype.destroy=function(){},e}(),h=function(e){function t(t){var r;return(r=e.call(this,t)||this)._portsOpen=i.openWithPorts(t.source).then((e=>r.client=e)),r}r._inheritsLoose(t,e);var n=t.prototype;return n.destroy=function(){this.client.close(),this.client=null},n.executeQuery=async function(e,t){await this._portsOpen;const r=await this.client.invoke("queryFeatures",e.toJSON(),t);return a.FeatureSetReaderJSON.fromFeatureSet(r,this.service.objectIdField)},t}(l),d=function(e){function t(){return e.apply(this,arguments)||this}return r._inheritsLoose(t,e),t.prototype.executeQuery=async function(e,t){const{data:r}=await o.executeQueryPBFBuffer(this.service.source,e,{...t,query:{...this.service.customParameters,...null==t?void 0:t.query}});return u.FeatureSetReaderPBF.fromBuffer(r,this.service.geometryType)},t}(l),f=function(e){function t(){return e.apply(this,arguments)||this}return r._inheritsLoose(t,e),t.prototype.executeQuery=async function(e,t){const{source:r,capabilities:i,spatialReference:c,objectIdField:u}=this.service;if(e.quantizationParameters&&!i.query.supportsQuantization){const n=e.clone();n.quantizationParameters=null;const{data:i}=await o.executeQuery(r,n,c,{...t,query:{...this.service.customParameters,...null==t?void 0:t.query}}),l=s.convertFromFeatureSet(i,u);return s.quantizeOptimizedFeatureSet(t.transform,l),a.FeatureSetReaderJSON.fromOptimizedFeatureSet(l)}const{data:l}=await o.executeQuery(r,e,this.service.spatialReference,{...t,query:{...n.unwrap(this.service.customParameters),...null==t?void 0:t.query}});return a.FeatureSetReaderJSON.fromFeatureSet(l,this.service.objectIdField)},t}(l),p=function(e){function t(){return e.apply(this,arguments)||this}return r._inheritsLoose(t,e),t.prototype.executeQuery=async function(e,t){const{capabilities:r}=this.service;if(e.quantizationParameters&&!r.query.supportsQuantization){e.clone().quantizationParameters=null;const r=await c.queryOptimizedFeatureSet(this.service.source,e,t);return s.quantizeOptimizedFeatureSet(t.transform,r),a.FeatureSetReaderJSON.fromOptimizedFeatureSet(r)}const n=await c.queryOptimizedFeatureSet(this.service.source,e,t);return a.FeatureSetReaderJSON.fromOptimizedFeatureSet(n)},t}(l);t.SourceAdapter=l,t.createSourceAdapter=function(e){const{capabilities:t}=e;return(r=e.source)&&r.capabilities&&r.collectionId&&r.layerDefinition&&r.url?new p(e):function(e){return Array.isArray(e.source)}(e)?new h(e):t.query.supportsFormatPBF?new d(e):new f(e);var r},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},6393:(e,t,r)=>{var n;void 0===(n=function(e,n){"use strict";function s(e){return Object.freeze({__proto__:null,default:e})}t.loadProcessorModule=function(e){return new Promise("heatmap"===e?function(e,t){r.e(58).then((function(){var t=[r(50058)];(function(t){e(s(t))}).apply(null,t)})).catch(t.bind(this))}:function(e,t){Promise.all([r.e(1361),r.e(6633),r.e(4090),r.e(2942),r.e(6972)]).then((function(){var t=[r(19363)];(function(t){e(s(t))}).apply(null,t)})).catch(t.bind(this))})},Object.defineProperty(n,"__esModule",{value:!0})}.apply(t,[r,t]))||(e.exports=n)},84572:(e,t,r)=>{var n,s;n=[t,r(58797),r(74637),r(3718),r(73462),r(49359),r(9720),r(40810),r(909),r(8876),r(56478),r(86882)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d){"use strict";const f=i.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource");let p=function(e){function t(t){var r;return(r=e.call(this,t)||this).type="feature",r._adapter=h.createSourceAdapter(t.serviceInfo),r._queue=new l.QueueProcessor({concurrency:8,process:async e=>{a.throwIfAborted(e);const t=e.tile.key.id,{tile:s,signal:i}=e,o={query:n("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:i,transform:s.transform};return r._adapter.executeQuery(e.query,o)}}),r._patchQueue=new l.QueueProcessor({concurrency:8,process:async e=>{a.throwIfAborted(e);const t=e.tile.key.id,{tile:s,signal:i}=e,o={query:n("esri-tiles-debug")?{tile:t.replace(/\//g,"."),depth:e.depth}:void 0,signal:i,transform:s.transform};return r._adapter.executeQuery(e.query,o)}}),r}r._inheritsLoose(t,e);var i=t.prototype;return i.destroy=function(){this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()},i.setViewState=function(e){},i.subscribe=function(t){e.prototype.subscribe.call(this,t),this._fetchDataTile(t).catch((e=>{a.isAbortError(e)||f.error(new o("mapview-query-error","Encountered error when fetching tile",{tile:t,error:e}))}))},i.unsubscribe=function(t){e.prototype.unsubscribe.call(this,t)},i.pause=function(){this._queue.pause()},i.resume=function(){this._queue.resume()},i.query=async function(e,t){return this._adapter.executeQuery(e,t)},i.queryLastEditDate=async function(){const e=this._serviceInfo.source,t={...e.query,f:"json"};return(await c(e.path,{query:t,responseType:"json"})).data.editingInfo.lastEditDate},i.forEachRequest=function(e,t){const r=this._subscriptions.get(e),{requests:n,signal:s}=r;for(const e of n.done)t(e.request,{signal:s})},i._executePatchQuery=async function(e,t,r,n){const i=t.clone();i.outFields=[this._serviceInfo.objectIdField,...r],i.returnCentroid=!1,i.returnGeometry=!1;const o=s.isSome(i.start)?i.start/8e3:0,a=n.signal;return this._patchQueue.push({tile:e,query:i,signal:a,depth:o})},i._resendRequest=async function(e,t){const{query:r,request:n}=e,i=s.isSome(r.outFields)?r.outFields:[],o=this._sourceQueryInfo.outFields,c=o.filter((e=>-1===i.indexOf(e)));if(!s.isNone(n.features))if(c.length)try{const e=await this._executePatchQuery(n.tile,r,c,t);a.throwIfAborted(t),r.outFields=o,n.features.joinAttributes(e),this._onRequest({...n,end:n.end||t.end},"new",t)}catch(e){}else this._onRequest({...n,end:n.end||t.end},"new",t)},i.resend=async function({dataTileOnly:e}){let t=0,r=!1;const n=[];for(this._subscriptions.forEach((e=>{if(!e.requests.done.length){const t=e.tile;this._onRequest({tile:t,id:t.id,features:null,noData:!0,end:!1},"new",{dataTileOnly:!0})}}));!r;)r=!0,this._subscriptions.forEach((({requests:s,signal:i})=>{if(s.done.length>t){r=!1;const o=s.done.length===t+1;n.push(this._resendRequest(s.done[t],{signal:i,dataTileOnly:e,end:o}))}})),t++;await a.all(n)},i._createQuery=function(e,t){const r=new u({...this._serviceQueryInfo,...this._sourceQueryInfo,...t});return this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,r.maxAllowableOffset=e.resolution),t.quantizationParameters&&"esriGeometryPolyline"===this.geometryType&&(r.maxAllowableOffset=e.resolution),r.resultType="tile",r.geometry=e.extent,r},r._createClass(t,[{key:"updating",get:function(){return!!this._queue.length}}]),t}(d.DataTileSource);t.BaseFeatureSource=p,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},86882:(e,t,r)=>{var n,s;n=[t,r(58797),r(3718),r(59286),r(63940)],void 0===(s=function(e,r,n,s,i){"use strict";let o=function(){function e(e){this._abortController=new AbortController,this.requests={pending:new Array,done:new Array},this.tile=e}var t=e.prototype;return t.add=function(e){this.requests.done.push(e),e.request.end&&(this.resolved=!0)},t.abort=function(){this._abortController.abort()},r._createClass(e,[{key:"signal",get:function(){return this._abortController.signal}}]),e}(),a=function(){function e(e){this.events=new s,this._subscriptions=new Map,this._serviceQueryInfo={outSpatialReference:e.outSR},this._serviceInfo=e.serviceInfo,this._onRequest=e.onRequest}var t=e.prototype;return t.queryLastEditDate=async function(){throw new Error("Service does not support query type")},t.query=async function(e,t){throw new Error("Service does not support query")},t.update=function(e){i.diff(e,this._sourceQueryInfo)&&(this._sourceQueryInfo=e)},t.updateSubscriptions=function(){},t.setViewState=function(e){},t.subscribe=function(e){const t=new o(e);this._subscriptions.set(e.id,t)},t.unsubscribe=function(e){const t=this.get(e.id);n.isSome(t)&&t.abort(),this._subscriptions.delete(e.id)},t.pause=function(){},t.resume=function(){},t.get=function(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null},t.enableEvent=function(e,t){},r._createClass(e,[{key:"geometryType",get:function(){return this._serviceInfo.geometryType}}]),e}();t.DataTileSource=a,t.DataTileSubscription=o,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},60635:(e,t,r)=>{var n,s;n=[t,r(58797),r(74637),r(9720),r(84572)],void 0===(s=function(e,r,n,s,i){"use strict";const o=n("esri-featurelayer-webgl"),a=n("esri-mobile"),c={maxDrillLevel:o&&"object"==typeof o&&null!=o.maxDrillLevel?o.maxDrillLevel:a?1:4,maxRecordCountFactor:o&&"object"==typeof o&&null!=o.maxRecordCountFactor?o.maxRecordCountFactor:a?1:3};let u=function(e){function t(t){return e.call(this,t)||this}return r._inheritsLoose(t,e),t.prototype._fetchDataTile=async function(e){const t=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,r=this._subscriptions.get(e.key.id),n=r.signal,i=e.getQuantizationParameters();let o=0;const a=async(u,l)=>{const h=this._sourceQueryInfo,d=this._createQuery(u,{maxRecordCountFactor:t?c.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:i});o++;try{const t=await this._queue.push({tile:e,query:d,signal:n,depth:l});if(o--,s.throwIfAborted(n),!t)return;if(h!==this._sourceQueryInfo)return void a(u,l);if(t.exceededTransferLimit&&l<c.maxDrillLevel){for(const e of u.createChildTiles())a(e,l+1);return}const i={tile:e,id:e.id,features:t,end:0===o};r.requests.done.push({query:d,request:i}),this._onRequest(i,"new")}catch(t){s.isAbortError(t)||this._onRequest({tile:e,id:e.id,features:null,end:!0},"new")}};a(e,0)},t}(i.BaseFeatureSource);t.DrillDownFeatureSource=u,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},40071:(e,t,r)=>{var n,s;n=[t,r(58797),r(74637),r(3718),r(87547),r(16985),r(44789),r(32782),r(63634),r(46233),r(86882)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h){"use strict";function d(e,t){const r=e.weakClone(),n=o.quantizeX(t,e.geometry.coords[0]),s=o.quantizeY(t,e.geometry.coords[1]);return r.geometry=new i([],[n,s]),r}function f(e,t){const r=c.rbush(9,function(e){switch(e){case"esriGeometryPoint":return e=>({minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]});default:return e=>{let t=1/0,r=1/0,n=-1/0,s=-1/0;return e.geometry.forEachVertex(((e,i)=>{t=Math.min(t,e),r=Math.min(r,i),n=Math.max(n,e),s=Math.max(s,i)})),{minX:t,minY:r,maxX:n,maxY:s}}}}(t));return r.load(e),r}function p(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}let _=function(){function e(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map}var t=e.prototype;return t.add=function(e){this._objectIdToFeature.set(e.objectId,e),this._index=null},t.get=function(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null},t.forEach=function(e){this._objectIdToFeature.forEach(e)},t.search=function(e){return this._index||(this._index=f(this._features,this._geometryType)),p(this._index,e)},t.removeById=function(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null},t.update=function(e,t){this.onUpdate(e,t)},r._createClass(e,[{key:"_features",get:function(){const e=[];return this._objectIdToFeature.forEach((t=>e.push(t))),e}},{key:"size",get:function(){return this._objectIdToFeature.size}}]),e}(),y=function(e){function t(t){var n;(n=e.call(this,t)||this).type="geoevent",n._dataReceiveEventEnabled=!1,n._updateInfo={websocket:0,client:0};const{outSR:s}=t,{geometryType:a,objectIdField:c,timeInfo:h,purgeOptions:f,source:p,spatialReference:y,serviceFilter:g,maxReconnectionAttempts:m,maxReconnectionInterval:I,updateInterval:v}=t.serviceInfo,b=new _(n._onUpdate.bind(r._assertThisInitialized(n)),a),S=new u.default(b,c,h,f),T=l.createConnection(p,y,s,a,g,m,I);n._store=b,n._manager=S,n._connection=T,n._quantize=function(e){switch(e){case"esriGeometryPoint":return d;case"esriGeometryPolygon":case"esriGeometryPolyline":default:return(t,r)=>{const n=t.weakClone(),s=new i,a=o.quantizeOptimizedGeometry(s,t.geometry,!1,!1,e,r,!1,!1);return n.geometry=a,n}}}(a),n._handles=[n._connection.on("feature",(e=>n._onFeature(e))),n._connection.watch("connectionStatus",(e=>n.events.emit("connectionStatus",e))),n._connection.watch("errorString",(e=>n.events.emit("errorString",e)))];let w=performance.now();return n._updateIntervalId=setInterval((()=>{const e=performance.now(),r=e-w;if(r>2500){w=e;const t=Math.round(n._updateInfo.client/(r/1e3)),s=Math.round(n._updateInfo.websocket/(r/1e3));n._updateInfo.client=0,n._updateInfo.websocket=0,n.events.emit("updateRate",{client:t,websocket:s})}t.canAcceptRequest()&&n._manager.checkForUpdates()}),v),n}r._inheritsLoose(t,e);var n=t.prototype;return n.destroy=function(){clearInterval(this._updateIntervalId),this._handles.forEach((e=>e.remove())),this._connection.destroy()},n._fetchDataTile=function(){},n.enableEvent=function(e,t){"data-received"===e&&(this._dataReceiveEventEnabled=t)},n.subscribe=function(t){e.prototype.subscribe.call(this,t);const r=this._getTileFeatures(t);this._onRequest({tile:t,id:t.key.id,features:r,end:!0},"new")},n.unsubscribe=function(t){e.prototype.unsubscribe.call(this,t)},n.forEachRequest=function(e,t){const r=this._subscriptions.get(e),{tile:n,signal:s}=r;t({tile:n,id:e,features:this._getTileFeatures(n),end:!0},{signal:s})},n.resend=async function(e){this._subscriptions.forEach((t=>{const{tile:r}=t,n={tile:r,id:r.id,features:this._getTileFeatures(r),end:!0};this._onRequest(n,"update",e)}))},n._getTileFeatures=function(e){const t=this._store.search(e).map((t=>this._quantize(t,e.transform)));return a.FeatureSetReaderJSON.fromOptimizedFeatures(t,this.geometryType,e.transform)},n._onFeature=function(e){this._updateInfo.websocket++;try{this._dataReceiveEventEnabled&&this.events.emit("feature",e);const t=o.convertFromFeature(e,this.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(e){}},n._onUpdate=async function(e,t){const r=s.andThen(e,(e=>f(e,this.geometryType))),n=s.andThen(t,(e=>f(e,this.geometryType)));s.isSome(e)&&(this._updateInfo.client+=e.length),this._subscriptions.forEach(((e,t)=>{const i=e.tile,o=s.andThen(r,(e=>p(e,i))),c=s.andThen(o,(e=>e.map((e=>this._quantize(e,i.transform))))),u=s.andThen(c,(e=>a.FeatureSetReaderJSON.fromOptimizedFeatures(e,this.geometryType,i.transform))),l=s.andThen(n,(e=>p(e,i))),h=s.andThen(l,(e=>e.map((e=>e.objectId))));this._onRequest({tile:i,id:t,features:u,remove:s.unwrapOr(h,[]),end:!0},"update")}))},r._createClass(t,[{key:"updating",get:function(){return!1}}]),t}(h.DataTileSource);t.GeoEventSource=y,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},53731:(e,t,r)=>{var n,s;n=[t,r(58797),r(73462),r(49359),r(9720),r(84572)],void 0===(s=function(e,r,n,s,i,o){"use strict";const a=n.getLogger("esri.views.2d.layers.features.sources.FeatureSource");let c=function(e){function t(t){return e.call(this,t)||this}r._inheritsLoose(t,e);var n=t.prototype;return n._fetchDataTile=async function(e){const t=this._subscriptions.get(e.key.id);let r=!1,n=0,o=0;const c=(n,s)=>{o--,i.throwIfAborted(t);const a=n.reader,c=n.query;if(!a.exceededTransferLimit){if(r=!0,0!==s&&!a.hasFeatures){const r={tile:e,id:e.id,features:a,end:0===o};return t.requests.done.push({request:r,query:c}),void this._onRequest(r,"new")}const n={tile:e,id:e.id,features:a,end:0===o};return t.requests.done.push({request:n,query:c}),void this._onRequest(n,"new")}const u={tile:e,id:e.id,features:a,end:r&&0===o};t.requests.done.push({request:u,query:c}),this._onRequest(u,"new")};let u=0,l=0;for(;!r&&l++<20;){let l;for(let h=0;h<u+1;h++){const u=n++;o++,l=this._fetchDataTilePage(e,u,t).then((e=>e&&c(e,u))).catch((t=>{r=!0,i.isAbortError(t)||(a.error(new s("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t})),this._onRequest({tile:e,id:e.id,features:null,end:r},"new"))}))}await l,i.throwIfAborted(t),u=Math.min(u+2,6)}},n._fetchDataTilePage=async function(e,t,r){const n=this._sourceQueryInfo,s=this._createQuery(e,{start:8e3*t,num:8e3,maxRecordCountFactor:3,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()});try{const o=r.signal,a=await this._queue.push({tile:e,query:s,signal:o,depth:t});return i.throwIfAborted(r),a?n!==this._sourceQueryInfo?this._fetchDataTilePage(e,t,r):{reader:a,query:s}:null}catch(e){return i.throwIfNotAbortError(e),null}},t}(o.BaseFeatureSource);t.PagedFeatureSource=c,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},11685:(e,t,r)=>{var n,s;n=[t,r(30106),r(60635),r(40071),r(53731)],void 0===(s=function(e,r,n,s,i){"use strict";t.createSource=function(e,t,o,a,c){const u=function(e,t,n,s,i){switch(e.type){case"stream":return{type:"geoevent",serviceInfo:e,onRequest:s,outSR:t,canAcceptRequest:i};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onRequest:s,outSR:t,origin:function(e){return Array.isArray(e)?"local":"path"in e&&r.isHostedAgolService(e.path)?"hosted":"unknown"}(e.source),tileInfoView:n,canAcceptRequest:i}}}(e,t,o,a,c);switch(u.type){case"feature":switch(u.origin){case"hosted":case"local":return new i.PagedFeatureSource(u);case"unknown":return new n.DrillDownFeatureSource(u)}case"geoevent":return new s.GeoEventSource(u)}},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},19866:(e,t,r)=>{var n,s;n=[t,r(58797),r(74637),r(3718),r(56750),r(23084),r(74558),r(26016),r(59286),r(63940),r(5691),r(87547),r(16985),r(34254),r(44789),r(73819),r(79043),r(39241),r(45552)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l,h,d,f,p,_,y,g,m,I){"use strict";let v=function(e){function t(t,r,n,s,i){var o;const a=new d([],[r,n]);return(o=e.call(this,a,s,null,t)||this).geohashBoundsInfo=i,o}r._inheritsLoose(t,e),t.create=function(e,r,n,s,i,o,a,c){const u=new t(r,n,s,o,a);return u.displayId=e.createDisplayId(!0),u.referenceId=c,u.tileLevel=i,u};var n=t.prototype;return n.update=function(e,t,r,n,s,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=n,this.geohashBoundsInfo=s,this.referenceId=null,this.referenceId=i,this},n.toJSON=function(){return{objectId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null,attributes:{...this.attributes,clusterId:this.objectId},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},r._createClass(t,[{key:"count",get:function(){return this.attributes.cluster_count}}]),t}(h);function b(e){return 57.29577951308232*e}let S=function(e){function t(t,r,n){var s;return(s=e.call(this,t,n)||this).events=new u,s._geohashLevel=0,s._aggregateValueRanges={},s._aggregateValueRangesChanged=!1,s._geohashBuf=[],s._clusters=new Map,s._tiles=new Map,s.geometryInfo=t.geometryInfo,s._spatialReference=r,s._projectionSupportCheck=g.checkProjectionSupport(r,o.WGS84),s._bitsets.geohash=n.getBitset(n.createBitset()),s._bitsets.inserted=n.getBitset(n.createBitset()),s}r._inheritsLoose(t,e);var c=t.prototype;return c.updateSchema=async function(t,r){const i=this._schema;try{await e.prototype.updateSchema.call(this,t,r),await this._projectionSupportCheck}catch(e){}const o=l.diff(i,r);t.mesh&&(t.targets.aggregate=!0),r&&(!s.isNone(o)||t.source||t.storage.filters)&&((l.hasDiff(o,"params.fields")||!this._tree||t.source)&&(this._tree=new y.GeohashTree(this._statisticFields),this._rebuildTree(),n("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),n("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",o),t.mesh=!0,t.targets[r.name]=!0,this._aggregateValueRanges={})},c.sweepFeatures=function(e,t){this._bitsets.inserted.forEachSet((r=>{if(!e.has(r)){const e=t.lookupByDisplayIdUnsafe(r);this._remove(e)}}))},c.sweepClusters=function(e,t,r){this._clusters.forEach(((n,s)=>{n&&n.tileLevel!==r&&(e.releaseDisplayId(n.displayId),t.unsetAttributeData(n.displayId),this._clusters.delete(s))}))},c.onTileData=function(e,t,r,n,i){if(!this._schema||s.isNone(t.addOrUpdate))return t;const o=this._tree,a=this._getTransforms(e,this._spatialReference);{const e=t.addOrUpdate.getCursor();for(;e.next();)this._update(e,n,o)}if(!i)return t;const c=new Array,u=this._schema.params.clusterRadius;this._getClustersForTile(c,e,u,r,o,a),t.type="replace"===t.type?"replace":"update",t.addOrUpdate=_.FeatureSetReaderJSON.fromOptimizedFeatures(c,"esriGeometryPoint"),t.addOrUpdate._storage=r;{const n=t.addOrUpdate.getCursor();for(;n.next();){const t=n.getDisplayId();this._bitsets.computed.unset(t),this.setComputedAttributes(r,n,t,e.scale)}}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t},c.onTileUpdate=function({added:e,removed:t}){if(e.length){const t=e[0].level;this._setGeohashLevel(t)}if(!this._schema)return;const r=this._schema.params.clusterRadius;t.forEach((e=>{this._tiles.delete(e.key.id),this._markTileClustersForDeletion(e,r)}))},c.getAggregate=function(e){let t=null;return this._clusters.forEach((r=>{r&&r.displayId===e&&(t=r.toJSON())})),t},c.getDisplayId=function(e){const t=this._clusters.get(e);return t?t.displayId:null},c.getFeatureDisplayIdsForAggregate=function(e){const t=this._clusters.get(e);if(!t)return[];const r=t.geohashBoundsInfo;return this._tree.getRegionDisplayIds(r.xLL,r.yLL,r.xTR,r.yTR,r.level)},c.getDisplayIdForReferenceId=function(e){let t;return this._clusters.forEach((r=>{r&&r.referenceId===e&&(t=r.displayId)})),t},c.getAggregateValueRanges=function(){return this._aggregateValueRanges},c.forEach=function(e){this._clusters.forEach(((t,r)=>{t&&e(t,r)}))},c.size=function(){let e=0;return this.forEach((t=>e++)),e},c._rebuildTree=function(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._bitsets.geohash.clear(),this._tree&&this._tree.clear()},c._remove=function(e){const t=e.getDisplayId(),r=e.getXHydrate(),n=e.getYHydrate(),s=this._geohashBuf[2*t],i=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,n,s,i,this._geohashLevel))},c._update=function(e,t,r){const n=e.getDisplayId(),s=this._bitsets.inserted,i=t.isVisible(n);if(i===s.has(n))return;if(!i)return void this._remove(e);const o=e.getXHydrate(),a=e.getYHydrate();if(!this._setGeohash(n,o,a))return;const c=this._geohashBuf[2*n],u=this._geohashBuf[2*n+1];r.insertCursor(e,n,o,a,c,u,this._geohashLevel),s.set(n)},c._setGeohash=function(e,t,r){if(this._bitsets.geohash.has(e))return!0;const n=this._geohashBuf;if(this._spatialReference.isWebMercator){const s=b(t/a.earth.radius),i=s-360*Math.floor((s+180)/360),o=b(Math.PI/2-2*Math.atan(Math.exp(-1*r/a.earth.radius)));p.setGeohashBuf(n,e,o,i,12)}else{const s={x:t,y:r},i=g.project(s,this._spatialReference,o.WGS84);if(!i)return!1;p.setGeohashBuf(n,e,i.y,i.x,12)}return this._bitsets.geohash.set(e),!0},c._getClustersForTile=function(e,t,r,n,i,o,a=!0){const c=this._schema.params.clusterPixelBuffer,u=2*r,l=this._getGeohashLevel(t.key.level),d=Math.ceil(Math.pow(2,t.key.level)*m.TILE_SIZE/u),p=Math.ceil(c/u)+0,_=Math.ceil(m.TILE_SIZE/u),{row:y,col:g}=t.key,I=g*m.TILE_SIZE,v=y*m.TILE_SIZE,b=Math.floor(I/u)-p,S=Math.floor(v/u)-p,T=b+_+2*p,w=S+_+2*p,E=t.tileInfoView.getLODInfoAt(t.key.level);for(let r=b;r<=T;r++)for(let c=S;c<=w;c++){let u=r;E.wrap&&(u=r<0?r+d:r%d);const p=E.wrap&&r<0,_=E.wrap&&r%d!==r,y=this._lookupCluster(n,E,t.key.level,u,c,l,i);if(s.isSome(y)){const t=s.andThen(o,(e=>p?e.left:_?e.right:e.tile));if(a&&s.isNone(t))continue;if(!y.count)continue;if(s.isSome(t)&&a){const r=y.geometry.clone();let n=y.attributes;r.coords[0]=f.quantizeX(t,r.coords[0]),r.coords[1]=f.quantizeY(t,r.coords[1]),1===y.count&&s.isSome(y.referenceId)&&(n={...y.attributes,referenceId:y.referenceId});const i=new h(r,n);i.displayId=y.displayId,e.push(i)}}}},c._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},c._setGeohashLevel=function(e){const t=this._getGeohashLevel(e),r=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==r)return this._geohashLevel=r,void this._rebuildTree()},c._getTransforms=function(e,t){const r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=i.getInfo(t);if(!n)return{tile:r,left:null,right:null};const[s,o]=n.valid;return{tile:r,left:{...r,translate:[o,e.bounds[3]]},right:{...r,translate:[s-o+e.bounds[0],e.bounds[3]]}}},c._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},c._markForDeletion=function(e,t,r){const n=this._getClusterId(e,t,r);this._clusters.delete(n)},c._getClusterBounds=function(e,t,r){const n=this._schema.params.clusterRadius,s=2*n;let i=r%2?t*s:t*s-n;const o=r*s;let a=i+s;const c=o-s,u=Math.pow(2,e.level)*m.TILE_SIZE;e.wrap&&i<0&&(i=0),e.wrap&&a>u&&(a=u);const l=i/m.TILE_SIZE,h=o/m.TILE_SIZE,d=a/m.TILE_SIZE,f=c/m.TILE_SIZE;return[e.getXForColumn(l),e.getYForRow(h),e.getXForColumn(d),e.getYForRow(f)]},c._lookupCluster=function(e,t,r,n,i,c,u){const l=this._getClusterId(r,n,i),h=this._clusters.get(l),[d,f,_,y]=this._getClusterBounds(t,n,i),m={x:d,y:f},I={x:_,y};let S=0,T=0,w=0,E=0;if(this._spatialReference.isWebMercator){{const e=b(m.x/a.earth.radius);S=e-360*Math.floor((e+180)/360),T=b(Math.PI/2-2*Math.atan(Math.exp(-1*m.y/a.earth.radius)))}{const e=b(I.x/a.earth.radius);w=e-360*Math.floor((e+180)/360),E=b(Math.PI/2-2*Math.atan(Math.exp(-1*I.y/a.earth.radius)))}}else{const e=g.project(m,this._spatialReference,o.WGS84),t=g.project(I,this._spatialReference,o.WGS84);if(!e||!t)return null;S=e.x,T=e.y,w=t.x,E=t.y}const x={geohashX:0,geohashY:0},F={geohashX:0,geohashY:0};p.setGeohashXY(x,T,S,c),p.setGeohashXY(F,E,w,c);const C=x.geohashX,A=x.geohashY,R=F.geohashX,O=F.geohashY,L={xLL:C,yLL:A,xTR:R,yTR:O,level:c},k=u.getRegionStatistics(C,A,R,O,c),{count:M,xTotal:P,yTotal:N,referenceId:D}=k,G=M?P/M:0,q=M?N/M:0;if(0===M)return this._clusters.set(l,null),null;const U={cluster_count:M,...k.attributes},B=s.isSome(h)?h.update(G,q,r,U,L,D):v.create(e,l,G,q,r,U,L,D);return 0===M&&(B.geometry.coords[0]=(d+_)/2,B.geometry.coords[1]=(f+y)/2),this._clusters.set(l,B),this._updateAggregateValueRangeForCluster(B,B.tileLevel),B},c._updateAggregateValueRangeForCluster=function(e,t){const r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},n=r.minValue,s=r.maxValue;r.minValue=Math.min(n,e.count),r.maxValue=Math.max(s,e.count),this._aggregateValueRanges[t]=r,n===r.minValue&&s===r.maxValue||(this._aggregateValueRangesChanged=!0)},c._markTileClustersForDeletion=function(e,t){const r=2*t,n=Math.ceil(m.TILE_SIZE/r),{row:s,col:i}=e.key,o=i*m.TILE_SIZE,a=s*m.TILE_SIZE,c=Math.floor(o/r),u=Math.floor(a/r);for(let t=c;t<c+n;t++)for(let r=u;r<u+n;r++)this._markForDeletion(e.key.level,t,r)},t}(I.Store2D);t.ClusterInfo=v,t.ClusterStore=S,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},3980:(e,t,r)=>{var n,s;n=[t,r(58797),r(73462),r(49359),r(5691),r(87547),r(16985),r(3434),r(93286),r(21717)],void 0===(s=function(e,r,n,s,i,o,a,c,u,l){"use strict";const h=n.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF"),d=268435455;function f(e){for(;e.next();)switch(e.tag()){case 1:return e.getMessage();default:e.skip()}return null}let p=function(e){function t(t,r,n,s){var i;return(i=e.call(this,t)||this)._hasNext=!1,i._isPoints=!1,i._isPolygons=!1,i._featureIndex=-1,i._featureOffset=0,i._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},i._geometryType=s,i._reader=r,i._header=n,i._hasNext=n.hasFeatures,i._isPoints="esriGeometryPoint"===s,i._isPolygons="esriGeometryPolygon"===s,i}r._inheritsLoose(t,e),t.fromBuffer=function(e,r){const n=function(e){try{const t=2,r=new u(new Uint8Array(e),new DataView(e));for(;r.next();)switch(r.tag()){case t:return f(r.getMessage());default:r.skip()}}catch(e){const t=new s("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});h.error(t)}return null}(e),i=l.parseHeader(n,"esriGeometryPoint"===r);return new t(c.FeatureSetReader.createInstance(),n,i,r)};var n=t.prototype;return n.getApproximateSize=function(){if(this._hasFilter){const e=Math.abs(this._xmax-this._xmin)*Math.abs(this._ymax-this._ymin),t=this.size*e/262144;return Math.max(Math.round(t),0)}return this.size},n.getQuantizationTransform=function(){return this._header.transform},n.getCursor=function(){return this.copy()},n.getIndex=function(){return this._featureIndex},n.setIndex=function(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e},n.getAttributeHash=function(){let e="";return this._header.fieldIndexMap.forEach((t=>{e+=this._readAttributeAtIndex(t)+"."})),e},n.getObjectId=function(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)},n.getDisplayId=function(){return this._header.displayIds[this._featureIndex]},n.setDisplayId=function(e){this._header.displayIds[this._featureIndex]=e},n.getGroupId=function(){return this._header.groupIds[this._featureIndex]},n.setGroupId=function(e){this._header.groupIds[this._featureIndex]=e},n.readLegacyFeature=function(){if(void 0===this._cache.legacyFeature){var e;const t=this.readCentroid(),r={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!=(e=t&&{x:t.coords[0],y:t.coords[1]})?e:null};return this._cache.legacyFeature=r,r}return this._cache.legacyFeature},n.readOptimizedFeature=function(){if(void 0===this._cache.optFeature){const e=new i(this.readGeometry(),this.readAttributes(),this.readCentroid());return this._cache.optFeature=e,e}return this._cache.optFeature},n.getXHydrate=function(){const e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return e*t.scale[0]+t.translate[0]},n.getYHydrate=function(){const e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return t.translate[1]-e*t.scale[1]},n.readLegacyPointGeometry=function(){return{x:this._header.centroid[2*this._featureIndex]+this._tx,y:this._header.centroid[2*this._featureIndex+1]+this._ty}},n.readLegacyGeometry=function(){const e=this.readGeometry();return a.convertToGeometry(e,this.geometryType,!1,!1)},n.readLegacyCentroid=function(){const e=this.readCentroid();if(!e)return null;const[t,r]=e.coords;return{x:t,y:r}},n.readGeometryArea=function(){return this._cache.area||this.readGeometry(),this._cache.area},n.readUnquantizedGeometry=function(){if(void 0===this._cache.unquantGeometry){const e=this.readGeometry();if(!e)return this._cache.unquantGeometry=null,null;const t=e.clone(),r=t.lengths,n=t.coords;for(let e=0,t=2;e<r.length;e++,t+=2){const s=r[e];for(let e=1;e<s;e+=1,t+=2)n[t]+=n[t-2],n[t+1]+=n[t-1]}return this._cache.unquantGeometry=t,t}return this._cache.unquantGeometry},n.readHydratedGeometry=function(){const e=this.readGeometry();if(!e)return null;const t=e.clone();return this._isPoints&&(t.coords[0]-=this._tx,t.coords[1]-=this._ty),a.unquantizeOptimizedGeometry(t,t,this.hasZ,this.hasM,this.getQuantizationTransform()),t},n.readGeometry=function(){if(void 0===this._cache.geometry){let e=null;if(this._isPoints){const t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;e=new o([],[t,r])}else{const t=this._header.offsets.geometry[this._featureIndex],r=this._reader;if(0===t)return null;r.move(t);try{e=this._parseGeometry(r)}catch(e){return console.error("Failed to parse geometry!",e),null}}return this._cache.geometry=e,e}return this._cache.geometry},n.readCentroid=function(){if(void 0===this._cache.centroid){let e=null;const t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;return t===d?(e=this._computeCentroid(),e&&(this._header.centroid[2*this._featureIndex]=e.coords[0]-this._tx,this._header.centroid[2*this._featureIndex+1]=e.coords[1]-this._ty)):e=new o([],[t,r]),this._cache.centroid=e,e}return this._cache.centroid},n.copy=function(){const e=this._reader.clone(),r=new t(this.instance,e,this._header,this.geometryType);return this.copyInto(r),r},n.next=function(){if(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,!this._hasFilter)return++this._featureIndex<this.size;for(;++this._featureIndex<this.size&&!this._passesFilter(););return this._featureIndex<this.size},n._readAttribute=function(e,t){const r=this._header.hasFieldIndex(e)?e:function(e){return e.toLowerCase().trim()}(e),n=this._header.getFieldIndex(r);if(null==n)return;const s=this._readAttributeAtIndex(n);return t&&this._header.isDateField(r)?new Date(s):s},n._readAttributes=function(){const e={};return this._header.fieldIndexMap.forEach(((t,r)=>{e[r]=this._readAttributeAtIndex(t)})),e},n.copyInto=function(t){e.prototype.copyInto.call(this,t),t._featureIndex=this._featureIndex,t._featureOffset=this._featureOffset,t._hasNext=this._hasNext},n._passesFilter=function(){if(!this._hasFilter)return!0;let e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];if(e===d){if(this._isPolygons&&!this.readCentroid())return!1;e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1]}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax},n._readAttributeAtIndex=function(e){const t=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],r=this._reader;return r.move(t),function(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:{const t=e.getString();return""===t?null:t}case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(r)},n._preprocessPolygon=function(e,t){let r=0,n=0,s=0,i=!1,a=!1,c=!1,u=-1;const l=[];let h=0,d=!1;for(let o=0;o<t.length;o++){const f=t[o];let p=e[2*r],_=e[2*r+1],y=0;for(let t=1;t<f;t++){const n=p,s=_,i=p+e[2*(r+t)],o=_+e[2*(r+t)+1];p=i,_=o,y+=(i-n)*(o+s)*.5}const g=y>0;if(g&&d&&(n+=f),g||(u++,d=!1),u>=1e6)break;h+=y,i&&g&&a&&(c=!0);{e[2*s]=e[2*n],e[2*s+++1]=e[2*n+++1];let t=1,r=e[2*n],i=e[2*n+++1];for(let o=2;o<f;o++){const o=e[2*n],a=e[2*n+++1];r*a-o*i==0?(r+=o,i+=a):(e[2*s]=r,e[2*s+++1]=i,t++,r=o,i=a)}e[2*s]=r,e[2*s+++1]=i,t++,l.push(t)}i=!1,a=!0,r+=f}return l.length?(this._cache.area=Math.abs(h),new o(l,e,c)):null},n._parseGeometry=function(e){const t=e.getLength(),r=e.pos()+t,n=[],s=[];for(;e.pos()<r&&e.next();)switch(e.tag()){case 2:{const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r;)s.push(e.getUInt32());break}case 3:{const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r;)n.push(e.getSInt32()),n.push(e.getSInt32()),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();break}case 1:default:e.skip()}let i=0;for(const e of s)n[2*i]+=this._tx,n[2*i+1]+=this._ty,i+=e;return this._isPolygons?this._preprocessPolygon(n,s):new o(s,n)},r._createClass(t,[{key:"geometryType",get:function(){return this._geometryType}},{key:"size",get:function(){return this._header.featureCount}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}},{key:"stride",get:function(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}},{key:"hasFeatures",get:function(){return this._header.hasFeatures}},{key:"hasNext",get:function(){return this._hasNext}},{key:"exceededTransferLimit",get:function(){return this._header.exceededTransferLimit}}]),t}(c.FeatureSetReader);t.FeatureSetReaderPBF=p,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},21717:(e,t,r)=>{var n,s;n=[t,r(49359),r(16686)],void 0===(s=function(e,r,n){"use strict";const s=268435455;let i=function(){function e(){this.hasFeatures=!1,this.fieldIndexMap=new Map,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.dateFields=new Set,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}var t=e.prototype;return t.hasFieldIndex=function(e){return this.fieldIndexMap.has(e)},t.isDateField=function(e){return this.dateFields.has(e)},t.getFieldIndex=function(e){return this.fieldIndexMap.get(e)},e}();function o(e){const t=e.getLength(),r=e.pos()+t,s={name:"",isDate:!1};for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:s.name=e.getString();break;case 2:"esriFieldTypeDate"===n.parseFieldType(e.getEnum())&&(s.isDate=!0);break;default:e.skip()}return s}t.FeatureSetHeader=i,t.parseHeader=function(e,t){const a=e.pos(),c=new i;let u=0,l=0,h=null,d=null,f=null,p=!1;for(;e.next();)switch(e.tag()){case 1:h=e.getString();break;case 3:d=e.getString();break;case 12:f=e.processMessage(n.parseTransform);break;case 9:c.exceededTransferLimit=e.getBool(),c.exceededTransferLimit&&(c.offsets.geometry=new Int32Array(8e3),c.centroid=new Int32Array(16e3));break;case 13:{const t=o(e),r=t.name.toLowerCase().trim(),n=u++;c.fieldIndexMap.set(t.name,n),c.fieldIndexMap.set(r,n),t.isDate&&(c.dateFields.add(t.name),c.dateFields.add(r));break}case 15:{const r=e.getLength(),n=e.pos()+r;if(!c.exceededTransferLimit){const e=c.offsets.geometry,t=c.centroid;e.push(0),t.push(s),t.push(s)}!p&&c.exceededTransferLimit&&(p=!0,c.offsets.attributes=new Uint32Array(8e3*u));let i=l*u;for(;e.pos()<n&&e.next();)switch(e.tag()){case 1:{p?c.offsets.attributes[i++]=e.pos():c.offsets.attributes.push(e.pos());const t=e.getLength();e.skipLen(t);break}case 2:if(t){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),r=e.getSInt32();c.centroid[2*l]=t,c.centroid[2*l+1]=r;break}default:e.skip()}}else{c.offsets.geometry[l]=e.pos();const t=e.getLength();e.skipLen(t)}break;case 4:{const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 3:{e.getUInt32();const t=e.getSInt32(),r=e.getSInt32();c.centroid[2*l]=t,c.centroid[2*l+1]=r;break}default:e.skip()}break}default:e.skip()}l++,c.hasFeatures=!0;break}default:e.skip()}const _=h||d;if(!_)throw new r("FeatureSet has no objectId or globalId field name");return c.featureCount=l,c.fieldCount=u,c.objectIdFieldIndex=c.getFieldIndex(_),c.transform=f,c.displayIds=new Uint32Array(c.featureCount),c.groupIds=new Uint16Array(c.featureCount),e.move(a),c},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},29707:(e,t)=>{var r;void 0===(r=function(e){"use strict";let r=function(){function e(){this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}e.create=function(t){const r=new e;for(const e in t){const n=t[e];if("object"==typeof n)for(const t in n){const s=n[t];r[e][t]=s}r[e]=n}return r},e.empty=function(){return e.create({})},e.all=function(){return e.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})};var t=e.prototype;return t.any=function(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter},t.describe=function(){let e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(const e of this.why.mesh)t+=`    + ${e}\n`}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(const e of this.why.source)t+=`    + ${e}\n`}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed");const r=e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow";console.debug(`Applying ${r} update of cost ${e}/45 `),console.debug(t)},t.toJSON=function(){return{source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh,queryFilter:this.queryFilter}},e}();t.UpdateToken=r,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)},89647:(e,t,r)=>{var n,s;n=[t,r(16585)],void 0===(s=function(e,r){"use strict";function n(e,t,r){const n=e.clone(),s=1<<n.level,i=n.col+t,o=n.row+r;return i<0&&i!==n.col?(n.col=i+s,n.world-=1):i>=s?(n.col=i-s,n.world+=1):n.col=i,n.row=o,n}t.getPow2NeighborKey=n,t.getPow2NeighborTile=function(e,t,s){const i=n(e.key,t,s);return new r.Tile(e.tileInfoView,i)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)},68305:(e,t,r)=>{var n,s;n=[t,r(3718),r(90920),r(39241),r(53183),r(31581),r(36494)],void 0===(s=function(e,r,n,s,i,o,a){"use strict";function c(e){return{value:e.value,size:n.toPt(e.size)}}function u(e){return e.map((e=>c(e)))}function l(e){if("string"==typeof e||"number"==typeof e)return n.toPt(e);const t=e;return{type:"size",expression:t.expression,stops:u(t.stops)}}const h=e=>{const t=[],r=[],i=u(e),o=i.length;for(let e=0;e<6;e++){const a=i[Math.min(e,o-1)];t.push(a.value),r.push(null==a.size?s.NAN_MAGIC_NUMBER:n.pt2px(a.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function d(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const r=e.stops;for(let e=0;e<8;++e){const n=r[Math.min(e,r.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=r}}return t}function f(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function p(e){if(r.isNone(e))return null;if(e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const r=e.stops;for(let e=0;e<8;++e){const n=r[Math.min(e,r.length-1)];t.values[e]=n.value,f(t.colors,e,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)t.values[e]=1/0,f(t.colors,e,r)}}for(let e=0;e<32;e+=4)o.premultiplyAlpha(t.colors,e,!0);return t}t.convertColorVariable=p,t.convertVisualVariables=function(e){const t=e&&e.length>0?{}:null,r=t?{}:null;if(!t)return{vvFields:t,vvRanges:r};for(const n of e)if(n.field&&(t[n.type]=n.field),"size"===n.type){r.size||(r.size={});const e=n;switch(a.getTypeOfSizeVisualVariable(e)){case i.WGLVVFlag.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:l(e.minSize),maxSize:l(e.maxSize)};break;case i.WGLVVFlag.SIZE_SCALE_STOPS:r.size.scaleStops={stops:u(e.stops)};break;case i.WGLVVFlag.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const r in e.levels)t[r]=h(e.levels[r]);r.size.fieldStops={type:"level-dependent",levels:t}}else r.size.fieldStops={type:"static",...h(e.stops)};break;case i.WGLVVFlag.SIZE_UNIT_VALUE:r.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)r.color=p(n);else if("opacity"===n.type)r.opacity=d(n);else if("rotation"===n.type){const e=n;r.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:r}},t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.getVisualVariablesFields=function(e){const t=e&&e.length>0?{}:null;return t&&e.forEach((e=>{const r=e.type;e.field&&(t[r]=e.field)})),t},t.normalizeSizeElement=l,t.normalizeSizeStops=u,t.stopToSizeStop=c,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=s)}}]);