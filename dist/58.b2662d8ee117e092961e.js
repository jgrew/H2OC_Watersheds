(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[58],{57575:(e,t,r)=>{var n,o;n=[t,r(70792),r(3438)],void 0===(o=function(e,r,n){"use strict";const o=(()=>{if(!("document"in r))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,r=>{t.clearRect(0,0,1,e.height);const n=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of r.colorStops)n.addColorStop(Math.max(e,.001),`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`);return t.fillStyle=n,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function a(e,t,r,o,a){const i=new Uint32Array(e*e),s="buffer"in t?t:new Float64Array(t),c="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),l=c.length/(a-o);for(let e=0;e<s.length;e++){const t=s[e],r=Math.floor((t-o)*l);i[e]=c[n.clamp(r,0,c.length-1)]}return i.buffer}function i(e){const t=Math.round(3*e),r=2*e*e,n=new Float64Array(2*t+1);for(let o=0;o<=n.length;o++)n[o]=Math.exp(-Math.pow(o-t,2)/r)/Math.sqrt(2*Math.PI)*(e/2);return n}function s(e,t){return"function"==typeof e?e:e?"string"==typeof t?t=>-1*+t[e]:r=>+r[e]+t:()=>1}function c(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}t.calculateHeatmapIntensityInfo=function(e,t,r,n){const{blurRadius:o,fieldOffset:a,field:c}=t,l=new Float64Array(r*n),u=i(o),p=Math.round(3*o);let d,f=Number.NEGATIVE_INFINITY;const h=s(c,a);for(const{geometry:t,attributes:o}of e){const e=t.x-p,a=t.y-p,i=Math.max(0,e),s=Math.max(0,a),c=Math.min(n,t.y+p),y=Math.min(r,t.x+p),m=+h(o);for(let t=s;t<c;t++){const n=u[t-a];for(let o=i;o<y;o++){const a=u[o-e];d=l[t*r+o]+=n*a*m,d>f&&(f=d)}}}return{matrix:l.buffer,max:f}},t.calculateHeatmapIntensityInfoReaders=function(e,t,r,n){const{blurRadius:o,fieldOffset:a,field:s}=t,l=new Float64Array(r*n),u=i(o),p=Math.round(3*o);let d,f=Number.NEGATIVE_INFINITY;const h=c(s,a),y=new Set;for(const t of e){const e=t.getCursor();for(;e.next();){const t=e.getObjectId();if(y.has(t))continue;y.add(t);const o=e.readLegacyPointGeometry(),a=+h(e),i=o.x-p,s=o.y-p,c=Math.max(0,i),m=Math.max(0,s),_=Math.min(n,o.y+p),g=Math.min(r,o.x+p);for(let e=m;e<_;e++){const t=u[e-s];for(let n=c;n<g;n++){const o=u[n-i];d=l[e*r+n]+=t*o*a,d>f&&(f=d)}}}}return{matrix:l.buffer,max:f}},t.createHeatmapImageData=a,t.createKernel=i,t.createValueFunction=s,t.createValueFunctionCursor=c,t.drawHeatmap=function(e,t,r,n,o,i){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const s=e.getImageData(0,0,t,t);r&&n&&s.data.set(new Uint8ClampedArray(a(t,r,n,o,i))),e.putImageData(s,0,0)},t.generateGradient=o,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n))||(e.exports=o)},13123:(e,t,r)=>{var n,o;n=[r(58797),r(11285),r(74637),r(73462),r(67059),r(26475),r(99752),r(4037),r(51916),r(18377),r(74474)],void 0===(o=function(e,t,r,n,o,a,i,s,c,l,u){"use strict";let p=function(t){function r(){return t.apply(this,arguments)||this}e._inheritsLoose(r,t);var n=r.prototype;return n.initialize=function(){},n.destroy=function(){},e._createClass(r,[{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(u.HandleOwner);return t.__decorate([a.property({readOnly:!0})],p.prototype,"supportsTileUpdates",null),t.__decorate([a.property({constructOnly:!0})],p.prototype,"remoteClient",void 0),t.__decorate([a.property({constructOnly:!0})],p.prototype,"service",void 0),t.__decorate([a.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],p.prototype,"spatialReference",null),t.__decorate([a.property({constructOnly:!0})],p.prototype,"tileInfo",void 0),t.__decorate([a.property({constructOnly:!0})],p.prototype,"tileStore",void 0),p=t.__decorate([i.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],p),p}.apply(t,n))||(e.exports=o)},50058:(e,t,r)=>{var n,o;n=[r(58797),r(11285),r(74637),r(3718),r(73462),r(67059),r(26475),r(99752),r(4037),r(51916),r(18377),r(63940),r(57575),r(13123)],void 0===(o=function(e,t,r,n,o,a,i,s,c,l,u,p,d,f){"use strict";let h=function(t){function r(){var e;return(e=t.apply(this,arguments)||this).type="heatmap",e._tileKeyToFeatureSets=new Map,e}e._inheritsLoose(r,t);var o=r.prototype;return o.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},o.update=async function(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&p.diff(this._schema,r)&&(e.mesh=!0,this._schema=r)},o.onTileUpdate=function(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)},o.onTileData=async function(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)&&"replace"!==t.type||this._tileKeyToFeatureSets.set(e.key.id,new Map);const o=this._tileKeyToFeatureSets.get(e.key.id);n.isSome(t.addOrUpdate)&&o.set(t.addOrUpdate.instance,t);let a=t.end;if(o.forEach((e=>a=a||e.end)),!a)return;const i=[];o.forEach((e=>{n.isSome(e.addOrUpdate)&&i.push(e.addOrUpdate)}));const s=d.calculateHeatmapIntensityInfoReaders(i,this._schema.mesh,512,512),c={tileKey:e.key.id,intensityInfo:s},l=[s.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",c,{...r,transferList:l})},o.onTileError=function(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)},r}(f);return h=t.__decorate([s.subclass("esri.views.2d.layers.features.processors.HeatmapProcessor")],h),h}.apply(t,n))||(e.exports=o)}}]);