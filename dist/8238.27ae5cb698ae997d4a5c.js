(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[8238],{79060:(e,t,r)=>{var i,n;i=[r(9720)],void 0===(n=function(e){"use strict";return function(){function t(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}var r=t.prototype;return r.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},r.featureSetByName=function(e,t=!0,r=["*"]){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},r.featureSetById=function(e,t=!0,r=["*"]){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},r.castToText=function(){return"object, FeatureSetCollection"},r.resolvePromise=function(t){return e.resolve(t)},t}()}.apply(t,i))||(e.exports=n)},78238:(e,t,r)=>{var i,n;i=[t,r(58797),r(9720),r(13032),r(40810),r(25489),r(22728),r(86856),r(79060),r(46621),r(69269),r(11027),r(67032),r(1650),r(86098),r(55481),r(98757),r(37899),r(93130),r(31699)],void 0===(n=function(e,r,i,n,s,a,l,o,u,c,d,h,f,p,_,y,g,m,F,S){"use strict";function w(e,t){if(c.applicationCache){const r=c.applicationCache.getLayerInfo(e);if(r)return r.then((r=>i.resolve(new g({url:e,outFields:t,sourceJSON:r}))));const n=new g({url:e,outFields:t});let s=i.create(((e,t)=>{n.load().then((()=>{e(n.sourceJSON)}),(e=>{t(e)}))}));return c.applicationCache&&(c.applicationCache.setLayerInfo(e,s),s=s.catch((t=>{throw c.applicationCache.clearLayerInfo(e),t}))),s.then((()=>i.resolve(n)))}return i.resolve(new g({url:e,outFields:t}))}function b(e,t,r,n,s){return w(e,["*"]).then((e=>i.resolve(v(e,t,r,n,s))))}function v(e,t=null,r=null,i=!0,n=null){return!0===e._hasMemorySource()?new F({layer:e,spatialReference:t,outFields:r,includeGeometry:i,lrucache:n}):new m({layer:e,spatialReference:t,outFields:r,includeGeometry:i,lrucache:n})}function I(e){if(null!==c.applicationCache){const t=c.applicationCache.getLayerInfo(e);if(null!==t)return t}let t=s(e,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),i.resolve(t)}return i.resolve({layers:[],tables:[]})}));return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(e,t),t=t.catch((t=>{throw c.applicationCache.clearLayerInfo(e),t}))),t}h.registerAction(),p.registerAction(),f.registerAction(),_.registerAction(),y.registerAction();let C=function(e){function t(t,r=null,i=null){var n;return(n=e.call(this)||this)._map=t,n._overridespref=r,n.lrucache=i,n._instantLayers=[],n}r._inheritsLoose(t,e);var n=t.prototype;return n.makeAndAddFeatureSet=function(e,t=!0,r=null){const i=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:i,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),i},n.featureSetByName=function(e,t=!0,r=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetByName(e,t,r)}catch(e){return i.reject(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===n)return this.resolvePromise(this._instantLayers[r].featureset)}const s=this._map.layers.find((t=>t instanceof g&&t.title===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const i=this._map.tables.find((t=>!!(t.title&&t.title===e||t.title&&t.title===e)));if(i){if(i instanceof g)return this.resolvePromise(this.makeAndAddFeatureSet(i,t,r));if(i._materializedTable);else{const e=i.outFields?i:{...i,outFields:["*"]};i._materializedTable=new g(e)}return i._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(i._materializedTable,t,r))))}}return this.resolvePromise(null)},n.featureSetById=function(e,t=!0,r=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetById(e,t,r)}catch(e){return i.reject(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===n)return this.resolvePromise(this._instantLayers[r].featureset)}const s=this._map.layers.find((t=>t instanceof g&&t.id===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const i=this._map.tables.find((t=>t.id===e));if(i){if(i instanceof g)return this.resolvePromise(this.makeAndAddFeatureSet(i,t,r));if(i._materializedTable);else{const e={...i,outFields:["*"]};i._materializedTable=new g(e)}return i._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(i._materializedTable,t,r))))}}return this.resolvePromise(null)},t}(u),D=function(e){function t(t,r=null,i=null){var n;return(n=e.call(this)||this)._url=t,n._overridespref=r,n.lrucache=i,n.metadata=null,n._instantLayers=[],n}r._inheritsLoose(t,e);var i=t.prototype;return i.makeAndAddFeatureSet=function(e,t=!0,r=null){const i=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:i,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),i},i._loadMetaData=function(){return I(this._url).then((e=>(this.metadata=e,e)))},i.load=function(){return this._loadMetaData()},i.clone=function(){return new t(this._url,this._overridespref,this.lrucache)},i.featureSetByName=function(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const i=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.title===e&&n.includeGeometry===t&&n.outFields===i)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((i=>{let n=null;for(const t of i.layers?i.layers:[])t.name===e&&(n=t);if(!n)for(const t of i.tables?i.tables:[])t.name===e&&(n=t);return n?w(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))},i.featureSetById=function(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const i=JSON.stringify(r);e=null!=e?e.toString():"";for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.id===e&&n.includeGeometry===t&&n.outFields===i)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((i=>{let n=null;for(const t of i.layers?i.layers:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);if(!n)for(const t of i.tables?i.tables:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);return n?w(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))},r._createClass(t,[{key:"url",get:function(){return this._url}}]),t}(u);t.constructAssociationMetaDataFeatureSetFromUrl=function(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return I(e).then((n=>{if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(const e of n.layers)r.layerNameLkp[e.id]=e.name;if(n.tables)for(const e of n.tables)r.layerNameLkp[e.id]=e.name;const a=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=a,function(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==c.applicationCache){const e=c.applicationCache.getLayerInfo(r);if(null!==e)return e}let i=s(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((e=>{if(e.data){const t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(r,i),i=i.catch((e=>{throw c.applicationCache.clearLayerInfo(r),e}))),i}(e,a).then((n=>{if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources?e.edgeSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources?e.junctionSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});return function(e){if(null!==c.applicationCache){const t=c.applicationCache.getLayerInfo(e);if(null!==t)return t}let t=s(e,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return i.resolve(t)}return i.resolve(null)}));return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(e,t),t=t.catch((t=>{throw c.applicationCache.clearLayerInfo(e),t}))),t}(e+"/"+a).then((i=>{if(i.systemLayers&&void 0!==i.systemLayers.associationsTableId&&null!==i.systemLayers.associationsTableId){const n=[];return r.unVersion>=4&&(n.push("STATUS"),n.push("PERCENTALONG")),b(e+"/"+i.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...n],!1,null).then((e=>e.load())).then((e=>r.unVersion>=4?(e=e.filter(d.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e)).then((e=>({lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals})))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))},t.constructFeatureSet=v,t.constructFeatureSetFromPortalItem=function(e,t,r,n,s,a,u){if(c.applicationCache){const l=c.applicationCache.getLayerInfo(e+":"+a.url);if(l)return l.then((e=>{try{const a=new g({url:o.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});return i.resolve(v(a,r,n,s,u))}catch(e){return i.reject(e)}}),(e=>i.reject(e)))}return i.create(((i,d)=>{const h=new l({id:e,portal:a}).load();c.applicationCache&&c.applicationCache.setLayerInfo(e+":"+a.url,h),h.then((e=>{try{const a=new g({url:o.extractServiceUrl(e.url)+"/"+t,outFields:["*"]});i(v(a,r,n,s,u))}catch(e){d(e)}}),(t=>{c.applicationCache&&c.applicationCache.clearLayerInfo(e+":"+a.url),d(t)}))}))},t.constructFeatureSetFromRelationship=function(e,t,r,i=null,n=null,s=!0,a=null){let l=e.serviceUrl();return l?(l="/"===l.charAt(l.length-1)?l+t.relatedTableId.toString():l+"/"+t.relatedTableId.toString(),b(l,i,n,s,a).then((l=>new S({layer:e,relatedLayer:l,relationship:t,objectId:r,spatialReference:i,outFields:n,includeGeometry:s,lrucache:a})))):null},t.constructFeatureSetFromUrl=b,t.createFeatureSetCollectionFromMap=function(e,t,r=null){return new C(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r=null){return new D(e,t,r)},t.getPortal=function(e,t){return null===e?t:new a({url:e.field("url")})},t.initialiseMetaDataCache=function(){null===c.applicationCache&&(c.applicationCache=new c)},t.lookupUser=function(e,t,r){return n.id.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?i.resolve(e.user.sourceJSON):""===t?s(e.restUrl+"/community/self",{responseType:"json",query:{f:"json",...!1===r?{}:{returnUserLicenseTypeExtensions:!0}}}).then((e=>{if(e.data){const t=e.data;if(t&&t.username)return i.resolve(t)}return i.resolve(null)})):s(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((e=>{if(e.data){const t=e.data;return t.error?null:i.resolve(t)}return i.resolve(null)})):i.resolve(null)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,i))||(e.exports=n)},94715:(e,t,r)=>{var i,n;i=[t,r(58797),r(9720),r(23084),r(31099),r(86856),r(47431),r(24378),r(69269),r(79722),r(45904)],void 0===(n=function(e,r,i,n,s,a,l,o,u,c,d){"use strict";let h=function(){function e(){this.sqlRewritable=!1}return e.prototype.postInitialization=function(e,t){},e}(),f=function(e){function t(t){var r;return(r=e.call(this)||this).field=t,r.sqlRewritable=!0,r}r._inheritsLoose(t,e);var i=t.prototype;return i.extractValue=function(e){return e.attributes[this.field.name]},i.rewriteSql=function(e){return{rewritten:this.sqlRewritable,where:e}},t}(h),p=function(e){function t(t,r,i){var n;return(n=e.call(this)||this).originalField=t,n.sqlRewritable=!0,n.field=a.cloneField(t),n.field.name=r,n.field.alias=i,n}r._inheritsLoose(t,e);var i=t.prototype;return i.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:c.reformulateWithoutField(e,this.field.name,this.originalField.name,t.getFieldsIndex())}},i.extractValue=function(e){return e.attributes[this.originalField.name]},t}(h),_=function(e){function t(t,r,i){var n;(n=e.call(this)||this).field=t,n.codefield=r,n.lkp=i,n.reverseLkp={};for(const e in i)n.reverseLkp[i[e]]=e;return n.sqlRewritable=!0,n}r._inheritsLoose(t,e);var i=t.prototype;return i.rewriteSql=function(e,r){const i=this.evaluateNodeToWhereClause(e.parseTree,a.FeatureServiceDatabaseType.Standardised,this.field.name,this.codefield instanceof u.WhereClause?c.toWhereClause(this.codefield,a.FeatureServiceDatabaseType.Standardised):this.codefield,e.parameters);return i.indexOf(t.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:u.WhereClause.create(i,r._parent.getFieldsIndex())}},i.evaluateNodeToWhereClause=function(e,r,i=null,n=null,s){let a,l,o,u;switch(e.type){case"interval":return c.convertIntervalToSql(this.evaluateNodeToWhereClause(e.value,r,i,n,s),e.qualifier,e.op);case"case_expression":{let n=" CASE ";"simple"===e.format&&(n+=this.evaluateNodeToWhereClause(e.operand,r,i,t.BADNESS,s));for(let a=0;a<e.clauses.length;a++)n+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[a].operand,r,i,t.BADNESS,s)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[a].value,r,i,t.BADNESS,s);return null!==e.else&&(n+=" ELSE "+this.evaluateNodeToWhereClause(e.else,r,i,t.BADNESS,s)),n+=" END ",n}case"param":{const t=s[e.value.toLowerCase()];if("string"==typeof t)return"'"+s[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(t instanceof Date)return c.makeDateString(t,r);if(t instanceof Array){const e=[];for(let i=0;i<t.length;i++)"string"==typeof t[i]?e.push("'"+t[i].toString().replace(/'/g,"''")+"'"):t[i]instanceof Date?e.push(c.makeDateString(t[i],r)):e.push(t[i].toString());return e}return t.toString()}case"expr_list":l=[];for(const t of e.value)l.push(this.evaluateNodeToWhereClause(t,r,i,n,s));return l;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,r,i,t.BADNESS,s)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" AND "+this.evaluateNodeToWhereClause(e.right,r,i,n,s)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" OR "+this.evaluateNodeToWhereClause(e.right,r,i,n,s)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const t=[];let a=!0;for(const r of e.right.value){if("string"!==r.type){a=!1;break}if(void 0===this.lkp[r.value]){a=!1;break}t.push(this.lkp[r.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IN ("+t.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,r,i,n,s)," ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IN ("+a.join(",")+")) "}return u=this.evaluateNodeToWhereClause(e.right,r,i,n,s),u instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" IN ("+u+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const t=[];let a=!0;for(const r of e.right.value){if("string"!==r.type){a=!1;break}if(void 0===this.lkp[r.value]){a=!1;break}t.push(this.lkp[r.value].toString())}if(a)return" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" NOT IN ("+t.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,r,i,n,s)," ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" NOT IN ("+a.join(",")+")) "}return u=this.evaluateNodeToWhereClause(e.right,r,i,n,s),u instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,i,n,s)+" NOT IN ("+u+")) ";case"BETWEEN":return o=this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)," ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"NOTBETWEEN":return o=this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)," ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" NOT BETWEEN "+o[0]+" AND "+o[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+n+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+n+") ";return" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,r,i,t.BADNESS,s)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,i,t.BADNESS,s)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return c.makeDateString(e.value,r);case"number":return e.value.toString();case"current_time":return c.makeToday("date"===e.mode,r);case"column_ref":return i&&i.toLowerCase()===e.column.toLowerCase()?"("+n+")":e.column;case"function":{const n=this.evaluateNodeToWhereClause(e.args,r,i,t.BADNESS,s);return c.translateFunctionToDatabaseSpecific(e.name,n,r)}}throw new Error("Unsupported sql syntax "+e.type)},i.extractValue=function(e){return this.codefield instanceof u.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]},t}(h);_.BADNESS="_!!!_BAD_LKP_!!!!";let y=function(e){function t(t,r){var i;return(i=e.call(this)||this).field=t,i.sql=r,i}r._inheritsLoose(t,e);var i=t.prototype;return i.rewriteSql=function(e,t){return{rewritten:!0,where:c.reformulateWithoutField(e,this.field.name,c.toWhereClause(this.sql,a.FeatureServiceDatabaseType.Standardised),t.getFieldsIndex())}},i.extractValue=function(e){return this.sql.calculateValueCompiled(e)},t}(h),g=function(e){function t(t){var r;return(r=e.call(this,t)||this)._calcFunc=null,r.declaredClass="esri.arcade.featureset.actions.Adapted",r.adaptedFields=null,r._extraFilter=null,r._extraFilter=t.extraFilter,r._parent=t.parentfeatureset,r._maxProcessing=30,r.adaptedFields=t.adaptedFields,r}r._inheritsLoose(t,e),t.findField=function(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null};var u=t.prototype;return u._initialiseFeatureSet=function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new n({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=a.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)},u._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._extraFilter?this._getFilteredSet("",null,null,null,e):this._parent._getSet(e))).then((t=>(this._checkCancelled(e),this._wset=new o(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):i.resolve(this._wset)},u._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},u._getFeatures=function(e,t,r,n){const a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);const u=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,u))return this._expandPagedSet(e,u,0,0,n).then((()=>this._getFeatures(e,t,r,n)));let c=0;for(let i=e._lastFetchedIndex;i<e._known.length&&(c++,c<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&a.push(e._known[i]),a.length>=u-1)));i++);if(0===a.length)return i.resolve("success");e=new o([],a,e._ordered,null);const d=Math.min(a.length,r);return this._parent._getFeatures(e,-1,d,n).then((()=>{this._checkCancelled(n);const e=[];for(let t=0;t<d;t++){const r=this._parent._featureFromCache(a[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:a[t]})}for(const t of e){const e=[];for(const r of this.adaptedFields)e[r.field.name]=r.extractValue(t);this._featureCache[t.id]=new s({attributes:e,geometry:l.cloneGeometry(t.geometry)})}return"success"}))},u._fetchAndRefineFeatures=function(){return i.reject(new Error("Fetch and Refine should not be called in this featureset"))},u._getFilteredSet=function(e,t,r,i,n){let s=!1;const a=this.reformulateWithoutAdaptions(r);s=a.cannot,r=a.where;let l=!1;if(null!==i){l=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof f)&&!0===i.scanForField(t.field.name)){if(!(t instanceof p)){i=null,l=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}i&&e.length>0&&(i=i.replaceFields(e))}return null!==r?null!==this._extraFilter&&(r=c.combine(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,i,n))).then((e=>{let t;return this._checkCancelled(n),t=!0===s?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))},u.reformulateWithoutAdaptions=function(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===c.scanForField(e,r.field.name)){const i=r.rewriteSql(e,this);if(!0!==i.rewritten){t.cannot=!0,t.where=null;break}t.where=i.where}return t},u._stat=function(e,t,r,n,s,a,l){let o=!1,u=this.reformulateWithoutAdaptions(t);return o=u.cannot,t=u.where,u=this.reformulateWithoutAdaptions(s),o=o||u.cannot,null!==(s=u.where)?null!==this._extraFilter&&(s=c.combine(this._extraFilter,s)):s=this._extraFilter,!0===o?null===s&&""===r&&null===n?this._manualStat(e,t,a,l):i.resolve({calculated:!1}):this._parent._stat(e,t,r,n,s,a,l).then((i=>!1===i.calculated?null===s&&""===r&&null===n?this._manualStat(e,t,a,l):{calculated:!1}:i))},u._canDoAggregates=function(e,t,r,n,s){if(null===this._parent)return i.resolve(!1);for(let t=0;t<e.length;t++)for(const r of this.adaptedFields)if(e[t].toLowerCase()===r.field.name.toLowerCase()&&!(r instanceof f))return i.resolve(!1);const a=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this.reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)return i.resolve(!1);const t=r.clone();t.workingexpr=e.where,a.push(t)}else a.push(r)}const l=this.reformulateWithoutAdaptions(s);return l.cannot?i.resolve(!1):(null!==(s=l.where)?null!==this._extraFilter&&(s=c.combine(this._extraFilter,s)):s=this._extraFilter,this._parent._canDoAggregates(e,a,r,n,s))},u._getAggregatePagesDataSourceDefinition=function(e,t,r,n,s,a,l){if(null===this._parent)return i.reject(new Error("Should never be called"));const o=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this.reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)return i.reject(new Error("Should never be called"));const t=r.clone();t.workingexpr=e.where,o.push(t)}else o.push(r)}const u=this.reformulateWithoutAdaptions(s);return u.cannot?i.reject(new Error("Should never be called")):(null!==(s=u.where)?null!==this._extraFilter&&(s=c.combine(this._extraFilter,s)):s=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,n,s,a,l))},t}(d);t.AdaptedFeatureSet=g,t.AdaptedField=h,t.FieldRename=p,t.OriginalField=f,t.SqlExpressionAdapted=y,t.StringToCodeAdapted=_,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,i))||(e.exports=n)},11027:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(23084),r(86856),r(24378),r(69269),r(79722),r(45904)],void 0===(n=function(e,t,r,i,n,s,a,l){"use strict";return function(o){function u(e){var t;return(t=o.call(this,e)||this).declaredClass="esri.arcade.featureset.actions.AttributeFilter",t._maxProcessing=1e3,t._parent=e.parentfeatureset,e.whereclause instanceof s.WhereClause?(t._whereclause=e.whereclause,t._whereClauseFunction=null):(t._whereClauseFunction=e.whereclause,t._whereclause=null),t}e._inheritsLoose(u,o);var c=u.prototype;return c._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new r({wkid:4326}),this.geometryType=i.layerGeometryEsriConstants.point)},c._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getFilteredSet("",null,this._whereclause,null,e))).then((t=>(this._checkCancelled(e),null!==this._whereClauseFunction?this._wset=new n(t._candidates.slice(0).concat(t._known.slice(0)),[],t._ordered,this._clonePageDefinition(t.pagesDefinition)):this._wset=new n(t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset))):t.resolve(this._wset)},c._isInFeatureSet=function(e){let t=this._parent._isInFeatureSet(e);return t===i.IdState.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?i.IdState.Unknown:t)},c._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},c._getFeatures=function(e,t,r,i){return this._parent._getFeatures(e,t,r,i)},c._featureFromCache=function(e){return this._parent._featureFromCache(e)},c.executeWhereClause=function(e){return this._whereclause.testFeature(e)},c.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction)try{const r=this._whereClauseFunction(e);return t.isPromiseLike(r)?r:t.resolve(r)}catch(e){return t.reject(e)}return t.resolve(this.executeWhereClause(e))},c._fetchAndRefineFeatures=function(e,r,s){const a=new n([],e,!1,null),l=Math.min(r,e.length);return this._parent._getFeatures(a,-1,l,s).then((()=>{if(this._checkCancelled(s),null==this._whereClauseFunction){for(let t=0;t<l;t++){const r=this._parent._featureFromCache(e[t]);!0===this.executeWhereClause(r)?this._idstates[e[t]]=i.IdState.InFeatureSet:this._idstates[e[t]]=i.IdState.NotInFeatureSet}return"success"}const n=[];for(let t=0;t<l;t++){const r=this._parent._featureFromCache(e[t]);n.push(this.executeWhereClauseDeferred(r))}return t.all(n).then((t=>{for(let n=0;n<r;n++)!0===t[n]?this._idstates[e[n]]=i.IdState.InFeatureSet:this._idstates[e[n]]=i.IdState.NotInFeatureSet;return"success"}))}))},c._getFilteredSet=function(e,t,r,i,s){return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=a.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,i,s))).then((e=>{let t;return this._checkCancelled(s),t=null!==this._whereClauseFunction?new n(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new n(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))},c._stat=function(e,r,i,n,s,l,o){if(null!==this._whereClauseFunction)return null===s&&""===i&&null===n?this._manualStat(e,r,l,o):t.resolve({calculated:!1});let u=this._whereclause;return null!==s&&null!==this._whereclause&&(u=a.combine(this._whereclause,s)),this._parent._stat(e,r,i,n,u,l,o).then((t=>!1===t.calculated?null===s&&""===i&&null===n?this._manualStat(e,r,l,o):{calculated:!1}:t))},c._canDoAggregates=function(e,r,i,n,s){return null!==this._whereClauseFunction?t.resolve(!1):(null!==s?null!==this._whereclause&&(s=a.combine(this._whereclause,s)):s=this._whereclause,null===this._parent?t.resolve(!1):this._parent._canDoAggregates(e,r,i,n,s))},c._getAggregatePagesDataSourceDefinition=function(e,r,i,n,s,l,o){return null===this._parent?t.reject(new Error("Should never be called")):(null!==s?null!==this._whereclause&&(s=a.combine(this._whereclause,s)):s=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,r,i,n,s,l,o))},u.registerAction=function(){l._featuresetFunctions.filter=function(e){if("function"==typeof e)return new u({parentfeatureset:this,whereclause:e});let t=null;return e instanceof s.WhereClause&&(t=e),new u({parentfeatureset:this,whereclause:t})}},u}(l)}.apply(t,i))||(e.exports=n)},1650:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(23084),r(31099),r(86003),r(62631),r(86856),r(24378),r(69269),r(79722),r(98054),r(97949),r(45904),r(11027),r(94715),r(25393),r(67032),r(49524),r(52059)],void 0===(n=function(e,t,r,i,n,s,a,l,o,u,c,d,h,f,p,_,y,g,m){"use strict";function F(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}return function(S){function w(e){var t;return(t=S.call(this,e)||this)._decodedStatsfield=[],t._decodedGroupbyfield=[],t._candosimplegroupby=!0,t.phsyicalgroupbyfields=[],t.objectIdField="ROW__ID",t._internalObjectIdField="ROW__ID",t._adaptedFields=[],t.declaredClass="esri.arcade.featureset.actions.Aggregate",t._uniqueIds=1,t._maxQuery=10,t._maxProcessing=10,t._parent=e.parentfeatureset,t._config=e,t}e._inheritsLoose(w,S);var b=w.prototype;return b.isTable=function(){return!0},b._getSet=function(e){return null===this._wset?this._getFilteredSet("",null,null,null,e).then((e=>(this._wset=e,this._wset))):t.resolve(this._wset)},b._isInFeatureSet=function(){return a.IdState.InFeatureSet},b.nextUniqueName=function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t},b.convertToEsriFieldType=function(e){return e},b._initialiseFeatureSet=function(){const e={};let t=!1,i=1;const n=this._parent?this._parent.getFieldsIndex():new d([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+i.toString(),i++)}for(const e of this._config.statsfields){const t=new g;t.field=e.name,t.tofieldname=e.name,t.workingexpr=e.expression instanceof o.WhereClause?e.expression:o.WhereClause.create(e.expression,n),t.typeofstat=F(e.statistic),this._decodedStatsfield.push(t)}this._decodedGroupbyfield=[];for(const e of this._config.groupbyfields){const t={name:e.name,singlefield:null,tofieldname:e.name,expression:e.expression instanceof o.WhereClause?e.expression:o.WhereClause.create(e.expression,n)};this._decodedGroupbyfield.push(t)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null}else this.geometryType=a.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null,this.spatialReference=new r({wkid:4326});this.fields=[];const l=new g;l.field=this.nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=o.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const t of this._decodedGroupbyfield){const r=new s;if(t.name=this.nextUniqueName(e),r.name=t.tofieldname,r.alias=r.name,u.isSingleField(t.expression)){const e=this._parent.getField(u.toWhereClause(t.expression,a.FeatureServiceDatabaseType.Standardised));if(!e)throw new Error("Field is not present for Aggregation");t.name=e.name,t.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),r.type=e.type}else{r.type=this.convertToEsriFieldType(u.predictType(t.expression,this._parent.fields));const e=new s;e.name=t.name,e.alias=e.name,this.phsyicalgroupbyfields.push(t.name),this._adaptedFields.push(new p.SqlExpressionAdapted(e,t.expression)),this._candosimplegroupby=!1}this.fields.push(r)}if(this._adaptedFields.length>0)for(const e of this._parent.fields)this._adaptedFields.push(new p.OriginalField(e));for(let t=0;t<this._decodedStatsfield.length;t++){const r=new s;let i=null;const n=this._decodedStatsfield[t];n.field=this.nextUniqueName(e),n.tofieldname===this.objectIdField&&(this._internalObjectIdField=n.field),r.name=n.tofieldname,r.alias=r.name;const l=null!==n.workingexpr&&u.isSingleField(n.workingexpr)?u.toWhereClause(n.workingexpr,a.FeatureServiceDatabaseType.Standardised):"";switch(this._decodedStatsfield[t].typeofstat){case"SUM":if(""!==l){if(i=this._parent.getField(l),!i)throw new Error("Field is not present for Aggregation");r.type=i.type}else r.type="double";break;case"MIN":case"MAX":if(""!==l){if(i=this._parent.getField(l),!i)throw new Error("Field is not present for Aggregation");r.type=i.type}else r.type="double";break;case"COUNT":r.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==l&&(i=this._parent.getField(l),!i))throw new Error("Field is not present for Aggregation");r.type="double"}this.fields.push(r)}},b._canDoAggregates=function(){return t.resolve(!1)},b._getFeatures=function(e,r,i,n){-1!==r&&this._featureCache[r];const s=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,s)?this._expandPagedSet(e,s,0,0,n).then((()=>this._getFeatures(e,r,i,n))):t.resolve("success")},b._getFilteredSet=function(e,r,i,n,s){if(""!==e)return t.resolve(new l([],[],!0,null));let a=null;const o={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((()=>{if(null!==i)for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===u.scanForField(i,this._decodedStatsfield[e].tofieldname)){o.nowhereclause=!0,i=null;break}if(null!==n){o.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===n.scanForField(this._decodedStatsfield[e].tofieldname)){n=null,o.ordered=!1;break}if(null!==n)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===n.scanForField(e.tofieldname)){n=null,o.ordered=!1;break}}return!1===this._candosimplegroupby?t.resolve(!1):this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)})).then((e=>{if(e){let e=null;i&&(e=this._reformulateWhereClauseWithoutGroupByFields(i));let t=null;return n&&(t=this._reformulateOrderClauseWithoutGroupByFields(n)),this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField).then((e=>(this._checkCancelled(s),a=!0===o.nowhereclause?new l(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===o.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new l(e._candidates.slice(0),e._known.slice(0),!0===o.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),a)))}let t=this._parent;if(this._adaptedFields.length>0&&(t=new p.AdaptedFeatureSet({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===o.nowhereclause)a=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new y({parentfeatureset:t,orderbyclause:new _(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=t;if(null!==i){let t=null;i&&(t=this._reformulateWhereClauseWithoutGroupByFields(i)),e=new f({parentfeatureset:e,whereclause:t})}a=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new y({parentfeatureset:e,orderbyclause:new _(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return a}))},b._reformulateWhereClauseWithoutStatsFields=function(e){for(const t of this._decodedStatsfield)e=u.reformulateWithoutField(e,t.tofieldname,u.toWhereClause(t.workingexpr,a.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex());return e},b._reformulateWhereClauseWithoutGroupByFields=function(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=u.reformulateWithoutField(e,t.tofieldname,u.toWhereClause(t.expression,a.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex()));return e},b._reformulateOrderClauseWithoutGroupByFields=function(e){const t=[];for(const e of this._decodedGroupbyfield)e.tofieldname!==e.name&&t.push({field:e.tofieldname,newfield:e.name});return t.length>0?e.replaceFields(t):e},b._clonePageDefinition=function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)},b._refineSetBlock=function(e,r,i){try{return!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery)?this._expandPagedSet(e,this._maxQuery,0,0,i).then((()=>this._refineSetBlock(e,r,i))):(this._checkCancelled(i),e._candidates.length,this._refineKnowns(e,r),e._candidates.length,e._candidates.length,t.resolve(e))}catch(e){return t.reject(e)}},b._expandPagedSet=function(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)},b._getPhysicalPage=function(e,r,n){return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?t.create(((t,r)=>{this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,n,[]).then((e=>{t(e)}),r)})):this._getAgregagtePhysicalPage(e,r,n).then((e=>{for(const t of e){const e={geometry:t.geometry,attributes:{}};for(const r of this._decodedGroupbyfield)e.attributes[r.tofieldname]=t.attributes[r.name];for(const r of this._decodedStatsfield)e.attributes[r.tofieldname]=t.attributes[r.field];this._featureCache[e.attributes[this.objectIdField]]=new i(e)}return e.length}))},b._sequentialGetPhysicalItem=function(e,r,i,n){return t.create(((t,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(i)),!0===e.pagesDefinition.internal.fullyResolved||0===r?t(n.length):this._nextAggregateItem(e,r,i,n,(s=>{null===s?t(n.length):(r-=1,t(this._sequentialGetPhysicalItem(e,r,i,n)))}),s)}))},b._nextAggregateItem=function(e,t,r,i,s,a){try{n.tick(e.pagesDefinition.internal.iterator.next()).then((n=>{if(null===n)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);i.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,s(null)}else e.pagesDefinition.internal.fullyResolved=!0,s(null);else{const l=this._generateAggregateHash(n);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[n],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){const r=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return i.push(r),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(r.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[n],id:l},void s(r)}e.pagesDefinition.internal.workingItem.features.push(n)}this._nextAggregateItem(e,t,r,i,s,a)}}),a)}catch(e){a(e)}},b._calculateFieldStat=function(e,t,r){const i=[];for(let r=0;r<e.features.length;r++)if(null!==t.workingexpr){const n=t.workingexpr.calculateValue(e.features[r]);null!==n&&i.push(n)}else i.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=c.calculateStat("min",i,-1);break;case"MAX":r.attributes[t.tofieldname]=c.calculateStat("max",i,-1);break;case"SUM":r.attributes[t.tofieldname]=c.calculateStat("sum",i,-1);break;case"COUNT":r.attributes[t.tofieldname]=i.length;break;case"VAR":r.attributes[t.tofieldname]=c.calculateStat("var",i,-1);break;case"STDDEV":r.attributes[t.tofieldname]=c.calculateStat("stddev",i,-1);break;case"AVG":r.attributes[t.tofieldname]=c.calculateStat("avg",i,-1)}return!0},b._calculateAndAppendAggregateItem=function(e){const t={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const i=r.singlefield?e.features[0].attributes[r.singlefield]:r.expression.calculateValue(e.features[0]);t.attributes[r.tofieldname]=i}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,t);const r=[];for(let i=0;i<this._decodedStatsfield.length;i++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[i],t));return this._featureCache[t.attributes[this.objectIdField]]=new i({attributes:t.attributes,geometry:t.geometry}),t},b._generateAggregateHash=function(e){let t="";for(const r of this._decodedGroupbyfield){const i=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==i?":":":"+i.toString()}return m.createMD5Hash(t,m.outputTypes.String)},b._stat=function(){return t.resolve({calculated:!1})},b.getFeatureByObjectId=function(){return t.resolve(null)},w.registerAction=function(){h._featuresetFunctions.groupby=function(e,t){return new w({parentfeatureset:this,groupbyfields:e,statsfields:t})}},w}(h)}.apply(t,i))||(e.exports=n)},67032:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(86003),r(24378),r(45904),r(25393)],void 0===(n=function(e,t,r,i,n,s){"use strict";return function(a){function l(e){var t;return(t=a.call(this,e)||this)._orderbyclause=null,t.declaredClass="esri.arcade.featureset.actions.OrderBy",t._maxProcessing=100,t._orderbyclause=e.orderbyclause,t._parent=e.parentfeatureset,t}e._inheritsLoose(l,a);var o=l.prototype;return o._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,this._orderbyclause,e))).then((t=>(this._checkCancelled(e),this._wset=t,this._wset))):t.resolve(this._wset)},o.manualOrderSet=function(e,t){return this.getIdColumnDictionary(e,[],-1,t).then((e=>{this._orderbyclause.order(e);const t=new i([],[],!0,null);for(let r=0;r<e.length;r++)t._known.push(e[r].id);return t}))},o.getIdColumnDictionary=function(e,i,n,s){if(n<e._known.length-1){const t=this._maxQueryRate();if("GETPAGES"===e._known[n+1])return r.tick(this._parent._expandPagedSet(e,t,0,0,s)).then((()=>this.getIdColumnDictionary(e,i,n,s)));let a=n+1;const l=[];for(;a<e._known.length&&"GETPAGES"!==e._known[a];)l.push(e._known[a]),a++;return n+=l.length,r.tick(this._parent._getFeatureBatch(l,s)).then((t=>{this._checkCancelled(s);for(const e of t)i.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,i,n,s)}))}return e._candidates.length>0?r.tick(this._refineSetBlock(e,this._maxProcessingRate(),s)).then((()=>(this._checkCancelled(s),this.getIdColumnDictionary(e,i,n,s)))):t.resolve(i)},o._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},o._getFeatures=function(e,t,r,i){return this._parent._getFeatures(e,t,r,i)},o._featureFromCache=function(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},o._fetchAndRefineFeatures=function(){return t.reject(new Error("Fetch and Refine should not be called in this featureset"))},o._getFilteredSet=function(e,t,r,n,s){return this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,null===n?this._orderbyclause:n,s))).then((e=>{let n;this._checkCancelled(s),n=new i(e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition));let a=!0;return e._candidates.length>0&&(a=!1),!1===n._ordered?this.manualOrderSet(n,s).then((e=>(!1===a&&(null===t&&null===r||(e=new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e))):n}))},l.registerAction=function(){n._featuresetFunctions.orderBy=function(e){return""===e?this:new l({parentfeatureset:this,orderbyclause:new s(e)})}},l}(n)}.apply(t,i))||(e.exports=n)},55481:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(86856),r(24378),r(45904)],void 0===(n=function(e,t,r,i,n){"use strict";return function(s){function a(e){var t;return(t=s.call(this,e)||this)._topnum=0,t.declaredClass="esri.arcade.featureset.actions.Top",t._countedin=0,t._maxProcessing=100,t._topnum=e.topnum,t._parent=e.parentfeatureset,t}e._inheritsLoose(a,s);var l=a.prototype;return l._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getSet(e))).then((e=>(this._wset=new i(e._candidates.slice(0),e._known.slice(0),!1,this._clonePageDefinition(e.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset))):t.resolve(this._wset)},l._setKnownLength=function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},l._isInFeatureSet=function(e){const t=this._parent._isInFeatureSet(e);if(t===r.IdState.NotInFeatureSet)return t;const i=this._idstates[e];return i===r.IdState.InFeatureSet||i===r.IdState.NotInFeatureSet?i:t===r.IdState.InFeatureSet&&void 0===i?this._countedin<this._topnum?(this._idstates[e]=r.IdState.InFeatureSet,this._countedin++,r.IdState.InFeatureSet):(this._idstates[e]=r.IdState.NotInFeatureSet,r.IdState.NotInFeatureSet):r.IdState.Unknown},l._expandPagedSet=function(e,r,i,n,s){if(null===this._parent)return t.reject(new Error("Parent Paging not implemented"));if(r>this._topnum&&(r=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){let r=e._known.length;return r>0&&"GETPAGES"===e._known[r-1]&&(e._known.length=r-1),r=e._candidates.length,r>0&&"GETPAGES"===e._candidates[r-1]&&(e._candidates.length=r-1),t.resolve("success")}return this._parent._expandPagedSet(e,r,i,n,s).then((t=>(this._setKnownLength(e)>this._topnum&&(e._known.length=this._topnum),this._setKnownLength(e)>=this._topnum&&(e._candidates.length=0),t)))},l._getFeatures=function(e,r,n,s){const a=[],l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l))return this._expandPagedSet(e,l,0,0,s).then((()=>this._getFeatures(e,r,n,s)));-1!==r&&void 0===this._featureCache[r]&&a.push(r);let o=0;for(let t=e._lastFetchedIndex;t<e._known.length&&(o++,o<=n&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[t]]&&(e._known[t]!==r&&a.push(e._known[t]),a.length>l-1)));t++);if(0===a.length)return t.resolve("success");const u=new i([],a,!1,null),c=Math.min(a.length,n);return this._parent._getFeatures(u,-1,c,s).then((()=>{for(let e=0;e<c;e++){const t=this._parent._featureFromCache(a[e]);void 0!==t&&(this._featureCache[a[e]]=t)}return"success"}))},l._getFilteredSet=function(e,t,r,n,s){return this._ensureLoaded().then((()=>this._getSet(s))).then((e=>new i(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,this._clonePageDefinition(e.pagesDefinition))))},l._refineKnowns=function(e,t){let i=0,n=null;const s=[];for(let a=0;a<e._candidates.length;a++){const l=this._isInFeatureSet(e._candidates[a]);if(l===r.IdState.InFeatureSet){if(e._known.push(e._candidates[a]),i+=1,null===n?n={start:a,end:a}:n.end===a-1?n.end=a:(s.push(n),n={start:a,end:a}),e._known.length>=this._topnum)break}else if(l===r.IdState.NotInFeatureSet)null===n?n={start:a,end:a}:n.end===a-1?n.end=a:(s.push(n),n={start:a,end:a}),i+=1;else if(l===r.IdState.Unknown)break;if(i>=t)break}null!==n&&s.push(n);for(let t=s.length-1;t>=0;t--)e._candidates.splice(s[t].start,s[t].end-s[t].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},l._stat=function(){return t.resolve({calculated:!1})},l._canDoAggregates=function(){return t.resolve(!1)},a.registerAction=function(){n._featuresetFunctions.top=function(e){return new a({parentfeatureset:this,topnum:e})}},a}(n)}.apply(t,i))||(e.exports=n)},37899:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(57167),r(13032),r(40810),r(31099),r(41916),r(86856),r(16985),r(24378),r(79722),r(98054),r(45904),r(52059),r(57517),r(40495),r(909),r(98757),r(49595),r(71315),r(39453)],void 0===(n=function(e,t,r,i,n,s,a,l,o,u,c,d,h,f,p,_,y,g,m,F,S){"use strict";return function(h){function w(e){var t;return(t=h.call(this,e)||this).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",t._removeGeometry=!1,t._overrideFields=null,t.formulaCredential=null,t._pageJustIds=!1,t._requestStandardised=!1,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,t._wset=null,void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}e._inheritsLoose(w,h);var b=w.prototype;return b._maxQueryRate=function(){return l.defaultMaxRecords},b.end=function(){return this._layer},b.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},b.convertQueryToLruCacheKey=function(e){const t=l.stableStringify(e.toJSON());return f.createMD5Hash(t,f.outputTypes.String)},b.load=function(){return null===this._loadPromise&&(this._loadPromise=t.create(((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}catch(e){t(e)}}))),this._loadPromise},b._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=l.FeatureServiceDatabaseType.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=l.FeatureServiceDatabaseType.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=l.FeatureServiceDatabaseType.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=l.FeatureServiceDatabaseType.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},b._isInFeatureSet=function(){return l.IdState.InFeatureSet},b._refineSetBlock=function(e){return t.resolve(e)},b._candidateIdTransform=function(e){return e},b._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):t.resolve(this._wset)},b._runDatabaseProbe=function(e){return t.create(((t,r)=>{try{this._ensureLoaded().then((()=>{try{const i=new y;i.where=e.replace("OBJECTID",this._layer.objectIdField),this._layer.queryObjectIds(i).then((()=>{t(!0)}),(()=>{try{t(!1)}catch(e){r(e)}}))}catch(e){r(e)}}))}catch(e){r(e)}}))},b._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},b._cacheableFeatureSetSourceKey=function(){return this._layer.url},b.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode},b.queryPBF=function(e){return e.quantizationParameters={mode:"edit"},F.executeQueryPBF(this._layer.parsedUrl,e,new m.OptimizedFeatureSetParserContext({})).then((e=>p.fromJSON(o.convertToFeatureSet(e.data)).unquantize()))},b.nativeCapabilities=function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}},b.executeQuery=function(e,t){const r=new S({url:this._layer.parsedUrl.path}),i="execute"===t&&this.pbfSupportedForQuery(e);let n=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);n=this.recentlyUsedQueries.getFromCache(s),null===n&&(n=!0!==i?r[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,n),n=n.catch((e=>{throw this.recentlyUsedQueries.removeFromCache(s),e})))}return null===n&&(n=!0!==i?r[t](e):this.queryPBF(e)),n},b._getFilteredSet=function(e,t,r,i,n){return this.databaseType().then((s=>{if(this.isTable()&&t&&null!==e&&""!==e)return new u([],[],!0,null);if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,i,n);let a="",l=!1;null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(a=i.constructClause(),l=!0);const o=new y;return o.where=null===r?null===t?"1=1":"":c.toWhereClause(r,s),this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=this._makeRelationshipEnum(e),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==a?a.split(","):null,o.geometry=null===t?null:t,o.relationParameter=this._makeRelationshipParam(e),this.executeQuery(o,"executeForIds").then((e=>(null===e&&(e=[]),this._checkCancelled(n),new u([],e,l,null))))}))},b._expandPagedSet=function(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)},b._getFilteredSetUsingPaging=function(e,r,i,n,s){try{let t="",a=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(t=n.constructClause(),a=!0),this.databaseType().then((n=>{let l=null===i?null===r?"1=1":"":c.toWhereClause(i,n);this._layer.definitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression);let o=this._maxQueryRate();const d=this._layer.capabilities.query.maxRecordCount;void 0!==d&&d<o&&(o=d);let h=null;if(!0===this._pageJustIds)h=new u([],["GETPAGES"],a,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:o,resultOffset:0,geometry:null===r?null:r,where:l,orderByFields:t,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let i=!0;!0===this._removeGeometry&&(i=!1);const n=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]);h=new u([],["GETPAGES"],a,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:n.join(","),resultRecordCount:o,resultOffset:0,geometry:null===r?null:r,where:l,orderByFields:t,returnGeometry:i,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(h,o,0,1,s).then((()=>h))}))}catch(e){return t.reject(e)}},b._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},b._getPhysicalPage=function(e,r,i){try{const t=e.pagesDefinition.internal.lastRetrieved,r=t,n=e.pagesDefinition.internal.lastPage,s=new y;return this._requestStandardised&&(s.sqlFormat="standard"),s.spatialRelationship=e.pagesDefinition.spatialRel,s.relationParameter=e.pagesDefinition.relationParam,s.outFields=e.pagesDefinition.outFields.split(","),s.num=e.pagesDefinition.resultRecordCount,s.start=e.pagesDefinition.internal.lastPage,s.geometry=e.pagesDefinition.geometry,s.where=e.pagesDefinition.where,s.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,s.returnGeometry=e.pagesDefinition.returnGeometry,s.outSpatialReference=this.spatialReference,this.executeQuery(s,"execute").then((s=>{if(this._checkCancelled(i),e.pagesDefinition.internal.lastPage!==n)return"done";for(let t=0;t<s.features.length;t++)e.pagesDefinition.internal.set[r+t]=s.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<s.features.length;e++)this._featureCache[s.features[e].attributes[this._layer.objectIdField]]=s.features[e];return(void 0===s.exceededTransferLimit&&s.features.length!==e.pagesDefinition.resultRecordCount||!1===s.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+s.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return t.reject(e)}},b._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},b._getFeatures=function(e,r,i,n){const s=[];try{if(-1!==r&&void 0===this._featureCache[r]&&s.push(r),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((()=>this._getFeatures(e,r,i,n)));let a=0;for(let t=e._lastFetchedIndex;t<e._known.length;t++){if(e._lastFetchedIndex+=1,a++,void 0===this._featureCache[e._known[t]]){let i=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const r=this._layer._mode;if(void 0!==r._featureMap[e._known[t]]){const n=r._featureMap[e._known[t]];null!==n&&(i=!0,this._featureCache[e._known[t]]=n)}}if(!1===i&&(e._known[t]!==r&&s.push(e._known[t]),s.length>=this._maxProcessingRate()-1))break}if(a>=i&&0===s.length)break}if(0===s.length)return t.resolve("success");try{const e=new y;return this._requestStandardised&&(e.sqlFormat="standard"),e.objectIds=s,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,"execute").then((e=>{if(this._checkCancelled(n),void 0!==e.error)return t.reject(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return t.reject(e)}}catch(e){return t.reject(e)}},b._getDistinctPages=function(e,r,i,n,s,a,l,o,u){return this._ensureLoaded().then((()=>this.databaseType())).then((d=>{let h=i.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===h.toLowerCase()){h=this._layer.fields[e].name;break}const f=new y;this._requestStandardised&&(f.sqlFormat="standard");let p=null===a?null===s?"1=1":"":c.toWhereClause(a,d);return this._layer.definitionExpression&&(p=""!==p?"(("+this._layer.definitionExpression+") AND ("+p+"))":this._layer.definitionExpression),f.where=p,f.spatialRelationship=this._makeRelationshipEnum(n),f.relationParameter=this._makeRelationshipParam(n),f.geometry=null===s?null:s,f.returnDistinctValues=!0,f.returnGeometry=!1,f.outFields=[h],this.executeQuery(f,"execute").then((c=>{if(this._checkCancelled(u),!c.hasOwnProperty("features"))return t.reject(new Error("Unnexected Result querying statistics from layer"));let d=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===h){"date"===this._layer.fields[e].type&&(d=!0);break}for(let e=0;e<c.features.length;e++){if(d){const t=c.features[e].attributes[h];null!==t?o.push(new Date(t)):o.push(t)}else o.push(c.features[e].attributes[h]);if(o.length>=l)break}return 0===c.features.length?o:c.features.length===this._layer.capabilities.query.maxRecordCount&&o.length<l?this._getDistinctPages(e+c.features.length,r,i,n,s,a,l,o,u).then((e=>({calculated:!0,result:e}))):o}))}))},b._distinctStat=function(e,t,r,i,n,s,a){return this._getDistinctPages(0,e,t,r,i,n,s,[],a).then((e=>({calculated:!0,result:e})))},b.isTable=function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},b._countstat=function(e,t,r,i){return this.databaseType().then((e=>{const n=new y;if(this._requestStandardised&&(n.sqlFormat="standard"),this.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let s=null===i?null===r?"1=1":"":c.toWhereClause(i,e);return this._layer.definitionExpression&&(s=""!==s?"(("+this._layer.definitionExpression+") AND ("+s+"))":this._layer.definitionExpression),n.where=s,n.where=s,n.spatialRelationship=this._makeRelationshipEnum(t),n.relationParameter=this._makeRelationshipParam(t),n.geometry=null===r?null:r,n.returnGeometry=!1,this.executeQuery(n,"executeForCount").then((e=>({calculated:!0,result:e})))}))},b._stats=function(e,r,i,n,s,a,l){return this._ensureLoaded().then((()=>{const o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,h=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return"count"===e?h?this._countstat(e,i,n,s):{calculated:!1}:!1===u||!1===c.isSingleField(r)&&!1===o||!1===r.isStandardized?""!==i||null!==s?{calculated:!1}:this._manualStat(e,r,a,l):"distinct"===e?!1===h?""!==i||null!==s?{calculated:!1}:this._manualStat(e,r,a,l):this._distinctStat(e,r,i,n,s,a,l):this.databaseType().then((a=>{if(this.isTable()&&n&&null!==i&&""!==i)return{calculated:!0,result:null};const l=new y;this._requestStandardised&&(l.sqlFormat="standard");let o=null===s?null===n?"1=1":"":c.toWhereClause(s,a);this._layer.definitionExpression&&(o=""!==o?"(("+this._layer.definitionExpression+") AND ("+o+"))":this._layer.definitionExpression),l.where=o,l.spatialRelationship=this._makeRelationshipEnum(i),l.relationParameter=this._makeRelationshipParam(i),l.geometry=null===n?null:n;const u=new _;u.statisticType=d.decodeStatType(e),u.onStatisticField=c.toWhereClause(r,a),u.outStatisticFieldName="ARCADE_STAT_RESULT",l.returnGeometry=!1;let h="ARCADE_STAT_RESULT";return l.outStatistics=[u],this.executeQuery(l,"execute").then((e=>{if(!e.hasOwnProperty("features")||0===e.features.length)return t.reject(new Error("Unnexected Result querying statistics from layer"));let r=!1;for(let t=0;t<e.fields.length;t++)if("ARCADE_STAT_RESULT"===e.fields[t].name.toUpperCase()){h=e.fields[t].name,"date"===e.fields[t].type&&(r=!0);break}if(r){let t=e.features[0].attributes[h];return null!==t&&(t=new Date(e.features[0].attributes[h])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[h]}}))}))}))},b._stat=function(e,t,r,i,n,s,a){return this._stats(e,t,r,i,n,s,a)},b._canDoAggregates=function(e,t){return this._ensureLoaded().then((()=>{let e=!1;const r=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let i=0;i<t.length-1;i++)null!==t[i].workingexpr&&(!1===t[i].workingexpr.isStandardized||!1===c.isSingleField(t[i].workingexpr)&&!1===r)&&(e=!1);return!1!==e}))},b._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},b._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},b._getAggregatePagesDataSourceDefinition=function(e,t,r,i,n,s,a){return this._ensureLoaded().then((()=>this.databaseType())).then((l=>{let o="",d=!1,h=!1;null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=s.constructClause(),h=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(h=!1,d=!0,o=this._layer.objectIdField);const f=[];for(let e=0;e<t.length;e++){const r=new _;r.onStatisticField=null!==t[e].workingexpr?c.toWhereClause(t[e].workingexpr,l):"",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),f.push(r)}""===o&&(o=e.join(","));let p=this._maxQueryRate();const y=this._layer.capabilities.query.maxRecordCount;void 0!==y&&y<p&&(p=y);let g=null===n?null===i?"1=1":"":c.toWhereClause(n,l);return this._layer.definitionExpression&&(g=""!==g?"(("+this._layer.definitionExpression+") AND ("+g+"))":this._layer.definitionExpression),new u([],["GETPAGES"],h,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:["*"],useOIDpagination:d,generatedOid:a,resultRecordCount:p,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:f,geometry:null===i?null:i,where:g,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))},b._getAgregagtePhysicalPage=function(e,r,i){try{let r=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(r=""!==r?"("+r+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const n=e.pagesDefinition.internal.lastRetrieved,a=n,l=e.pagesDefinition.internal.lastPage,o=new y;return this._requestStandardised&&(o.sqlFormat="standard"),o.where=r,o.spatialRelationship=e.pagesDefinition.spatialRel,o.relationParameter=e.pagesDefinition.relationParam,o.outFields=e.pagesDefinition.outFields,o.outStatistics=e.pagesDefinition.outStatistics,o.geometry=e.pagesDefinition.geometry,o.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,o.num=e.pagesDefinition.resultRecordCount,o.start=e.pagesDefinition.internal.lastPage,o.returnGeometry=e.pagesDefinition.returnGeometry,o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&o.geometry&&o.spatialRelationship?t.resolve([]):this.executeQuery(o,"execute").then((r=>{if(this._checkCancelled(i),!r.hasOwnProperty("features"))return t.reject(new Error("Unnexected Result querying aggregates from layer"));const o=[];if(e.pagesDefinition.internal.lastPage!==l)return[];for(let t=0;t<r.features.length;t++)e.pagesDefinition.internal.set[a+t]=r.features[t].attributes[e.pagesDefinition.generatedOid];for(let e=0;e<r.features.length;e++)o.push(new s({attributes:r.features[e].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===r.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=r.features[r.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===r.exceededTransferLimit&&r.features.length!==e.pagesDefinition.resultRecordCount||!1===r.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=n+r.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,o}))}catch(e){return t.reject(e)}},w.create=function(e,t,r,i){return new w({layer:new g({url:e,outFields:null===t?["*"]:t}),spatialReference:r,lrucache:i})},b.relationshipMetaData=function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]},b.serviceUrl=function(){return l.extractServiceUrl(this._layer.parsedUrl.path)},b.queryAttachments=function(e,r,i,n){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const t={objectIds:[e]};return(r&&r>0||i&&i>0)&&(t.size=[r&&r>0?r:0,i&&i>0?i:r+1]),n&&n.length>0&&(t.attachmentTypes=n),this._layer.queryAttachments(t).then((t=>{const r=[];return t&&t[e]&&t[e].forEach((t=>{const i=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new a(t.id,t.name,t.contentType,t.size,i))})),r}))}return t.resolve([])},b.queryRelatedFeatures=function(e){const i={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(i.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(i.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(i.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(i.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(i.outSR=JSON.stringify(e.outSpatialReference.toJSON())),n(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:i}).then((e=>{if(e.data){const t={},i=e.data;if(i&&i.relatedRecordGroups){const e=i.spatialReference;for(const n of i.relatedRecordGroups){const a=n.objectId,l=[];for(const t of n.relatedRecords){t.geometry&&(t.geometry.spatialReference=e);const i=new s({geometry:t.geometry?r.fromJSON(t.geometry):null,attributes:t.attributes});l.push(i)}t[a]={features:l,exceededTransferLimit:!0===i.exceededTransferLimit}}}return t}return t.reject("Invalid Request")}))},b.getFeatureByObjectId=function(e,t){const r=new S({url:this._layer.parsedUrl.path}),i=new y;return i.outFields=t,i.returnGeometry=!1,i.outSpatialReference=this.spatialReference,i.where=this.objectIdField+"="+e.toString(),r.execute(i).then((e=>1===e.features.length?e.features[0]:null))},b.getIdentityUser=function(){return this.load().then((()=>{var e;const t=null==(e=i.id)?void 0:e.findCredential(this._layer.url);return t?t.userId:null}))},b.getOwningSystemUrl=function(){return this.load().then((()=>{var e;const r=null==(e=i.id)?void 0:e.findServerInfo(this._layer.url);if(r)return t.resolve(r.owningSystemUrl);let s=this._layer.url;const a=s.toLowerCase().indexOf("/rest/services");return s=a>-1?s.substring(0,a):s,s?(s+="/rest/info",t.create(((e,t)=>{n(s,{query:{f:"json"}}).then((t=>{let r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(t=>{e("")}))}))):t.resolve("")}))},e._createClass(w,[{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}}]),w}(h)}.apply(t,i))||(e.exports=n)},93130:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(27572),r(31099),r(62631),r(86856),r(24378),r(79722),r(45904),r(37266),r(909),r(98757)],void 0===(n=function(e,t,r,i,n,s,a,l,o,u,c,d){"use strict";return function(o){function h(e){var t;return(t=o.call(this,e)||this).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",t._removeGeometry=!1,t._overrideFields=null,t._forceIsTable=!1,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,t._wset=null,!0===e.isTable&&(t._forceIsTable=!0),void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}e._inheritsLoose(h,o);var f=h.prototype;return f._maxQueryRate=function(){return s.defaultMaxRecords},f.end=function(){return this._layer},f.optimisePagingFeatureQueries=function(){},f.load=function(){return null===this._loadPromise&&(this._loadPromise=t.create(((e,t)=>{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}))),this._loadPromise},f._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=s.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},f.isTable=function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType},f._isInFeatureSet=function(){return s.IdState.InFeatureSet},f._candidateIdTransform=function(e){return e},f._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):t.resolve(this._wset)},f._changeFeature=function(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new i({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},f._getFilteredSet=function(e,r,i,n,o){let u="",d=!1;if(null!==n&&(u=n.constructClause(),d=!0),this.isTable()&&r&&null!==e&&""!==e){const e=new a([],[],!0,null);return t.resolve(e)}const h=new c;return h.where=null===i?null===r?"1=1":"":l.toWhereClause(i,s.FeatureServiceDatabaseType.Standardised),h.spatialRelationship=this._makeRelationshipEnum(e),h.outSpatialReference=this.spatialReference,h.orderByFields=""!==u?u.split(","):null,h.geometry=null===r?null:r,h.returnGeometry=!0,h.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(h).then((e=>{if(null===e)return new a([],[],d,null);this._checkCancelled(o);const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),new a([],t,d,null)}))},f._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},f._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},f._queryAllFeatures=function(){if(this._wset)return t.resolve(this._wset);const e=new c;return e.where="1=1",this._ensureLoaded().then((()=>{if(this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new a([],e,!1,null),this._wset}return this._layer.queryFeatures(e).then((e=>{const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),this._wset=new a([],t,!1,null),this._wset}))}))},f._getFeatures=function(e,r,i){const n=[];-1!==r&&void 0===this._featureCache[r]&&n.push(r);for(let t=e._lastFetchedIndex;t<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[t]]&&(e._known[t]!==r&&n.push(e._known[t]),n.length>i)));t++);return 0===n.length?t.resolve("success"):t.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},f._refineSetBlock=function(e){return t.resolve(e)},f._stat=function(){return t.resolve({calculated:!1})},f._canDoAggregates=function(){return t.resolve(!1)},f.relationshipMetaData=function(){return[]},h._cloneAttr=function(e){const t={};for(const r in e)t[r]=e[r];return t},f.nativeCapabilities=function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}},h.create=function(e,t){let i=e.layerDefinition.objectIdField;const s=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",a=[];if(e.layerDefinition.types)for(const t of e.layerDefinition.types)a.push(u.fromJSON(t));let l=e.layerDefinition.geometryType;void 0===l&&(l=e.featureSet.geometryType||"");let o=e.featureSet.features;const c=t.toJSON();if(""===i||void 0===i){let t=!1;for(const r of e.layerDefinition.fields)if("oid"===r.type||"esriFieldTypeOID"===r.type){i=r.name,t=!0;break}if(!1===t){let t="FID",r=!0,n=0;for(;r;){let i=!0;for(const r of e.layerDefinition.fields)if(r.name===t){i=!1;break}!0===i?r=!1:(n++,t="FID"+n.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const s=[];for(let r=0;r<o.length;r++)s.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),s[r].attributes[t]=r;o=s,i=t}}const f=[];for(const t of e.layerDefinition.fields)t instanceof n?f.push(t):f.push(n.fromJSON(t));let p=l;switch(p){case"esriGeometryPoint":p="point";break;case"esriGeometryPolyline":p="polyline";break;case"esriGeometryPolygon":p="polygon";break;case"esriGeometryExtent":p="extent";break;case"esriGeometryMultipoint":p="multipoint"}for(const e of o)e.geometry&&e.geometry instanceof r==0&&(e.geometry.type=p,void 0===e.geometry.spatialReference&&(e.geometry.spatialReference=c));const _={outFields:["*"],source:o,fields:f,types:a,typeIdField:s,objectIdField:i,spatialReference:t};return _.geometryType=p||"point",new h({layer:new d(_),spatialReference:t,isTable:null===p||""===p})},f.queryAttachments=function(){return t.resolve([])},f.getFeatureByObjectId=function(e){const t=new c;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((e=>1===e.features.length?e.features[0]:null))},f.getOwningSystemUrl=function(){return t.resolve("")},f.getIdentityUser=function(){return t.resolve("")},e._createClass(h,[{key:"gdbVersion",get:function(){return""}}]),h}(o)}.apply(t,i))||(e.exports=n)},31699:(e,t,r)=>{var i,n;i=[r(58797),r(9720),r(31099),r(86856),r(24378),r(45904),r(51256)],void 0===(n=function(e,t,r,i,n,s,a){"use strict";return function(s){function l(e){var t;return(t=s.call(this,e)||this).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",t._findObjectId=-1,t._requestStandardised=!1,t._removeGeometry=!1,t._overrideFields=null,t.featureObjectId=null,t.relatedLayer=null,t.relationship=null,e.spatialReference&&(t.spatialReference=e.spatialReference),t._transparent=!0,t._maxProcessing=1e3,t._layer=e.layer,t._wset=null,t._findObjectId=e.objectId,t.featureObjectId=e.objectId,t.relationship=e.relationship,t.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(t._overrideFields=e.outFields),void 0!==e.includeGeometry&&(t._removeGeometry=!1===e.includeGeometry),t}e._inheritsLoose(l,s);var o=l.prototype;return o._maxQueryRate=function(){return i.defaultMaxRecords},o.end=function(){return this._layer},o.optimisePagingFeatureQueries=function(){},o.load=function(){return null===this._loadPromise&&(this._loadPromise=t.create(((e,r)=>{t.all([this._layer.load(),this.relatedLayer.load()]).then((()=>{this._initialiseFeatureSet(),e(this)}),r)}))),this._loadPromise},o.nativeCapabilities=function(){return this.relatedLayer.nativeCapabilities()},o._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types},o.databaseType=function(){return this.relatedLayer.databaseType().then((()=>(this._databaseType=this.relatedLayer._databaseType,this._databaseType)))},o.isTable=function(){return this.relatedLayer.isTable()},o._isInFeatureSet=function(){return i.IdState.InFeatureSet},o._candidateIdTransform=function(e){return e},o._getSet=function(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):t.resolve(this._wset)},o._changeFeature=function(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new r({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},o._getFilteredSet=function(e,t,r,i,s){return this.databaseType().then((()=>{if(this.isTable()&&t&&null!==e&&""!==e)return new n([],[],!0,null);const l=this._layer.nativeCapabilities();if(!1===l.canQueryRelated)return new n([],[],!0,null);if(l.capabilities.queryRelated&&l.capabilities.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,r,i,s);let o="",u=!1;null!==i&&l.capabilities&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(o=i.constructClause(),u=!0);const c=new a;c.objectIds=[this._findObjectId];const d=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);c.outFields=d,c.relationshipId=this.relationship.id,c.where="1=1";let h=!0;return!0===this._removeGeometry&&(h=!1),c.returnGeometry=h,this._requestStandardised&&(c.sqlFormat="standard"),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==o?o.split(","):null,l.source.queryRelatedFeatures(c).then((i=>{this._checkCancelled(s);const a=i[this._findObjectId]?i[this._findObjectId].features:[],l=[];for(let e=0;e<a.length;e++)this._featureCache[a[e].attributes[this._layer.objectIdField]]=a[e],l.push(a[e].attributes[this._layer.objectIdField]);const o=t&&null!==e&&""!==e,c=null!=r;return new n(o||c?l:[],o||c?[]:l,u,null)}))}))},o._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},o._getFilteredSetUsingPaging=function(e,r,i,s,a){try{let t="",l=!1;const o=this._layer.nativeCapabilities();return null!==s&&o&&o.capabilities.queryRelated&&!0===o.capabilities.queryRelated.supportsOrderBy&&(t=s.constructClause(),l=!0),this.databaseType().then((()=>{let s=this._maxQueryRate();const u=o.capabilities.query.maxRecordCount;void 0!==u&&u<s&&(s=u);const c=r&&null!==e&&""!==e,d=null!=i;let h=null,f=!0;!0===this._removeGeometry&&(f=!1);const p=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);return h=new n(c||d?["GETPAGES"]:[],c||d?[]:["GETPAGES"],l,{outFields:p.join(","),resultRecordCount:s,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:t,returnGeometry:f,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),this._expandPagedSet(h,s,0,0,a).then((()=>h))}))}catch(e){return t.reject(e)}},o._expandPagedSet=function(e,t,r,i,n){return this._expandPagedSetFeatureSet(e,t,r,i,n)},o._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},o._getPhysicalPage=function(e,r,i){try{const t=e.pagesDefinition.internal.lastRetrieved,r=t,n=e.pagesDefinition.internal.lastPage,s=this._layer.nativeCapabilities(),l=new a;return!0===this._requestStandardised&&(l.sqlFormat="standard"),l.relationshipId=this.relationship.id,l.objectIds=e.pagesDefinition.objectIds,l.resultOffset=e.pagesDefinition.internal.lastPage,l.resultRecordCount=e.pagesDefinition.resultRecordCount,l.outFields=e.pagesDefinition.outFields.split(","),l.where=e.pagesDefinition.where,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=e.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,s.source.queryRelatedFeatures(l).then((s=>{if(this._checkCancelled(i),e.pagesDefinition.internal.lastPage!==n)return 0;const a=s[this._findObjectId]?s[this._findObjectId].features:[];for(let t=0;t<a.length;t++)e.pagesDefinition.internal.set[r+t]=a[t].attributes[this._layer.objectIdField];for(let e=0;e<a.length;e++)this._featureCache[a[e].attributes[this._layer.objectIdField]]=a[e];const l=!s[this._findObjectId]||!1===s[this._findObjectId].exceededTransferLimit;return a.length!==e.pagesDefinition.resultRecordCount&&l&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+a.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,a.length}))}catch(e){return t.reject(e)}},o._getFeatures=function(e,r,i,n){const s=[];-1!==r&&void 0===this._featureCache[r]&&s.push(r);const a=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,a))return this._expandPagedSet(e,a,0,0,n).then((()=>this._getFeatures(e,r,i,n)));let l=0;for(let t=e._lastFetchedIndex;t<e._known.length&&(l++,l<=i&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[t]&&void 0===this._featureCache[e._known[t]]&&(e._known[t]!==r&&s.push(e._known[t]),s.length>i)))&&!(l>=i&&0===s.length);t++);return 0===s.length?t.resolve("success"):t.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},o._refineSetBlock=function(e,r,i){return t.resolve(e)},o._stat=function(e,r,i,n,s,a,l){return t.resolve({calculated:!1})},o._canDoAggregates=function(e,r,i,n,s){return t.resolve(!1)},o.relationshipMetaData=function(){return this.relatedLayer.relationshipMetaData()},o.serviceUrl=function(){return this.relatedLayer.serviceUrl()},o.queryAttachments=function(e,t,r,i){return this.relatedLayer.queryAttachments(e,t,r,i)},o.getFeatureByObjectId=function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)},o.getOwningSystemUrl=function(){return this.relatedLayer.getOwningSystemUrl()},o.getIdentityUser=function(){return this.relatedLayer.getIdentityUser()},e._createClass(l,[{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}}]),l}(s)}.apply(t,i))||(e.exports=n)},25393:(e,t,r)=>{var i;void 0===(i=function(){"use strict";function e(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}return function(){function t(e){const t=e.split(",");this._fields=[],this._directions=[];for(let e=0;e<t.length;e++){const r=t[e].match(/\S+/g);this._fields.push(r[0]),2===r.length?"asc"===r[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}var r=t.prototype;return r.constructClause=function(){let e="";for(let t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},r.order=function(t){t.sort(((t,r)=>{for(let i=0;i<this._fields.length;i++){const n=this.featureValue(t.feature,this._fields[i],i),s=this.featureValue(r.feature,this._fields[i],i);let a=0;if(a=1===this._directions[i]?e(n,s):-1*e(n,s),0!==a)return a}return 0}))},r.scanForField=function(e){for(let t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},r.replaceFields=function(e){let r="";for(let t=0;t<this._fields.length;t++){0!==t&&(r+=",");let i=this._fields[t];for(const t of e)if(i.toLowerCase()===t.field.toLowerCase()){i=t.newfield;break}r+=i,1===this._directions[t]?r+=" ASC":r+=" DESC"}return new t(r)},r.featureValue=function(e,t,r){const i=e.attributes[t];if(void 0!==i)return i;for(const i in e.attributes)if(t.toLowerCase()===i.toLowerCase())return this._fields[r]=i,e.attributes[i];return null},t}()}.call(t,r,t,e))||(e.exports=i)},49524:(e,t,r)=>{var i,n;i=[r(86856),r(69269),r(79722)],void 0===(n=function(e,t,r){"use strict";return function(){function i(){}var n=i.prototype;return n.clone=function(){const e=new i;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e},i.parseStatField=function(n,s,a){const l=new i;l.field=n;const o=t.WhereClause.create(s,a),u=function(i){if("function"===i.parseTree.type){if(0===i.parseTree.args.value.length)return{name:i.parseTree.name,expr:null};if(i.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");const n=t.WhereClause.create(r.toWhereClauseFromTree(i.parseTree.args.value[0],e.FeatureServiceDatabaseType.Standardised,i.parameters),i.fieldsIndex);return{name:i.parseTree.name,expr:n}}return null}(o);if(null===u)throw new Error("Invalid Statistic Function");const c=u.name.toUpperCase().trim();if("MIN"===c){if(l.typeofstat="MIN",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===c){if(l.typeofstat="MAX",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===c)l.typeofstat="COUNT",l.workingexpr=u.expr;else if("STDEV"===c){if(l.typeofstat="STDDEV",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===c){if(l.typeofstat="SUM",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===c){if(l.typeofstat="AVG",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===c){if(l.typeofstat="AVG",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==c)throw new Error("Invalid Statistic Function");if(l.typeofstat="VAR",l.workingexpr=u.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}return l},n.toStatisticsName=function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}},i}()}.apply(t,i))||(e.exports=n)},52059:(e,t)=>{var r;void 0===(r=function(e){"use strict";const r={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,n,s,a){return i((l=i(i(t,e),i(n,a)))<<(o=s)|l>>>32-o,r);var l,o}function s(e,t,r,i,s,a,l){return n(t&r|~t&i,e,t,s,a,l)}function a(e,t,r,i,s,a,l){return n(t&i|r&~i,e,t,s,a,l)}function l(e,t,r,i,s,a,l){return n(t^r^i,e,t,s,a,l)}function o(e,t,r,i,s,a,l){return n(r^(t|~i),e,t,s,a,l)}t.createMD5Hash=function(e,t=r.Hex){const n=t||r.Base64,u=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,n=-271733879,u=-1732584194,c=271733878;for(let t=0;t<e.length;t+=16){const d=r,h=n,f=u,p=c;r=s(r,n,u,c,e[t+0],7,-680876936),c=s(c,r,n,u,e[t+1],12,-389564586),u=s(u,c,r,n,e[t+2],17,606105819),n=s(n,u,c,r,e[t+3],22,-1044525330),r=s(r,n,u,c,e[t+4],7,-176418897),c=s(c,r,n,u,e[t+5],12,1200080426),u=s(u,c,r,n,e[t+6],17,-1473231341),n=s(n,u,c,r,e[t+7],22,-45705983),r=s(r,n,u,c,e[t+8],7,1770035416),c=s(c,r,n,u,e[t+9],12,-1958414417),u=s(u,c,r,n,e[t+10],17,-42063),n=s(n,u,c,r,e[t+11],22,-1990404162),r=s(r,n,u,c,e[t+12],7,1804603682),c=s(c,r,n,u,e[t+13],12,-40341101),u=s(u,c,r,n,e[t+14],17,-1502002290),n=s(n,u,c,r,e[t+15],22,1236535329),r=a(r,n,u,c,e[t+1],5,-165796510),c=a(c,r,n,u,e[t+6],9,-1069501632),u=a(u,c,r,n,e[t+11],14,643717713),n=a(n,u,c,r,e[t+0],20,-373897302),r=a(r,n,u,c,e[t+5],5,-701558691),c=a(c,r,n,u,e[t+10],9,38016083),u=a(u,c,r,n,e[t+15],14,-660478335),n=a(n,u,c,r,e[t+4],20,-405537848),r=a(r,n,u,c,e[t+9],5,568446438),c=a(c,r,n,u,e[t+14],9,-1019803690),u=a(u,c,r,n,e[t+3],14,-187363961),n=a(n,u,c,r,e[t+8],20,1163531501),r=a(r,n,u,c,e[t+13],5,-1444681467),c=a(c,r,n,u,e[t+2],9,-51403784),u=a(u,c,r,n,e[t+7],14,1735328473),n=a(n,u,c,r,e[t+12],20,-1926607734),r=l(r,n,u,c,e[t+5],4,-378558),c=l(c,r,n,u,e[t+8],11,-2022574463),u=l(u,c,r,n,e[t+11],16,1839030562),n=l(n,u,c,r,e[t+14],23,-35309556),r=l(r,n,u,c,e[t+1],4,-1530992060),c=l(c,r,n,u,e[t+4],11,1272893353),u=l(u,c,r,n,e[t+7],16,-155497632),n=l(n,u,c,r,e[t+10],23,-1094730640),r=l(r,n,u,c,e[t+13],4,681279174),c=l(c,r,n,u,e[t+0],11,-358537222),u=l(u,c,r,n,e[t+3],16,-722521979),n=l(n,u,c,r,e[t+6],23,76029189),r=l(r,n,u,c,e[t+9],4,-640364487),c=l(c,r,n,u,e[t+12],11,-421815835),u=l(u,c,r,n,e[t+15],16,530742520),n=l(n,u,c,r,e[t+2],23,-995338651),r=o(r,n,u,c,e[t+0],6,-198630844),c=o(c,r,n,u,e[t+7],10,1126891415),u=o(u,c,r,n,e[t+14],15,-1416354905),n=o(n,u,c,r,e[t+5],21,-57434055),r=o(r,n,u,c,e[t+12],6,1700485571),c=o(c,r,n,u,e[t+3],10,-1894986606),u=o(u,c,r,n,e[t+10],15,-1051523),n=o(n,u,c,r,e[t+1],21,-2054922799),r=o(r,n,u,c,e[t+8],6,1873313359),c=o(c,r,n,u,e[t+15],10,-30611744),u=o(u,c,r,n,e[t+6],15,-1560198380),n=o(n,u,c,r,e[t+13],21,1309151649),r=o(r,n,u,c,e[t+4],6,-145523070),c=o(c,r,n,u,e[t+11],10,-1120210379),u=o(u,c,r,n,e[t+2],15,718787259),n=o(n,u,c,r,e[t+9],21,-343485551),r=i(r,d),n=i(n,h),u=i(u,f),c=i(c,p)}return[r,n,u,c]}(function(e){const t=[];for(let r=0,i=8*e.length;r<i;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(n){case r.Raw:return u;case r.Hex:return function(e){const t="0123456789abcdef",r=[];for(let i=0,n=4*e.length;i<n;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}(u);case r.String:return function(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(u);case r.Base64:return function(e){const t=[];for(let r=0,i=4*e.length;r<i;r+=3){const i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let n=0;n<4;n++)8*r+6*n>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-n)&63))}return t.join("")}(u)}},t.outputTypes=r,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=r)}}]);