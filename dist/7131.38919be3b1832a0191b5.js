(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[7131],{17131:(t,e,a)=>{var r,s;r=[a(58797),a(11285),a(74637),a(92231),a(72885),a(3718),a(73462),a(67059),a(26475),a(99752),a(49359),a(4037),a(51916),a(18377),a(9720),a(12997),a(40810),a(88074),a(62008),a(54220),a(36051),a(39453),a(21863)],void 0===(s=function(t,e,a,r,s,n,u,i,o,l,c,d,y,h,p,m,f,g,b,F,R,_,q){"use strict";const I=new Set(["Feature Layer","Table"]);let w=function(e){function u(){var t;return(t=e.apply(this,arguments)||this).type="feature-layer",t}t._inheritsLoose(u,e);var i=u.prototype;return i.load=function(t){const e=n.isSome(t)?t.signal:null;return this.addResolvingPromise(this._fetchService(e)),p.resolve(this)},i.addAttachment=async function(t,e){await this.load();const a=t.attributes[this.layer.objectIdField],r=this.layer.parsedUrl.path+"/"+a+"/addAttachment",s=this._getLayerRequestOptions(),n=this._getFormDataForAttachment(e,s.query);try{const t=await f(r,{body:n});return this._createFeatureEditResult(t.data.addAttachmentResult)}catch(t){throw this._createAttachmentErrorResult(a,t)}},i.updateAttachment=async function(t,e,a){await this.load();const r=t.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/updateAttachment",n=this._getLayerRequestOptions({query:{attachmentId:e}}),u=this._getFormDataForAttachment(a,n.query);try{const t=await f(s,{body:u});return this._createFeatureEditResult(t.data.updateAttachmentResult)}catch(t){throw this._createAttachmentErrorResult(r,t)}},i.applyEdits=async function(t,e){await this.load();const a=t.addFeatures.map(this._serializeFeature,this),r=t.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(t.deleteFeatures);F.unapplyEditsZUnitScaling(a,r,this.layer.spatialReference);const n=[],u=[],i=[...t.deleteAttachments];for(const e of t.addAttachments)n.push(await this._serializeAttachment(e));for(const e of t.updateAttachments)u.push(await this._serializeAttachment(e));const o=n.length||u.length||i.length?{adds:n,updates:u,deletes:i}:null,l=this._getLayerRequestOptions({method:"post",query:{adds:a.length?JSON.stringify(a):null,updates:r.length?JSON.stringify(r):null,deletes:s.length?s.join(","):null,gdbVersion:null==e?void 0:e.gdbVersion,rollbackOnFailure:null==e?void 0:e.rollbackOnFailureEnabled,useGlobalIds:null==e?void 0:e.globalIdUsed,attachments:o&&JSON.stringify(o)}}),c=await f(this.layer.parsedUrl.path+"/applyEdits",l);return this._createEditsResult(c)},i.deleteAttachments=async function(t,e){await this.load();const a=t.attributes[this.layer.objectIdField],r=this.layer.parsedUrl.path+"/"+a+"/deleteAttachments";try{return(await f(r,this._getLayerRequestOptions({query:{attachmentIds:e.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(t){throw this._createAttachmentErrorResult(a,t)}},i.fetchRecomputedExtents=function(t={}){const e=t.signal;return this.load({signal:e}).then((async()=>{const e=this._getLayerRequestOptions({...t,query:{returnUpdates:!0}}),{layerId:a,url:r}=this.layer,{data:s}=await f(`${r}/${a}`,e),{id:n,extent:u,fullExtent:i,timeExtent:o}=s,l=u||i;return{id:n,fullExtent:l&&m.fromJSON(l),timeExtent:o&&b.fromJSON({start:o[0],end:o[1]})}}))},i.queryAttachments=async function(t,e={}){const{parsedUrl:a}=this.layer,r=a.path;await this.load();const s=this._getLayerRequestOptions(e);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:e}=t,a=[];for(const t of e){const e=r+"/"+t+"/attachments";a.push(f(e,s))}return p.all(a).then((t=>e.map(((e,a)=>({parentObjectId:e,attachmentInfos:t[a].data.attachmentInfos}))))).then((t=>R.processAttachmentQueryResult(t,r)))}return this.queryTask.executeAttachmentQuery(t,s)},i.queryFeatures=async function(t,e){return await this.load(),this.queryTask.execute(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryFeaturesJSON=async function(t,e){return await this.load(),this.queryTask.executeJSON(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryObjectIds=async function(t,e){return await this.load(),this.queryTask.executeForIds(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryFeatureCount=async function(t,e){return await this.load(),this.queryTask.executeForCount(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryExtent=async function(t,e){return await this.load(),this.queryTask.executeForExtent(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryRelatedFeatures=async function(t,e){return await this.load(),this.queryTask.executeRelationshipQuery(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i.queryRelatedFeaturesCount=async function(t,e){return await this.load(),this.queryTask.executeRelationshipQueryForCount(t,{...e,query:{...this.layer.customParameters,...null==e?void 0:e.query}})},i._fetchService=async function(t){let e=this.layer.sourceJSON;if(!e){const{data:r}=await f(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:a("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));e=r}this.sourceJSON=this._patchServiceJSON(e);const r=e.type;if(!I.has(r))throw new c("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)},i._patchServiceJSON=function(t){var e;if("Table"!==t.type&&t.geometryType&&(null==t||null==(e=t.drawingInfo)||!e.renderer)&&!t.defaultSymbol){const e=q.createDrawingInfo(t.geometryType).renderer;s.setDeepValue("drawingInfo.renderer",e,t)}return t},i._serializeFeature=function(t){const{geometry:e,attributes:a}=t;return n.isNone(e)?{attributes:a}:"mesh"===e.type||"extent"===e.type?null:{geometry:e.toJSON(),attributes:a}},i._serializeAttachment=async function(t){const{feature:e,attachment:a}=t,{globalId:r,name:s,contentType:n,data:u,uploadId:i}=a,o={globalId:r,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(e&&(o.parentGlobalId="attributes"in e?e.attributes&&e.attributes[this.layer.globalIdField]:e.globalId),i)o.uploadId=i;else if(u){const t=await async function(t){return"string"==typeof t?d.dataComponents(t)||{data:t}:p.create(((e,a)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(d.dataComponents(r.result)),r.onerror=t=>a(t)}))}(u);o.contentType=t.mediaType,o.data=t.data,u instanceof File&&(o.name=u.name)}return s&&(o.name=s),n&&(o.contentType=n),o},i._getFeatureIds=function(t){const e=t[0];return e?"objectId"in e?this._getIdsFromFeatureIdentifier(t):this._getIdsFromFeatures(t):[]},i._getIdsFromFeatures=function(t){const e=this.layer.objectIdField;return t.map((t=>t.attributes&&t.attributes[e]))},i._getIdsFromFeatureIdentifier=function(t){return t.map((t=>t.objectId))},i._createEditsResult=function(t){const e=t.data,a=t.data&&t.data.attachments;return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:a&&a.addResults?a.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:a&&a.updateResults?a.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:a&&a.deleteResults?a.deleteResults.map(this._createFeatureEditResult,this):[]}},i._createFeatureEditResult=function(t){const e=!0===t.success?null:t.error||{code:void 0,description:void 0};return{objectId:t.objectId,globalId:t.globalId,error:e?new c("feature-layer-source:edit-failure",e.description,{code:e.code}):null}},i._createAttachmentErrorResult=function(t,e){const a=e.details.messages&&e.details.messages[0]||e.message,r=e.details.httpStatus||e.details.messageCode;return{objectId:t,globalId:null,error:new c("feature-layer-source:attachment-failure",a,{code:r})}},i._getFormDataForAttachment=function(t,e){const a=t instanceof FormData?t:t&&t.elements?new FormData(t):null;if(a)for(const t in e){const r=e[t];null!=r&&(a.set?a.set(t,r):a.append(t,r))}return a},i._getLayerRequestOptions=function(t={}){const{parsedUrl:e,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...t,query:r.fixJson({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...e.query,f:"json",...this.layer.customParameters,...null==t?void 0:t.query}),responseType:"json"}},t._createClass(u,[{key:"queryTask",get:function(){const{capabilities:{query:{supportsFormatPBF:t}},parsedUrl:e,dynamicDataSource:r,gdbVersion:s,spatialReference:n,fieldsIndex:u}=this.layer,i=a("featurelayer-pbf")&&t?"pbf":"json";return new _({url:e.path,format:i,fieldsIndex:u,dynamicDataSource:r,gdbVersion:s,sourceSpatialReference:n})}}]),u}(g);return e.__decorate([o.property()],w.prototype,"type",void 0),e.__decorate([o.property({constructOnly:!0})],w.prototype,"layer",void 0),e.__decorate([o.property({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource","layer.fieldsIndex"]})],w.prototype,"queryTask",null),w=e.__decorate([l.subclass("esri.layers.graphics.sources.FeatureLayerSource")],w),w}.apply(e,r))||(t.exports=s)},21863:(t,e,a)=>{var r,s;r=[e,a(74637),a(92231),a(63063)],void 0===(s=function(t,a,r,s){"use strict";e.createDefaultAttributesFunction=function(t,e){if(a("csp-restrictions"))return()=>({[e]:null,...t});try{let a=`this.${e} = null;`;for(const e in t)a+=`this${e.indexOf(".")?`["${e}"]`:`.${e}`} = ${JSON.stringify(t[e])};`;const r=new Function(a);return()=>new r}catch(a){return()=>({[e]:null,...t})}},e.createDefaultTemplate=function(t={}){return[{name:"New Feature",description:"",prototype:{attributes:r.clone(t)}}]},e.createDrawingInfo=function(t){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?s.defaultPointSymbolJSON:"esriGeometryPolyline"===t?s.defaultPolylineSymbolJSON:s.defaultPolygonSymbolJSON}}},Object.defineProperty(t,"__esModule",{value:!0})}.apply(e,r))||(t.exports=s)}}]);