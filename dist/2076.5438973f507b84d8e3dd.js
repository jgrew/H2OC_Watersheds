(self.webpackChunkh2oc=self.webpackChunkh2oc||[]).push([[2076],{8194:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(31099)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c){"use strict";var p;let d=p=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).isAggregate=!0,e}e._inheritsLoose(i,t);var r=i.prototype;return r.getEffectivePopupTemplate=function(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer&&this.sourceLayer.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null},r.getObjectId=function(){return this.objectId},r.clone=function(){return new p({objectId:this.objectId,...this.cloneProperties()})},i}(c);return t.__decorate([s.property({type:Boolean})],d.prototype,"isAggregate",void 0),t.__decorate([s.property({type:Number,json:{read:!0}})],d.prototype,"objectId",void 0),d=p=t.__decorate([o.subclass("esri.AggregateGraphic")],d),d}.apply(t,r))||(e.exports=n)},80498:(e,t)=>{var i;void 0===(i=function(e){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let r=0;r<e.length;r++){const n=e[r].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}t.calculateTolerance=function(e){const t=e&&e.renderer,n="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return n;const s="visualVariables"in t?function(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:n}=t;return(r(i,e)+r(n,e))/2}));let n=0;const s=i.length;if(0===s)return e;for(let e=0;e<s;e++)n+=i[e];const o=Math.floor(n/s);return Math.max(o,e)}(n,t.visualVariables):n;if("simple"===t.type)return i(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return t.type,s},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]))||(e.exports=i)},36494:(e,t,i)=>{var r,n;r=[t,i(73462),i(49359),i(53183),i(20780)],void 0===(n=function(e,i,r,n,s){"use strict";const o=i.getLogger("esri.views.2d.engine.webgl");t.getTypeOfSizeVisualVariable=function(e){return s.isNumber(e.minDataValue)&&s.isNumber(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?n.WGLVVFlag.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?n.WGLVVFlag.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?n.WGLVVFlag.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?n.WGLVVFlag.SIZE_UNIT_VALUE:(o.error(new r("mapview-bad-type","Found invalid size VisualVariable",e)),n.WGLVVFlag.NONE)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},59948:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(92231),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(45630),i(9720),i(12997),i(26016),i(82438),i(31099),i(8194),i(69788),i(57517),i(909),i(28187),i(39241),i(43768),i(75885),i(80498),i(87515),i(64637),i(74167),i(50783),i(55726),i(69675),i(99045),i(89453),i(46351),i(30012),i(74819),i(30939),i(67768)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c,p,d,h,f,y,m,_,g,v,x,b,w,S,R,F,M,E,I,O,P,T,q,k,C,V,U,A,L,N,z){"use strict";const G=s.getLogger("esri.views.2d.layers.FeatureLayerView2D");let j=function(t){function i(){var i;return(i=t.apply(this,arguments)||this)._pipelineIsUpdating=!0,i._updatingPipelineConfig=!1,i._onGoingEdits=0,i._isRefreshing=!1,i._viewStateId=-1,i._visibilityOverrides=new Set,i._effect=null,i._highlightIds=new Map,i._lastPixelBuffer=0,i.filter=null,i.effectLists={included:new P.default,excluded:new P.default},i.doRefresh=f.debounce((async()=>{i._onGoingEdits=0,i.isUpdating()&&await x.whenFalseOnce(e._assertThisInitialized(i),"updating");try{i._set("_isRefreshing",!0),i._lockGPUUploads(),await i._proxy.refresh(),i._unlockGPUUploads(),i._set("_isRefreshing",!1)}catch(e){f.isAbortError(e)||G.error(e)}})),i._doUpdate=f.debounce((async()=>{if(i.destroyed||!i._hasRequiredSupport(i.layer))return;i._set("_updatingPipelineConfig",!0),await x.whenFalseOnce(e._assertThisInitialized(i),"_isRefreshing");const{effect:t,filter:r}=e._assertThisInitialized(i);if(await i._updateRequiredFields(),i.destroyed)return;const{renderer:s}=i._getEffectiveRenderer();i._set("_effectiveRenderer",s);const o="feature"===i.layer.type?i.layer.historicMoment:null,a="feature"===i.layer.type?i.layer.gdbVersion:null,l={renderer:i.layer.renderer,spatialReference:i.layer.spatialReference,timeExtent:i.layer.timeExtent,definitionExpression:i.layer.definitionExpression,featureReduction:i.layer.featureReduction,fields:i.layer.fields,geometryType:i.layer.geometryType,historicMoment:o,labelsVisible:i.layer.labelsVisible,labelingInfo:i.layer.labelingInfo,availableFields:i.availableFields,effect:i.effect,filter:i.filter,gdbVersion:a,pixelBuffer:0},u=T.toJSONGeometryType(i.layer.geometryType),c=await L.computePxBuffer(s,u,i.layer.featureReduction),p=i._createConfiguration(l,r,t);i._lastPixelBuffer=0===c?0:Math.max(c,i._lastPixelBuffer),p.schema.source.pixelBuffer=i._lastPixelBuffer;const d=i._createTileRendererHash(s);if(!i.destroyed){if(d!==i._tileRendererHash){if(await i._initTileRenderer(s),i.destroyed)return;const e=await i._createServiceOptions();if(i.destroyed)return;if(i.effects.forEach((e=>n.isSome(e)&&n.isSome(e.filter)&&e.filter.enable())),i.tileRenderer.onConfigUpdate(s),await i._proxy.startup(i.view.featuresTilingScheme,p,e),await i._proxy.updateTiles({added:i._tileStrategy.tileKeys(),removed:[]}),i.destroyed)return;if(i.hasHighlight()&&await i._proxy.setHighlight(Array.from(i._highlightIds.keys())),i.destroyed)return;if(await i._onceTilesUpdated(),i.destroyed)return;i.tileRenderer.onConfigUpdate(s)}else{const e=await i._proxy.update(p,!0);if(i.destroyed)return;if(e.queryFilter){i._lockGPUUploads();try{await i._proxy.invalidate(e)}catch(e){f.isAbortError(e)||G.error(e)}if(i.destroyed)return;i._unlockGPUUploads()}else{try{await i._proxy.invalidate({...e,mesh:!1})}catch(e){f.isAbortError(e)||G.error(e)}if(i.destroyed)return;if(e.mesh){i._lockGPUUploads();try{var h;await i._proxy.invalidate({mesh:!0,targets:{aggregate:null==(h=e.targets)?void 0:h.aggregate}})}catch(e){f.isAbortError(e)||G.error(e)}i._unlockGPUUploads()}}if(i.destroyed)return;i._proxy.resume(),i.effects.forEach((e=>n.isSome(e)&&n.isSome(e.filter)&&e.filter.enable())),i.tileRenderer.onConfigUpdate(s),i._forceAttributeTextureUpload()}i._tileRendererHash=d,i.tileRenderer.invalidateLabels(),i.requestUpdate()}})),i._updateHighlight=f.debounce((async()=>i._proxy.setHighlight(Array.from(i._highlightIds.keys())))),i}e._inheritsLoose(i,t);var s=i.prototype;return s.destroy=function(){var e,t;null==(e=this._proxy)||e.destroy(),n.andThen(this._updateClusterSizeTask,(e=>e.remove())),null==(t=this.tileRenderer)||t.destroy()},s.initialize=function(){this.addResolvingPromise(this._initProxy()),this.handles.add([this.on("valueRangesChanged",(e=>{this._set("_aggregateValueRanges",e.valueRanges)})),x.init(this,"effect",(e=>{this.effectLists.included.effect=null==e?void 0:e.includedEffect})),x.init(this,"effect",(e=>{this.effectLists.excluded.effect=null==e?void 0:e.excludedEffect}))])},s._initProxy=async function(){if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type&&this.layer.isTable)throw new u("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const e=this._createClientOptions();return this._set("_proxy",new N({client:e})),this._proxy.when()},s.highlight=function(e){let t;return e instanceof g?t=[e.getObjectId()]:"number"==typeof e?t=[e]:_.isCollection(e)?t=e.map((e=>e&&e.getAttribute(this.layer.objectIdField))).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]?e:e.map((e=>e&&e.getAttribute(this.layer.objectIdField)))),t&&t.length?(t=t.filter((e=>null!=e)),this._addHighlight(t),{remove:()=>this._removeHighlight(t)}):{remove:()=>{}}},s.hasHighlight=function(){return!!this._highlightIds.size},s.hitTest=function(e,t){return this._hitTest(e,t)},s.queryStatistics=function(){return this._proxy.queryStatistics()},s.queryFeatures=function(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=b.fromJSON(e);return t.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),t}))},s.queryFeaturesJSON=function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)},s.queryObjectIds=function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)},s.queryFeatureCount=function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)},s.queryExtent=function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((e=>({count:e.count,extent:y.fromJSON(e.extent)})))},s.setVisibility=function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()},s.update=function(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:i,removed:r}=this._tileStrategy.update(e);(i.length||r.length)&&this._proxy.updateTiles({added:i,removed:r}),t&&this.requestUpdate();const{state:n}=e;this._viewStateId!==n.id&&(this._proxy.setViewState(n),this._viewStateId=n.id),this.notifyChange("updating")},s.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new z.TileManager({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(x.init(this,"renderingConfigHash",(()=>this._update())),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(async e=>{this._set("_onGoingEdits",this._onGoingEdits+1),await this._proxy.onEdits(e),this._set("_onGoingEdits",Math.max(0,this._onGoingEdits-1))})),"attach")},s.detach=function(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null},s.moveStart=function(){this.requestUpdate()},s.viewChange=function(){this.requestUpdate()},s.moveEnd=function(){this.requestUpdate()},s.fetchPopupFeatures=async function(e,t){if(n.isSome(t)&&t.clientGraphics.length){const e=t.clientGraphics[0];if(e instanceof v)return[e]}const i=this.validateFetchPopupFeatures(t);if(i)throw i;if(n.isSome(t)&&0===t.clientGraphics.length)return[];const r=this.fetchClientPopupFeatures(t);if(!e)return r;const s=this._fetchServicePopupFeatures(e,t);return f.eachAlwaysValues([r,s]).then(h.flatten)},s._fetchServicePopupFeatures=async function(e,t){if("stream"===this.layer.type)return[];const i=await this.createPopupQuery(t),{layer:r}=this,{renderer:s}=r,o=n.isSome(t)?t.event:null,a=E.calculateTolerance({renderer:s,event:o});i.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a);const l=new Set,{objectIdField:u}=r,c=n.isSome(t)?t.clientGraphics:null;if(c)for(const e of c)l.add(e.attributes[u]);return r.queryFeatures(i).then((e=>e.features.filter((e=>!l.has(e.attributes[u])))))},s.createFetchPopupFeaturesQueryGeometry=function(e,t){return I.createQueryGeometry(e,t,this.view)},s.isUpdating=function(){return null!=this.layer.renderer&&(null!=this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||this._onGoingEdits>0)},s._createClientOptions=function(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}},s._createServiceOptions=async function(){const e=this.layer;if("stream"===e.type)return null;const{capabilities:t,objectIdField:i}=e,n=e.fields.map((e=>e.toJSON())),s=e.fullExtent&&e.fullExtent.toJSON(),o=T.toJSONGeometryType(e.geometryType),a=e.timeInfo&&e.timeInfo.toJSON()||null,l=e.spatialReference?e.spatialReference.toJSON():null,u="feature"===e.type?e.customParameters:null;let c;return"ogc-feature"===e.type?c=function(e){const{capabilities:t,collectionId:i,source:{layerDefinition:r},url:n}=e;return{capabilities:t,collectionId:i,url:n,layerDefinition:r}}(e):function(e){return e&&"openPorts"in e}(e.source)?c=await e.source.openPorts():e.parsedUrl&&(c=r.clone(e.parsedUrl),"dynamicDataSource"in e&&e.dynamicDataSource&&(c.query={layer:JSON.stringify({source:e.dynamicDataSource})})),{type:"on-demand",maxRecordCount:t.query.maxRecordCount,tileMaxRecordCount:t.query.tileMaxRecordCount,capabilities:t,fields:n,fullExtent:s,geometryType:o,objectIdField:i,source:c,timeInfo:a,spatialReference:l,customParameters:u}},s._createMemoryServiceOptions=async function(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:"memory",source:t}},s._cleanUpQuery=function(e){const t=w.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t},s._createUpdateClusterSizeTask=function(e,t){return this.watch("_aggregateValueRanges",(async i=>{this._updateClusterEffectiveRendererSizeVariable(e,t,i),this._updatingPipelineConfig||this.tileRenderer.onConfigUpdate(this._effectiveRenderer)}))},s._updateClusterEffectiveRendererSizeVariable=async function(e,t,i){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const r=O.findSizeVV(e.visualVariables);if(n.isSome(r)&&"cluster_count"===r.field){const n=e.visualVariables.indexOf(r);e.visualVariables[n]=O.createClusterCountSizeVariable(t,i);const s=e.clone();s.dynamicClusterSize=!0,this._set("_effectiveRenderer",s)}}},s._getEffectiveRenderer=function(){const e=this.layer.renderer,t=this.layer.featureReduction;if(n.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&O.isClusterCompatibleRenderer(e)){const i=t,r=[],s=O.createClusterRenderer(r,e,i,this._aggregateValueRanges);return n.andThen(this._updateClusterSizeTask,(e=>e.remove())),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,i),{renderer:s,aggregateFields:r,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}},s._acquireTile=function(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",(()=>{this.requestUpdate()})),t},s._releaseTile=function(e){this.tileRenderer.releaseTile(e)},s._initTileRenderer=async function(e){const t=await A.createOrReuseTileRenderer(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set("tileRenderer",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)},s._createTileRendererHash=function(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`},s._createFeatureDataHash=function(e,t,i){const r=e.getAttributeHash(),s=JSON.stringify(t),o=n.isSome(i)&&JSON.stringify(i.filter),a=JSON.stringify(this.timeExtent);let l="";return this._visibilityOverrides.forEach((e=>l+=e)),`${r}.${s}.${o}.${a}.${l}`},s._injectOverrides=function(e){const t=n.isSome(e)?e.timeExtent:null,i=n.isSome(this.timeExtent)&&n.isSome(t)?this.timeExtent.intersection(t):this.timeExtent||t;if(!this._visibilityOverrides.size&&!i)return e;const r=n.isSome(e)&&e.clone()||new k;return r.hiddenIds=this._visibilityOverrides,r.timeExtent=i,r},s._createConfiguration=function(e,t,i){const r="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s="feature"===this.layer.type?this.layer.gdbVersion:void 0,o=new Array(R.MAX_FILTERS),a=this._injectOverrides(t);o[0]=n.isSome(a)?a.toJSON():null,o[1]=n.isSome(i)&&i.filter?i.filter.toJSON():null;const l=q.createSchema(e);if(n.isNone(l))return null;const u=F();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:o,schema:l,supportsTextureFloat:u.supportsTextureFloat,maxTextureSize:u.maxTextureSize}},s._hasRequiredSupport=function(e){var t;return!("dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!F().supportsTextureFloat&&(G.error(new u("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))},s._onceTilesUpdated=function(){return this.requestUpdate(),x.whenFalseOnce(this,"_pipelineIsUpdating",!1)},s._lockGPUUploads=function(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()},s._unlockGPUUploads=function(){this.tileRenderer&&this.tileRenderer.unlockGPUUploads()},s._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()},s._update=function(){this.view.timeline.begin(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`);const e=this._doUpdate();this._updatingPromise=e;const t=()=>{e===this._updatingPromise&&this._set("_updatingPipelineConfig",!1),this.view&&this.view.timeline.end(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`)};e.then(t).catch((e=>{f.isAbortError(e)||G.error(e),t()}))},s._addHighlight=function(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch((e=>{f.isAbortError(e)||G.error(e)}))},s._removeHighlight=function(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch((e=>{f.isAbortError(e)||G.error(e)}))},s._createHittestResult=function(e){return e.layer=this.layer,e.sourceLayer=this.layer,n.isSome(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e},s._hitTest=async function(e,t){if(this.suspended||!this.tileRenderer)return null;const i=await this.tileRenderer.hitTest(e,t);if(0===i.length)return await f.after(1),null;const r=i[0];if(!(e=>(2147483648&e)>>>31==1)(r)){const e=await this._proxy.getFeature(r);return n.andThen(e,(e=>this._createHittestResult(g.fromJSON(e))))}const s=await this._proxy.getAggregate(r);if(n.isNone(s))return null;if(n.isSome(s.referenceId)){const e=await this._proxy.getFeature(s.referenceId);return n.andThen(e,(e=>this._createHittestResult(g.fromJSON(e))))}return this._createHittestResult(v.fromJSON(s))},e._createClass(i,[{key:"labelsVisible",get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}},{key:"effect",get:function(){return n.unwrapOr(this._effect,null)},set:function(e){const t=this._effect;n.isSome(t)&&n.isSome(t.filter)&&t.filter.enabled&&n.isSome(e)&&n.isSome(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,{definitionExpression:i,renderer:r,labelingInfo:s}=t,o="feature"===t.type?t.gdbVersion:void 0,a="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:l}=this,u="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,c=JSON.stringify(this.clips),p=t.featureReduction&&t.featureReduction.toJSON();return JSON.stringify({filterHash:n.isSome(this.filter)&&this.filter.toJSON(),effectHash:n.isSome(this.effect)&&this.effect.toJSON(),streamFilter:u,gdbVersion:o,definitionExpression:i,historicMoment:a,availableFields:e,renderer:r,labelingInfo:t.labelsVisible&&s,timeExtent:l,clipsHash:c,featureReduction:p})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}}]),i}(V.FeatureLayerView(S.RefreshableLayerView(U.LayerView2DMixin(M))));return t.__decorate([a.property()],j.prototype,"_proxy",void 0),t.__decorate([a.property()],j.prototype,"_pipelineIsUpdating",void 0),t.__decorate([a.property()],j.prototype,"_updatingPipelineConfig",void 0),t.__decorate([a.property()],j.prototype,"_effectiveRenderer",void 0),t.__decorate([a.property()],j.prototype,"_aggregateValueRanges",void 0),t.__decorate([a.property()],j.prototype,"_onGoingEdits",void 0),t.__decorate([a.property()],j.prototype,"_isRefreshing",void 0),t.__decorate([a.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],j.prototype,"labelsVisible",null),t.__decorate([a.property({type:k})],j.prototype,"filter",void 0),t.__decorate([a.property({type:C})],j.prototype,"effect",null),t.__decorate([a.property({readOnly:!0,dependsOn:["effect"]})],j.prototype,"effects",null),t.__decorate([a.property({dependsOn:["layer.renderer","layer.outFields","layer.definitionExpression","layer.gdbVersion?","layer.geometryDefinition?","layer.historicMoment?","layer.labelingInfo","layer.labelsVisible","layer.featureReduction","filter","effect","timeExtent","clips"]})],j.prototype,"renderingConfigHash",null),t.__decorate([a.property()],j.prototype,"tileRenderer",void 0),t.__decorate([a.property({dependsOn:["layer.renderer","tileRenderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_updatingRequiredFieldsPromise","_proxy","_proxy.isReady?","_onGoingEdits"]})],j.prototype,"updating",void 0),j=t.__decorate([l.subclass("esri.views.2d.layers.FeatureLayerView2D")],j),j}.apply(t,r))||(e.exports=n)},46351:(e,t,i)=>{var r,n;r=[t,i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(82438),i(24002),i(69788),i(85698),i(45168),i(57042),i(70034),i(96138)],void 0===(n=function(e,i,r,n,s,o,a,l,u,c,p,d,h,f,y,m,_,g,v){"use strict";const x=d.ofType({key:"type",base:y,typeMap:{rect:m,path:v,geometry:g}});t.LayerView2DMixin=e=>{let t=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).clips=new x,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}i._inheritsLoose(t,e);var r=t.prototype;return r.initialize=function(){var e;this.container||(this.container=new _.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([f.init(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),f.init(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),f.init(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),f.init(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))},r.destroy=function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1},r.isVisibleAtScale=function(e){let t=!0;const i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){let i=!r,s=!n;!i&&e<=r&&(i=!0),!s&&e>=n&&(s=!0),t=i&&s}return t},r.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())},r.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},r.isUpdating=function(){return!1},r.isRendering=function(){return!1},r.canResume=function(){return!!e.prototype.canResume.call(this)&&this.isVisibleAtScale(this.view.scale)},i._createClass(t,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]),t}(e);return r.__decorate([a.property({type:x,set(e){const t=h.referenceSetter(e,this._get("clips"),x);this._set("clips",t)}})],t.prototype,"clips",void 0),r.__decorate([a.property()],t.prototype,"moving",void 0),r.__decorate([a.property()],t.prototype,"attached",void 0),r.__decorate([a.property()],t.prototype,"container",void 0),r.__decorate([a.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"updateParameters",void 0),r.__decorate([a.property()],t.prototype,"updateRequested",void 0),r.__decorate([a.property({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),r.__decorate([a.property()],t.prototype,"view",void 0),t=r.__decorate([l.subclass("esri.views.2d.layers.LayerView2D")],t),t},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},74819:(e,t,i)=>{var r,n;r=[t,i(9720),i(90920),i(39241),i(29282),i(51361),i(61377)],void 0===(n=function(e,i,r,n,s,o,a){"use strict";const l={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},u=[0,0,0,0];function c(e,t){return null==e?t:e}const p={sdf:!0,code:99,metrics:n.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new s(0,0,24,24),page:0,textureBinding:2};async function d(e,t){if("simple-marker"===e.type){const i=Math.max(c(e.size,12),t);return f(e)+.707*i}if("picture-marker"===e.type){const i=Math.max(c(e.height,12),t),r=c(e.width,12)*(i/c(e.height,12))/2,n=i/2;return f(e)+Math.sqrt(r*r+n*n)}if("text"===e.type){const t=function(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[p]};const i=[];for(let r=0;r<t;r++)i.push({...p,code:e.text.charCodeAt(r)});return{glyphMosaicItems:i}}(e);a.getTextSymbolSize(u,e.toJSON(),t);const i=Math.abs(u[0]),r=Math.abs(u[1]),n=u[2],s=u[3];return Math.max(i,r)+Math.max(n,s)}if("simple-line"===e.type){const i=e,r=Math.max(c(i.width,.75),t)/2;return i.marker?Math.max(6*i.width,2*t):r}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(function(e,t){return null==e.outline?0:c(e.outline.width,0)}(e),t)/2;if("cim"===e.type){const t=o.CIMSymbolHelper.getEnvelope(e.data);return t?Math.sqrt(t.width*t.width+t.height*t.height):0}return"web-style"===e.type?d(await e.fetchCIMSymbol(),t):0}async function h(e,t){return function(e){return e.type in l}(e)?Math.min(await d(e,t),75):0}function f(e){const t=c(e.xoffset,0),i=c(e.yoffset,0);return Math.sqrt(t*t+i*i)}function y(e,t){return Math.max(e,t)}t.computePxBuffer=async function(e,t,n){if(!e||n&&"cluster"===n.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;const s=e.getSymbols(),o=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const t=e.getVisualVariablesForType("size");if(!t[0])return 0;const i=t[0];return"stops"===i.transformationType?i.stops.map((e=>e.size)).reduce(y,0):"clamped-linear"===i.transformationType?"number"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map((e=>e.size)).reduce(y,0):"real-world-size"===i.transformationType?30:void 0}(e),a=[];for(const e of s)a.push(h(e,o));const l=await i.all(a);return r.pt2px(l.reduce(y,0))},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},30012:(e,t,i)=>{var r;void 0===(r=function(e,r){"use strict";function n(e){return Object.freeze({__proto__:null,default:e})}t.createOrReuseTileRenderer=async function(e,t){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((await new Promise((function(e,t){Promise.all([i.e(9066),i.e(8520),i.e(9473),i.e(2662)]).then((function(){var t=[i(2560)];(function(t){e(n(t))}).apply(null,t)})).catch(t.bind(this))}))).default)(t);case"heatmap":return new((await new Promise((function(e,t){Promise.all([i.e(9066),i.e(8520),i.e(7739)]).then((function(){var t=[i(77739)];(function(t){e(n(t))}).apply(null,t)})).catch(t.bind(this))}))).default)(t)}},Object.defineProperty(r,"__esModule",{value:!0})}.apply(t,[i,t]))||(e.exports=r)},61377:(e,t,i)=>{var r,n;r=[t,i(74637),i(3718),i(56750),i(23084),i(52148),i(63629),i(57167),i(90920),i(18167),i(2707),i(10709),i(68904),i(38970),i(1422),i(81901),i(35561),i(69911),i(51361)],void 0===(n=function(e,i,r,n,s,o,a,l,u,c,p,d,h,f,y,m,_,g,v){"use strict";const x=Math.PI/180,b=.04,w=f.create(),S=y.create(),R=c.create(),F=y.create(),M=y.create(),E=y.create(),I=y.create(),O=y.create(),P=y.create(),T=y.create();function q(e,t,i,r,n,s){let o,a;const l=u.pt2px(i.xoffset),c=u.pt2px(i.yoffset),p=x*i.angle,f=x*s;switch(i.type){case"esriSMS":o=a=u.pt2px(i.size);break;case"esriPMS":o=u.pt2px(i.width),a=u.pt2px(i.height)}n<b&&(r=b*r/n);const y=h.identity(w);h.translate(y,y,d.set(S,e,t)),h.rotate(y,y,f-p),h.scale(y,y,d.set(S,r,-r)),h.translate(y,y,d.set(S,l,-c));const m=[0,0];d.transformMat2d(m,d.set(S,-.5*o,-.5*a),y);const _=[0,0];d.transformMat2d(_,d.set(S,-.5*o,.5*a),y);const g=[0,0];d.transformMat2d(g,d.set(S,.5*o,-.5*a),y);const v=[0,0];return d.transformMat2d(v,d.set(S,.5*o,.5*a),y),{rings:[[m,g,v,_,m]]}}function k(e,t,i,r,n,s){const o=v.CIMSymbolHelper.getEnvelope(i.data);if(!o)return null;n<b&&(r=b*r/n);const a=u.pt2px(o.width),l=u.pt2px(o.height),c=u.pt2px(o.x),p=u.pt2px(o.y),f=0*x,y=x*s,m=h.identity(w);h.translate(m,m,d.set(S,e,t)),h.rotate(m,m,y-f),h.scale(m,m,d.set(S,r,r));const _=[0,0];d.transformMat2d(_,d.set(S,c,p+l),m);const g=[0,0];d.transformMat2d(g,d.set(S,c,p),m);const R=[0,0];d.transformMat2d(R,d.set(S,c+a,p+l),m);const F=[0,0];return d.transformMat2d(F,d.set(S,c+a,p),m),{rings:[[_,R,F,g,_]]}}function C(e,t,i,r,n,s){const o=u.pt2px(i.xoffset),a=u.pt2px(i.yoffset),l=x*i.angle,c=x*s,p=h.identity(w);h.translate(p,p,d.set(S,e,t)),h.rotate(p,p,c),h.scale(p,p,d.set(S,n,-n));const f=r[0]+r[2]/2,y=r[1]+r[3]/2;h.translate(p,p,d.set(S,o,-a)),h.translate(p,p,d.set(S,f,y)),h.rotate(p,p,l),h.translate(p,p,d.set(S,-f,-y));const m=[0,0];d.transformMat2d(m,d.set(S,r[0],r[1]),p);const _=[0,0];d.transformMat2d(_,d.set(S,r[0],r[1]+r[3]),p);const g=[0,0];d.transformMat2d(g,d.set(S,r[0]+r[2],r[1]),p);const v=[0,0];return d.transformMat2d(v,d.set(S,r[0]+r[2],r[1]+r[3]),p),{rings:[[m,g,v,_,m]]}}function V(e){switch(e.symbol.type){case"esriSFS":case"esriPFS":{const t=e.symbol.outline;return t?t.width:0}case"esriSLS":return u.pt2px(e.symbol.width);case"esriSMS":return u.pt2px(e.symbol.size);case"esriPMS":return u.pt2px(Math.max(e.symbol.width,e.symbol.height));case"esriTS":{const t=[0,0,0,0];U(t,e.symbol,e.mosaicItem);const i=Math.max(Math.abs(t[0]),Math.abs(t[1]));return Math.max(t[2],t[3])+i}case"expanded-cim":{const t=v.CIMSymbolHelper.getEnvelope(e.symbol.data);return u.pt2px(Math.sqrt(t.width*t.width+t.height*t.height))}case"composite-symbol":{if(!e.symbol.layers.length)return 0;const t=e.symbol.layers.length-1;return V({symbol:e.symbol.layers[t],mosaicItem:null})}case"label":default:return 0}}function U(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;const r=g.bidiText(t.text)[1],n=i.glyphMosaicItems,s=_.shapeGlyphs(n,r,{scale:u.pt2px(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:m.getXAnchorDirection(t.horizontalAlignment||"center"),vAlign:m.getYAnchorDirection(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=u.pt2px(s.x-s.halfWidth),e[1]=u.pt2px(s.y-s.halfHeight),e[2]=u.pt2px(s.width),e[3]=u.pt2px(s.height),e}const A={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:s.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:s.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:s.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:s.WGS84}}};function L(e,t){return Math.ceil((e-t)/(2*t))}function N(e,t){const[i,r]=t.valid,n=2*r;let s,o=0;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n,o=s):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n,o=-s),{x:e,frameId:o}}function z(e,t){const{xmin:i,ymin:r,xmax:n,ymax:s}=t;return G(e,i,r)&&G(e,i,s)&&G(e,n,s)&&G(e,n,r)}function G(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function j(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=L(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=L(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=L(r,t);e.x+=i*(-2*t)}else if(r<i){const t=L(r,i);e.x+=t*(-2*i)}}return e}let H=function(){function e(){}return e.prototype.cut=function(e,t){let i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}const r=i.length,n=-2*t;for(let e=0;e<r;e++){const t=i[e];if(t&&t.length>=this.minPts){const e=[];for(const i of t)e.push([i[0]+n,i[1]]);i.push(e)}}return this.closed?e.rings=i:e.paths=i,e},e}();t.getBounds=function(e,t,i,r,s,o,u){if(!r||!i.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;const c=r;if(!l.isPoint(c)){a.getBoundsXY(e,c);let r=t[0];0===r&&(r=V(i),t[0]=r);const n=s*r/2;return e[0]-=n,e[1]-=n,e[2]+=n,e[3]+=n,e}{const r=c.x,a=c.y;"esriTS"===i.symbol.type&&0===t[2]&&0===t[3]&&U(t,i.symbol,i.mosaicItem),function(e,t,i,r,s,o,a,l){let u;switch(r.type){case"esriSMS":case"esriPMS":u=q(t,i,r,o,a,0);break;case"esriTS":u=C(t,i,r,s,o,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":u=k(t,i,r,o,a,0)}let c,d,h=0;for(let e=0;e<u.rings[0].length-1;e++)d=u.rings[0][e],c=(t-d[0])*(t-d[0])+(i-d[1])*(i-d[1]),h=Math.max(h,c);h=Math.sqrt(h);let f=p.normalizeMapX(t-h,l),y=p.normalizeMapX(t+h,l);if(f>y){const e=n.getInfo(l);if(e){const[t,i]=e.valid;f=t,y=i}}e[0]=f,e[1]=i-h,e[2]=y,e[3]=i+h}(e,r,a,i.symbol,t,s,o,u)}return e},t.getCIMMarkerBounds=k,t.getMarkerSymbolBounds=q,t.getTextSymbolBounds=C,t.getTextSymbolSize=U,t.graphicGeometryToNumber=function(e){switch(r.unwrap(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.isPointOnPolyline=function(e,t,i,r){d.set(E,t,i);const n=e.paths;let s,o,a,l,u,c,p,h,f,y=1/0;for(let e=0;e<n.length;e++){const m=n[e];if(!(m.length<2))for(let e=1;e<m.length;e++)s=m[e-1][0],a=m[e-1][1],o=m[e][0],l=m[e][1],u=Math.min(s,o)-r,c=Math.min(a,l)-r,p=Math.max(s,o)+r,h=Math.max(a,l)+r,t<u||t>p||i<c||i>h||(d.set(F,s,a),d.set(M,o,l),d.subtract(I,M,F),d.subtract(O,F,E),d.scale(P,I,d.dot(I,O)/d.dot(I,I)),d.subtract(T,O,P),f=d.dot(T,T),y>f&&(y=f))}return Math.sqrt(y)<=r},t.normalizeCentralMeridian=function(e){let t,i,r,s,u,c,p,d,h,f=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,i=n.getInfo(t),!i)return e.toJSON();r=t.isWebMercator,c=r?102100:4326,s=A[c].maxX,u=A[c].minX,p=A[c].plus180Line,d=A[c].minus180Line;const y=e.toJSON();if(l.isPoint(y))h=j(y,s,u);else if(l.isMultipoint(y))y.points=y.points.map((e=>j(e,s,u))),h=y;else if(l.isExtent(y))h=function(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:r,ymax:n}=e,s=e.xmax-e.xmin,o=e.xmin,a=e.xmax;let l;const[u,c]=t.valid;l=N(e.xmin,t);const p=l.x,d=l.frameId;l=N(e.xmax,t);const h=l.x,f=l.frameId,y=p===h&&s>0;if(s>2*c){const e={xmin:o<a?p:h,ymin:r,xmax:c,ymax:n},t={xmin:u,ymin:r,xmax:o<a?h:p,ymax:n},s={xmin:0,ymin:r,xmax:c,ymax:n},l={xmin:u,ymin:r,xmax:0,ymax:n},y=[],m=[];z(e,s)&&y.push(d),z(e,l)&&m.push(d),z(t,s)&&y.push(f),z(t,l)&&m.push(f);for(let e=d+1;e<f;e++)y.push(e),m.push(e);i.push({extent:e,frameIds:[d]},{extent:t,frameIds:[f]},{extent:s,frameIds:y},{extent:l,frameIds:m})}else p>h||y?i.push({extent:{xmin:p,ymin:r,xmax:c,ymax:n},frameIds:[d]},{extent:{xmin:u,ymin:r,xmax:h,ymax:n},frameIds:[f]}):i.push({extent:{xmin:p,ymin:r,xmax:h,ymax:n},frameIds:[d]});return i}(e,t).map((e=>e.extent));return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}(y,i);else if(l.isPolygon(y)||l.isPolyline(y)){const e=R;a.getBoundsXY(e,y);const t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=L(t.xmin,u)*(2*s),r=0===i?y:function(e,t){const i=function(e){return l.isPolygon(e)?e.rings:e.paths}(e);for(const e of i)for(const i of e)i[0]+=t;return e}(y,i);t.xmin+=i,t.xmax+=i,o.extentIntersectsPolyline(t,p)&&t.xmax!==s||o.extentIntersectsPolyline(t,d)&&t.xmin!==u?f=r:h=r}else h=e.clone();return null!==f?(new H).cut(f,s):h},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},30939:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(9720),i(96349),i(51972)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c,p,d){"use strict";let h=function(t){function i(e){var i;return(i=t.call(this,e)||this)._startupResolver=c.createResolver(),i.isReady=!1,i}e._inheritsLoose(i,t);var r=i.prototype;return r.initialize=function(){this._controller=c.createAbortController(),this.addResolvingPromise(this._startWorker(this._controller.signal))},r.destroy=function(){this._controller.abort(),this._connection&&this._connection.close()},r.startup=async function(e,t,i){await this.when();const r=this._controller.signal,n=(s=i.source,Array.isArray(s)?{transferList:i.source,signal:r}:void 0);var s;const o={service:i,config:t,tileInfo:e.tileInfo.toJSON()};await this._connection.invoke("startup",o,n),this._startupResolver.resolve(),this._set("isReady",!0)},r.updateTiles=async function(e){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("updateTiles",e))},r.update=async function(e,t){const i={config:e,pause:t};return await this._startupResolver.promise,this._connection.invoke("update",i)},r.invalidate=async function(e){return await this._startupResolver.promise,this._connection.invoke("invalidate",e)},r.resume=async function(){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("controller.resume"))},r.setHighlight=async function(e){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",e))},r.refresh=async function(){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("controller.refresh"))},r.setViewState=async function(e){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("setViewState",e.toJSON()))},r.queryFeatures=async function(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",e.toJSON(),t)},r.queryObjectIds=async function(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)},r.queryFeatureCount=async function(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)},r.queryExtent=async function(e,t){return this._connection.invoke("controller.queryExtent",e.toJSON(),t)},r.queryLatestObservations=async function(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)},r.queryStatistics=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",e)},r.getObjectId=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.getObjectId",e)},r.getDisplayId=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",e)},r.getFeature=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.getFeature",e)},r.getAggregate=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregate",e)},r.getAggregateValueRanges=async function(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")},r.mapValidDisplayIds=async function(e){return await this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",e)},r.onEdits=async function(e){await this._startupResolver.promise;const{addedFeatures:t,deletedFeatures:i,updatedFeatures:r}=e;return c.ignoreAbortErrors(this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:i,updatedFeatures:r}))},r.enableEvent=async function(e,t){return await this._startupResolver.promise,c.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:e,value:t}))},r._startWorker=async function(e){try{this._connection=await d.open("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(e){c.throwIfNotAbortError(e)}},e._createClass(i,[{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}}]),i}(p.EsriPromise);return t.__decorate([s.property()],h.prototype,"isReady",void 0),t.__decorate([s.property()],h.prototype,"client",void 0),t.__decorate([s.property()],h.prototype,"tileRenderer",null),h=t.__decorate([o.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],h),h}.apply(t,r))||(e.exports=n)},67768:(e,t,i)=>{var r,n;r=[t,i(3718),i(11286),i(73692)],void 0===(n=function(e,i,r,n){"use strict";let s=function(){function e(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}var t=e.prototype;return t.destroy=function(){},t.clear=function(){this._tiles.forEach((e=>this._releaseTile(e)))},t.tileKeys=function(){const e=[];return this._tiles.forEach(((t,i)=>e.push(i))),e},t.update=function(e){const t=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),{spans:i,lodInfo:s}=t,{level:o}=s,a=[],l=[],u=new Set,c=new Set;for(const{row:e,colFrom:t,colTo:n}of i)for(let i=t;i<=n;i++){const t=r.getId(o,e,s.normalizeCol(i),s.getWorldForColumn(i)),n=this._getOrAcquireTile(a,t);u.add(t),n.isReady?n.visible=!0:c.add(n.key)}return c.forEach((e=>this._addPlaceholders(u,e))),this._tiles.forEach((e=>{u.has(e.key.id)||(l.push(e.key.id),this._releaseTile(e))})),n.pool.release(t),{hasMissingTiles:c.size>0,added:a,removed:l}},t._getOrAcquireTile=function(e,t){if(!this._tiles.has(t)){const i=this.acquireTile(new r(t));e.push(t),this._tiles.set(t,i),i.visible=!1}return this._tiles.get(t)},t._getTile=function(e){return this._tiles.get(e)},t._releaseTile=function(e){this._tiles.delete(e.key.id),this.releaseTile(e)},t._addPlaceholders=function(e,t){const i=this._addPlaceholderChildren(e,t);Math.abs(1-i)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)},t._addPlaceholderChildren=function(e,t){let i=0;return this._tiles.forEach((r=>{i+=this._addPlaceholderChild(e,r,t)})),i},t._addPlaceholderChild=function(e,t,i){return t.key.level<=i.level||!t.hasData||!i.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-i.level)))},t._addPlaceholderParent=function(e,t){let r=t.getParentKey(),n=0,s=null;for(;i.isSome(r);){if(e.has(r.id))return!0;const t=this._getTile(r.id);if(null!=t&&t.isReady)return t.visible=!0,e.add(t.key.id),!0;null!=t&&t.hasData&&t.patchCount>n&&(n=t.patchCount,s=t),r=r.getParentKey()}return!!s&&(s.visible=!0,e.add(s.key.id),!0)},e}();t.TileManager=s,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},89453:(e,t,i)=>{var r,n;r=[t,i(58797),i(11285),i(74637),i(3718),i(73462),i(67059),i(26475),i(99752),i(49359),i(4037),i(51916),i(18377),i(9720),i(27006),i(12808),i(69788),i(8336),i(909),i(69675),i(99045),i(28575)],void 0===(n=function(e,i,r,n,s,o,a,l,u,c,p,d,h,f,y,m,_,g,v,x,b,w){"use strict";const S=o.getLogger("esri.views.layers.FeatureLayerView");t.FeatureLayerView=e=>{let t=function(e){function t(...t){var i;return(i=e.call(this,...t)||this)._updatingRequiredFieldsPromise=null,i.effect=null,i.filter=null,i.timeExtent=null,i.layer=null,i.requiredFields=[],i.view=null,i}i._inheritsLoose(t,e);var r=t.prototype;return r.initialize=function(){_.init(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","timeExtent"],(()=>this._handleRequiredFieldsChange()),!0)},r.highlight=function(e){throw new Error("missing implementation")},r.createQuery=function(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=s.isSome(this.filter)?this.filter.createQuery(e):new v(e);return s.isSome(this.timeExtent)&&(t.timeExtent=s.isSome(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t},r.queryFeatures=function(e,t){throw new Error("missing implementation")},r.queryObjectIds=function(e,t){throw new Error("missing implementation")},r.queryFeatureCount=function(e,t){throw new Error("missing implementation")},r.queryExtent=function(e,t){throw new Error("missing implementation")},r._loadArcadeModules=function(e){if(e.get("expressionInfos.length"))return y.loadArcade()},r._handleRequiredFieldsChange=function(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))},r._updateRequiredFields=async function(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fields:i,objectIdField:r,renderer:n,displayField:o}}=this,a=t.featureReduction,l=new Set,u=await f.eachAlways([n?n.collectRequiredFields(l,i):null,m.collectLabelingFields(l,t),e?m.collectElevationFields(l,t):null,s.isSome(this.filter)?m.collectFilterFields(l,t,this.filter):null,this.effect?m.collectFilterFields(l,t,this.effect.filter):null,a?m.collectFeatureReductionFields(l,t,a):null]);t.timeInfo&&this.timeExtent&&m.collectFields(l,t.fields,[t.timeInfo.startField,t.timeInfo.endField]);for(const e of u)e.error&&S.error(e.error);m.collectField(l,i,r),e&&o&&m.collectField(l,i,o);const c=Array.from(l).sort();this._set("requiredFields",c)},r.validateFetchPopupFeatures=function(e){const{layer:t,layer:{popupEnabled:i}}=this;return i?w.getFetchPopupTemplate(this.layer,e)?void 0:new c("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new c("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})},r.fetchClientPopupFeatures=async function(e){const t=s.isSome(e)?e.clientGraphics:null;if(!t||0===t.length)return f.resolve([]);const i=[],r=[],{layer:n}=this,o=w.getFetchPopupTemplate(n,e);if(!s.isSome(o))return f.resolve([]);const a=await this._loadArcadeModules(o),l=a&&a.arcadeUtils.hasGeometryOperations(o),u=await this.createPopupQuery(e),c=m.unpackFieldNames(n.fields,u.outFields);for(const e of t)l||!m.featureHasFields(c,e)?r.push(e):i.push(e);return"stream"===n.type||0===r.length?f.resolve(i):(u.objectIds=r.map((e=>e.attributes[n.objectIdField])),n.queryFeatures(u).then((e=>i.concat(e.features))).catch((()=>r)))},r.createPopupQuery=async function(e){const t=this.layer,i=t.createQuery(),r=w.getFetchPopupTemplate(t,e),n=s.isSome(r)&&await this._loadArcadeModules(r),o=s.isSome(r)&&n&&n.arcadeUtils.hasGeometryOperations(r),a=!("point"!==t.geometryType&&!o);return i.returnGeometry=a,i.returnZ=a,i.returnM=a,i.outFields=await w.getRequiredFields(this.layer,r),i.outSpatialReference=this.view.spatialReference,i},r.canResume=function(){return!(!e.prototype.canResume.call(this)||s.isSome(this.timeExtent)&&this.timeExtent.isEmpty)},i._createClass(t,[{key:"availableFields",get:function(){const{layer:e,layer:{fields:t},requiredFields:i}=this;return"outFields"in e&&e.outFields?m.fixFields(t,[...m.unpackFieldNames(t,e.outFields),...i]):m.fixFields(t,i)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){S.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]),t}(e);return r.__decorate([l.property()],t.prototype,"_updatingRequiredFieldsPromise",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),r.__decorate([l.property({type:b})],t.prototype,"effect",void 0),r.__decorate([l.property({type:x})],t.prototype,"filter",void 0),r.__decorate([l.property(g.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),r.__decorate([l.property()],t.prototype,"layer",void 0),r.__decorate([l.property({type:Number})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([l.property({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([l.property({readOnly:!0})],t.prototype,"requiredFields",void 0),r.__decorate([l.property({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),r.__decorate([l.property()],t.prototype,"view",void 0),t=r.__decorate([u.subclass("esri.views.layers.FeatureLayerView")],t),t},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},75885:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(37862),i(59286),i(52521),i(96349),i(74474)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c,p,d,h,f){"use strict";let y=function(t){function i(e){var i;return(i=t.call(this,e)||this).layer=null,i.parent=null,i}e._inheritsLoose(i,t);var n=i.prototype;return n.initialize=function(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw r.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}}))},n.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},n.getSuspendInfo=function(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e},n.isUpdating=function(){return!1},e._createClass(i,[{key:"fullOpacity",get:function(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}}]),i}(f.HandleOwnerMixin(d.IdentifiableMixin(h.EsriPromiseMixin(p.EventedMixin(c)))));return t.__decorate([s.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],y.prototype,"fullOpacity",null),t.__decorate([s.property()],y.prototype,"layer",void 0),t.__decorate([s.property()],y.prototype,"parent",void 0),t.__decorate([s.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],y.prototype,"suspended",null),t.__decorate([s.property({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],y.prototype,"suspendInfo",null),t.__decorate([s.property({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],y.prototype,"legendEnabled",null),t.__decorate([s.property({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],y.prototype,"updating",null),t.__decorate([s.property({dependsOn:["layer.visible"]})],y.prototype,"visible",null),y=t.__decorate([o.subclass("esri.views.layers.LayerView")],y),y}.apply(t,r))||(e.exports=n)},85698:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(56162)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c){"use strict";let p=function(t){function i(){return t.apply(this,arguments)||this}return e._inheritsLoose(i,t),i}(c.JSONSupport);return p=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],p),p}.apply(t,r))||(e.exports=n)},45168:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(85698)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c){"use strict";var p;let d=p=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return e._inheritsLoose(i,t),i.prototype.clone=function(){return new p({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},e._createClass(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(c);return t.__decorate([s.property({type:[Number,String],json:{write:!0}})],d.prototype,"left",void 0),t.__decorate([s.property({type:[Number,String],json:{write:!0}})],d.prototype,"right",void 0),t.__decorate([s.property({type:[Number,String],json:{write:!0}})],d.prototype,"top",void 0),t.__decorate([s.property({type:[Number,String],json:{write:!0}})],d.prototype,"bottom",void 0),t.__decorate([s.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],d.prototype,"version",null),d=p=t.__decorate([o.subclass("esri.views.layers.support.ClipRect")],d),d}.apply(t,r))||(e.exports=n)},70034:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(27572),i(12997),i(50257),i(57167),i(26016),i(85698)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c,p,d,h,f,y){"use strict";var m;const _={base:c,key:"type",typeMap:{extent:p,polygon:d}};let g=m=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).type="geometry",e.geometry=null,e}return e._inheritsLoose(i,t),i.prototype.clone=function(){return new m({geometry:this.geometry.clone()})},e._createClass(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(y);return t.__decorate([s.property({types:_,json:{read:h.fromJSON,write:!0}})],g.prototype,"geometry",void 0),t.__decorate([s.property({readOnly:!0,dependsOn:["geometry"]})],g.prototype,"version",null),g=m=t.__decorate([o.subclass("esri.views.layers.support.Geometry")],g),g}.apply(t,r))||(e.exports=n)},96138:(e,t,i)=>{var r,n;r=[i(58797),i(11285),i(74637),i(73462),i(67059),i(26475),i(99752),i(4037),i(51916),i(18377),i(85698)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,c){"use strict";let p=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).type="path",e.path=[],e}return e._inheritsLoose(i,t),e._createClass(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(c);return t.__decorate([s.property({type:[[[Number]]],json:{write:!0}})],p.prototype,"path",void 0),t.__decorate([s.property({readOnly:!0,dependsOn:["path"]})],p.prototype,"version",null),p=t.__decorate([o.subclass("esri.views.layers.support.Path")],p),p}.apply(t,r))||(e.exports=n)},28575:(e,t,i)=>{var r,n;r=[t,i(3718),i(12808)],void 0===(n=function(e,i,r){"use strict";t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:i.isSome(t)&&t.defaultPopupTemplateEnabled&&i.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null},t.getRequiredFields=async function(e,t=e.popupTemplate){if(!i.isSome(t))return[];const n=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:s}=t,{objectIdField:o,typeIdField:a,globalIdField:l,relationships:u}=e;if(n.includes("*"))return["*"];const c=s?await r.getFeatureEditFields(e):[],p=r.fixFields(e.fields,[...n,...c]);return a&&p.push(a),p&&o&&r.hasField(e.fields,o)&&-1===p.indexOf(o)&&p.push(o),p&&l&&r.hasField(e.fields,l)&&-1===p.indexOf(l)&&p.push(l),u&&u.forEach((t=>{const{keyField:i}=t;p&&i&&r.hasField(e.fields,i)&&-1===p.indexOf(i)&&p.push(i)})),p},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)},87515:(e,t,i)=>{var r,n;r=[t,i(3718),i(12997),i(26016),i(35477),i(80498)],void 0===(n=function(e,i,r,n,s,o){"use strict";function a(e,t,n,o=new r){let a;if("2d"===n.type)a=t*n.resolution;else if("3d"===n.type){const r=n.overlayPixelSizeInMapUnits(e),o=n.basemapSpatialReference;a=i.isSome(o)&&!o.equals(n.spatialReference)?s.getMetersPerUnitForSR(o)/s.getMetersPerUnitForSR(n.spatialReference):t*r}const l=e.x-a,u=e.y-a,c=e.x+a,p=e.y+a,{spatialReference:d}=n;return o.xmin=Math.min(l,c),o.ymin=Math.min(u,p),o.xmax=Math.max(l,c),o.ymax=Math.max(u,p),o.spatialReference=d,o}const l=new r;t.createQueryGeometry=a,t.intersectsDrapedGeometry=function(e,t,r){const n=r.toMap(e);return!i.isNone(n)&&a(n,o.calculateTolerance(),r,l).intersects(t)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,r))||(e.exports=n)}}]);